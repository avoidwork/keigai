/*
 2014 Jason Mulligan
 @version 1.0.2
 */
!function(a){var b,c,d,e,f,g,h,i,j,k=a.document,l=a.location,m=a.navigator,n="undefined"!=typeof process,o="undefined"!=typeof Blob&&"undefined"!=typeof Worker,p=10,q=100,r=500,s=["readystatechange","abort","load","loadstart","loadend","error","progress","timeout"];n?(g=require("url"),c=require("http"),d=require("https"),f=require("mongodb").MongoClient,b=require("util").format,"undefined"==typeof Promise&&(Promise=require("es6-promise").Promise),"undefined"==typeof Storage&&(localStorage=require("localStorage")),"undefined"==typeof XMLHttpRequest&&(XMLHttpRequest=null),"undefined"==typeof btoa&&(btoa=require("btoa"))):"undefined"==typeof Buffer&&(Buffer=function(){}),e=function(){"use strict";function b(a){this.cache={},this.max=a||1e3,this.first=null,this.last=null,this.length=0}function e(a){this.next=null,this.previous=null,this.value=a}function t(a){this.limit=a||p,this.listeners={},this.hooks={}}function u(){this.observer=null}function v(a){this.observer=H.factory(),this.defer=P.factory(),this.xhr=a}function w(a,b,c){this.debounce=c,this.element=a,this.filters={},this.list=b,this.observer=H.factory()}function x(a,store,b,c,d,e){var f;d.order&&!string.isEmpty(d.order)&&(f=string.explode(d.order).map(function(a){return a.replace(regex.after_space,"")})),this.element=Q.create("section",{"class":"grid"},a),this.fields=b,this.filter=null,this.filtered=e===!0,this.list=null,this.observer=H.factory(),this.options=d||{},this.store=store,this.sortable=c||[],this.sortOrder=f||c||[]}function y(a,store,b){this.callback=null,this.current=[],this.element=a,this.emptyMsg=S.noData,this.filter=null,this.filtered=[],this.id=utility.genId(),this.items=[],this.listFilter=null,this.mutation=null,this.observer=H.factory(),this.pageIndex=1,this.pageSize=null,this.pageRange=5,this.pagination="bottom",this.placeholder="",this.order="",this.records=[],this.template=b,this.total=0,this.store=store,this.where=null}function z(){var a=this;this.promise=V.factory(),this.onDone=[],this.onAlways=[],this.onFail=[],this.promise.then(function(b){array.each(a.onDone,function(a){a(b)}),array.each(a.onAlways,function(a){a(b)}),a.onAlways=[],a.onDone=[],a.onFail=[]},function(b){array.each(a.onFail,function(a){a(b)}),array.each(a.onAlways,function(a){a(b)}),a.onAlways=[],a.onDone=[],a.onFail=[]})}function A(){this.autosave=!1,this.callback=null,this.credentials=null,this.lists=[],this.events=!0,this.expires=null,this.headers={Accept:"application/json"},this.ignore=[],this.index=[],this.indexes={key:{}},this.key=null,this.loaded=!1,this.mongodb="",this.observer=H.factory(),this.records=[],this.source=null,this.total=0,this.versions={},this.versioning=!0,this.views={},this.uri=null}function B(){var a,b,e,f,g,h,i=0,j=1,k=2,l=3,m=4,n=/ECONNREFUSED/,o=new RegExp(k+"|"+l);return b={"user-agent":"keigai/1.0.2 node.js/"+process.versions.node.replace(/^v/,"")+" ("+string.capitalize(process.platform)+" V8/"+process.versions.v8+" )","content-type":"text/plain",accept:"*/*"},e=function(a){var b="on"+a;return"function"==typeof this[b]&&this[b](),this.dispatchEvent(a),this},h=function(a){return this.readyState!==a&&(this.readyState=a,e.call(this,"readystatechange"),this.readyState!==m||this._error||(e.call(this,"load"),e.call(this,"loadend"))),this},f=function(a){var b=this;h.call(this,k),this.status=a.statusCode,this._resheaders=a.headers,this._resheaders["set-cookie"]&&this._resheaders["set-cookie"]instanceof Array&&(this._resheaders["set-cookie"]=this._resheaders["set-cookie"].join(";")),a.on("data",function(c){a.setEncoding("utf8"),b._send&&(c&&(b.responseText+=c),h.call(b,l))}),a.on("end",function(){b._send&&(h.call(b,m),b._send=!1)})},g=function(a){this.status=n.test(a.message)?503:500,this.statusText="",this.responseText=a.message,this._error=!0,this._send=!1,e.call(this,"error"),h.call(this,m)},a=function(){this.onabort=null,this.onerror=null,this.onload=null,this.onloadend=null,this.onloadstart=null,this.onreadystatechange=null,this.readyState=i,this.response=null,this.responseText="",this.responseType="",this.responseXML=null,this.status=i,this.statusText="",this.observer=H.factory(),this._error=!1,this._headers={},this._params={},this._request=null,this._resheaders={},this._send=!1},a.prototype=I.factory(),a.prototype.constructor=a,a.prototype.abort=function(){return null!==this._request&&(this._request.abort(),this._request=null,this.responseText="",this.responseXML="",this._error=!0,this._headers={},(this._send===!0||o.test(this.readyState))&&(this._send=!1,h.call(this,m)),e.call(this,"abort"),this.readyState=i),this},a.prototype.getAllResponseHeaders=function(){var a="";if(this.readyState<k)throw new Error(S.invalidStateNoHeaders);return utility.iterate(this._resheaders,function(b,c){a+=c+": "+b+"\n"}),a},a.prototype.getResponseHeader=function(a){var b;if(this.readyState<k||this._error)throw new Error(S.invalidStateNoHeaders);return b=this._resheaders[a]||this._resheaders[a.toLowerCase()]},a.prototype.open=function(a,c,d,e,f){var g=this;if(d!==!0)throw new Error(S.invalidStateNoSync);return this.abort(),this._error=!1,this._params={method:a,url:c,async:d||!0,user:e||null,password:f||null},utility.iterate(b,function(a,b){g._headers[b]=a}),this.readyState=j,this},a.prototype.overrideMimeType=function(a){return this._headers["content-type"]=a,this},a.prototype.send=function(a){a=a||null;var b,h,i,k,l=this;if(this.readyState<j)throw new Error(S.invalidStateNotOpen);if(this._send)throw new Error(S.invalidStateNotSending);if(h=utility.parse(this._params.url),h.port=h.port||("https:"===h.protocol?443:80),null!==this._params.user&&null!==this._params.password&&(h.auth=this._params.user+":"+this._params.password),regex.put_post.test(this._params.method))if(null===a)this._headers["content-length"]=0;else if("string"==typeof a)this._headers["content-length"]=Buffer.byteLength(a);else{if(!(a instanceof Buffer||"function"==typeof a.toString))throw new Error(S.invalidArguments);a=a.toString(),this._headers["content-length"]=Buffer.byteLength(a)}return this._headers.host=h.host,"XMLHttpRequest"===this._headers["x-requested-with"]&&delete this._headers["x-requested-with"],b={hostname:h.hostname,path:h.path,port:h.port,method:this._params.method,headers:this._headers},"https:"===h.protocol&&(b.rejectUnauthorized=!1,b.agent=!1),h.auth&&(b.auth=h.auth),this._send=!0,e.call(this,"readystatechange"),k="http:"===h.protocol?c:d,i=k.request(b,function(a){f.call(l,a)}).on("error",function(a){g.call(l,a)}),null===a?i.setSocketKeepAlive(!0):i.write(a,"utf8"),this._request=i,i.end(),e.call(this,"loadstart"),this},a.prototype.setRequestHeader=function(a,b){if(this.readyState!==j)throw new Error(S.invalidStateNotUsable);if(this._send)throw new Error(S.invalidStateNotSending);return this._headers[a.toLowerCase()]=b,this},a}function C(){if(n)XMLHttpRequest=B();else{if(K.version=K.version(),K.ie&&K.version<9)throw new Error(S.upgrade);void 0===Element.prototype.getElementsByClassName&&(Element.prototype.getElementsByClassName=function(a){return k.querySelectorAll("."+a)}),k.documentElement.classList||!function(a){var b,c,d,e,f;if("HTMLElement"in a||"Element"in a)if(b=function(a){var b=string.explode(a.className," "),c=this;array.each(b,function(a){c.push(a)}),this.updateClassName=function(){a.className=this.join(" ")}},c=function(){return new b(this)},d=b.prototype=[],e=(a.HTMLElement||a.Element).prototype,d.add=function(a){array.contains(this,a)||(this.push(a),this.updateClassName())},d.contains=function(a){return array.contains(this,a)},d.remove=function(a){array.contains(this,a)&&(array.remove(this,a),this.updateClassName())},d.toggle=function(a){array[array.contains(this,a)?"remove":"add"](this,a),this.updateClassName()},Object.defineProperty)f={get:c,enumerable:!0,configurable:!0},Object.defineProperty(e,"classList",f);else{if(!Object.prototype.__defineGetter__)throw new Error("Could not create classList shim");e.__defineGetter__("classList",c)}}(a)}E=Object.prototype.hasOwnProperty,F=Array.prototype.slice,o&&(j=a.URL.createObjectURL(utility.blob("var "+string.fromObject(array,"array")+", "+string.fromObject(regex,"regex")+", "+string.fromObject(string,"string")+", "+string.fromObject(utility,"utility")+"; onmessage = "+store.worker.toString()+";"))),i=(new Date).getTime(),h=a.requestAnimationFrame||function(a){var b=(new Date).getTime()-i;utility.defer(function(){a(b)},16,b)}}var D,E,F,regex={after_space:/\s+.*/,allow:/^allow$/i,allow_cors:/^access-control-allow-methods$/i,and:/^&/,args:/\((.*)\)/,auth:/\/\/(.*)\@/,bool:/^(true|false)?$/,caps:/[A-Z]/,cdata:/\&|<|>|\"|\'|\t|\r|\n|\@|\$/,checked_disabled:/checked|disabled/i,complete_loaded:/^(complete|loaded)$/i,csv_quote:/^\s|\"|\n|,|\s$/,del:/^del/,domain:/^[\w.-_]+\.[A-Za-z]{2,}$/,down:/down/,endslash:/\/$/,eol_nl:/\n$/,element_update:/id|innerHTML|innerText|textContent|type|src/,get_headers:/^(head|get|options)$/,get_remove_set:/get|remove|set/,hash:/^\#/,header_replace:/:.*/,header_value_replace:/.*:\s+/,html:/^<.*>$/,http_body:/200|201|202|203|206/,http_ports:/80|443/,host:/\/\/(.*)\//,ie:/msie|ie|\.net|windows\snt/i,ip:/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,is_xml:/^<\?xml.*\?>/,json_maybe:/json|plain|javascript/,json_wrap:/^[\[\{]/,klass:/^\./,no:/no-store|no-cache/i,not_dotnotation:/-|\s/,not_endpoint:/.*\//,null_undefined:/null|undefined/,number:/(^-?\d\d*\.\d*$)|(^-?\d\d*$)|(^-?\.\d\d*$)|number/,number_format_1:/.*\./,number_format_2:/\..*/,number_present:/\d{1,}/,number_string:/number|string/i,number_string_object:/number|object|string/i,object_type:/\[object Object\]/,patch:/^patch$/,primitive:/^(boolean|function|number|string)$/,priv:/private/,protocol:/^(.*)\/\//,put_post:/^(post|put)$/i,radio_checkbox:/^(radio|checkbox)$/i,root:/^\/[^\/]/,select:/select/i,selector_is:/^:/,selector_complex:/\s+|\>|\+|\~|\:|\[/,set_del:/^(set|del|delete)$/,space_hyphen:/\s|-/,string_object:/string|object/i,svg:/svg/,top_bottom:/top|bottom/i,url:/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/i,word:/^\w+$/,xdomainrequest:/^(get|post)$/i,xml:/xml/i},G={factory:function(a){return new b(a)}};b.prototype.constructor=b,b.prototype.evict=function(){return null!==this.last&&this.remove(this.last),this},b.prototype.get=function(a){var b=this.cache[a];if(void 0!==b)return this.set(a,b.value),b.value},b.prototype.remove=function(a){var b=this.cache[a];return b&&(delete this.cache[a],this.length--,null!==b.previous&&(this.cache[b.previous].next=b.next),null!==b.next&&(this.cache[b.next].previous=b.previous),this.first===a&&(this.first=b.previous),this.last===a&&(this.last=b.next)),b},b.prototype.set=function(a,b){var c=this.remove(a);return void 0===c?c=new e(b):c.value=b,c.next=null,c.previous=this.first,this.cache[a]=c,null!==this.first&&(this.cache[this.first].next=a),this.first=a,null===this.last&&(this.last=a),++this.length>this.max&&this.evict(),this},e.prototype.constructor=e;var H={factory:function(a){return new t(a)}};t.prototype.constructor=t,t.prototype.dispatch=function(){var a=array.cast(arguments),b=a.shift();return b&&this.listeners[b]&&utility.iterate(this.listeners[b],function(b){b.handler.apply(b.scope,a)}),this},t.prototype.hook=function(a,b){var c=this;if("function"!=typeof a.addEventListener)throw new Error(S.invalidArguments);return utility.genId(a),this.hooks[a.id]=function(a){c.dispatch(b,a)},a.addEventListener(b,this.hooks[a.id],!1),a},t.prototype.off=function(a,b){return this.listeners[a]&&(b?delete this.listeners[a][b]:delete this.listeners[a]),this},t.prototype.on=function(a,b,c,d){if(c=c||utility.uuid(),d=d||this,this.listeners[a]||(this.listeners[a]={}),array.keys(this.listeners[a]).length>=this.limit)throw new Error("Possible memory leak, more than "+this.limit+" listeners for event: "+a);return this.listeners[a][c]={scope:d,handler:b},this},t.prototype.once=function(a,b,c,d){var e=this;return c=c||utility.uuid(),d=d||this,this.on(a,function(){b.apply(d,[].concat(array.cast(arguments))),e.off(a,c)},c,d)},t.prototype.unhook=function(a,b){return a.removeEventListener(b,this.hooks[a.id],!1),delete this.hooks[a.id],a};var I={factory:function(){return new u}};u.prototype.constructor=u,u.prototype.addEventListener=function(a,b,c,d){return this.observer.on(a,b,c,d||this),this},u.prototype.addListener=function(a,b,c,d){return this.observer.on(a,b,c,d||this),this},u.prototype.dispatch=function(){return this.observer.dispatch.apply(this.observer,[].concat(array.cast(arguments))),this},u.prototype.dispatchEvent=function(){return this.observer.dispatch.apply(this.observer,[].concat(array.cast(arguments))),this},u.prototype.emit=function(){return this.observer.dispatch.apply(this.observer,[].concat(array.cast(arguments))),this},u.prototype.hook=function(){return this.observer.hook.apply(this.observer,[].concat(array.cast(arguments))),this},u.prototype.listeners=function(a){return a?this.observer.listeners[a]:this.listeners},u.prototype.off=function(a,b){return this.observer.off(a,b),this},u.prototype.on=function(a,b,c,d){return this.observer.on(a,b,c,d||this),this},u.prototype.once=function(a,b,c,d){return this.observer.once(a,b,c,d||this),this},u.prototype.removeEventListener=function(a,b){return this.observer.off(a,b),this},u.prototype.removeListener=function(a,b){return this.observer.off(a,b),this};var array={add:function(a,b){return array.contains(a,b)||a.push(b),a},binIndex:function(a,b){for(var c,d,e=0,f=a.length-1;f>=e;)if(c=Math.floor((e+f)/2),d=a[c],b>d)e=c+1;else{if(!(d>b))return c;f=c-1}return-1},cast:function(a,b){b=b===!0;var c=[];return isNaN(a.length)?b?c=array.keys(a):utility.iterate(a,function(a){c.push(a)}):c=F.call(a),c},chunk:function(a,b){for(var c=[],d=U.round(a.length/b,"up"),e=0,f=-1;++f<d;)e=f*b,c.push(array.limit(a,e,b));return c},clear:function(a){return a.length>0?array.remove(a,0,a.length):a},clone:function(a,b){return utility.clone(a,b!==!1)},contains:function(a,b){return a.indexOf(b)>-1},collect:function(a,b){var c=[];return array.each(a,function(a){c.push(b(a))}),c},compact:function(a,b){b=b===!0;var c;return c=a.filter(function(a){return!regex.null_undefined.test(a)}),b?c.length<a.length?c:null:c},count:function(a,b){return a.filter(function(a){return a===b}).length},diff:function(a,b){var c=[];return array.each(a,function(a){array.contains(b,a)||array.add(c,a)}),array.each(b,function(b){array.contains(a,b)||array.add(c,b)}),c},each:function(a,b,c,d){var e,f,g=a.length;if(c!==!0)for(e=-1;++e<g&&b.call(a,a[e],e)!==!1;);else d=d||10,f=0,d>g&&(d=g),utility.repeat(function(){for(var c,e=-1;++e<d;)if(c=e+f,c===g||b.call(a,a[c],c)===!1)return!1;return f+=d,f>=g?!1:void 0},void 0,void 0,!1);return a},eachReverse:function(a,b,c,d){var e,f,g=a.length;if(c!==!0)for(e=g;--e>-1&&b.call(a,a[e],e)!==!1;);else d=d||10,f=g-1,d>g&&(d=g),utility.repeat(function(){for(var c,e=-1;++e<d;)if(c=f-e,0>c||b.call(a,a[c],c)===!1)return!1;return f-=d,0>f?!1:void 0},void 0,void 0,!1);return a},empty:function(a){return 0===a.length},equal:function(a,b){return R.encode(a)===R.encode(b)},fib:function(a){var b,c=[1,1],d=c[0],e=c[1];if(a=(a||100)-1,isNaN(a)||2>a)throw new Error(S.invalidArguments);for(;--a;)b=d+e,d=e,e=b,c.push(b);return c},fill:function(a,b,c,d){var e="function"==typeof b,f=a.length,g=isNaN(c)?0:c,h=isNaN(d)?f-1:g+d;for(h>f-1&&(h=f-1);h>=g;)a[g]=e?b(a[g]):b,g++;return a},first:function(a){return a[0]},flat:function(a){var b=[];return b=a.reduce(function(a,b){return a.concat(b)},b)},forEach:function(a,b,c,d){return array.each(a,b,c,d)},fromObject:function(a){return array.mingle(array.keys(a),array.cast(a))},index:function(a,b){return a.indexOf(b)},indexed:function(a){var b=[];return utility.iterate(a,function(a){b.push(a)}),b},intersect:function(a,b){var c=a.length>b.length?a:b,d=c===a?b:a;return c.filter(function(a){return array.contains(d,a)})},keepIf:function(a,b){var c=[],d=[];return c=a.filter(b),d=array.diff(a,c),array.each(d,function(b){array.remove(a,array.index(a,b))}),a},keys:function(a){return Object.keys(a)},keySort:function(a,b,c){b=b.replace(/\s*asc/gi,"").replace(/\s*desc/gi," desc");var d=string.explode(b).map(function(a){return a.split(" ")}),e=[],f='["',g='"]';return c=c&&""!==c?"."+c:"",array.each(d,function(a){var b=".",d="";regex.not_dotnotation.test(a[0])&&(b=f,d=g),e.push("try {"),"desc"===a[1]?(e.push("if ( a"+c+b+a[0]+d+" < b"+c+b+a[0]+d+" ) return 1;"),e.push("if ( a"+c+b+a[0]+d+" > b"+c+b+a[0]+d+" ) return -1;")):(e.push("if ( a"+c+b+a[0]+d+" < b"+c+b+a[0]+d+" ) return -1;"),e.push("if ( a"+c+b+a[0]+d+" > b"+c+b+a[0]+d+" ) return 1;")),e.push("} catch (e) {"),e.push("try {"),e.push("if ( a"+c+b+a[0]+d+" !== undefined ) return "+("desc"===a[1]?"-1":"1")+";"),e.push("} catch (e) {}"),e.push("try {"),e.push("if ( b"+c+b+a[0]+d+" !== undefined ) return "+("desc"===a[1]?"1":"-1")+";"),e.push("} catch (e) {}"),e.push("}")}),e.push("return 0;"),a.sort(new Function("a","b",e.join("\n")))},last:function(a,b){var c=a.length-1;return b>=c+1?a:isNaN(b)||1===b?a[c]:array.limit(a,c- --b,c)},limit:function(a,b,c){var d=[],e=b-1,f=b+c,g=a.length;if(g>0)for(;++e<f&&g>e;)d.push(a[e]);return d},max:function(a){return array.last(a.sort(array.sort))},mean:function(a){return a.length>0?array.sum(a)/a.length:void 0},median:function(a){var b=a.length,c=U.round(b/2,"down"),d=a.sort(array.sort);return U.odd(b)?d[c]:(d[c-1]+d[c])/2},merge:function(a,b){return array.each(b,function(b){array.add(a,b)}),a},min:function(a){return a.sort(array.sort)[0]},mingle:function(a,b){var c;return c=a.map(function(a,c){return[a,b[c]]})},mode:function(a){var b,c,d={},e=0,f=[];return array.each(a,function(a){isNaN(d[a])?d[a]=1:d[a]++}),e=array.max(array.cast(d)),utility.iterate(d,function(a,b){a===e&&f.push(U.parse(b))}),b=f.length,b>0&&(c=1===b?f[0]:f),c},percents:function(a,b,c){var d,e,f,g=[],h=!1;return b=b||0,void 0===c?c=array.sum(a):h=!0,array.each(a,function(a){g.push(U.parse((a/c*100).toFixed(b)))}),h||(f=array.sum(g),100>f?(e=U.parse(U.diff(f,100).toFixed(b)),d=array.last(g)+e,g[g.length-1]=d):f>100&&(e=U.parse(U.diff(f,100).toFixed(b)),d=U.parse((array.last(g)-e).toFixed(b)),g[g.length-1]=d)),g},range:function(a){return array.max(a)-array.min(a)},rassoc:function(a,b){var c;return array.each(a,function(d,e){return d[1]===b?(c=a[e],!1):void 0}),c},reject:function(a,b){return array.diff(a,a.filter(b))},remove:function(a,b,c){if(isNaN(b)){if(b=a.indexOf(b),-1===b)return a}else b=b||0;var d=a.length,e=a.slice((c||b)+1||d);return a.length=0>b?d+b:b,a.push.apply(a,e),a},removeIf:function(a,b){var c=a.filter(b);return array.each(c,function(b){array.remove(a,array.index(a,b))}),a},removeWhile:function(a,b){var c=[];return array.each(a,function(a){return b(a)===!1?!1:void c.push(a)}),array.each(c,function(b){array.remove(a,array.index(a,b))}),a},replace:function(a,b){return array.remove(a,0,a.length),array.each(b,function(b){a.push(b)}),a},rest:function(a,b){return b=b||1,1>b&&(b=1),array.limit(a,b,a.length)},rindex:function(a,b){var c=-1;return array.each(a,function(a,d){a===b&&(c=d)}),c},rotate:function(a,b){var c,d=a.length;return 0===b?c=a:(0>b?b+=d:b--,c=array.limit(a,b,d),c=c.concat(array.limit(a,0,b))),c},series:function(a,b,c){a=a||0,b=b||a,c=c||1;for(var d=[],e=-1,f=Math.max(0,Math.ceil((b-a)/c));++e<f;)d[e]=a,a+=c;return d},sort:function(a,b){var c,d,e,f={a:typeof a,b:typeof b};return"number"===f.a&&"number"===f.b?e=a-b:(c=a.toString(),d=b.toString(),e=d>c?-1:c>d?1:f.a===f.b?0:"boolean"===f.a?-1:1),e},sorted:function(a){return a.sort(array.sort)},split:function(a,b){var c=[],d=a.length,e=Math.ceil(d/b),f=Math.floor(d/b),g=Math.ceil(d/e),h=!1,i=0,j=-1;for(U.diff(d,b*e)>e?g=d-f*b+f-1:d%b>0&&g*e>=d&&g--;++j<b;)j>0&&(i+=e),!h&&b>g&&j===g&&(--e,h=!0),c.push(array.limit(a,i,e));return c},stddev:function(a){return Math.sqrt(array.variance(a))},sum:function(a){var b=0;return a.length>0&&(b=a.reduce(function(a,b){return a+b})),b},take:function(a,b){return array.limit(a,0,b)},toObject:function(a){for(var b={},c=a.length;c--;)b[c.toString()]=a[c];return b},total:function(a){return array.indexed(a).length},unique:function(a){var b=[];return array.each(a,function(a){array.add(b,a)}),b},variance:function(a){var b,c=a.length,d=0;return c>0?(b=array.mean(a),array.each(a,function(a){d+=T.sqr(a-b)}),d/c):d},zip:function(a,b){var c=[];return b instanceof Array||(b="object"==typeof b?array.cast(b):[b]),array.each(b,function(a,b){a instanceof Array||(this[b]=[a])}),array.each(a,function(a,d){c[d]=[a],array.each(b,function(a){c[d].push(a[d]||null)})}),c}},J={lru:G.factory(r),expire:function(a){return J.lru.cache[a]?(J.lru.remove(a),!0):!1},expired:function(a){var b=J.lru.cache[a];return b&&b.value.expires<(new Date).getTime()},get:function(a,b){a=utility.parse(a).href;var c=J.lru.get(a);return c?b!==!1&&J.expired(a)?(J.expire(a),!1):utility.clone(c,!0):!1},set:function(a,b,c){a=utility.parse(a).href;var d=J.lru.get(a);return d||(d={permission:0}),"permission"===b?d.permission|=c:"!permission"===b?d.permission&=~c:d[b]=c,J.lru.set(a,d),d}};v.prototype=I.factory(),v.prototype.constructor=v;var K={ie:function(){return!n&&regex.ie.test(m.userAgent)}(),version:function(){var a=0;return this.ie&&(a=m.userAgent.replace(/(.*msie|;.*)/gi,""),a=U.parse(string.trim(a)||9,10)),a},allows:function(a,b){if(string.isEmpty(a)||string.isEmpty(b))throw new Error(S.invalidArguments);a=utility.parse(a).href,b=b.toLowerCase();var c=!1,d=0;return J.get(a,!1)?(regex.del.test(b)?d=1:regex.get_headers.test(b)?d=4:regex.put_post.test(b)?d=2:regex.patch.test(b)&&(d=8),c=Boolean(K.permissions(a,b).bit&d)):c=void 0,c},bit:function(a){var b=0;return array.each(a,function(a){a=a.toLowerCase(),regex.get_headers.test(a)?b|=4:regex.put_post.test(a)?b|=2:regex.patch.test(a)?b|=8:regex.del.test(a)&&(b|=1)}),b},cors:function(a){return!n&&a.indexOf("//")>-1&&-1===a.indexOf("//"+l.host)},headers:function(a,b,c){var d=string.trim(a.getAllResponseHeaders()).split("\n"),e={},f={},g=null,h=new Date,i=K.cors(b);return array.each(d,function(a){var b=a.split(": ");e[b[0].toLowerCase()]=string.trim(b[1]),null===g&&(!i&&regex.allow.test(b)||i&&regex.allow_cors.test(b))&&(g=b[1])}),h=regex.no.test(e["cache-control"])?h.getTime():e["cache-control"]&&regex.number_present.test(e["cache-control"])?h.setSeconds(h.getSeconds()+U.parse(regex.number_present.exec(e["cache-control"])[0],10)):e.expires?new Date(e.expires).getTime():h.getTime(),f.expires=h,f.headers=e,f.timestamp=new Date,f.permission=K.bit(null!==g?string.explode(g):[c]),"get"===c&&(J.set(b,"expires",f.expires),J.set(b,"headers",f.headers),J.set(b,"timestamp",f.timestamp),J.set(b,"permission",f.permission)),f},parse:function(a,b){b=b||"";var c,d;return(regex.json_maybe.test(b)||string.isEmpty(b))&&regex.json_wrap.test(a.responseText)&&Boolean(d=R.decode(a.responseText,!0))?c=d:"text/csv"===b?c=L.decode(a.responseText):"text/tsv"===b?c=L.decode(a.responseText,"	"):regex.xml.test(b)?("text/xml"!==b&&a.overrideMimeType("text/xml"),c=a.responseXML):c="text/plain"===b&&regex.is_xml.test(a.responseText)&&W.valid(a.responseText)?W.decode(a.responseText):a.responseText,c},permissions:function(a){var b=J.get(a,!1),c=b?b.permission:0,d={allows:[],bit:c,map:{partial:8,read:4,write:2,"delete":1,unknown:0}};return 1&c&&d.allows.push("DELETE"),2&c&&(d.allows.push("POST"),d.allows.push("PUT")),4&c&&d.allows.push("GET"),8&c&&d.allows.push("PATCH"),d},jsonp:function(b,c){var d,e,f=P.factory(),g="callback";void 0===D&&(a.keigai||(a.keigai={callback:{}}),D="keigai"),c instanceof Object&&!c.callback&&(g=c.callback);do d=utility.genId().slice(0,10);while(a.callback[d]);return b=b.replace(g+"=?",g+"="+D+".callback."+d),a.callback[d]=function(b){utility.clearTimers(d),delete a.callback[d],f.resolve(b),Q.destroy(e)},e=Q.create("script",{src:b,type:"text/javascript"},utility.dom("head")[0]),utility.defer(function(){f.reject(void 0)},3e4,d),f},kxhr:function(a){var b=new v(a);return array.each(array.keys(z.prototype),function(a){b[a]=function(){return b.defer[a].apply(b.defer,array.cast(arguments))}}),array.each(s,function(a){b.hook(b.xhr,a)}),b},request:function(a,b,c,d){var e,f,g,h,i,j,k,l;if(b=b||"GET",(regex.put_post.test(b)||regex.patch.test(b))&&void 0===c)throw new Error(S.invalidArguments);if(a=utility.parse(a).href,b=b.toLowerCase(),d=d instanceof Object?d:null,e=K.cors(a),f=K.kxhr(!K.ie||!e||K.version>9?new XMLHttpRequest:new XDomainRequest),g=(regex.put_post.test(b)||regex.patch.test(b))&&c?c:null,h="get"===b?J.get(a):!1,i=null,j="undefined"!=typeof Document,k="undefined"!=typeof ArrayBuffer,l="undefined"!=typeof Blob,e&&K.ie&&9===K.version&&!regex.xdomainrequest.test(b))throw new Error(S.notAvailable);return f.on("readystatechange",function(a){switch(this.xhr.readyState){case 1:this.dispatch("beforeXHR",this.xhr,a);break;case 4:this.dispatch("afterXHR",this.xhr,a)}}),e||regex.get_headers.test(b)||K.allows(a,b)!==!1||(utility.delay(function(){f.dispatch("beforeXHR",f.xhr,null),f.dispatch("afterXHR",f.xhr,null)}),f.xhr.status=405,f.reject(null)),"get"===b&&Boolean(h)?(n&&(f.xhr.readyState=4,f.xhr.status=200,f.xhr._resheaders=h.headers),utility.delay(function(){f.dispatch("beforeXHR",f.xhr,null),f.dispatch("afterXHR",f.xhr,null)}),f.resolve(h.response)):utility.delay(function(){f.xhr.open(b.toUpperCase(),a,!0),null!==d&&d.hasOwnProperty("content-type")&&(i=d["content-type"]),e&&null===i&&(i="text/plain"),null!==g&&(g.hasOwnProperty("xml")&&(g=g.xml),j&&g instanceof Document&&(g=W.decode(g)),"string"==typeof g&&regex.is_xml.test(g)&&(i="application/xml"),k&&g instanceof ArrayBuffer||l&&g instanceof Blob||g instanceof Buffer||!(g instanceof Object)||(i="application/json",g=R.encode(g)),null===i&&(k&&g instanceof ArrayBuffer||l&&g instanceof Blob)&&(i="application/octet-stream"),null===i&&(i="application/x-www-form-urlencoded; charset=UTF-8")),(!K.ie||!e||K.version>9)&&(null===d&&(d={}),"object"==typeof h&&h.headers.hasOwnProperty("etag")&&(d.etag=h.headers.etag),null!==i&&(d["content-type"]=i),d.hasOwnProperty("callback")&&delete d.callback,d["x-requested-with"]="XMLHttpRequest",utility.iterate(d,function(a,b){null!==a&&"withCredentials"!==b&&f.xhr.setRequestHeader(b,a)}),"boolean"==typeof f.xhr.withCredentials&&null!==d&&"boolean"==typeof d.withCredentials&&(f.xhr.withCredentials=d.withCredentials)),f.on("load",function(){var c,d,e,f,g=this,h=K.ie&&void 0===this.xhr.readyState,i=!0;if(h||4!==this.xhr.readyState)h&&(d=K.parse(this.xhr,"text/plain"),J.set(a,"permission",K.bit(["get"])),J.set(a,"response",d),this.resolve(d));else switch(this.xhr.status){case 200:case 201:case 202:case 203:case 204:case 205:case 206:if(c=K.headers(this.xhr,a,b),"head"===b)return this.resolve(c.headers);if("options"===b)return this.resolve(c.headers);switch("delete"!==b?(n&&regex.priv.test(c.headers["cache-control"])&&(i=!1),regex.http_body.test(this.xhr.status)&&(e=c.headers["content-type"]||"",d=K.parse(this.xhr,e),void 0===d&&this.reject(new Error(S.serverError))),"get"===b&&i?J.set(a,"response",c.response=utility.clone(d,!0)):J.expire(a,!0)):"delete"===b&&J.expire(a,!0),this.xhr.status){case 200:case 202:case 203:case 206:this.resolve(d);break;case 201:void 0!==c.headers.location&&!string.isEmpty(c.headers.location)||string.isUrl(d)?(f=string.trim(c.headers.Location||d),K.request(f).then(function(a){g.resolve(a)},function(a){g.reject(a)})):this.resolve(d);break;case 204:case 205:this.resolve(null)}break;case 304:this.resolve(d);break;case 401:this.reject(new Error(this.xhr.responseText||S.serverUnauthorized));break;case 403:J.set(a,"!permission",K.bit([b])),this.reject(new Error(this.xhr.responseText||S.serverForbidden));break;case 405:J.set(a,"!permission",K.bit([b])),this.reject(new Error(this.xhr.responseText||S.serverInvalidMethod));break;default:this.reject(new Error(this.xhr.responseText||S.serverError))}}),f.on("error",function(a){this.reject(a)}),f.xhr.send(null!==g?g:void 0)}),f},scroll:function(a,b){var c=P(),d=K.scrollPos(),e=0;return b=(isNaN(b)?250:b)/100,utility.repeat(function(){var b=T.bezier(d[0],d[1],a[0],a[1],++e/100);return window.scrollTo(b[0],b[1]),100===e?(c.resolve(!0),!1):void 0},b,"scrolling"),c},scrollPos:function(){return[window.scrollX||0,window.scrollY||0]}},L={decode:function(a,b){b=b||",";for(var c,d,e,regex=new RegExp(b+'(?=(?:[^"]|"(?:[^"])[^"]*")*$)'),f=string.trim(a).split("\n"),g=f.shift().split(b),h=[],i=f.length,j=g.length,k=-1;++k<i;){for(d={},e=f[k].split(regex),c=-1;++c<j;)d[g[c]]=utility.coerce((e[c]||"").replace(/^"|"$/g,""));h.push(d)}return h},encode:function(a,b,c){function d(a){var c;return a instanceof Array?(c='"'+a.toString()+'"',regex.object_type.test(c)&&(c='"'+L.encode(a,b)+'"')):c=a instanceof Object?'"'+L.encode(a,b)+'"':regex.csv_quote.test(a)?'"'+a.replace(/"/g,'""')+'"':a,c}var e=R.decode(a,!0)||a,f="";return b=b||",",c=c!==!1,e instanceof Array?e[0]instanceof Object?(c&&(f=array.keys(e[0]).join(b)+"\n"),f+=e.map(function(a){return L.encode(a,b,!1)}).join("\n")):f+=d(e,b)+"\n":(c&&(f=array.keys(e).join(b)+"\n"),f+=array.cast(e).map(d).join(b)+"\n"),f.replace(regex.eol_nl,"")}},M={factory:function(a,b,c,d){var e,f=[b];if(d=d||250,!(a instanceof Element)||b&&!b.store||"string"!=typeof c||string.isEmpty(c))throw new Error(S.invalidArguments);return e=new w(a,f[0],d).set(c),Q.attr(a,"type","text"),e.observer.hook(e.element,"keyup"),e.observer.hook(e.element,"input"),e.on("keyup",e.update,"keyup"),e.on("input",e.update,"input"),e}};w.prototype=I.factory(),w.prototype.constructor=w,w.prototype.set=function(a){var b={};return array.each(string.explode(a),function(a){b[a]=""}),this.filters=b,this},w.prototype.teardown=function(){return this.observer.unhook(this.element,"keyup"),this.observer.unhook(this.element,"input"),this},w.prototype.update=function(){var a=this;return utility.defer(function(){var b=Q.val(a.element).toString();a.list.dispatch("beforeFilter",a.element,b),string.isEmpty(b)?a.list.filter=null:(utility.iterate(a.filters,function(a,c){var d=string.explode(b);d=d.filter(function(a){return!string.isEmpty(a)}),array.each(d,function(a,b){this[b]="^.*"+string.escape(a).replace(/(^\*|\*$)/g,"").replace(/\*/g,".*")+".*"}),this[c]=d.join(",")}),a.list.filter=a.filters),a.list.pageIndex=1,a.list.refresh(),a.list.dispatch("afterFilter",a.element)},this.debounce,this.element.id+"Debounce"),this};var N={factory:function(a,store,b,c,d,e,f){var g,h,i,j,k,l,m=[store];return g=new x(a,m[0],b,c,d,e),h="",i=Q.create("li",{},Q.create("ul",{"class":"header"},g.element)),j=100/g.fields.length+"%",k="display:inline-block;width:"+j,l=g.options.order?string.explode(g.options.order):[],array.each(g.fields,function(a){var b=a.replace(/.*\./g,""),c=Q.create("span",{innerHTML:string.capitalize(string.unCamelCase(string.unhyphenate(b,!0)).replace(/_|-/g," "),!0),style:k,"data-field":a},i);array.contains(g.sortable,a)&&(Q.klass(c,"sortable",!0),l.filter(function(b){return 0===b.indexOf(a)}).length>0&&Q.data(c,"sort",array.contains(l,a+" desc")?"desc":"asc")),h+='<span class="'+a+'" data-field="'+a+'" style="'+k+'">{{'+a+"}}</span>"}),g.sortable.length>0&&g.observer.hook(i.parentNode,"click",g.sort,"sort",g),m.push(O.factory(g.element,m[0],h,g.options)),g.list=m[1],g.filtered===!0&&(m.push(M.factory(Q.create("input",{"class":"filter",placeholder:"Filter"},g.element,"first"),m[1],g.fields.join(","),f||250)),g.filter=m[2]),g.on("beforeRefresh",function(a){Q.dispatch(a,"beforeRefresh")},"bubble"),g.on("afterRefresh",function(a){Q.dispatch(a,"afterRefresh")},"bubble"),g.on("click",function(a){Q.hasClass(a.currentTarget,"header")&&g.sort(a)},"header"),g.list.on("change",function(){g.dispatch.apply(g,["change"].concat(array.cast(arguments)))
},"change"),g.list.on("beforeFilter",function(){g.dispatch.apply(g,["beforeFilter"].concat(array.cast(arguments)))},"beforeFilter"),g.list.on("afterFilter",function(){g.dispatch.apply(g,["afterFilter"].concat(array.cast(arguments)))},"afterFilter"),g}};x.prototype=I.factory(),x.prototype.constructor=x,x.prototype.add=function(a){var b=this;return this.store.set(null,a).then(null,function(a){utility.error(a),b.dispatch("error",a)}),this},x.prototype.dump=function(){return this.store.dump(this.list.records,this.fields)},x.prototype.refresh=function(){var a=[],b=this;return this.dispatch("beforeRefresh",this.element),this.sortOrder.length>0&&(array.each(this.sortOrder,function(c){var d=Q.find(b.element,".header span[data-field='"+c+"']")[0];a.push(string.trim(c+" "+(Q.data(d,"sort")||"")))}),this.options.order=this.list.order=a.join(", ")),this.list.where=null,utility.merge(this.list,this.options),this.list.refresh(),this.dispatch("afterRefresh",this.element),this},x.prototype.remove=function(a){var b=this;return this.store.del(a).then(null,function(a){utility.error(a),b.dispatch("error",a)}),this},x.prototype.sort=function(a){var b,c=utility.target(a);return utility.stop(a),Q.hasClass(c,"sortable")&&(b=Q.data(c,"field"),Q.data(c,"sort","asc"===Q.data(c,"sort")?"desc":"asc"),array.remove(this.sortOrder,b),this.sortOrder.splice(0,0,b),this.refresh()),this},x.prototype.teardown=function(){return null!==this.filter&&(this.filter.teardown(),this.filter=null),this.list.teardown(),this.observer.unhook(Q.find(this.element,".header")[0],"click"),Q.destroy(this.element),this.element=null,this},x.prototype.update=function(a,b){var c=this;return this.store.update(a,b).then(null,function(a){utility.error(a),c.dispatch("error",a)}),this};var O={factory:function(a,store,b,c){var d,e=[store];if(!(a instanceof Element&&"object"==typeof store&&regex.string_object.test(typeof b)))throw new Error(S.invalidArguments);return d=new y(Q.create("ul",{"class":"list"},a),e[0],b),c instanceof Object&&(c.listFiltered&&c.listFilter&&(d.listFilter=M.factory(Q.create("input",{id:d.element.id+"-filter","class":"filter",placeholder:"Filter"},a,"first"),d,c.listFilter,c.debounce||250),delete c.listFilter,delete c.listFiltered),utility.merge(d,c)),d.store.lists.push(d),d.on("beforeRefresh",function(a){Q.dispatch(a,"beforeRefresh")},"bubble"),d.on("afterRefresh",function(a){Q.dispatch(a,"afterRefresh")},"bubble"),d.on("change",function(a){Q.dispatch(d.element,"change",a)},"change"),d.on("click",function(a){var b,c=utility.target(a);utility.stop(a),"A"===c.nodeName&&(b=Q.data(c,"page"),isNaN(b)||d.page(b))},"pagination"),"function"==typeof MutationObserver&&(d.mutation=new MutationObserver(function(a){d.dispatch("change",a)}),d.mutation.observe(d.element,{childList:!0,subtree:!0})),(null===d.store.uri||d.store.loaded)&&d.refresh(),d},pages:function(){if(isNaN(this.pageSize))throw new Error(S.invalidArguments);return Math.ceil((this.filter?this.filtered.length:this.total)/this.pageSize)},range:function(){var a=this.pageIndex*this.pageSize-this.pageSize,b=this.pageSize;return[a,b]}};y.prototype=I.factory(),y.prototype.constructor=y,y.prototype.add=function(a){var b=this;return this.store.set(null,a).then(null,function(a){utility.error(a),b.dispatch("error",a)}),this},y.prototype.dump=function(){return this.store.dump(this.records)},y.prototype.page=function(a){return this.pageIndex=a,this.refresh()},y.prototype.pages=function(){var a,b=this,c=this.element,d=this.pageIndex,e=this.pagination,f=this.pageRange,g=Math.floor(f/2),h=d-g,i=d+g,j=O.pages.call(this);if(!regex.top_bottom.test(e))throw new Error(S.invalidArguments);return array.each(utility.dom("#"+c.id+"-pages-top, #"+c.id+"-pages-bottom"),function(a){a&&(b.observer.unhook(a,"click"),Q.destroy(a))}),this.filter&&0===this.filtered.length||0===this.total||1===j?this:(1>h&&(a=U.diff(h,1),h+=a,i+=a),i>j&&(i=j,h=i-f+1,1>h&&(h=1)),U.diff(h,i)>=f&&--i,array.each(string.explode(e),function(a){var e,f,g=!1,k=d>1,l=j>=d+1,m=d>=j;for(e=Q.create("ul",{"class":"list pages hidden "+a,id:c.id+"-pages-"+a},c,"bottom"===a?"after":"before"),Q.create(k?"a":"span",{"class":"first page","data-page":1,innerHTML:"&lt;&lt;"},Q.create("li",{},e)),Q.create(k?"a":"span",{"class":"prev page","data-page":d-1,innerHTML:"&lt;"},Q.create("li",{},e)),f=h;i>=f;f++)g=f===d,Q.create(g?"span":"a",{"class":g?"current page":"page","data-page":f,innerHTML:f},Q.create("li",{},e));Q.create(l?"a":"span",{"class":"next page","data-page":l?d+1:null,innerHTML:"&gt;"},Q.create("li",{},e)),Q.create(m?"span":"a",{"class":"last page","data-page":m?null:j,innerHTML:"&gt;&gt;"},Q.create("li",{},e)),Q.klass(e,"hidden",!1),b.observer.hook(e,"click")}),this)},y.prototype.refresh=function(a){var b,c,d,e=this,f=this.element,g="object"==typeof this.template,h=null!==this.filter,i=[],j="function"==typeof this.callback,k=new RegExp,l=[],m=[];return a=a===!0,this.dispatch("beforeRefresh",f),b=g?function(a){var b=R.encode(e.template),c=array.unique(b.match(/\{\{[\w\.\-\[\]]+\}\}/g));return b=b.replace("{{"+e.store.key+"}}",a.key),array.each(c,function(c){var d=c.replace(/\{\{|\}\}/g,""),e=utility.walk(a.data,d)||"";k.compile(string.escape(c),"g"),b=b.replace(k,R.encode(e).replace(/(^")|("$)/g,""))}),b=R.decode(b.replace(/\{\{.*\}\}/g,e.placeholder)),{li:b}}:function(a){var b=e.template,c=array.unique(b.match(/\{\{[\w\.\-\[\]]+\}\}/g));return b=b.replace("{{"+e.store.key+"}}",a.key),array.each(c,function(c){var d=c.replace(/\{\{|\}\}/g,""),e=utility.walk(a.data,d);void 0===e&&(e=""),k.compile(string.escape(c),"g"),b=b.replace(k,e)}),b=b.replace(/\{\{.*\}\}/g,e.placeholder),'<li data-key="'+a.key+'">'+b+"</li>"},d=function(a){if(e.records=a,e.total=e.records.length,e.filtered=[],e.current=[],h&&array.each(e.records,function(a){utility.iterate(e.filter,function(b,c){var d,f;return array.contains(l,a.key)?!1:(b=string.explode(b),d=new RegExp,f=c===e.store.key,void array.each(b,function(b){var g=f?"":utility.walk(a.data,c);return utility.compile(d,b,"i"),f&&d.test(a.key)||d.test(g)?(l.push(a.key),e.filtered.push(a),!1):void 0}))})}),null===e.pageSize||isNaN(e.pageIndex)||isNaN(e.pageSize))e.current=h?e.filtered:e.records;else{if(c=O.pages.call(e),c>0&&e.pageIndex>c)return e.page(c);e.total>0&&(m=O.range.call(e),e.current=array.limit(h?e.filtered:e.records,m[0],m[1]))}array.each(e.current,function(a){var c=b(a),d=btoa(c);i.push({key:a.key,template:c,hash:d})}),utility.render(function(){var a,b,c=[],d=[];if(0===i.length)Q.html(f,'<li class="empty">'+e.emptyMsg+"</li>");else if(0===e.items.length)Q.html(f,i.map(function(a){return a.template}).join("")),j&&array.each(array.cast(f.childNodes),function(a){e.callback(a)});else{if(array.each(i,function(a,b){void 0!==e.items[b]&&e.items[b].hash!==a.hash?(Q.data(Q.html(f.childNodes[b],a.template.replace(/<li data-key=\"\d+\">|<\/li>/g,"")),"key",a.key),d.push(b)):void 0===e.items[b]&&(Q.create(a.template,null,f),d.push(b))}),i.length<e.items.length){for(a=i.length-1,b=e.items.length;++a<b;)c.push(a);array.each(c.reverse(),function(a){Q.destroy(f.childNodes[a])})}j&&array.each(d,function(a){e.callback(f.childNodes[a])})}e.items=i,null===e.pageSize||!regex.top_bottom.test(e.pagination)||isNaN(e.pageIndex)||isNaN(e.pageSize)?array.each(utility.$("#"+f.id+"-pages-top, #"+f.id+"-pages-bottom"),function(a){Q.destroy(a)}):e.pages(),e.dispatch("afterRefresh",f)})},null===this.where?string.isEmpty(this.order)?d(this.store.get()):this.store.sort(this.order,a).then(d,function(a){utility.error(a),e.dispatch("error",a)}):string.isEmpty(this.order)?this.store.select(this.where).then(d,function(a){utility.error(a),e.dispatch("error",a)}):this.store.sort(this.order,a,this.where).then(d,function(a){utility.error(a),e.dispatch("error",a)}),this},y.prototype.remove=function(a){var b=this;return this.store.del(a).then(null,function(a){utility.error(a),b.dispatch("error",a)}),this},y.prototype.sort=function(a){return this.order=a,this.refresh()},y.prototype.teardown=function(a){a=a===!0;var b=this,c=this.element.id;return array.each(this.store.lists,function(a,c){return a.id===b.id?(array.remove(this,c),!1):void 0}),delete this.observer.hooks[c],this.listFilter&&this.listFilter.teardown(),a&&(Q.destroy(this.element),array.each(utility.$("#"+c+"-filter, #"+c+"-pages-top, #"+c+"-pages-bottom"),function(a){Q.destroy(a)}),this.element=null),this},y.prototype.update=function(a,b){var c=this;return this.store.update(a,b).then(null,function(a){utility.error(a),c.dispatch("error",a)}),this};var P={factory:function(){return new z}};z.prototype.constructor=z,z.prototype.always=function(a){return this.onAlways.push(a),this},z.prototype.done=function(a){return this.onDone.push(a),this},z.prototype.fail=function(a){return this.onFail.push(a),this},z.prototype.reject=function(a){return this.promise.reject.call(this.promise,a),this},z.prototype.resolve=function(a){return this.promise.resolve.call(this.promise,a),this},z.prototype.then=function(a,b){return this.promise.then(a,b)};var Q={appendTo:function(a,b){return a.appendChild(b),a},attr:function(a,b,c){var d,e;if(regex.svg.test(a.namespaceURI))void 0===c?(e=a.getAttributeNS(a.namespaceURI,b),e=null===e||string.isEmpty(e)?void 0:utility.coerce(e)):a.setAttributeNS(a.namespaceURI,b,c);else{if("string"==typeof c&&(c=string.trim(c)),regex.checked_disabled.test(b)&&void 0===c)return utility.coerce(a[b]);if(regex.checked_disabled.test(b)&&void 0!==c)a[b]=c;else{if("SELECT"===a.nodeName&&"selected"===b&&void 0===c)return utility.dom("#"+a.id+' option[selected="selected"]')[0]||utility.dom("#"+a.id+" option")[0];if("SELECT"===a.nodeName&&"selected"===b&&void 0!==c)d=utility.dom("#"+a.id+' option[selected="selected"]')[0],void 0!==d&&(d.selected=!1,d.removeAttribute("selected")),d=utility.dom("#"+a.id+' option[value="'+c+'"]')[0],d.selected=!0,d.setAttribute("selected","selected");else{if(void 0===c)return e=a.getAttribute(b),e=null===e||string.isEmpty(e)?void 0:utility.coerce(e);a.setAttribute(b,c)}}}return a},clear:function(a){return"function"==typeof a.reset?a.reset():void 0!==a.value?Q.update(a,{innerHTML:"",value:""}):Q.update(a,{innerHTML:""}),a},create:function(a,b,c,d){var e,f,g,h=!1,i=!1;return a=a.replace(/\t|\n|\r/g,""),c?h=c.namespaceURI&&regex.svg.test(c.namespaceURI):c=k.body,b instanceof Object&&b.id&&!utility.dom("#"+b.id)?(f=b.id,delete b.id):h||(f=utility.genId(void 0,!0)),regex.html.test(a)?(i=!0,e=Q.frag(a),g=1===e.childNodes.length?e.childNodes[0]:array.cast(e.childNodes)):(e=h||regex.svg.test(a)?k.createElementNS("http://www.w3.org/2000/svg",a):k.createElement(a),f&&(e.id=f),b instanceof Object&&Q.update(e,b)),d&&"last"!==d?"first"===d?Q.prependChild(c,e):"after"===d?(d={after:c},c=c.parentNode,c.insertBefore(e,d.after.nextSibling)):d.after?c.insertBefore(e,d.after.nextSibling):"before"===d?(d={before:c},c=c.parentNode,c.insertBefore(e,d.before)):d.before?c.insertBefore(e,d.before):c.appendChild(e):c.appendChild(e),i?g:e},css:function(a,b,c){return regex.caps.test(b)||(b=string.toCamelCase(b)),void 0!==c?(a.style[b]=c,a):a.style[b]},data:function(a,b,c){return void 0!==c?(a.setAttribute("data-"+b,regex.json_wrap.test(c)?R.encode(c):c),a):utility.coerce(a.getAttribute("data-"+b))},destroy:function(a){return void(null!==a.parentNode&&a.parentNode.removeChild(a))},disable:function(a){return"boolean"!=typeof a.disabled||a.disabled||(a.disabled=!0),a},dispatch:function(a,b,c,d,e){var f;if(a){try{f=new CustomEvent(b)}catch(g){f=k.createEvent("CustomEvent")}return d=d!==!1,e=e!==!1,f.initCustomEvent(b,d,e,c||{}),a.dispatchEvent(f),a}},enable:function(a){return"boolean"==typeof a.disabled&&a.disabled&&(a.disabled=!1),a},find:function(a,b){var c=[];return utility.genId(a,!0),array.each(string.explode(b),function(b){c=c.concat(utility.dom("#"+a.id+" "+b))}),c},frag:function(a){var b=k.createDocumentFragment();return a&&(array.each(array.cast(Q.create("div",{innerHTML:a},b).childNodes),function(a){b.appendChild(a)}),b.removeChild(b.childNodes[0])),b},has:function(a,b){var c=Q.find(a,b);return!isNaN(c.length)&&c.length>0},hasClass:function(a,b){return a.classList.contains(b)},hidden:function(a){return"none"===a.style.display||"boolean"==typeof a.hidden&&a.hidden},html:function(a,b){return void 0===b?a.innerHTML:(a.innerHTML=b,a)},is:function(a,b){return regex.selector_is.test(b)?1===Q.find(a.parentNode,a.nodeName.toLowerCase()+b).filter(function(b){return b.id===a.id}).length:new RegExp(b,"i").test(a.nodeName)},klass:function(a,b,c){return c=c!==!1,b=string.explode(b," "),c?array.each(b,function(b){a.classList.add(b)}):array.each(b,function(b){return"*"===b?(array.each(a.classList,function(a){this.remove(a)}),!1):void a.classList.remove(b)}),a},position:function(a){a=a||k.body;var b,c,d,e,f,g;if(b=c=0,g=a.offsetWidth,f=a.offsetHeight,a.offsetParent){for(c=a.offsetTop,b=a.offsetLeft;a=a.offsetParent;)b+=a.offsetLeft,c+=a.offsetTop;d=k.body.offsetWidth-(b+g),e=k.body.offsetHeight-(c+f)}else d=g,e=f;return[b,c,d,e]},prependChild:function(a,b){return 0===a.childNodes.length?a.appendChild(b):a.insertBefore(b,a.childNodes[0])},removeAttr:function(a,b){var c;return regex.svg.test(a.namespaceURI)?a.removeAttributeNS(a.namespaceURI,b):"SELECT"===a.nodeName&&"selected"===b?(c=utility.dom("#"+a.id+' option[selected="selected"]')[0],c&&(c.selected=!1,c.removeAttribute("selected"))):a.removeAttribute(b),a},scrollTo:function(a,b,c,d){var e=array.remove(Q.position(a),2,3);return isNaN(c)||(e[0]+=c),isNaN(d)||(e[1]+=d),K.scroll(e,b)},serialize:function(a,string,b){string=string===!0,b=b!==!1;var c,d,e={};return c="FORM"===a.nodeName?a.elements?array.cast(a.elements):a.find("button, input, select, textarea"):[a],array.each(c,function(a){var b=a.id||a.name||a.type;"FORM"===a.nodeName?utility.merge(e,R.decode(Q.serialize(a))):e[b]||(e[b]=Q.val(a))}),string?(d="",utility.iterate(e,function(a,c){d+=b?"&"+encodeURIComponent(c)+"="+encodeURIComponent(a):"&"+c+"="+a}),d=d.replace(regex.and,"?")):d=e,d},size:function(a){return[a.offsetWidth+U.parse(a.style.paddingLeft||0)+U.parse(a.style.paddingRight||0)+U.parse(a.style.borderLeft||0)+U.parse(a.style.borderRight||0),a.offsetHeight+U.parse(a.style.paddingTop||0)+U.parse(a.style.paddingBottom||0)+U.parse(a.style.borderTop||0)+U.parse(a.style.borderBottom||0)]},text:function(a,b){var c=a.textContent?"textContent":"innerText",d={},e=!1;return"undefined"!=typeof b&&(e=!0,d[c]=b),e?Q.update(a,d):a[c]},toggleClass:function(a,b){return a.classList.toggle(b),a},update:function(a,b){return utility.iterate(b,function(b,c){regex.element_update.test(c)?a[c]=b:"class"===c?string.isEmpty(b)?Q.klass(a,"*",!1):Q.klass(a,b):0===c.indexOf("data-")?Q.data(a,c.replace("data-",""),b):Q.attr(a,c,b)}),a},val:function(a,b){var c,d="input";if(void 0===b){if(regex.radio_checkbox.test(a.type)){if(string.isEmpty(a.name))throw new Error(S.expectedProperty);array.each(utility.dom("input[name='"+a.name+"']"),function(a){return a.checked?(c=a.value,!1):void 0})}else c=regex.select.test(a.type)?a.options[a.selectedIndex].value:a.value?a.value:Q.text(a);void 0!==c?(c=utility.coerce(c),"string"==typeof c&&(c=string.trim(c))):c=""}else b=b.toString(),regex.radio_checkbox.test(a.type)?(d="click",array.each(utility.dom("input[name='"+a.name+"']"),function(a){return a.value===b?(a.checked=!0,c=a,!1):void 0})):regex.select.test(a.type)?(d="change",array.each(Q.find(a,"> *"),function(a){return a.value===b?(a.selected=!0,c=a,!1):void 0})):void 0!==a.value?a.value=b:Q.text(a,b),Q.dispatch(a,d),c=a;return c}},R={decode:function(a,b){try{return JSON.parse(a)}catch(c){return void(b!==!0&&utility.error(c,arguments,this))}},encode:function(a,b){try{return JSON.stringify(a)}catch(c){return void(b!==!0&&utility.error(c,arguments,this))}}},S={expectedNumber:"Expected a Number",expectedProperty:"Expected a property, and it was not set",expectedObject:"Expected an Object",invalidArguments:"One or more arguments is invalid",invalidStateNoHeaders:"INVALID_STATE_ERR: Headers have not been received",invalidStateNoSync:"Synchronous XMLHttpRequest requests are not supported",invalidStateNotOpen:"INVALID_STATE_ERR: Object is not open",invalidStateNotSending:"INVALID_STATE_ERR: Object is sending",invalidStateNotUsable:"INVALID_STATE_ERR: Object is not usable",noData:"Nothing to display",notAvailable:"Requested method is not available",datastoreNoPrevVersion:"No previous version found",serverError:"Server error has occurred",serverForbidden:"Forbidden to access URI",serverInvalidMethod:"Method not allowed",serverUnauthorized:"Authorization required to access URI",upgrade:"Your browser is too old to use keigai, please upgrade"},T={bezier:function(){var a,b,c,d,e,f,g,h,i,j=array.cast(arguments),k=j.pop(),l=array.chunk(j,2),m=l.length;if(2>m||m>4)throw new Error(S.invalidArguments);return a=[],b=1-k,c=T.sqr(b),d=2*b*k,e=T.sqr(k),f=Math.pow(b,3),g=3*c*k,h=3*b*e,i=Math.pow(k,3),2===m?(a.push(b*l[0][0]+k*l[1][0]),a.push(b*l[0][1]+k*l[1][1])):3===m?(a.push(c*l[0][0]+d*l[1][0]+(e+l[2][0])),a.push(c*l[0][1]+d*l[1][1]+(e+l[2][1]))):4===m&&(a.push(f*l[0][0]+g*l[1][0]+h*l[2][0]+i*l[3][0]),a.push(f*l[0][1]+g*l[1][1]+h*l[2][1]+i*l[3][1])),a},dist:function(a,b){return Math.sqrt(T.sqr(b[0]-a[0])+T.sqr(b[1]-a[1]))},sqr:function(a){return Math.pow(a,2)}},U={diff:function(a,b){if(isNaN(a)||isNaN(b))throw new Error(S.expectedNumber);return Math.abs(a-b)},even:function(a){return a%2===0},format:function(a,b,c){if(isNaN(a))throw new Error(S.expectedNumber);a=a.toString(),b=b||",",c=c||3;var d,e,f=a.indexOf(".")>-1?"."+a.replace(regex.number_format_1,""):"",g=a.replace(regex.number_format_2,"").split("").reverse(),h=Math.floor(g.length/c),i=1;for(e=0;h>e;e++)d=1===i?c:c*i+(2===i?1:i-1),g.splice(d,0,b),i++;return g=g.reverse().join(""),g.charAt(0)===b&&(g=g.substring(1)),g+f},half:function(a,b){return b?a/b===.5:a/2},odd:function(a){return!U.even(a)},parse:function(a,b){return void 0===b?parseFloat(a):parseInt(a,b)},random:function(a){return a=a||100,Math.floor(Math.random()*(a+1))},round:function(a,b){return a=U.parse(a),void 0===b||string.isEmpty(b)?U.parse(a.toFixed(0)):regex.down.test(b)?~~a:Math.ceil(a)}},V={factory:function(){var a,b,c,d,e;return a=new Promise(function(a,b){c=a,d=b}),b=function(){return a["catch"].apply(a,arguments)},e=function(){return a.then.apply(a,arguments)},{"catch":b,resolve:c,reject:d,then:e}}},store={factory:function(a,b){var c=new A;return b instanceof Object&&utility.merge(c,b),null!==a&&"object"==typeof a&&c.batch("set",a),c},worker:function(a){var b,c,d,e,f,g,h,i,j,k=a.data.cmd,l=a.data.records;"select"===k?(i=JSON.parse(a.data.where),d=a.data.functions,b=array.fromObject(i),h=array.flat(b).filter(function(a,b){return b%2===0}).sort(array.sort),f=h.join("|"),j=h.map(function(a){return i[a]}).join("|"),e=a.data.indexes,c="return ( ",0===d.length&&e[f]?g=(e[f][j]||[]).map(function(a){return l[a]}):(b.length>1?array.each(b,function(a,b){var e="( ";b>0&&(e=" && ( "),c+=array.contains(d,a[0])?e+a[1]+'( rec.data["'+a[0]+'"] ) )':isNaN(a[1])?e+'rec.data["'+a[0]+'"] === "'+a[1]+'" )':e+'rec.data["'+a[0]+'"] === '+a[1]+" )"}):c+=array.contains(d,b[0][0])?b[0][1]+'( rec.data["'+b[0][0]+'"] )':isNaN(b[0][1])?'rec.data["'+b[0][0]+'"] === "'+b[0][1]+'"':'rec.data["'+b[0][0]+'"] === '+b[0][1],c+=" );",g=l.filter(new Function("rec",c)))):"sort"===k&&(g=array.keySort(l,a.data.query,"data")),postMessage(g)}};A.prototype=I.factory(),A.prototype.constructor=A,A.prototype.batch=function(a,b,c){c=c===!0;var d=this,e=this.events,f=P.factory(),g=[];return!regex.set_del.test(a)||c&&regex.del.test(a)||"object"!=typeof b?f.reject(new Error(S.invalidArguments)):(e&&this.dispatch("beforeBatch",b),c&&this.clear(c),0===b.length?(this.loaded=!0,e&&this.dispatch("afterBatch",this.records),f.resolve(this.records)):("del"===a?array.each(b,function(a){g.push(d.del(a,!1,!0))}):array.each(b,function(a){g.push(d.set(null,a,!0))}),this.loaded=!1,utility.when(g).then(function(b){d.loaded=!0,e&&d.dispatch("afterBatch",b),array.each(d.lists,function(a){a.refresh(!0)}),"del"===a&&(d.records=array.compact(d.records),d.reindex()),d.autosave&&d.save(),f.resolve(b)},function(a){e&&d.dispatch("failedBatch",a),f.reject(a)}))),f},A.prototype.buildUri=function(a){var b=utility.parse(this.uri);return b.protocol+"//"+b.host+b.pathname+(regex.endslash.test(b.pathname)?"":"/")+a},A.prototype.clear=function(a){a=a===!0;var b=this.events===!0,c=this.autosave===!0;return a?(this.indexes={key:{}},this.loaded=!1,this.records=[],this.total=0,this.views={},array.each(this.lists,function(a){a&&a.refresh()})):(b&&this.dispatch("beforeClear"),array.each(this.lists,function(a){a&&a.teardown(!0)}),this.autosave=!1,this.callback=null,this.credentials=null,this.lists=[],this.events=!0,this.expires=null,this.headers={Accept:"application/json"},this.ignore=[],this.index=[],this.indexes={key:{}},this.key=null,this.loaded=!1,this.records=[],this.source=null,this.total=0,this.versions={},this.versioning=!0,this.views={},this.uri=null,b&&this.dispatch("afterClear")),c&&this.save(),this},A.prototype.del=function(a,b,c){a=a.key?a:this.get(a),b=b!==!1,c=c===!0;var d=this,e=P.factory();return void 0===a?e.reject(new Error(S.invalidArguments)):(this.events&&d.dispatch("beforeDelete",a),null===this.uri||null!==this.callback?this.delComplete(a,b,c,e):K.request(this.buildUri(a.key),"DELETE",null,utility.merge({withCredentials:this.credentials},this.headers)).then(function(){d.delComplete(a,b,c,e)},function(a){d.dispatch("failedDelete",a),e.reject(a)})),e},A.prototype.delComplete=function(a,b,c,d){var e=this;return delete this.indexes.key[a.key],delete this.versions[a.key],this.total--,this.views={},c?this.records[a.index]=null:(array.remove(this.records,a.index),b?this.reindex():array.each(a.indexes,function(b){array.remove(e.indexes[b[0]][b[1]],a.index),0===e.indexes[b[0]][b[1]].length&&delete e.indexes[b[0]][b[1]]}),this.autosave&&this.purge(a.key),this.events&&this.dispatch("afterDelete",a),array.each(this.lists,function(a){a.refresh()})),d.resolve(a.key)},A.prototype.dump=function(a,b){a=a||this.records;var c,d=this,e=b instanceof Array&&b.length>0,f=null!==this.key;return c=e?function(a){var c={};return array.each(b,function(b){c[b]=b===d.key?isNaN(a.key)?a.key:Number(a.key):utility.clone(a.data[b],!0)}),c}:function(a){var b={};return f&&(b[d.key]=isNaN(a.key)?a.key:Number(a.key)),utility.iterate(a.data,function(a,c){b[c]=utility.clone(a,!0)}),b},a.map(c)},A.prototype.get=function(a,b){var c,d=typeof a,e=this;return"undefined"===d?c=this.records:"string"===d?c=-1===a.indexOf(",")?this.records[this.indexes.key[a]]:string.explode(a).map(function(a){return isNaN(a)?e.records[e.indexes.key[a]]:e.records[parseInt(a,10)]}):"number"===d&&(c=isNaN(b)?this.records[parseInt(a,10)]:array.limit(this.records,parseInt(a,10),parseInt(b,10))),utility.clone(c,!0)},A.prototype.join=function(a,b,c){c=c||"inner";var d,e=this,f=P.factory(),g=[],h=[],i=b===this.key,j=array.merge(array.keys(this.records[0].data),array.keys(a.records[0].data));return"inner"===c?d=function(c){var d={},e=c.data,f=P.factory();d[b]=i?c.key:e[b],a.select(d).then(function(a){a.length>2?f.reject(new Error(S.databaseMoreThanOne)):1===a.length?(g.push(utility.merge(e,a[0].data)),f.resolve(!0)):f.resolve(!1)}),h.push(f)}:"left"===c?d=function(c){var d={},e=c.data,f=P.factory();d[b]=i?c.key:e[b],a.select(d).then(function(a){a.length>2?f.reject(new Error(S.databaseMoreThanOne)):1===a.length?(g.push(utility.merge(e,a[0].data)),f.resolve(!0)):(array.each(j,function(a){void 0===e[a]&&(e[a]=null)}),g.push(e),f.resolve(!0))}),h.push(f)}:"right"===c&&(d=function(a){var c={},d=a.data,f=P.factory();c[b]=i?a.key:d[b],e.select(c).then(function(a){a.length>2?f.reject(new Error(S.databaseMoreThanOne)):1===a.length?(g.push(utility.merge(d,a[0].data)),f.resolve(!0)):(array.each(j,function(a){void 0===d[a]&&(d[a]=null)}),g.push(d),f.resolve(!0))}),h.push(f)}),array.each(utility.clone("right"===c?a.records:this.records,!0),d),utility.when(h).then(function(){f.resolve(g)},function(a){f.reject(a)}),f},A.prototype.only=function(a){return this.records.map(a===this.key?function(a){return a.key}:function(b){return b.data[a]})},A.prototype.purge=function(a){return this.storage(a||this,"remove")},A.prototype.reindex=function(){var a=this,b=-1,c=[];return this.views={},this.indexes={key:{}},this.total>0&&array.each(this.records,function(d){void 0!==d&&(c[++b]=d,d.index=b,a.indexes.key[d.key]=b,a.setIndexes(d))}),this.records=c,this},A.prototype.restore=function(a){return this.storage(a||this,"get")},A.prototype.save=function(a){return this.storage(a||this,"set")},A.prototype.select=function(a){var b,c,d,e,f,g,h,i=this,j=P.factory(),k=[];if(a instanceof Object)if(utility.iterate(a,function(a,b){"function"==typeof a&&(this[b]=a.toString(),k.push(b))}),o)try{h=utility.worker(j),h.postMessage({cmd:"select",indexes:this.indexes,records:this.records,where:R.encode(a),functions:k})}catch(l){o=!1,this.select(a).then(function(a){j.resolve(a)},function(a){j.reject(a)})}else b=array.fromObject(a),f=array.flat(b).filter(function(a,b){return b%2===0}).sort(array.sort),d=f.join("|"),g=f.map(function(b){return a[b]}).join("|"),c="return ( ",0===k.length&&this.indexes[d]?e=(this.indexes[d][g]||[]).map(function(a){return i.records[a]}):(b.length>1?array.each(b,function(a,b){var d="( ";b>0&&(d=" && ( "),c+=a[1]instanceof Function?d+a[1].toString()+'( rec.data["'+a[0]+'"] ) )':isNaN(a[1])?d+'rec.data["'+a[0]+'"] === "'+a[1]+'" )':d+'rec.data["'+a[0]+'"] === '+a[1]+" )"}):c+=b[0][1]instanceof Function?b[0][1].toString()+'( rec.data["'+b[0][0]+'"] )':isNaN(b[0][1])?'rec.data["'+b[0][0]+'"] === "'+b[0][1]+'"':'rec.data["'+b[0][0]+'"] === '+b[0][1],c+=" );",e=utility.clone(this.records,!0).filter(new Function("rec",c))),j.resolve(e);else j.reject(new Error(S.invalidArguments));return j},A.prototype.set=function(a,b,c,d){function e(a,b,c){var d=[];return a&&array.each(array.keys(c),function(a){a!==i.key&&void 0===b[a]&&d.push({op:"remove",path:"/"+a})}),utility.iterate(b,function(a,b){b!==i.key&&void 0===c[b]?d.push({op:"add",path:"/"+b,value:a}):R.encode(c[b])!==R.encode(a)&&d.push({op:"replace",path:"/"+b,value:a})}),d}b=utility.clone(b,!0),c=c===!0,d=d===!0;var f,g,h,i=this,j=this.events,k=P.factory(),l=null!==a?this.get(a)||null:b[this.key]?this.get(b[this.key])||null:null,m="POST",n=utility.parse(i.uri||"");return"string"==typeof b?(f=-1===b.indexOf("//")?"/"!==b.charAt(0)?this.buildUri(b):null!==i.uri&&regex.root.test(b)?n.protocol+"//"+n.host+b:b:b,a=f.replace(regex.not_endpoint,""),string.isEmpty(a)?k.reject(new Error(S.invalidArguments)):(!c&&j&&i.dispatch("beforeSet",{key:a,data:b}),K.request(f,"GET",null,utility.merge({withCredentials:i.credentials},i.headers)).then(function(b){i.setComplete(l,a,i.source?utility.walk(b,i.source):b,c,d,k)},function(a){i.dispatch("failedSet",a),k.reject(a)}))):(!c&&j&&i.dispatch("beforeSet",{key:a,data:b}),c||null===this.uri?this.setComplete(l,a,b,c,d,k):(null!==a?(f=this.buildUri(a),m="PATCH",g=utility.clone(b,!0),b=e(d,b,this.dump([l])[0])):f=n.protocol+"//"+n.host+n.pathname,h=K.request(f,m,b,utility.merge({withCredentials:this.credentials},this.headers)),h.then(function(b){var e;e=204!==h.xhr.status&&h.xhr.status<300&&null===a?i.source?utility.walk(b,i.source):b:g,i.setComplete(l,a,e,c,d,k)},function(e){"PATCH"==m?(m="PUT",b=utility.clone(g,!0),utility.iterate(l.data,function(a,c){b[c]=a}),K.request(f,m,b,utility.merge({withCredentials:i.credentials},i.headers)).then(function(){i.setComplete(l,a,g,c,d,k)},function(a){i.dispatch("failedSet",a),k.reject(a)})):(i.dispatch("failedSet",e),k.reject(e))}))),k},A.prototype.setComplete=function(a,b,c,d,e,f){return this.views={},null===b&&(b=null!==this.key&&void 0!==c[this.key]&&null!==c[this.key]?c[this.key].toString():utility.uuid()),this.key&&delete c[this.key],null===a?(a={index:this.total++,key:b,data:c,indexes:[]},this.indexes.key[b]=a.index,this.records[a.index]=a,this.versioning&&(this.versions[a.key]=G.factory(q),this.versions[a.key].nth=0)):(this.versioning&&(void 0===this.versions[a.key]&&(this.versions[a.key]=G.factory(q),this.versions[a.key].nth=0),this.versions[a.key].set("v"+ ++this.versions[a.key].nth,this.dump([a])[0])),a=this.records[a.index],e&&(a.data={}),utility.iterate(c,function(b,c){a.data[c]=b}),a=utility.clone(a,!0)),this.setIndexes(a),d||(this.autosave&&this.save(),this.events&&this.dispatch("afterSet",a),array.each(this.lists,function(a){a.refresh()})),f.resolve(a),this},A.prototype.setExpires=function(a){var b=this.id+"Expire",c=a,d=this;if(null!==a&&null===this.uri||null!==a&&(isNaN(a)||1e3>a))throw new Error(S.invalidArguments);this.expires!==a&&(this.expires=a,utility.clearTimers(b),null!==a&&utility.repeat(function(){return null===d.uri?(d.setExpires(null),!1):(d.dispatch("beforeExpire"),J.expire(d.uri),d.dispatch("expire"),void d.dispatch("afterExpire"))},c,b,!1))},A.prototype.setIndexes=function(a){var b=this,c="|";return a.indexes=[],array.each(this.index,function(d){var e=d.split(c),f="";void 0===b.indexes[d]&&(b.indexes[d]={}),array.each(e,function(b,d){f+=(d>0?c:"")+a.data[b]}),void 0===b.indexes[d][f]&&(b.indexes[d][f]=[]),array.contains(b.indexes[d][f],a.index)||(b.indexes[d][f].push(a.index),a.indexes.push([d,f]))}),this},A.prototype.setUri=function(a){var b,c=P.factory();return null!==a&&string.isEmpty(a)&&c.reject(new Error(S.invalidArguments)),null===a?this.uri=a:(b=utility.parse(a),this.uri=b.protocol+"//"+b.host+b.path,string.isEmpty(b.auth)||this.headers.authorization||this.headers.Authorization||(this.headers.Authorization="Basic "+btoa(decodeURIComponent(b.auth))),this.on("expire",function(){this.sync()},"resync",this),J.expire(this.uri),this.sync().then(function(a){c.resolve(a)},function(a){c.reject(a)})),c},A.prototype.sort=function(a,b,c){b=b===!0||c instanceof Object;var d,e,f=this,g=string.toCamelCase(string.explode(a).join(" ")),h=P.factory();return d=function(c){if(0===f.total)h.resolve([]);else if(!b&&f.views[g])h.resolve(f.views[g]);else if(o){h.then(function(a){return f.views[g]=a,f.views[g]},function(a){utility.error(a)});try{e=utility.worker(h),e.postMessage({cmd:"sort",indexes:f.indexes,records:c,query:a})}catch(d){o=!1,f.views[g]=array.keySort(c,a,"data"),h.resolve(f.views[g])}}else f.views[g]=array.keySort(c,a,"data"),h.resolve(f.views[g])},c?this.select(c).then(d,function(a){h.reject(a)}):d(utility.clone(this.records,!0)),h},A.prototype.storage=function(a,b,c){var d,e,g,h=this,i=!1,j=!string.isEmpty(this.mongodb),k="session"===c&&"undefined"!=typeof sessionStorage,l=P.factory();return regex.number_string_object.test(typeof a)&&regex.get_remove_set.test(b)?(i=regex.number_string.test(typeof a)||a.hasOwnProperty("data"),"remove"!==b?(!i||a instanceof Object||(a=this.get(a)),e=i?a.key:a.id):"remove"===b&&i&&(e=a.key||a),j?f.connect(this.mongodb,function(c,d){return c?(d&&d.close(),l.reject(c)):void d.collection(h.id,function(c,f){return c?(d.close(),l.reject(c)):void("get"===b?i?f.find({_id:a.key}).limit(1).toArray(function(a,b){d.close(),a?l.reject(a):0===b.length?l.resolve(null):(delete b[0]._id,h.set(e,b[0],!0).then(function(a){l.resolve(a)},function(a){l.reject(a)}))}):f.find({}).toArray(function(a,b){var c,e;return a?(d.close(),l.reject(a)):(c=-1,e=b.length,e>0&&(h.records=b.map(function(a){var b={key:a._id,index:++c,data:{}};return h.indexes.key[b.key]=b.index,b.data=a,delete b.data._id,h.setIndexes(b),b}),h.total=e),d.close(),void l.resolve(h.records))}):"remove"===b?f.remove(i?{_id:e}:{},{safe:!0},function(a,b){d.close(),a?l.reject(a):l.resolve(b)}):"set"===b?i?f.update({_id:a.key},a.data,{w:1,safe:!0,upsert:!0},function(a,b){d.close(),a?l.reject(a):l.resolve(b)}):f.remove({},{w:1,safe:!0},function(a){var b;return a?(d.close(),l.reject(a)):(b=[],array.each(h.records,function(a){var c={},d=P.factory();b.push(d),utility.iterate(a.data,function(a,b){c[b]=a}),f.update({_id:a.key},c,{w:1,safe:!0,upsert:!0},function(a,b){a?d.reject(a):d.resolve(b)})}),utility.when(b).then(function(a){d.close(),l.resolve(a)},function(a){d.close(),l.reject(a)
}),void 0)}):(d.close(),l.reject(null)))})}):"get"===b?(g=k?sessionStorage.getItem(e):localStorage.getItem(e),null!==g?(g=R.decode(g),i?h.set(e,g,!0).then(function(a){l.resolve(a)},function(a){l.reject(a)}):(utility.merge(h,g),l.resolve(h))):l.resolve(h),l.then(function(){h.loaded=!0},function(a){throw a})):"remove"===b?(k?sessionStorage.removeItem(e):localStorage.removeItem(e),l.resolve(this)):"set"===b?(d=R.encode(i?a.data:{total:this.total,index:this.index,indexes:this.indexes,records:this.records}),k?sessionStorage.setItem(e,d):localStorage.setItem(e,d),l.resolve(this)):l.reject(null)):l.reject(new Error(S.invalidArguments)),l},A.prototype.sync=function(){var a,b,c=this,d=this.events===!0,e=P.factory();return a=function(a){var f;return"object"!=typeof a?b(new Error(S.expectedObject)):(null!==c.source&&(a=utility.walk(a,c.source)),f=a instanceof Array?a:[a],void c.batch("set",f,!0).then(function(a){d&&c.dispatch("afterSync",a),e.resolve(a)},b))},b=function(a){d&&c.dispatch("failedSync",a),e.reject(a)},null===this.uri||string.isEmpty(this.uri)?e.reject(new Error(S.invalidArguments)):(d&&this.dispatch("beforeSync",this.uri),null!==this.callback?K.jsonp(this.uri,{callback:this.callback}).then(a,b):K.request(this.uri,"GET",null,utility.merge({withCredentials:this.credentials},this.headers)).then(a,b)),e},A.prototype.teardown=function(){var a,b=this.uri;return null!==b&&(J.expire(b,!0),a=this.id+"DataExpire",utility.clearTimers(a),array.each(this.records,function(a){var c=b+"/"+a.key;J.expire(c,!0)})),array.each(this.lists,function(a){a.teardown(!0)}),this.clear(!0),this.dispatch("afterTeardown"),this},A.prototype.undo=function(a,b){var c,d=this.get(a),e=P.factory(),f=this.versions[d.key];return void 0===d?e.reject(new Error(S.invalidArguments)):f?(c=f.get(b||f.first),void 0===c?e.reject(S.datastoreNoPrevVersion):this.set(a,c).then(function(a){e.resolve(a)},function(a){e.reject(a)})):e.reject(S.datastoreNoPrevVersion),e},A.prototype.unique=function(a){return array.unique(this.records.map(function(b){return b.data[a]}))},A.prototype.update=function(a,b){var c=this.get(a),d=P.factory();return void 0===c?d.reject(new Error(S.invalidArguments)):this.set(a,utility.merge(c.data,b)).then(function(a){d.resolve(a)},function(a){d.reject(a)}),d};var string={capitalize:function(a,b){b=b===!0;var c;return c=b?string.explode(a," ").map(function(a){return a.charAt(0).toUpperCase()+a.slice(1)}).join(" "):a.charAt(0).toUpperCase()+a.slice(1)},escape:function(a){return a.replace(/[\-\[\]{}()*+?.,\\\/\^\$|#\s]/g,"\\$&")},explode:function(a,b){return b=b||",",string.trim(a).split(new RegExp("\\s*"+b+"\\s*"))},fromObject:function(a,b){var c=(b?b+" = {":"{")+"\n";return utility.iterate(a,function(a,b){c+='"'+b+'":'+a.toString()+",\n"}),c=c.replace(/\[object Object\]/g,"{}").replace(/,\n$/,"\n")+"}"},hyphenate:function(a,b){var c=string.trim(a).replace(/\s+/g,"-");return b===!0&&(c=c.replace(/([A-Z])/g,"-$1").toLowerCase()),c},isBoolean:function(a){return regex.bool.test(a)},isEmpty:function(a){return""===string.trim(a)},isNumber:function(a){return regex.number.test(a)},isUrl:function(a){return regex.url.test(a)},toCamelCase:function(a){var b=string.trim(a).replace(/\.|_|-|\@|\[|\]|\(|\)|\#|\$|\%|\^|\&|\*|\s+/g," ").toLowerCase().split(regex.space_hyphen),c=[];return array.each(b,function(a,b){c.push(0===b?a:string.capitalize(a))}),c.join("")},singular:function(a){return a.replace(/oe?s$/,"o").replace(/ies$/,"y").replace(/ses$/,"se").replace(/s$/,"")},toFunction:function(a){var b=string.trim(a.replace(/^.*\(/,"").replace(/[\t|\r|\n|\"|\']+/g,"").replace(/\).*/,"")),c=string.trim(a.replace(/^.*\{/,"").replace(/\}$/,""));return Function.apply(Function,string.explode(b).concat([c]))},trim:function(a){return a.replace(/^(\s+|\t+|\n+)|(\s+|\t+|\n+)$/g,"")},unCamelCase:function(a){return string.trim(a.replace(/([A-Z])/g," $1").toLowerCase())},uncapitalize:function(a){return a=string.trim(a),a.charAt(0).toLowerCase()+a.slice(1)},unhyphenate:function(a,b){return b!==!0?string.explode(a,"-").join(" "):string.explode(a,"-").map(function(a){return string.capitalize(a)}).join(" ")}},utility={timer:{},repeating:{},$:function(a){var b;return a&&(regex.html.test(a)?b=[Q.create(a)]:(a=string.trim(a),-1===a.indexOf(",")?(b=utility.dom(a),b?isNaN(b.length)&&(b=[b]):b=[]):(b=[],array.each(string.explode(a),function(a){var c=utility.dom(a);c instanceof Array?b=b.concat(c):c&&b.push(c)})))),b},base:function(a){var b=new u;return a instanceof Object&&utility.merge(b,a),b.observer=H.factory(),b},blob:function(b){var c;try{c=new Blob([b],{type:"application/javascript"})}catch(d){a.BlobBuilder||(a.BlobBuilder=a.MSBlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder),c=(new a.BlobBuilder).append(b).getBlob()}return c},clearTimers:function(a){if(void 0===a||string.isEmpty(a))throw new Error(S.invalidArguments);utility.timer[a]&&(clearTimeout(utility.timer[a]),delete utility.timer[a]),utility.repeating[a]&&(clearTimeout(utility.repeating[a]),delete utility.repeating[a])},clone:function(a,b){var c,d;return b===!0?void 0!==a&&null!==a?R.decode(R.encode(a)):a:!a||regex.primitive.test(typeof a)||a instanceof RegExp?a:a instanceof Array?(d=[],array.each(a,function(a,b){d[b]=utility.clone(a)}),d):!n&&!K.ie&&a instanceof Document?W.decode(W.encode(a)):"undefined"!=typeof a.__proto__?utility.extend(a.__proto__,a):a instanceof Object?(c=R.encode(a,!0),void 0!==c?(c=R.decode(c),utility.iterate(a,function(a,b){"function"==typeof a&&(c[b]=a)})):c=a,c):a},coerce:function(a){var b;return null===a||void 0===a?void 0:"true"===a?!0:"false"===a?!1:"null"===a?null:"undefined"===a?void 0:""===a?a:isNaN(b=Number(a))?regex.json_wrap.test(a)?R.decode(a,!0)||a:a:b},compile:function(a,b,c){return a.compile(b,c),!0},curry:function(){var a=array.cast(arguments),b=a.shift(),c=b.apply(b,a);return function(){return c.apply(c,arguments)}},defer:function(a,b,c,d){var e;return b=b||0,d=d===!0,void 0!==c?utility.clearTimers(c):c=utility.uuid(!0),e=function(){utility.clearTimers(c),a()},utility[d?"repeating":"timer"][c]=setTimeout(e,b),c},delay:function(){return"undefined"!=typeof setImmediate?function(a){setImmediate(a)}:"undefined"!=typeof process?process.nextTick:function(a){setTimeout(a,0)}}(),dom:function(a){var b;return b=regex.selector_complex.test(a)?array.cast(k.querySelectorAll(a)):regex.hash.test(a)?k.getElementById(a.replace(regex.hash,""))||void 0:array.cast(regex.klass.test(a)?k.getElementsByClassName(a.replace(regex.klass,"")):regex.word.test(a)?k.getElementsByTagName(a):k.querySelectorAll(a))},domId:function(a){return"a"+a.replace(/-/g,"").slice(1)},error:function(a,b,c,d){var e={arguments:b?array.cast(b):[],message:a.message||a,number:a.number?65535&a.number:void 0,scope:c,stack:a.stack||void 0,timestamp:(new Date).toUTCString(),type:a.type||"TypeError"};return void utility.log(e.stack||e.message,d!==!0?"error":"warn")},extend:function(a,b){var c;if(void 0===a)throw new Error(S.invalidArguments);return c=Object.create(a),b instanceof Object&&utility.merge(c,b),c},genId:function(a,b){b=b===!0;var c;if(a&&(a.id||a instanceof Array||"string"==typeof a||a instanceof String))return a;if(b){do c=utility.domId(utility.uuid(!0));while(utility.dom("#"+c))}else c=utility.domId(utility.uuid(!0));return"object"==typeof a?(a.id=c,a):c},iterate:function(a,b){return array.each(Object.keys(a),function(c){return b.call(a,a[c],c)}),a},log:function(a,b){var c,d;"undefined"!=typeof console&&(c="object"!=typeof a,d=c?"["+(new Date).toLocaleTimeString()+"] "+a:a,console[b||"log"](d))},merge:function(a,b){return utility.iterate(b,function(b,c){a[c]instanceof Array&&b instanceof Array?array.merge(a[c],b):a[c]instanceof Object&&b instanceof Object?utility.iterate(b,function(b,d){a[c][d]=utility.clone(b)}):a[c]=utility.clone(b)}),a},parse:function(a){var b,c,d={},e={};return void 0===a&&(a=n?"":l.href),n?d=g.parse(a):(d=k.createElement("a"),d.href=a,b=d.href.match(regex.host)[1],c=d.href.match(regex.protocol)[1]),n&&utility.iterate(d,function(a,b){null===a&&(d[b]=void 0)}),e={auth:n?null:regex.auth.exec(a),protocol:d.protocol||c,hostname:d.hostname||b,port:d.port?U.parse(d.port,10):"",pathname:d.pathname,search:d.search||"",hash:d.hash||"",host:d.host||b},K.ie&&(":"===e.protocol&&(e.protocol=l.protocol),string.isEmpty(e.hostname)&&(e.hostname=l.hostname),string.isEmpty(e.host)&&(e.host=l.host),"/"!==e.pathname.charAt(0)&&(e.pathname="/"+e.pathname)),e.auth=d.auth||(null===e.auth?"":e.auth[1]),e.href=d.href||e.protocol+"//"+(string.isEmpty(e.auth)?"":e.auth+"@")+e.host+e.pathname+e.search+e.hash,e.path=d.path||e.pathname+e.search,e.query=utility.queryString(null,e.search),e},partial:function(){var a=array.cast(arguments),b=a.shift();return function(){return b.apply(b,a.concat(array.cast(arguments)))}},prevent:function(a){return"function"==typeof a.preventDefault&&a.preventDefault(),a},queryString:function(a,b){var c={},d=void 0!==b?b.indexOf("?")>-1?b.replace(/.*\?/,""):null:n||string.isEmpty(l.search)?null:l.search.replace("?","");return null===d||string.isEmpty(d)||(d=d.split("&"),array.each(d,function(a){var b=a.split("=");string.isEmpty(b[0])||(b[1]=void 0===b[1]?"":utility.coerce(decodeURIComponent(b[1])),void 0===c[b[0]]?c[b[0]]=b[1]:c[b[0]]instanceof Array?c[b[0]].push(b[1]):(c[b[0]]=[c[b[0]]],c[b[0]].push(b[1])))})),null!==a&&void 0!==a&&(c=c[a]),c},race:function(){var a=P.factory(),b=array.cast(arguments);return b[0]instanceof Array&&(b=b[0]),0===b.length?a.resolve(null):Promise.race(b).then(function(b){a.resolve(b)},function(b){a.reject(b)}),a},render:function(a){var b=P.factory();return h(function(c){try{b.resolve(a(c))}catch(d){b.reject(d)}}),b},repeat:function(a,b,c,d){return b=b||10,c=c||utility.uuid(!0),d=d!==!1,d&&a()===!1?void 0:(utility.defer(function(){var d=function(a,b,c){var d=this;a()!==!1?utility.repeating[c]=setTimeout(function(){d.call(d,a,b,c)},b):delete utility.repeating[c]};d.call(d,a,b,c)},b,c,!0),c)},stop:function(a){return"function"==typeof a.stopPropagation&&a.stopPropagation(),utility.prevent(a),a},target:function(a){return a.target||a.srcElement},uuid:function(a){var b,c=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},d=[8,9,"a","b"];return b=c()+c()+"-"+c()+"-4"+c().substr(0,3)+"-"+d[Math.floor(4*Math.random())]+c().substr(0,3)+"-"+c()+c()+c(),a===!0&&(b=b.replace(/-/g,"")),b},walk:function(a,b){var c=a;return array.each(b.replace(/\]$/,"").replace(/\]/g,".").replace(/\.\./g,".").split(/\.|\[/),function(a){return void 0===c[a]||null===c[a]?(c=void 0,!1):void(c=c[a])}),c},when:function(){var a=P.factory(),b=array.cast(arguments);return b[0]instanceof Array&&(b=b[0]),0===b.length?a.resolve(null):Promise.all(b).then(function(b){a.resolve(b)},function(b){a.reject(b)}),a},worker:function(a){var b=new Worker(j);return b.onerror=function(c){a.reject(c),b.terminate()},b.onmessage=function(c){a.resolve(c.data),b.terminate()},b}},W={decode:function(a){if("string"!=typeof a||string.isEmpty(a))throw new Error(S.invalidArguments);return(new DOMParser).parseFromString(a,"text/xml")},encode:function(a,b){try{if(void 0===a)throw new Error(S.invalidArguments);b=b!==!1;var c,d=b?"<xml>":"",e=arguments[2]!==!1;return c=function(a,b){var c="<n>v</n>";return c=c.replace("v",regex.cdata.test(b)?"<![CDATA["+b+"]]>":b),c.replace(/<(\/)?n>/g,"<$1"+a+">")},null!==a&&a.xml&&(a=a.xml),a instanceof Document&&(a=(new XMLSerializer).serializeToString(a)),regex.boolean_number_string.test(typeof a)?d+=c("item",a):"object"==typeof a&&utility.iterate(a,function(a,b){d+=W.encode(a,"object"==typeof a,!1).replace(/item|xml/g,isNaN(b)?b:"item")}),d+=b?"</xml>":"",e&&(d='<?xml version="1.0" encoding="UTF8"?>'+d),d}catch(f){return void utility.error(f,arguments,this)}},valid:function(a){return 0===W.decode(a).getElementsByTagName("parsererror").length}};return C(),{filter:M.factory,list:O.factory,grid:N.factory,store:store.factory,util:{$:utility.$,array:array,base:utility.base,clone:utility.clone,coerce:utility.coerce,curry:utility.curry,csv:L,defer:P.factory,element:Q,extend:utility.extend,genId:utility.genId,iterate:utility.iterate,json:R,jsonp:K.jsonp,log:utility.log,lru:G.factory,math:T,merge:utility.merge,number:U,observer:H.factory,parse:utility.parse,partial:utility.partial,prevent:utility.prevent,race:utility.race,render:utility.render,repeat:utility.repeat,request:K.request,stop:utility.stop,string:string,target:utility.target,uuid:utility.uuid,walk:utility.walk,when:utility.when},version:"1.0.2"}}(),"undefined"!=typeof exports?module.exports=e:"function"==typeof define?define(function(){return e}):a.keigai=e}(this);
//# sourceMappingURL=keigai.min.js.map