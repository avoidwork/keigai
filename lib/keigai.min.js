/*
 2015 Jason Mulligan
 @version 1.1.4
 */
"use strict";var _this=this,_inherits=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(a.__proto__=b)},_prototypeProperties=function(a,b,c){b&&Object.defineProperties(a,b),c&&Object.defineProperties(a.prototype,c)};!function(a){var b=a.document,c=a.location,d=a.navigator,e="undefined"!=typeof process,f=10,g=100,h=500,i=["readystatechange","abort","load","loadstart","loadend","error","progress","timeout"],j=function(){},k=a.Promise||void 0,l=a.localStorage||void 0,m=a.XMLHttpRequest||null,n=a.WeakMap||null,o=a.btoa||void 0,p="undefined"!=typeof Blob&&"undefined"!=typeof Worker,q=void 0,r=void 0,s=void 0,t=void 0,u=void 0,v=void 0,w=void 0,x=void 0,y=void 0,z=void 0;e&&(w=require("url"),s=require("http"),t=require("https"),v=require("mongodb").MongoClient,r=require("util").format,j=require("buffer").Buffer,"undefined"==typeof k&&(k=require("es6-promise").Promise),"undefined"==typeof l&&(l=require("localStorage")),"undefined"==typeof o&&(o=require("btoa")));var u=function(){var regex={after_space:/\s+.*/,allow:/^allow$/i,allow_cors:/^access-control-allow-methods$/i,and:/^&/,args:/\((.*)\)/,auth:/\/\/(.*)\@/,bool:/^(true|false)?$/,caps:/[A-Z]/,cdata:/\&|<|>|\"|\'|\t|\r|\n|\@|\$/,checked_disabled:/checked|disabled/i,complete_loaded:/^(complete|loaded)$/i,csv_quote:/^\s|\"|\n|,|\s$/,del:/^del/,domain:/^[\w.-_]+\.[A-Za-z]{2,}$/,down:/down/,endslash:/\/$/,eol_nl:/\n$/,element_update:/id|innerHTML|innerText|textContent|type|src/,get_headers:/^(head|get|options)$/,get_remove_set:/get|remove|set/,hash:/^\#/,header_replace:/:.*/,header_value_replace:/.*:\s+/,html:/^<.*>$/,http_body:/200|201|202|203|206/,http_ports:/80|443/,host:/\/\/(.*)\//,ie:/msie|ie|\.net|windows\snt/i,ip:/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,is_xml:/^<\?xml.*\?>/,json_maybe:/json|plain|javascript/,json_wrap:/^[\[\{]/,klass:/^\./,no:/no-store|no-cache/i,not_dotnotation:/-|\s/,not_endpoint:/.*\//,null_undefined:/null|undefined/,number:/(^-?\d\d*\.\d*$)|(^-?\d\d*$)|(^-?\.\d\d*$)|number/,number_format_1:/.*\./,number_format_2:/\..*/,number_present:/\d{1,}/,number_string:/number|string/i,number_string_object:/number|object|string/i,object_type:/\[object Object\]/,patch:/^patch$/,primitive:/^(boolean|function|number|string)$/,priv:/private/,protocol:/^(.*)\/\//,put_post:/^(post|put)$/i,radio_checkbox:/^(radio|checkbox)$/i,root:/^\/[^\/]/,select:/select/i,selector_is:/^:/,selector_complex:/\s+|\>|\+|\~|\:|\[/,set_del:/^(set|del|delete)$/,space_hyphen:/\s|-/,string_object:/string|object/i,svg:/svg/,top_bottom:/top|bottom/i,url:/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/i,word:/^\w+$/,xdomainrequest:/^(get|post)$/i,xml:/xml/i},r=function(){function a(){var a=void 0===arguments[0]?1e3:arguments[0];this.cache={},this.max=a,this.first=null,this.last=null,this.length=0}return _prototypeProperties(a,null,{evict:{value:function(){return null!==this.last&&this.remove(this.last),this},writable:!0,enumerable:!0,configurable:!0},get:{value:function(a){var b=this.cache[a];if(void 0!==b)return this.set(a,b.value),b.value},writable:!0,enumerable:!0,configurable:!0},remove:{value:function(a){var b=this.cache[a];return b&&(delete this.cache[a],this.length--,null!==b.previous&&(this.cache[b.previous].next=b.next),null!==b.next&&(this.cache[b.next].previous=b.previous),this.first===a&&(this.first=b.previous),this.last===a&&(this.last=b.next)),b},writable:!0,enumerable:!0,configurable:!0},set:{value:function(a,b){var c=this.remove(a);return void 0===c?c=new u(b):c.value=b,c.next=null,c.previous=this.first,this.cache[a]=c,null!==this.first&&(this.cache[this.first].next=a),this.first=a,null===this.last&&(this.last=a),++this.length>this.max&&this.evict(),this},writable:!0,enumerable:!0,configurable:!0}}),a}(),u=function(a){this.next=null,this.previous=null,this.value=a},A={factory:function(a){return new r(a)}},B=function(){function a(){var a=this,b=void 0===arguments[0]?f:arguments[0];return function(){a.limit=b,a.listeners={},a.hooks=new n}()}return _prototypeProperties(a,null,{dispatch:{value:function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return a&&this.listeners[a]&&utility.iterate(this.listeners[a],function(a){a.handler.apply(a.scope,c)}),this},writable:!0,enumerable:!0,configurable:!0},hook:{value:function(a,b){if("function"!=typeof a.addEventListener)throw new Error(S.invalidArguments);var c=this,d=this.hooks.get(a)||{};return d[b]=function(a){c.dispatch(b,a)},this.hooks.set(a,d),a.addEventListener(b,this.hooks.get(a)[b],!1),a},writable:!0,enumerable:!0,configurable:!0},off:{value:function(a,b){return this.listeners[a]&&(b?delete this.listeners[a][b]:delete this.listeners[a]),this},writable:!0,enumerable:!0,configurable:!0},on:{value:function(a,b,c,d){var e=this,c=void 0===arguments[2]?utility.uuid():arguments[2];return function(){if(e.listeners[a]||(e.listeners[a]={}),array.keys(e.listeners[a]).length>=e.limit)throw new Error("Possible memory leak, more than "+e.limit+" listeners for event: "+a);return e.listeners[a][c]={scope:d||e,handler:b},e}()},writable:!0,enumerable:!0,configurable:!0},once:{value:function(a,b,c,d){var e=this,c=void 0===arguments[2]?utility.uuid():arguments[2];return function(){d=d||e;var f=e;return e.on(a,function(){for(var e=arguments.length,g=Array(e),h=0;e>h;h++)g[h]=arguments[h];b.apply(d,g),f.off(a,c)},c,d)}()},writable:!0,enumerable:!0,configurable:!0},unhook:{value:function(a,b){var c=this.hooks.get(a);return c&&(a.removeEventListener(b,c[b],!1),delete c[b],0===array.keys(c).length?this.hooks["delete"](a):this.hooks.set(a,c)),a},writable:!0,enumerable:!0,configurable:!0}}),a}(),C={factory:function(a){return new B(a)}},D=function(){function a(){this.observer=null}return _prototypeProperties(a,null,{addEventListener:{value:function(a,b,c,d){return this.observer.on(a,b,c,d||this),this},writable:!0,enumerable:!0,configurable:!0},addListener:{value:function(a,b,c,d){return this.observer.on(a,b,c,d||this),this},writable:!0,enumerable:!0,configurable:!0},dispatch:{value:function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return this.observer.dispatch.apply(this.observer,b),this},writable:!0,enumerable:!0,configurable:!0},dispatchEvent:{value:function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return this.observer.dispatch.apply(this.observer,b),this},writable:!0,enumerable:!0,configurable:!0},emit:{value:function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return this.observer.dispatch.apply(this.observer,b),this},writable:!0,enumerable:!0,configurable:!0},hook:{value:function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return this.observer.hook.apply(this.observer,b),this},writable:!0,enumerable:!0,configurable:!0},listeners:{value:function(a){return a?this.observer.listeners[a]:this.observer.listeners},writable:!0,enumerable:!0,configurable:!0},off:{value:function(a,b){return this.observer.off(a,b),this},writable:!0,enumerable:!0,configurable:!0},on:{value:function(a,b,c,d){return this.observer.on(a,b,c,d||this),this},writable:!0,enumerable:!0,configurable:!0},once:{value:function(a,b,c,d){return this.observer.once(a,b,c,d||this),this},writable:!0,enumerable:!0,configurable:!0},removeEventListener:{value:function(a,b){return this.observer.off(a,b),this},writable:!0,enumerable:!0,configurable:!0},removeListener:{value:function(a,b){return this.observer.off(a,b),this},writable:!0,enumerable:!0,configurable:!0}}),a}(),array={add:function(a,b){return array.contains(a,b)||a.push(b),a},binIndex:function(a,b){for(var c=a.length-1,d=0,e=0,f=0;c>=d;)if(e=Math.floor((d+c)/2),f=a[e],b>f)d=e+1;else{if(!(f>b))return e;c=e-1}return-1},cast:function(a,b){var c=[];return isNaN(a.length)?b===!0?c=array.keys(a):utility.iterate(a,function(a){c.push(a)}):c=Array.from(a),c},chunk:function(a,b){for(var c=[],d=U.round(a.length/b,"up"),e=0,f=-1;++f<d;)e=f*b,c.push(array.limit(a,e,b));return c},clear:function(a){return a.length>0?array.remove(a,0,a.length):a},clone:function(a){var b=void 0===arguments[1]?!0:arguments[1];return utility.clone(a,b)},contains:function(a,b){return a.indexOf(b)>-1},collect:function(a,b){var c=[];return array.each(a,function(a){c.push(b(a))}),c},compact:function(a,b){var c=a.filter(function(a){return!regex.null_undefined.test(a)});return b!==!0?c:c.length<a.length?c:null},count:function(a,b){return a.filter(function(a){return a===b}).length},diff:function(a,b){var c=[];return array.each(a,function(a){array.contains(b,a)||array.add(c,a)}),array.each(b,function(b){array.contains(a,b)||array.add(c,b)}),c},each:function(a,b,c){var d=void 0===arguments[3]?10:arguments[3],e=a.length,f=void 0,g=void 0;if(c!==!0)for(f=-1;++f<e&&b.call(a,a[f],f)!==!1;);else g=0,d>e&&(d=e),utility.repeat(function(){for(var c=-1,f=void 0;++c<d;)if(f=c+g,f===e||b.call(a,a[f],f)===!1)return!1;return g+=d,g>=e?!1:void 0},void 0,void 0,!1);return a},eachReverse:function(a,b,c,d){var e=a.length,f=void 0,g=void 0;if(c!==!0)for(f=e;--f>-1&&b.call(a,a[f],f)!==!1;);else d=d||10,g=e-1,d>e&&(d=e),utility.repeat(function(){for(var c=-1,e=void 0;++c<d;)if(e=g-c,0>e||b.call(a,a[e],e)===!1)return!1;return g-=d,0>g?!1:void 0},void 0,void 0,!1);return a},empty:function(a){return 0===a.length},equal:function(a,b){return R.encode(a)===R.encode(b)},fill:function(a,b,c,d){var e="function"==typeof b,f=a.length,g=isNaN(c)?0:c,h=isNaN(d)?f-1:g+d;if(h>f-1&&(h=f-1),e)for(;h>=g;)a[g]=b(a[g]),g++;else for(;h>=g;)a[g]=b,g++;return a},first:function(a){return a[0]},flat:function(a){var b=[];return b=a.reduce(function(a,b){return a.concat(b)},b)},forEach:function(a,b,c,d){return array.each(a,b,c,d)},fromObject:function(a){return array.mingle(array.keys(a),array.cast(a))},index:function(a,b){return a.indexOf(b)},indexed:function(a){var b=[];return utility.iterate(a,function(a){b.push(a)}),b},intersect:function(a,b){var c=a.length>b.length?a:b,d=c===a?b:a;return c.filter(function(a){return array.contains(d,a)})},iterate:function(a,b){var c=array.iterator(a),d=void 0;do d=c.next(),b(d.value);while(!d.done);return a},iterator:function(a){var b=-1;return{next:function(){return++b<a.length?{done:!1,value:a[b]}:{done:!0}}}},keepIf:function(a,b){var c=[],d=[];return c=a.filter(b),d=array.diff(a,c),array.each(d,function(b){array.remove(a,array.index(a,b))}),a},keys:function(a){return Array.keys(a)},keySort:function(a,b,c){b=b.replace(/\s*asc/gi,"").replace(/\s*desc/gi," desc");var d=string.explode(b).map(function(a){return a.split(" ")}),e=[],f='["',g='"]';return c=c&&""!==c?"."+c:"",array.each(d,function(a){var b=".",d="";regex.not_dotnotation.test(a[0])&&(b=f,d=g),e.push("try {"),"desc"===a[1]?(e.push("if ( a"+c+b+a[0]+d+" < b"+c+b+a[0]+d+" ) return 1;"),e.push("if ( a"+c+b+a[0]+d+" > b"+c+b+a[0]+d+" ) return -1;")):(e.push("if ( a"+c+b+a[0]+d+" < b"+c+b+a[0]+d+" ) return -1;"),e.push("if ( a"+c+b+a[0]+d+" > b"+c+b+a[0]+d+" ) return 1;")),e.push("} catch (e) {"),e.push("try {"),e.push("if ( a"+c+b+a[0]+d+" !== undefined ) return "+("desc"===a[1]?"-1":"1")+";"),e.push("} catch (e) {}"),e.push("try {"),e.push("if ( b"+c+b+a[0]+d+" !== undefined ) return "+("desc"===a[1]?"1":"-1")+";"),e.push("} catch (e) {}"),e.push("}")}),e.push("return 0;"),a.sort(new Function("a","b",e.join("\n")))},last:function(a,b){var c=a.length-1;return b>=c+1?a:isNaN(b)||1===b?a[c]:array.limit(a,c- --b,c)},limit:function(a,b,c){var d=[],e=b-1,f=b+c,g=a.length;if(g>0)for(;++e<f&&g>e;)d.push(a[e]);return d},max:function(a){return array.last(array.sorted(array.clone(a)))},mean:function(a){return a.length>0?array.sum(a)/a.length:void 0},median:function(a){var b=array.sorted(array.clone(a)),c=b.length,d=U.round(c/2,"down");return U.odd(c)?b[d]:(b[d-1]+b[d])/2},merge:function(a,b){return array.each(b,function(b){array.add(a,b)}),a},min:function(a){return array.sorted(array.clone(a))[0]},mingle:function(a,b){var c=a.map(function(a,c){return[a,b[c]]});return c},mode:function(a){var b={},c=0,d=[],e=void 0,f=void 0;return array.each(a,function(a){isNaN(b[a])?b[a]=1:b[a]++}),c=array.max(array.cast(b)),utility.iterate(b,function(a,b){a===c&&d.push(U.parse(b))}),e=d.length,e>0&&(f=1===e?d[0]:d),f},range:function(a){return array.max(a)-array.min(a)},rassoc:function(a,b){var c=void 0;return array.each(a,function(d,e){return d[1]===b?(c=utility.clone(a[e],!0),!1):void 0}),c},reject:function(a,b){return array.diff(a,a.filter(b))},remove:function(a,b,c){if(isNaN(b)){if(b=array.index(a,b),-1===b)return a}else b=b||0;var d=a.length,e=a.slice((c||b)+1||d);return a.length=0>b?d+b:b,a.push.apply(a,e),a},removeIf:function(a,b){var c=a.filter(b);return array.each(c,function(b){array.remove(a,array.index(a,b))}),a},removeWhile:function(a,b){var c=[];return array.each(a,function(a){return b(a)===!1?!1:void c.push(a)}),array.each(c,function(b){array.remove(a,array.index(a,b))}),a},replace:function(a,b){return array.remove(a,0,a.length),array.each(b,function(b){a.push(b)}),a},rest:function(a){var b=void 0===arguments[1]?1:arguments[1];return 1>b&&(b=1),array.limit(a,b,a.length)},rindex:function(a,b){var c=-1;return array.each(a,function(a,d){a===b&&(c=d)}),c},rotate:function(a,b){var c=a.length,d=void 0;return 0===b?d=a:(0>b?b+=c:b--,d=array.limit(a,b,c),d=d.concat(array.limit(a,0,b))),d},series:function(a,b){var a=void 0===arguments[0]?0:arguments[0],c=void 0===arguments[2]?1:arguments[2];b=b||a;for(var d=[],e=-1,f=Math.max(0,Math.ceil((b-a)/c));++e<f;)d[e]=a,a+=c;return d},sort:function(a,b){var c={a:typeof a,b:typeof b},d=void 0,e=void 0,f=void 0;return"number"==c.a&&"number"==c.b?f=a-b:(d=a.toString(),e=b.toString(),f=e>d?-1:d>e?1:c.a==c.b?0:"boolean"==c.a?-1:1),f},sorted:function(a){return a.sort(array.sort)},split:function(a,b){var c=[],d=a.length,e=Math.ceil(d/b),f=Math.floor(d/b),g=Math.ceil(d/e),h=!1,i=0,j=-1;for(U.diff(d,b*e)>e?g=d-f*b+f-1:d%b>0&&g*e>=d&&g--;++j<b;)j>0&&(i+=e),!h&&b>g&&j===g&&(--e,h=!0),c.push(array.limit(a,i,e));return c},stddev:function(a){return Math.sqrt(array.variance(a))},sum:function(a){var b=0;return a.length>0&&(b=a.reduce(function(a,b){return a+b})),b},take:function(a,b){return array.limit(a,0,b)},toObject:function(a){for(var b={},c=a.length;c--;)b[c.toString()]=a[c];return b},total:function(a){return array.indexed(a).length},unique:function(a){var b=[];return array.each(a,function(a){array.add(b,a)}),b},variance:function(a){var b=a.length,c=0,d=void 0;return b>0?(d=array.mean(a),array.each(a,function(a){c+=T.sqr(a-d)}),c/b):c},zip:function(a,b){var c=[];return b instanceof Array||(b="object"==typeof b?array.cast(b):[b]),array.each(b,function(a,b){a instanceof Array||(_this[b]=[a])}),array.each(a,function(a,d){c[d]=[a],array.each(b,function(a){c[d].push(a[d]||null)})}),c}},E={lru:A.factory(h),expire:function(a){return E.lru.cache[a]?(E.lru.remove(a),!0):!1},expired:function(a){var b=E.lru.cache[a];return b&&b.value.expires<(new Date).getTime()},get:function(a,b){a=utility.parse(a).href;var c=E.lru.get(a);return c?b!==!1&&E.expired(a)?(E.expire(a),!1):utility.clone(c,!0):!1},set:function(a,b,c){a=utility.parse(a).href;var d=E.lru.get(a);return d||(d={permission:0}),"permission"===b?d.permission|=c:"!permission"===b?d.permission&=~c:d[b]=c,E.lru.set(a,d),d}},F=function(a){function b(a){this.observer=C.factory(),this.defer=P.factory(),this.xhr=a}return _inherits(b,a),b}(D),G={ab:"undefined"!=typeof ArrayBuffer,blob:"undefined"!=typeof Blob,doc:"undefined"!=typeof Document,ie:function(){return!e&&regex.ie.test(d.userAgent)}(),version:function(){var a=0;return G.ie&&(a=U.parse(string.trim(d.userAgent.replace(/( .*msie|;.*)/gi,""))||9,10)),a},allows:function(a,b){a=utility.parse(a).href,b=b.toLowerCase();var c=!1,d=0;return E.get(a,!1)?(regex.del.test(b)?d=1:regex.get_headers.test(b)?d=4:regex.put_post.test(b)?d=2:regex.patch.test(b)&&(d=8),c=Boolean(G.permissions(a,b).bit&d)):c=void 0,c},bit:function(a){var b=0;return array.each(a,function(a){a=a.toLowerCase(),regex.get_headers.test(a)?b|=4:regex.put_post.test(a)?b|=2:regex.patch.test(a)?b|=8:regex.del.test(a)&&(b|=1)}),b},cors:function(a){return!e&&a.indexOf("//")>-1&&-1===a.indexOf("//"+c.host)},headers:function(a,b,c){var d=string.trim(a.getAllResponseHeaders()).split("\n"),e={},f={},g=null,h=new Date,i=G.cors(b);return array.each(d,function(a){var b=a.split(": ");e[b[0].toLowerCase()]=string.trim(b[1]),null===g&&(!i&&regex.allow.test(b)||i&&regex.allow_cors.test(b))&&(g=b[1])}),h=regex.no.test(e["cache-control"])?h.getTime():e["cache-control"]&&regex.number_present.test(e["cache-control"])?h.setSeconds(h.getSeconds()+U.parse(regex.number_present.exec(e["cache-control"])[0],10)):e.expires?new Date(e.expires).getTime():h.getTime(),f.expires=h,f.headers=e,f.timestamp=new Date,f.permission=G.bit(null!==g?string.explode(g):[c]),"get"===c&&(E.set(b,"expires",f.expires),E.set(b,"headers",f.headers),E.set(b,"timestamp",f.timestamp),E.set(b,"permission",f.permission)),f},parse:function(a){var b=void 0===arguments[1]?"":arguments[1],c=void 0,d=void 0;return(regex.json_maybe.test(b)||string.isEmpty(b))&&regex.json_wrap.test(a.responseText)&&Boolean(d=R.decode(a.responseText,!0))?c=d:"text/csv"===b?c=H.decode(a.responseText):"text/tsv"===b?c=H.decode(a.responseText,"	"):regex.xml.test(b)?("text/xml"!==b&&a.overrideMimeType("text/xml"),c=a.responseXML):c="text/plain"===b&&regex.is_xml.test(a.responseText)&&Z.valid(a.responseText)?Z.decode(a.responseText):a.responseText,c},permissions:function(a){var b=E.get(a,!1),c=b?b.permission:0,d={allows:[],bit:c,map:{partial:8,read:4,write:2,"delete":1,unknown:0}};return 1&c&&d.allows.push("DELETE"),2&c&&(d.allows.push("POST"),d.allows.push("PUT")),4&c&&d.allows.push("GET"),8&c&&d.allows.push("PATCH"),d},jsonp:function(b,c){var d=P.factory(),e="callback",f=void 0,g=void 0;void 0===q&&(a.keigai||(a.keigai={callback:{}}),q="keigai"),c instanceof Object&&!c.callback&&(e=c.callback);do f=utility.genId().slice(0,10);while(a.callback[f]);return b=b.replace(e+"=?",e+"="+q+".callback."+f),a.callback[f]=function(b){utility.clearTimers(f),delete a.callback[f],d.resolve(b),Q.destroy(g)},g=Q.create("script",{src:b,type:"text/javascript"},utility.dom("head")[0]),utility.defer(function(){d.reject(new Error(S.requestTimeout))},3e4,f),d},kxhr:function(a){var b=new F(a);return array.each(array.keys(O.prototype),function(a){b[a]=function(){for(var c=arguments.length,d=Array(c),e=0;c>e;e++)d[e]=arguments[e];return b.defer[a].apply(b.defer,d)}}),array.each(i,function(a){b.hook(b.xhr,a)}),b},request:function(a,b,c,d){var b=void 0===arguments[1]?"GET":arguments[1];a=utility.parse(a).href,b=b.toLowerCase(),d=d instanceof Object?d:null;var f=G.cors(a),g=G.kxhr(!G.ie||!f||G.version>9?new m:new XDomainRequest),h=(regex.put_post.test(b)||regex.patch.test(b))&&c?c:null,i="get"===b?E.get(a):!1,k=null,l=G.doc,n=G.ab,o=G.blob;if(G.ie&&9===G.version&&f&&!regex.xdomainrequest.test(b))throw new Error(S.notAvailable);return g.on("readystatechange",function(a){var b=g.xhr.readyState;1===b?g.dispatch("beforeXHR",g.xhr,a):4===b&&g.dispatch("afterXHR",g.xhr,a)}),f||regex.get_headers.test(b)||G.allows(a,b)!==!1?"get"===b&&Boolean(i)?(e&&(g.xhr.readyState=4,g.xhr.status=200,g.xhr._resheaders=i.headers),g.dispatch("beforeXHR",g.xhr,null),g.resolve(i.response),void utility.delay(function(){g.dispatch("afterXHR",g.xhr,null)})):(utility.delay(function(){g.xhr.open(b.toUpperCase(),a,!0),null!==d&&d.hasOwnProperty("content-type")&&(k=d["content-type"]),f&&null===k&&(k="text/plain"),null!==h&&(h.hasOwnProperty("xml")&&(h=h.xml),l&&h instanceof Document&&(h=Z.decode(h)),"string"==typeof h&&regex.is_xml.test(h)&&(k="application/xml"),n&&h instanceof ArrayBuffer||o&&h instanceof Blob||h instanceof j||!(h instanceof Object)||(k="application/json",h=R.encode(h)),null===k&&(n&&h instanceof ArrayBuffer||o&&h instanceof Blob)&&(k="application/octet-stream"),null===k&&(k="application/x-www-form-urlencoded; charset=UTF-8")),(!G.ie||!f||G.version>9)&&(null===d&&(d={}),"object"==typeof i&&i.headers.hasOwnProperty("etag")&&(d.etag=i.headers.etag),null!==k&&(d["content-type"]=k),d.hasOwnProperty("callback")&&delete d.callback,d["x-requested-with"]="XMLHttpRequest",utility.iterate(d,function(a,b){null!==a&&"withCredentials"!==b&&g.xhr.setRequestHeader(b,a)}),"boolean"==typeof g.xhr.withCredentials&&null!==d&&"boolean"==typeof d.withCredentials&&(g.xhr.withCredentials=d.withCredentials)),g.on("load",function(){var c=g,d=G.ie&&void 0===c.xhr.readyState,f=!0,h=void 0,i=void 0,j=void 0,k=void 0;if(d||4!==g.xhr.readyState)d&&(i=G.parse(g.xhr,"text/plain"),E.set(a,"permission",G.bit(["get"])),E.set(a,"response",i),g.resolve(i));else switch(g.xhr.status){case 200:case 201:case 202:case 203:case 204:case 205:case 206:if(h=G.headers(g.xhr,a,b),"head"===b)return g.resolve(h.headers);if("options"===b)return g.resolve(h.headers);switch("delete"!==b?(e&&regex.priv.test(h.headers["cache-control"])&&(f=!1),regex.http_body.test(g.xhr.status)&&(j=h.headers["content-type"]||"",i=G.parse(g.xhr,j),void 0===i&&g.reject(new Error(S.serverError))),"get"===b&&f?E.set(a,"response",h.response=utility.clone(i,!0)):E.expire(a,!0)):"delete"===b&&E.expire(a,!0),g.xhr.status){case 200:case 202:case 203:case 206:g.resolve(i);break;case 201:void 0!==h.headers.location&&!string.isEmpty(h.headers.location)||string.isUrl(i)?(k=string.trim(h.headers.Location||i),G.request(k).then(function(a){c.resolve(a)},function(a){c.reject(a)})):g.resolve(i);break;case 204:case 205:g.resolve(null)}break;case 304:g.resolve(i);break;case 401:g.reject(new Error(g.xhr.responseText||S.serverUnauthorized));break;case 403:E.set(a,"!permission",G.bit([b])),g.reject(new Error(g.xhr.responseText||S.serverForbidden));break;case 405:E.set(a,"!permission",G.bit([b])),g.reject(new Error(g.xhr.responseText||S.serverInvalidMethod));break;default:g.reject(new Error(g.xhr.responseText||S.serverError))}}),g.on("error",function(a){g.reject(a)}),g.xhr.send(null!==h?h:void 0)}),g):(g.dispatch("beforeXHR",g.xhr,null),g.xhr.status=405,g.reject(new Error(S.methodNotAllowed)),void utility.delay(function(){g.dispatch("afterXHR",g.xhr,null)}))},scroll:function(a,b){var c=P(),d=G.scrollPos(),e=0;return b=(isNaN(b)?250:b)/100,utility.repeat(function(){var b=T.bezier(d[0],d[1],a[0],a[1],++e/100);return window.scrollTo(b[0],b[1]),100===e?(c.resolve(!0),!1):void 0},b,"scrolling"),c},scrollPos:function(){return[window.scrollX||0,window.scrollY||0]}},H={decode:function(a){for(var b=void 0===arguments[1]?",":arguments[1],regex=new RegExp(b+'(?=(?:[^"]|"(?:[^"])[^"]*")*$)'),c=string.trim(a).split("\n"),d=c.shift().split(b),e=[],f=c.length,g=d.length,h=-1,i=void 0,j=void 0,k=void 0;++h<f;){for(j={},k=c[h].split(regex),i=-1;++i<g;)j[d[i]]=utility.coerce((k[i]||"").replace(/^"|"$/g,""));e.push(j)}return e},encode:function(a){var b=void 0===arguments[1]?",":arguments[1],c=void 0===arguments[2]?!0:arguments[2],d=R.decode(a,!0)||a,e="",f=function(a){var c=void 0;return a instanceof Array?(c='"'+a.toString()+'"',regex.object_type.test(c)&&(c='"'+H.encode(a,b)+'"')):c=a instanceof Object?'"'+H.encode(a,b)+'"':regex.csv_quote.test(a)?'"'+a.replace(/"/g,'""')+'"':a,c};return d instanceof Array?d[0]instanceof Object?(c&&(e=array.keys(d[0]).join(b)+"\n"),e+=d.map(function(a){return H.encode(a,b,!1)}).join("\n")):e+=f(d,b)+"\n":(c&&(e=array.keys(d).join(b)+"\n"),e+=array.cast(d).map(f).join(b)+"\n"),e.replace(regex.eol_nl,"")}},I=function(a){function b(a,b,c){this.debounce=c,this.element=a,this.filters={},this.list=b,this.observer=C.factory()}return _inherits(b,a),_prototypeProperties(b,null,{set:{value:function(a){var b=this;return this.filters={},array.each(string.explode(a),function(a){b.filters[a]=""}),this},writable:!0,enumerable:!0,configurable:!0},teardown:{value:function(){return this.observer.unhook(this.element,"keyup"),this.observer.unhook(this.element,"input"),this.element=null,this},writable:!0,enumerable:!0,configurable:!0},update:{value:function(){var a=this;return utility.defer(function(){var b=Q.val(a.element).toString();a.list.dispatch("beforeFilter",a.element,b),string.isEmpty(b)?a.list.filter=null:(utility.iterate(a.filters,function(c,d){var e=string.explode(b);e=e.filter(function(a){return!string.isEmpty(a)}),array.each(e,function(a,b){e[b]="^.*"+string.escape(a).replace(/(^\*|\*$)/g,"").replace(/\*/g,".*")+".*"}),a.filters[d]=e.join(",")}),a.list.filter=a.filters),a.list.pageIndex=1,a.list.refresh(),a.list.dispatch("afterFilter",a.element)},this.debounce,this.element.id+"Debounce"),this},writable:!0,enumerable:!0,configurable:!0}}),b}(D),J={factory:function(a,b,c){var d=void 0===arguments[3]?250:arguments[3],e=[b],f=new I(a,e[0],d).set(c);return Q.attr(a,"type","text"),f.observer.hook(f.element,"keyup"),f.observer.hook(f.element,"input"),f.on("keyup",f.update,"keyup"),f.on("input",f.update,"input"),f}},K=function(a){function b(a,store,b){var c=void 0===arguments[3]?[]:arguments[3],d=void 0===arguments[4]?{}:arguments[4],e=void 0===arguments[5]?!1:arguments[5],f=void 0;d.order&&!string.isEmpty(d.order)&&(f=string.explode(d.order).map(function(a){return a.replace(regex.after_space,"")})),this.element=Q.create("section",{"class":"grid"},a),this.fields=b,this.filtered=e,this.list=null,this.observer=C.factory(),this.options=d,this.store=store,this.sortable=c,this.sortOrder=f||c}return _inherits(b,a),_prototypeProperties(b,null,{add:{value:function(a){var b=this;return this.store.set(null,a).then(null,function(a){utility.error(a),b.dispatch("error",a)}),this},writable:!0,enumerable:!0,configurable:!0},dump:{value:function(){return this.store.dump(this.list.records,this.fields)},writable:!0,enumerable:!0,configurable:!0},refresh:{value:function(){var a=[],b=this;return this.dispatch("beforeRefresh",this.element),this.sortOrder.length>0&&(array.each(this.sortOrder,function(c){var d=Q.find(b.element,".header span[data-field='"+c+"']")[0];a.push(string.trim(c+" "+(Q.data(d,"sort")||"")))}),this.options.order=this.list.order=a.join(", ")),this.list.where=null,utility.merge(this.list,this.options),this.list.refresh(),this.dispatch("afterRefresh",this.element),this},writable:!0,enumerable:!0,configurable:!0},remove:{value:function(a){var b=this;return this.store.del(a).then(null,function(a){utility.error(a),b.dispatch("error",a)}),this},writable:!0,enumerable:!0,configurable:!0},sort:{value:function(a){var b=utility.target(a),c=void 0;return utility.stop(a),Q.hasClass(b,"sortable")&&(c=Q.data(b,"field"),Q.data(b,"sort","asc"===Q.data(b,"sort")?"desc":"asc"),array.remove(this.sortOrder,c),this.sortOrder.splice(0,0,c),this.refresh()),this},writable:!0,enumerable:!0,configurable:!0},teardown:{value:function(){return this.observer.unhook(Q.find(this.element,"ul.header")[0],"click"),this.list.teardown(),Q.destroy(this.element),this.element=null,this},writable:!0,enumerable:!0,configurable:!0},update:{value:function(a,b){var c=this;return this.store.update(a,b).then(null,function(a){utility.error(a),c.dispatch("error",a)}),this},writable:!0,enumerable:!0,configurable:!0}}),b}(D),L={factory:function(a,store,b,c,d,e){var f=[store],g=new K(a,f[0],b,c,d,e),h="",i=Q.create("li",{},Q.create("ul",{"class":"header"},g.element)),j=100/g.fields.length+"%",k="display:inline-block;width:"+j,l=g.options.order?string.explode(g.options.order):[];return array.each(g.fields,function(a){var b=a.replace(/.*\./g,""),c=Q.create("span",{innerHTML:string.capitalize(string.unCamelCase(string.unhyphenate(b,!0)).replace(/_|-/g," "),!0),style:k,"data-field":a},i);array.contains(g.sortable,a)&&(Q.addClass(c,"sortable"),l.filter(function(b){return 0===b.indexOf(a)}).length>0&&Q.data(c,"sort",array.contains(l,a+" desc")?"desc":"asc")),h+='<span class="'+a+'" data-field="'+a+'" style="'+k+'">{{'+a+"}}</span>"}),g.sortable.length>0&&g.observer.hook(i.parentNode,"click",g.sort,"sort",g),g.filtered===!0&&(g.options.listFiltered=!0,g.options.listFilter=g.fields.join(",")),f.push(N.factory(g.element,f[0],h,g.options)),g.list=f[1],g.on("beforeRefresh",function(a){Q.dispatch(a,"beforeRefresh")},"bubble"),g.on("afterRefresh",function(a){Q.dispatch(a,"afterRefresh")},"bubble"),g.on("click",function(a){Q.hasClass(a.currentTarget,"header")&&g.sort(a)},"header"),g.list.on("change",function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];g.dispatch.apply(g,["change"].concat(b))},"change"),g.list.on("beforeFilter",function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];g.dispatch.apply(g,["beforeFilter"].concat(b))},"beforeFilter"),g.list.on("afterFilter",function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];g.dispatch.apply(g,["afterFilter"].concat(b))},"afterFilter"),g}},M=function(a){function b(a,store,b){this.callback=null,this.current=[],this.element=a,this.emptyMsg=S.noData,this.filter=null,this.filtered=[],this.id=utility.genId(),this.items=[],this.listFilter=null,this.mutation=null,this.observer=C.factory(),this.pageIndex=1,this.pageSize=null,this.pageRange=5,this.pagination="bottom",this.placeholder="",this.order="",this.records=[],this.template=b,this.total=0,this.store=store,this.where=null}return _inherits(b,a),_prototypeProperties(b,null,{add:{value:function(a){var b=this;return this.store.set(null,a).then(null,function(a){utility.error(a),b.dispatch("error",a)}),this},writable:!0,enumerable:!0,configurable:!0},dump:{value:function(){return this.store.dump(this.records)},writable:!0,enumerable:!0,configurable:!0},page:{value:function(a){return this.pageIndex=a,this.refresh()},writable:!0,enumerable:!0,configurable:!0},pages:{value:function(){var a=this,b=this.element,c=this.pageIndex,d=this.pagination,e=this.pageRange,f=Math.floor(e/2),g=c-f,h=c+f,i=N.pages(this),j=void 0;return array.each(utility.dom("#"+b.id+"-pages-top, #"+b.id+"-pages-bottom"),function(b){b&&(a.observer.unhook(b,"click"),Q.destroy(b))}),this.filter&&0===this.filtered.length||0===this.total||1===i?this:(1>g&&(j=U.diff(g,1),g+=j,h+=j),h>i&&(h=i,g=h-e+1,1>g&&(g=1)),U.diff(g,h)>=e&&--h,array.each(string.explode(d),function(d){var e=!1,f=c>1,j=i>=c+1,k=c>=i,l=void 0,m=void 0;for(l=Q.create("ul",{"class":"list pages hidden "+d,id:b.id+"-pages-"+d},b,"bottom"===d?"after":"before"),Q.create(f?"a":"span",{"class":"first page","data-page":1,innerHTML:"&lt;&lt;"},Q.create("li",{},l)),Q.create(f?"a":"span",{"class":"prev page","data-page":c-1,innerHTML:"&lt;"},Q.create("li",{},l)),m=g-1;++m<=h;)e=m===c,Q.create(e?"span":"a",{"class":e?"current page":"page","data-page":m,innerHTML:m},Q.create("li",{},l));Q.create(j?"a":"span",{"class":"next page","data-page":j?c+1:null,innerHTML:"&gt;"},Q.create("li",{},l)),Q.create(k?"span":"a",{"class":"last page","data-page":k?null:i,innerHTML:"&gt;&gt;"},Q.create("li",{},l)),Q.removeClass(l,"hidden"),a.observer.hook(l,"click")}),this)},writable:!0,enumerable:!0,configurable:!0},refresh:{value:function(a){a=a===!0;var b=this,c=this.element,d="object"==typeof this.template,e=null!==this.filter,f=[],g="function"==typeof this.callback,h=new RegExp,i=[],j=[],k=void 0,l=void 0,m=void 0;return this.dispatch("beforeRefresh",c),k=d?function(a){var c=R.encode(b.template),d=array.unique(c.match(/\{\{[\w\.\-\[\]]+\}\}/g));return c=c.replace("{{"+b.store.key+"}}",a.key),array.each(d,function(b){var d=b.replace(/\{\{|\}\}/g,""),e=utility.walk(a.data,d)||"";h.compile(string.escape(b),"g"),c=c.replace(h,R.encode(e).replace(/(^")|("$)/g,""))
}),c=R.decode(c.replace(/\{\{.*\}\}/g,b.placeholder)),{li:c}}:function(a){var c=b.template,d=array.unique(c.match(/\{\{[\w\.\-\[\]]+\}\}/g));return c=c.replace("{{"+b.store.key+"}}",a.key),array.each(d,function(b){var d=b.replace(/\{\{|\}\}/g,""),e=utility.walk(a.data,d);void 0===e&&(e=""),h.compile(string.escape(b),"g"),c=c.replace(h,e)}),c=c.replace(/\{\{.*\}\}/g,b.placeholder),'<li data-key="'+a.key+'">'+c+"</li>"},m=function(a){if(b.records=a,b.total=b.records.length,b.filtered=[],b.current=[],e&&array.each(b.records,function(a){utility.iterate(b.filter,function(c,d){var e=void 0;return array.contains(i,a.key)?!1:(e=d===b.store.key,void array.each(string.explode(c),function(c){var f=new RegExp(c,"i"),g=e?"":utility.walk(a.data,d);return e&&f.test(a.key)||f.test(g)?(i.push(a.key),b.filtered.push(a),!1):void 0}))})}),null===b.pageSize||isNaN(b.pageIndex)||isNaN(b.pageSize))b.current=e?b.filtered:b.records;else{if(l=N.pages(b),l>0&&b.pageIndex>l)return b.page(l);b.total>0&&(j=N.range(b),b.current=array.limit(e?b.filtered:b.records,j[0],j[1]))}array.each(b.current,function(a){var b=k(a),c=o(b);f.push({key:a.key,template:b,hash:c})}),utility.render(function(){var a=[],d=[],e=void 0,h=void 0;if(0===f.length)Q.html(c,'<li class="empty">'+b.emptyMsg+"</li>");else if(0===b.items.length)Q.html(c,f.map(function(a){return a.template}).join("")),g&&array.each(array.cast(c.childNodes),function(a){b.callback(a)});else{if(array.each(f,function(a,e){void 0!==b.items[e]&&b.items[e].hash!==a.hash?(Q.data(Q.html(c.childNodes[e],a.template.replace(/<li data-key=\"\d+\">|<\/li>/g,"")),"key",a.key),d.push(e)):void 0===b.items[e]&&(Q.create(a.template,null,c),d.push(e))}),f.length<b.items.length){for(e=f.length-1,h=b.items.length;++e<h;)a.push(e);array.each(a.reverse(),function(a){Q.destroy(c.childNodes[a])})}g&&array.each(d,function(a){b.callback(c.childNodes[a])})}b.items=f,null===b.pageSize||!regex.top_bottom.test(b.pagination)||isNaN(b.pageIndex)||isNaN(b.pageSize)?array.each(utility.$("#"+c.id+"-pages-top, #"+c.id+"-pages-bottom"),function(a){Q.destroy(a)}):b.pages(),b.dispatch("afterRefresh",c)})},null===this.where?string.isEmpty(this.order)?m(this.store.get()):this.store.sort(this.order,a).then(m,function(a){utility.error(a),b.dispatch("error",a)}):string.isEmpty(this.order)?this.store.select(this.where).then(m,function(a){utility.error(a),b.dispatch("error",a)}):this.store.sort(this.order,a,this.where).then(m,function(a){utility.error(a),b.dispatch("error",a)}),this},writable:!0,enumerable:!0,configurable:!0},remove:{value:function(a){var b=this;return this.store.del(a).then(null,function(a){utility.error(a),b.dispatch("error",a)}),this},writable:!0,enumerable:!0,configurable:!0},sort:{value:function(a){return this.order=a,this.refresh()},writable:!0,enumerable:!0,configurable:!0},teardown:{value:function(a){a=a===!0;var b=this,c=this.element,d=c.id;return array.each(this.store.lists,function(a,c){return a.id===b.id?(array.remove(b.store.lists,c),!1):void 0}),this.listFilter&&this.listFilter.teardown(),array.each(utility.$("#"+d+"-pages-top, #"+d+"-pages-bottom"),function(c){b.observer.unhook(c,"click"),a&&Q.destroy(c)}),this.observer.unhook(c,"click"),a&&Q.destroy(c),this.element=null,this},writable:!0,enumerable:!0,configurable:!0},update:{value:function(a,b){var c=this;return this.store.update(a,b).then(null,function(a){utility.error(a),c.dispatch("error",a)}),this},writable:!0,enumerable:!0,configurable:!0}}),b}(D),N={factory:function(a,store,b,c){var d=[store],e=new M(Q.create("ul",{"class":"list",id:utility.genId(null,!0)},a),d[0],b);return c instanceof Object&&(c.listFiltered&&c.listFilter&&(e.listFilter=J.factory(Q.create("input",{id:e.element.id+"-filter","class":"filter",placeholder:"Filter"},a,"first"),e,c.listFilter,c.debounce||250),delete c.listFilter,delete c.listFiltered,delete c.debounce),utility.merge(e,c)),e.store.lists.push(e),e.on("beforeRefresh",function(a){Q.dispatch(a,"beforeRefresh")},"bubble"),e.on("afterRefresh",function(a){Q.dispatch(a,"afterRefresh")},"bubble"),e.on("change",function(a){Q.dispatch(e.element,"change",a)},"change"),e.on("click",function(a){var b=utility.target(a),c=void 0;utility.stop(a),"A"===b.nodeName&&(c=Q.data(b,"page"),isNaN(c)||e.page(c))},"pagination"),"function"==typeof MutationObserver&&(e.mutation=new MutationObserver(function(a){e.dispatch("change",a)}),e.mutation.observe(e.element,{childList:!0,subtree:!0})),(null===e.store.uri||e.store.loaded)&&e.refresh(),e},pages:function(a){if(isNaN(a.pageSize))throw new Error(S.invalidArguments);return Math.ceil((a.filter?a.filtered.length:a.total)/a.pageSize)},range:function(a){var b=a.pageIndex*a.pageSize-a.pageSize,c=a.pageSize;return[b,c]}},O=function(){function a(){var a=this;this.promise=V.factory(),this.onDone=[],this.onAlways=[],this.onFail=[],this.promise.then(function(b){array.each(a.onDone,function(a){a(b)}),array.each(a.onAlways,function(a){a(b)}),a.onAlways=[],a.onDone=[],a.onFail=[]},function(b){array.each(a.onFail,function(a){a(b)}),array.each(a.onAlways,function(a){a(b)}),a.onAlways=[],a.onDone=[],a.onFail=[]})}return _prototypeProperties(a,null,{always:{value:function(a){return this.onAlways.push(a),this},writable:!0,enumerable:!0,configurable:!0},done:{value:function(a){return this.onDone.push(a),this},writable:!0,enumerable:!0,configurable:!0},fail:{value:function(a){return this.onFail.push(a),this},writable:!0,enumerable:!0,configurable:!0},reject:{value:function(a){return this.promise.reject.call(this.promise,a),this},writable:!0,enumerable:!0,configurable:!0},resolve:{value:function(a){return this.promise.resolve.call(this.promise,a),this},writable:!0,enumerable:!0,configurable:!0},then:{value:function(a,b){return this.promise.then(a,b)},writable:!0,enumerable:!0,configurable:!0}}),a}(),P={factory:function(){return new O}},Q={addClass:function(a,b){Q.klass(a,b,!0)},appendTo:function(a,b){return a.appendChild(b),a},attr:function(a,b,c){var d=void 0,e=void 0;if(regex.svg.test(a.namespaceURI))void 0===c?(e=a.getAttributeNS(a.namespaceURI,b),e=null===e||string.isEmpty(e)?void 0:utility.coerce(e)):a.setAttributeNS(a.namespaceURI,b,c);else{if("string"==typeof c&&(c=string.trim(c)),regex.checked_disabled.test(b)&&void 0===c)return utility.coerce(a[b]);if(regex.checked_disabled.test(b)&&void 0!==c)a[b]=c;else{if("SELECT"===a.nodeName&&"selected"===b&&void 0===c)return utility.dom("#"+a.id+' option[selected="selected"]')[0]||utility.dom("#"+a.id+" option")[0];if("SELECT"===a.nodeName&&"selected"===b&&void 0!==c)d=utility.dom("#"+a.id+' option[selected="selected"]')[0],void 0!==d&&(d.selected=!1,d.removeAttribute("selected")),d=utility.dom("#"+a.id+' option[value="'+c+'"]')[0],d.selected=!0,d.setAttribute("selected","selected");else{if(void 0===c)return e=a.getAttribute(b),e=null===e||string.isEmpty(e)?void 0:utility.coerce(e);a.setAttribute(b,c)}}}return a},clear:function(a){return"function"==typeof a.reset?a.reset():void 0!==a.value?Q.update(a,{innerHTML:"",value:""}):Q.update(a,{innerHTML:""}),a},create:function(a,c,d,e){var f=!1,g=!1,h=void 0,i=void 0;return a=a.replace(/\t|\n|\r/g,""),d?f=d.namespaceURI&&regex.svg.test(d.namespaceURI):d=b.body,regex.html.test(a)?(g=!0,h=Q.frag(a),i=1===h.childNodes.length?h.childNodes[0]:array.cast(h.childNodes)):(h=f||regex.svg.test(a)?b.createElementNS("http://www.w3.org/2000/svg",a):b.createElement(a),c instanceof Object&&Q.update(h,c)),e&&"last"!==e?"first"===e?Q.prependChild(d,h):"after"===e?(e={after:d},d=d.parentNode,d.insertBefore(h,e.after.nextSibling)):e.after?d.insertBefore(h,e.after.nextSibling):"before"===e?(e={before:d},d=d.parentNode,d.insertBefore(h,e.before)):e.before?d.insertBefore(h,e.before):d.appendChild(h):d.appendChild(h),g?i:h},css:function(a,b,c){return regex.caps.test(b)||(b=string.toCamelCase(b)),void 0!==c?(a.style[b]=c,a):a.style[b]},data:function(a,b,c){return void 0!==c?(a.setAttribute("data-"+b,regex.json_wrap.test(c)?R.encode(c):c),a):utility.coerce(a.getAttribute("data-"+b))},destroy:function(a){return void(null!==a.parentNode&&a.parentNode.removeChild(a))},disable:function(a){return"boolean"!=typeof a.disabled||a.disabled||(a.disabled=!0),a},dispatch:function(a,c){var d=void 0===arguments[2]?{}:arguments[2],e=void 0===arguments[3]?!0:arguments[3],f=void 0===arguments[4]?!0:arguments[4],g=void 0;if(a){try{g=new CustomEvent(c)}catch(h){g=b.createEvent("CustomEvent")}return g.initCustomEvent(c,e,f,d),a.dispatchEvent(g),a}},enable:function(a){return"boolean"==typeof a.disabled&&a.disabled&&(a.disabled=!1),a},find:function(a,b){var c=[];return array.each(string.explode(b),function(b){c=c.concat(array.cast(a.querySelectorAll(b)))}),c},frag:function(a){var c=b.createDocumentFragment();return a&&(array.each(array.cast(Q.create("div",{innerHTML:a},c).childNodes),function(a){c.appendChild(a)}),c.removeChild(c.childNodes[0])),c},has:function(a,b){var c=Q.find(a,b);return!isNaN(c.length)&&c.length>0},hasClass:function(a,b){return a.classList.contains(b)},hidden:function(a){return"none"===a.style.display||a.hidden===!0},html:function(a,b){return void 0===b?a.innerHTML:(a.innerHTML=b,a)},is:function(a,b){return regex.selector_is.test(b)?1===Q.find(a.parentNode,a.nodeName.toLowerCase()+b).filter(function(b){return b.id===a.id}).length:new RegExp(b,"i").test(a.nodeName)},klass:function(a,b){var c=void 0===arguments[2]?!0:arguments[2];return b=string.explode(b," "),c?array.each(b,function(b){a.classList.add(b)}):array.each(b,function(b){return"*"===b?(array.each(a.classList,function(b){a.classList.remove(b)}),!1):void a.classList.remove(b)}),a},position:function(){var a=void 0===arguments[0]?b.body:arguments[0];return function(){var c=void 0,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0;if(c=d=0,h=a.offsetWidth,g=a.offsetHeight,a.offsetParent){for(d=a.offsetTop,c=a.offsetLeft;a=a.offsetParent;)c+=a.offsetLeft,d+=a.offsetTop;e=b.body.offsetWidth-(c+h),f=b.body.offsetHeight-(d+g)}else e=h,f=g;return[c,d,e,f]}()},prependChild:function(a,b){return 0===a.childNodes.length?a.appendChild(b):a.insertBefore(b,a.childNodes[0])},removeAttr:function(a,b){return regex.svg.test(a.namespaceURI)?a.removeAttributeNS(a.namespaceURI,b):"SELECT"===a.nodeName&&"selected"===b?array.each(Q.find(a,"option"),function(a){return a.selected===!0?(a.selected=!1,a.removeAttribute("selected"),!1):void 0}):a.removeAttribute(b),a},removeClass:function(a,b){Q.klass(a,b,!1)},scrollTo:function(a,b,c,d){var e=array.remove(Q.position(a),2,3);return isNaN(c)||(e[0]+=c),isNaN(d)||(e[1]+=d),G.scroll(e,b)},serialize:function(a){var string=void 0===arguments[1]?!0:arguments[1],b=void 0===arguments[2]?!0:arguments[2],c={},d=void 0,e=void 0;return d="FORM"===a.nodeName?a.elements?array.cast(a.elements):a.find("button, input, select, textarea"):[a],array.each(d,function(a){var b=a.id||a.name||a.type;"FORM"===a.nodeName?utility.merge(c,R.decode(Q.serialize(a))):c[b]||(c[b]=Q.val(a))}),string?(e="",utility.iterate(c,function(a,c){e+=b?"&"+encodeURIComponent(c)+"="+encodeURIComponent(a):"&"+c+"="+a}),e=e.replace(regex.and,"?")):e=c,e},size:function(a){return[a.offsetWidth+U.parse(a.style.paddingLeft||0)+U.parse(a.style.paddingRight||0)+U.parse(a.style.borderLeft||0)+U.parse(a.style.borderRight||0),a.offsetHeight+U.parse(a.style.paddingTop||0)+U.parse(a.style.paddingBottom||0)+U.parse(a.style.borderTop||0)+U.parse(a.style.borderBottom||0)]},text:function(a,b){var c=a.textContent?"textContent":"innerText",d={},e=!1;return"undefined"!=typeof b&&(e=!0,d[c]=b),e?Q.update(a,d):a[c]},toggleClass:function(a,b){return a.classList.toggle(b),a},update:function(a,b){return utility.iterate(b,function(b,c){regex.element_update.test(c)?a[c]=b:"class"===c?string.isEmpty(b)?Q.removeClass(a,"*"):Q.addClass(a,b):0===c.indexOf("data-")?Q.data(a,c.replace("data-",""),b):Q.attr(a,c,b)}),a},val:function(a,b){var c="input",d=void 0;if(void 0===b){if(regex.radio_checkbox.test(a.type)){if(string.isEmpty(a.name))throw new Error(S.expectedProperty);array.each(utility.dom("input[name='"+a.name+"']"),function(a){return a.checked?(d=a.value,!1):void 0})}else regex.select.test(a.type)?(d=null,array.each(Q.find(a,"option"),function(a){return a.selected===!0?(d=a.value,!1):void 0})):d=a.value?a.value:Q.text(a);void 0!==d?(d=utility.coerce(d),"string"==typeof d&&(d=string.trim(d))):d=""}else b=b.toString(),regex.radio_checkbox.test(a.type)?(c="click",array.each(utility.dom("input[name='"+a.name+"']"),function(a){return a.value===b?(a.checked=!0,d=a,!1):void 0})):regex.select.test(a.type)?(c="change",array.each(Q.find(a," option"),function(a){return a.value===b?(a.selected=!0,d=a,!1):void 0})):void 0!==a.value?a.value=b:Q.text(a,b),Q.dispatch(a,c),d=a;return d}},R={decode:function(a,b){try{return JSON.parse(a)}catch(c){return void(b!==!0&&utility.error(c,[a,b],_this))}},encode:function(a,b){try{return JSON.stringify(a)}catch(c){return void(b!==!0&&utility.error(c,[a,b],_this))}}},S={expectedNumber:"Expected a Number",expectedProperty:"Expected a property, and it was not set",expectedObject:"Expected an Object",invalidArguments:"One or more arguments is invalid",invalidStateNoHeaders:"INVALID_STATE_ERR: Headers have not been received",invalidStateNoSync:"Synchronous XMLHttpRequest requests are not supported",invalidStateNotOpen:"INVALID_STATE_ERR: Object is not open",invalidStateNotSending:"INVALID_STATE_ERR: Object is sending",invalidStateNotUsable:"INVALID_STATE_ERR: Object is not usable",methodNotAllowed:"Method not allowed",noData:"Nothing to display",notAvailable:"Requested method is not available",datastoreNoPrevVersion:"No previous version found",requestTimeout:"Request timed out",serverError:"Server error has occurred",serverForbidden:"Forbidden to access URI",serverInvalidMethod:"Method not allowed",serverUnauthorized:"Authorization required to access URI",upgrade:"Your browser is too old to use keigai, please upgrade"},T={bezier:function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];var d=array.cast(b),e=d.pop(),f=array.chunk(d,2),g=f.length,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=void 0;if(2>g||g>4)throw new Error(S.invalidArguments);return h=[],i=1-e,j=T.sqr(i),k=2*i*e,l=T.sqr(e),m=Math.pow(i,3),n=3*j*e,o=3*i*l,p=Math.pow(e,3),2===g?(h.push(i*f[0][0]+e*f[1][0]),h.push(i*f[0][1]+e*f[1][1])):3===g?(h.push(j*f[0][0]+k*f[1][0]+(l+f[2][0])),h.push(j*f[0][1]+k*f[1][1]+(l+f[2][1]))):4===g&&(h.push(m*f[0][0]+n*f[1][0]+o*f[2][0]+p*f[3][0]),h.push(m*f[0][1]+n*f[1][1]+o*f[2][1]+p*f[3][1])),h},dist:function(a,b){return Math.sqrt(T.sqr(b[0]-a[0])+T.sqr(b[1]-a[1]))},sqr:function(a){return a*a}},U={diff:function(a,b){return Math.abs(a-b)},even:function(a){return a%2===0},format:function(a){var b=void 0===arguments[1]?",":arguments[1],c=void 0===arguments[2]?3:arguments[2];a=a.toString();var d=a.indexOf(".")>-1?"."+a.replace(regex.number_format_1,""):"",e=a.replace(regex.number_format_2,"").split("").reverse(),f=Math.floor(e.length/c),g=1,h=void 0,i=void 0;for(i=0;f>i;i++)h=1===g?c:c*g+(2===g?1:g-1),e.splice(h,0,b),g++;return e=e.reverse().join(""),e.charAt(0)===b&&(e=e.substring(1)),e+d},half:function(a,b){return b?a/b===.5:a/2},odd:function(a){return!U.even(a)},parse:function(a,b){return void 0===b?parseFloat(a):parseInt(a,b)},random:function(){var a=void 0===arguments[0]?100:arguments[0];return Math.floor(Math.random()*(a+1))},round:function(a,b){return a=U.parse(a),void 0===b||string.isEmpty(b)?U.parse(a.toFixed(0)):regex.down.test(b)?~~a:Math.ceil(a)}},V={factory:function(){var a=void 0,b=void 0,c=void 0,d=void 0,e=void 0;return a=new k(function(a,b){c=a,d=b}),b=function(){for(var b=arguments.length,c=Array(b),d=0;b>d;d++)c[d]=arguments[d];return a["catch"].apply(a,c)},e=function(){for(var b=arguments.length,c=Array(b),d=0;b>d;d++)c[d]=arguments[d];return a.then.apply(a,c)},{"catch":b,resolve:c,reject:d,then:e}}},W=function(a){function b(){this.autosave=!1,this.callback=null,this.credentials=null,this.lists=[],this.events=!0,this.expires=null,this.headers={Accept:"application/json"},this.ignore=[],this.index=[],this.indexes={key:{}},this.key=null,this.loaded=!1,this.mongodb="",this.observer=C.factory(),this.records=[],this.source=null,this.total=0,this.versions={},this.versioning=!0,this.views={},this.uri=null}return _inherits(b,a),_prototypeProperties(b,null,{batch:{value:function(a,b){var c=void 0===arguments[2]?!1:arguments[2],d=this,e=this.events,f=P.factory(),g=[];return!regex.set_del.test(a)||c&&regex.del.test(a)||"object"!=typeof b?f.reject(new Error(S.invalidArguments)):(e&&this.dispatch("beforeBatch",b),c&&this.clear(c),0===b.length?(this.loaded=!0,e&&this.dispatch("afterBatch",this.records),f.resolve(this.records)):("del"===a?array.each(b,function(a){g.push(d.del(a,!1,!0))}):array.each(b,function(a){g.push(d.set(null,a,!0))}),this.loaded=!1,utility.when(g).then(function(b){d.loaded=!0,e&&d.dispatch("afterBatch",b),array.each(d.lists,function(a){a.refresh(!0)}),"del"===a&&(d.records=array.compact(d.records),d.reindex()),d.autosave&&d.save(),f.resolve(b)},function(a){e&&d.dispatch("failedBatch",a),f.reject(a)}))),f},writable:!0,enumerable:!0,configurable:!0},buildUri:{value:function(a){var b=utility.parse(this.uri);return b.protocol+"//"+b.host+b.pathname+(regex.endslash.test(b.pathname)?"":"/")+a},writable:!0,enumerable:!0,configurable:!0},clear:{value:function(){var a=void 0===arguments[0]?!0:arguments[0],b=this.events===!0,c=this.autosave===!0;return a?(this.indexes={key:{}},this.loaded=!1,this.records=[],this.total=0,this.views={},array.each(this.lists,function(a){a&&a.refresh()})):(b&&this.dispatch("beforeClear"),array.each(this.lists,function(a){a&&a.teardown(!0)}),this.autosave=!1,this.callback=null,this.credentials=null,this.lists=[],this.events=!0,this.expires=null,this.headers={Accept:"application/json"},this.ignore=[],this.index=[],this.indexes={key:{}},this.key=null,this.loaded=!1,this.records=[],this.source=null,this.total=0,this.versions={},this.versioning=!0,this.views={},this.uri=null,b&&this.dispatch("afterClear")),c&&this.save(),this},writable:!0,enumerable:!0,configurable:!0},del:{value:function(a){var b=void 0===arguments[1]?!0:arguments[1],c=void 0===arguments[2]?!1:arguments[2];a=a.key?a:this.get(a);var d=this,e=P.factory();return void 0===a?e.reject(new Error(S.invalidArguments)):(this.events&&d.dispatch("beforeDelete",a),null===this.uri||null!==this.callback?this.delComplete(a,b,c,e):G.request(this.buildUri(a.key),"DELETE",null,utility.merge({withCredentials:this.credentials},this.headers)).then(function(){d.delComplete(a,b,c,e)},function(a){d.dispatch("failedDelete",a),e.reject(a)})),e},writable:!0,enumerable:!0,configurable:!0},delComplete:{value:function(a,b,c,d){var e=this;return delete this.indexes.key[a.key],delete this.versions[a.key],this.total--,this.views={},c?this.records[a.index]=null:(array.remove(this.records,a.index),b?this.reindex():array.each(a.indexes,function(b){array.remove(e.indexes[b[0]][b[1]],a.index),0===e.indexes[b[0]][b[1]].length&&delete e.indexes[b[0]][b[1]]}),this.autosave&&this.purge(a.key),this.events&&this.dispatch("afterDelete",a),array.each(this.lists,function(a){a.refresh()})),d.resolve(a.key)},writable:!0,enumerable:!0,configurable:!0},dump:{value:function(a,b){a=a||this.records;var c=this,d=b instanceof Array&&b.length>0,e=null!==this.key,f=void 0;return f=d?function(a){var d={};return array.each(b,function(b){d[b]=b===c.key?isNaN(a.key)?a.key:Number(a.key):utility.clone(a.data[b],!0)}),d}:function(a){var b={};return e&&(b[c.key]=isNaN(a.key)?a.key:Number(a.key)),utility.iterate(a.data,function(a,c){b[c]=utility.clone(a,!0)}),b},a.map(f)},writable:!0,enumerable:!0,configurable:!0},get:{value:function(a,b){var c=typeof a,d=this,e=void 0;return"undefined"===c?e=this.records:"string"===c?e=-1===a.indexOf(",")?this.records[this.indexes.key[a]]:string.explode(a).map(function(a){return isNaN(a)?d.records[d.indexes.key[a]]:d.records[parseInt(a,10)]}):"number"===c&&(e=isNaN(b)?this.records[parseInt(a,10)]:array.limit(this.records,parseInt(a,10),parseInt(b,10))),utility.clone(e,!0)},writable:!0,enumerable:!0,configurable:!0},join:{value:function c(a,b){var c=void 0===arguments[2]?"inner":arguments[2],d=this,e=P.factory(),f=[],g=[],h=b===this.key,i=array.merge(array.keys(this.records[0].data),array.keys(a.records[0].data)),j=void 0;return"inner"===c?j=function(c){var d={},e=c.data,i=P.factory();d[b]=h?c.key:e[b],a.select(d).then(function(a){a.length>2?i.reject(new Error(S.databaseMoreThanOne)):1===a.length?(f.push(utility.merge(e,a[0].data)),i.resolve(!0)):i.resolve(!1)}),g.push(i)}:"left"===c?j=function(c){var d={},e=c.data,j=P.factory();d[b]=h?c.key:e[b],a.select(d).then(function(a){a.length>2?j.reject(new Error(S.databaseMoreThanOne)):1===a.length?(f.push(utility.merge(e,a[0].data)),j.resolve(!0)):(array.each(i,function(a){void 0===e[a]&&(e[a]=null)}),f.push(e),j.resolve(!0))}),g.push(j)}:"right"===c&&(j=function(a){var c={},e=a.data,j=P.factory();c[b]=h?a.key:e[b],d.select(c).then(function(a){a.length>2?j.reject(new Error(S.databaseMoreThanOne)):1===a.length?(f.push(utility.merge(e,a[0].data)),j.resolve(!0)):(array.each(i,function(a){void 0===e[a]&&(e[a]=null)}),f.push(e),j.resolve(!0))}),g.push(j)}),array.each(utility.clone("right"===c?a.records:this.records,!0),j),utility.when(g).then(function(){e.resolve(f)},function(a){e.reject(a)}),e},writable:!0,enumerable:!0,configurable:!0},only:{value:function(a){return this.records.map(a===this.key?function(a){return a.key}:function(b){return b.data[a]})},writable:!0,enumerable:!0,configurable:!0},purge:{value:function(a){return this.storage(a||this,"remove")},writable:!0,enumerable:!0,configurable:!0},reindex:{value:function(){var a=this,b=-1,c=[];return this.views={},this.indexes={key:{}},this.total>0&&array.each(this.records,function(d){void 0!==d&&(c[++b]=d,d.index=b,a.indexes.key[d.key]=b,a.setIndexes(d))}),this.records=c,this},writable:!0,enumerable:!0,configurable:!0},restore:{value:function(a){return this.storage(a||this,"get")},writable:!0,enumerable:!0,configurable:!0},save:{value:function(a){return this.storage(a||this,"set")},writable:!0,enumerable:!0,configurable:!0},select:{value:function(a){var b=this,c=this,d=P.factory(),e=[],f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0;if(a instanceof Object)if(utility.iterate(a,function(a,c){"function"==typeof a&&(b[c]=a.toString(),e.push(c))}),p)try{l=utility.worker(d),l.postMessage({cmd:"select",indexes:this.indexes,records:this.records,where:R.encode(a),functions:e})}catch(m){p=!1,this.select(a).then(function(a){d.resolve(a)},function(a){d.reject(a)})}else f=array.fromObject(a),j=array.flat(f).filter(function(a,b){return b%2===0}).sort(array.sort),h=j.join("|"),k=j.map(function(b){return a[b]}).join("|"),g="return ( ",0===e.length&&this.indexes[h]?i=(this.indexes[h][k]||[]).map(function(a){return c.records[a]}):(f.length>1?array.each(f,function(a,b){var c="( ";b>0&&(c=" && ( "),g+=a[1]instanceof Function?c+a[1].toString()+'( rec.data["'+a[0]+'"] ) )':isNaN(a[1])?c+'rec.data["'+a[0]+'"] === "'+a[1]+'" )':c+'rec.data["'+a[0]+'"] === '+a[1]+" )"}):g+=f[0][1]instanceof Function?f[0][1].toString()+'( rec.data["'+f[0][0]+'"] )':isNaN(f[0][1])?'rec.data["'+f[0][0]+'"] === "'+f[0][1]+'"':'rec.data["'+f[0][0]+'"] === '+f[0][1],g+=" );",i=utility.clone(this.records,!0).filter(new Function("rec",g))),d.resolve(i);else d.reject(new Error(S.invalidArguments));return d},writable:!0,enumerable:!0,configurable:!0},set:{value:function(a,b){var c=void 0===arguments[2]?!1:arguments[2],d=void 0===arguments[3]?!1:arguments[3];b=utility.clone(b,!0);var e=this,f=this.events,g=P.factory(),h=null!==a?this.get(a)||null:b[this.key]?this.get(b[this.key])||null:null,i="POST",j=utility.parse(e.uri||""),k=void 0,l=void 0,m=void 0,n=function(a,b,c){var d=[];return a&&array.each(array.keys(c),function(a){a!==e.key&&void 0===b[a]&&d.push({op:"remove",path:"/"+a})}),utility.iterate(b,function(a,b){b!==e.key&&void 0===c[b]?d.push({op:"add",path:"/"+b,value:a}):R.encode(c[b])!==R.encode(a)&&d.push({op:"replace",path:"/"+b,value:a})}),d};return"string"==typeof b?(k=-1===b.indexOf("//")?"/"!==b.charAt(0)?this.buildUri(b):null!==e.uri&&regex.root.test(b)?j.protocol+"//"+j.host+b:b:b,a=k.replace(regex.not_endpoint,""),string.isEmpty(a)?g.reject(new Error(S.invalidArguments)):(!c&&f&&e.dispatch("beforeSet",{key:a,data:b}),G.request(k,"GET",null,utility.merge({withCredentials:e.credentials},e.headers)).then(function(b){e.setComplete(h,a,e.source?utility.walk(b,e.source):b,c,d,g)},function(a){e.dispatch("failedSet",a),g.reject(a)}))):(!c&&f&&e.dispatch("beforeSet",{key:a,data:b}),c||null===this.uri?this.setComplete(h,a,b,c,d,g):(null!==a?(k=this.buildUri(a),i="PATCH",l=utility.clone(b,!0),b=n(d,b,this.dump([h])[0])):k=j.protocol+"//"+j.host+j.pathname,m=G.request(k,i,b,utility.merge({withCredentials:this.credentials},this.headers)),m.then(function(b){var f=void 0;f=204!==m.xhr.status&&m.xhr.status<300&&null===a?e.source?utility.walk(b,e.source):b:l,e.setComplete(h,a,f,c,d,g)},function(f){"PATCH"==i?(i="PUT",b=utility.clone(l,!0),utility.iterate(h.data,function(a,c){b[c]=a}),G.request(k,i,b,utility.merge({withCredentials:e.credentials},e.headers)).then(function(){e.setComplete(h,a,l,c,d,g)},function(a){e.dispatch("failedSet",a),g.reject(a)})):(e.dispatch("failedSet",f),g.reject(f))}))),g},writable:!0,enumerable:!0,configurable:!0},setComplete:{value:function(a,b,c,d,e,f){return this.views={},null===b&&(b=null!==this.key&&void 0!==c[this.key]&&null!==c[this.key]?c[this.key].toString():utility.uuid()),this.key&&delete c[this.key],null===a?(a={index:this.total++,key:b,data:c,indexes:[]},this.indexes.key[b]=a.index,this.records[a.index]=a,this.versioning&&(this.versions[a.key]=A.factory(g),this.versions[a.key].nth=0)):(this.versioning&&(void 0===this.versions[a.key]&&(this.versions[a.key]=A.factory(g),this.versions[a.key].nth=0),this.versions[a.key].set("v"+ ++this.versions[a.key].nth,this.dump([a])[0])),a=this.records[a.index],e&&(a.data={}),utility.iterate(c,function(b,c){a.data[c]=b}),a=utility.clone(a,!0)),this.setIndexes(a),d||(this.autosave&&this.save(),this.events&&this.dispatch("afterSet",a),array.each(this.lists,function(a){a.refresh()})),f.resolve(a),this},writable:!0,enumerable:!0,configurable:!0},setExpires:{value:function(a){var b=this.id+"Expire",c=a,d=this;if(null!==a&&null===this.uri||null!==a&&(isNaN(a)||1e3>a))throw new Error(S.invalidArguments);this.expires!==a&&(this.expires=a,utility.clearTimers(b),null!==a&&utility.repeat(function(){return null===d.uri?(d.setExpires(null),!1):(d.dispatch("beforeExpire"),E.expire(d.uri),d.dispatch("expire"),void d.dispatch("afterExpire"))},c,b,!1))},writable:!0,enumerable:!0,configurable:!0},setIndexes:{value:function(a){var b=this,c="|";return a.indexes=[],array.each(this.index,function(d){var e=d.split(c),f="";void 0===b.indexes[d]&&(b.indexes[d]={}),array.each(e,function(b,d){f+=(d>0?c:"")+a.data[b]}),void 0===b.indexes[d][f]&&(b.indexes[d][f]=[]),array.contains(b.indexes[d][f],a.index)||(b.indexes[d][f].push(a.index),a.indexes.push([d,f]))}),this},writable:!0,enumerable:!0,configurable:!0},setUri:{value:function(a){var b=this,c=P.factory(),d=void 0;return null!==a&&string.isEmpty(a)&&c.reject(new Error(S.invalidArguments)),null===a?this.uri=a:(d=utility.parse(a),this.uri=d.protocol+"//"+d.host+d.path,string.isEmpty(d.auth)||this.headers.authorization||this.headers.Authorization||(this.headers.Authorization="Basic "+o(decodeURIComponent(d.auth))),this.on("expire",function(){b.sync()},"resync",this),E.expire(this.uri),this.sync().then(function(a){c.resolve(a)},function(a){c.reject(a)})),c},writable:!0,enumerable:!0,configurable:!0},sort:{value:function(a,b,c){b=b===!0||c instanceof Object;var d=this,e=string.toCamelCase(string.explode(a).join(" ")),f=P.factory(),g=function(c){var g=void 0;if(0===d.total)f.resolve([]);else if(!b&&d.views[e])f.resolve(d.views[e]);else if(p){f.then(function(a){return d.views[e]=a,d.views[e]},function(a){utility.error(a)});try{g=utility.worker(f),g.postMessage({cmd:"sort",indexes:d.indexes,records:c,query:a})}catch(h){p=!1,d.views[e]=array.keySort(c,a,"data"),f.resolve(d.views[e])}}else d.views[e]=array.keySort(c,a,"data"),f.resolve(d.views[e])};return c?this.select(c).then(g,function(a){f.reject(a)}):g(utility.clone(this.records,!0)),f},writable:!0,enumerable:!0,configurable:!0},storage:{value:function(a,b,c){var d=this,e=!1,f=!string.isEmpty(this.mongodb),g="session"===c&&"undefined"!=typeof sessionStorage,h=P.factory(),i=void 0,j=void 0,k=void 0;return regex.number_string_object.test(typeof a)&&regex.get_remove_set.test(b)?(e=regex.number_string.test(typeof a)||a.hasOwnProperty("data"),"remove"!==b?(!e||a instanceof Object||(a=this.get(a)),j=e?a.key:a.id):"remove"===b&&e&&(j=a.key||a),f?v.connect(this.mongodb,function(c,f){return c?(f&&f.close(),h.reject(c)):void f.collection(d.id,function(c,g){return c?(f.close(),h.reject(c)):void("get"===b?e?g.find({_id:a.key}).limit(1).toArray(function(a,b){f.close(),a?h.reject(a):0===b.length?h.resolve(null):(delete b[0]._id,d.set(j,b[0],!0).then(function(a){h.resolve(a)},function(a){h.reject(a)}))}):g.find({}).toArray(function(a,b){var c=void 0,e=void 0;return a?(f.close(),h.reject(a)):(c=-1,e=b.length,e>0&&(d.records=b.map(function(a){var b={key:a._id,index:++c,data:{}};return d.indexes.key[b.key]=b.index,b.data=a,delete b.data._id,d.setIndexes(b),b}),d.total=e),f.close(),void h.resolve(d.records))}):"remove"===b?g.remove(e?{_id:j}:{},{safe:!0},function(a,b){f.close(),a?h.reject(a):h.resolve(b)}):"set"===b?e?g.update({_id:a.key},a.data,{w:1,safe:!0,upsert:!0},function(a,b){f.close(),a?h.reject(a):h.resolve(b)}):g.remove({},{w:1,safe:!0},function(a){var b=void 0;return a?(f.close(),h.reject(a)):(b=[],array.each(d.records,function(a){var c={},d=P.factory();b.push(d),utility.iterate(a.data,function(a,b){c[b]=a}),g.update({_id:a.key},c,{w:1,safe:!0,upsert:!0},function(a,b){a?d.reject(a):d.resolve(b)})}),utility.when(b).then(function(a){f.close(),h.resolve(a)},function(a){f.close(),h.reject(a)}),void 0)}):(f.close(),h.reject(null)))})}):"get"===b?(k=g?sessionStorage.getItem(j):l.getItem(j),null!==k?(k=R.decode(k),e?d.set(j,k,!0).then(function(a){h.resolve(a)},function(a){h.reject(a)}):(utility.merge(d,k),h.resolve(d))):h.resolve(d),h.then(function(){d.loaded=!0},function(a){throw a})):"remove"===b?(g?sessionStorage.removeItem(j):l.removeItem(j),h.resolve(this)):"set"===b?(i=R.encode(e?a.data:{total:this.total,index:this.index,indexes:this.indexes,records:this.records}),g?sessionStorage.setItem(j,i):l.setItem(j,i),h.resolve(this)):h.reject(null)):h.reject(new Error(S.invalidArguments)),h},writable:!0,enumerable:!0,configurable:!0},sync:{value:function(){var a=this,b=this.events===!0,c=P.factory(),d=function(d){var f=void 0;return"object"!=typeof d?e(new Error(S.expectedObject)):(null!==a.source&&(d=utility.walk(d,a.source)),f=d instanceof Array?d:[d],void a.batch("set",f,!0).then(function(d){b&&a.dispatch("afterSync",d),c.resolve(d)},e))},e=function(d){b&&a.dispatch("failedSync",d),c.reject(d)};return null===this.uri||string.isEmpty(this.uri)?c.reject(new Error(S.invalidArguments)):(b&&this.dispatch("beforeSync",this.uri),null!==this.callback?G.jsonp(this.uri,{callback:this.callback}).then(d,e):G.request(this.uri,"GET",null,utility.merge({withCredentials:this.credentials},this.headers)).then(d,e)),c},writable:!0,enumerable:!0,configurable:!0},teardown:{value:function(){var a=this.uri,b=void 0;return null!==a&&(E.expire(a,!0),b=this.id+"DataExpire",utility.clearTimers(b),array.each(this.records,function(b){var c=a+"/"+b.key;E.expire(c,!0)})),array.each(this.lists,function(a){a.teardown(!0)}),this.clear(!0),this.dispatch("afterTeardown"),this},writable:!0,enumerable:!0,configurable:!0},undo:{value:function(a,b){var c=this.get(a),d=P.factory(),e=this.versions[c.key],f=void 0;return void 0===c?d.reject(new Error(S.invalidArguments)):e?(f=e.get(b||e.first),void 0===f?d.reject(S.datastoreNoPrevVersion):this.set(a,f).then(function(a){d.resolve(a)
},function(a){d.reject(a)})):d.reject(S.datastoreNoPrevVersion),d},writable:!0,enumerable:!0,configurable:!0},unique:{value:function(a){return array.unique(this.records.map(function(b){return b.data[a]}))},writable:!0,enumerable:!0,configurable:!0},update:{value:function(a,b){var c=this.get(a),d=P.factory();return void 0===c?d.reject(new Error(S.invalidArguments)):this.set(a,utility.merge(c.data,b)).then(function(a){d.resolve(a)},function(a){d.reject(a)}),d},writable:!0,enumerable:!0,configurable:!0}}),b}(D),store={factory:function(a,b){var c=new W;return b instanceof Object&&utility.merge(c,b),null!==a&&"object"==typeof a&&c.batch("set",a),c},worker:function(a){var b=a.data.cmd,c=a.data.records,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0;"select"===b?(k=JSON.parse(a.data.where),f=a.data.functions,d=array.fromObject(k),j=array.flat(d).filter(function(a,b){return b%2===0}).sort(array.sort),h=j.join("|"),l=j.map(function(a){return k[a]}).join("|"),g=a.data.indexes,e="return ( ",0===f.length&&g[h]?i=(g[h][l]||[]).map(function(a){return c[a]}):(d.length>1?array.each(d,function(a,b){var c="( ";b>0&&(c=" && ( "),e+=array.contains(f,a[0])?c+a[1]+'( rec.data["'+a[0]+'"] ) )':isNaN(a[1])?c+'rec.data["'+a[0]+'"] === "'+a[1]+'" )':c+'rec.data["'+a[0]+'"] === '+a[1]+" )"}):e+=array.contains(f,d[0][0])?d[0][1]+'( rec.data["'+d[0][0]+'"] )':isNaN(d[0][1])?'rec.data["'+d[0][0]+'"] === "'+d[0][1]+'"':'rec.data["'+d[0][0]+'"] === '+d[0][1],e+=" );",i=c.filter(new Function("rec",e)))):"sort"===b&&(i=array.keySort(c,a.data.query,"data")),postMessage(i)}},string={capitalize:function(a){var b=void 0===arguments[1]?!1:arguments[1],c=void 0;return c=b?string.explode(a," ").map(function(a){return a.charAt(0).toUpperCase()+a.slice(1)}).join(" "):a.charAt(0).toUpperCase()+a.slice(1)},escape:function(a){return a.replace(/[\-\[\]{}()*+?.,\\\/\^\$|#\s]/g,"\\$&")},explode:function(a){var b=void 0===arguments[1]?",":arguments[1];return string.trim(a).split(new RegExp("\\s*"+b+"\\s*"))},fromObject:function(a,b){var c=(b?b+" = {":"{")+"\n";return utility.iterate(a,function(a,b){c+='"'+b+'":'+a.toString()+",\n"}),c=c.replace(/\[object Object\]/g,"{}").replace(/,\n$/,"\n")+"}"},hyphenate:function(a){var b=void 0===arguments[1]?!1:arguments[1],c=string.trim(a).replace(/\s+/g,"-");return b===!0&&(c=c.replace(/([A-Z])/g,"-$1").toLowerCase()),c},isBoolean:function(a){return regex.bool.test(a)},isEmpty:function(a){return""===string.trim(a)},isNumber:function(a){return regex.number.test(a)},isUrl:function(a){return regex.url.test(a)},toCamelCase:function(a){var b=string.trim(a).replace(/\.|_|-|\@|\[|\]|\(|\)|\#|\$|\%|\^|\&|\*|\s+/g," ").toLowerCase().split(regex.space_hyphen),c=[];return array.each(b,function(a,b){c.push(0===b?a:string.capitalize(a))}),c.join("")},singular:function(a){return a.replace(/oe?s$/,"o").replace(/ies$/,"y").replace(/ses$/,"se").replace(/s$/,"")},toFunction:function(a){var b=string.trim(a.replace(/^.*\(/,"").replace(/[\t|\r|\n|\"|\']+/g,"").replace(/\).*/,"")),c=string.trim(a.replace(/^.*\{/,"").replace(/\}$/,""));return Function.apply(Function,string.explode(b).concat([c]))},trim:function(a){return a.replace(/^(\s+|\t+|\n+)|(\s+|\t+|\n+)$/g,"")},unCamelCase:function(a){return string.trim(a.replace(/([A-Z])/g," $1").toLowerCase())},uncapitalize:function(a){var b=string.trim(a);return b.charAt(0).toLowerCase()+b.slice(1)},unhyphenate:function(a){var b=void 0===arguments[1]?!1:arguments[1];return b!==!0?string.explode(a,"-").join(" "):string.explode(a,"-").map(function(a){return string.capitalize(a)}).join(" ")}},utility={timer:{},repeating:{},$:function(a){var b=void 0;return a&&(regex.html.test(a)?b=[Q.create(a)]:(a=string.trim(a),-1===a.indexOf(",")?(b=utility.dom(a),b?isNaN(b.length)&&(b=[b]):b=[]):(b=[],array.each(string.explode(a),function(a){var c=utility.dom(a);c instanceof Array?b=b.concat(c):c&&b.push(c)})))),b},base:function(a){var b=new D;return a instanceof Object&&utility.merge(b,a),b.observer=C.factory(),b},blob:function(b){var c=void 0;try{c=new Blob([b],{type:"application/javascript"})}catch(d){a.BlobBuilder||(a.BlobBuilder=a.MSBlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder),c=(new a.BlobBuilder).append(b).getBlob()}return c},clearTimers:function(a){utility.timer[a]&&(clearTimeout(utility.timer[a]),delete utility.timer[a]),utility.repeating[a]&&(clearTimeout(utility.repeating[a]),delete utility.repeating[a])},clone:function(a){var b=void 0===arguments[1]?!1:arguments[1],c=void 0,d=void 0;return b===!0?void 0!==a&&null!==a?JSON.parse(JSON.stringify(a)):a:!a||regex.primitive.test(typeof a)||a instanceof RegExp?a:a instanceof Array?(d=[],array.each(a,function(a,b){d[b]=utility.clone(a)}),d):!e&&!G.ie&&a instanceof Document?Z.decode(Z.encode(a)):"undefined"!=typeof a.__proto__?utility.extend(a.__proto__,a):a instanceof Object?(c=R.encode(a,!0),void 0!==c?(c=R.decode(c),utility.iterate(a,function(a,b){"function"==typeof a&&(c[b]=a)})):c=a,c):a},coerce:function(a){var b=void 0;return null===a||void 0===a?void 0:"true"===a?!0:"false"===a?!1:"null"===a?null:"undefined"===a?void 0:""===a?a:isNaN(b=Number(a))?regex.json_wrap.test(a)?R.decode(a,!0)||a:a:b},compile:function(a,b,c){return a.compile(b,c),!0},curry:function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];var e=a.apply(a,c);return function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return e.apply(e,b)}},defer:function(a,b,c){var b=void 0===arguments[1]?0:arguments[1],d=void 0===arguments[3]?!1:arguments[3],e=void 0;return void 0!==c?utility.clearTimers(c):c=utility.uuid(!0),e=function(){utility.clearTimers(c),a()},utility[d?"repeating":"timer"][c]=setTimeout(e,b),c},delay:function(){return"undefined"!=typeof setImmediate?function(a){setImmediate(a)}:"undefined"!=typeof process?process.nextTick:function(a){setTimeout(a,0)}}(),dom:function(a){var c=void 0;return c=regex.selector_complex.test(a)?array.cast(b.querySelectorAll(a)):regex.hash.test(a)?b.getElementById(a.replace(regex.hash,""))||void 0:array.cast(regex.klass.test(a)?b.getElementsByClassName(a.replace(regex.klass,"")):regex.word.test(a)?b.getElementsByTagName(a):b.querySelectorAll(a))},domId:function(a){return"a"+a.replace(/-/g,"").slice(1)},error:function(a,b,c,d){var e={arguments:b?array.cast(b):[],message:a.message||a,number:a.number?65535&a.number:void 0,scope:c,stack:a.stack||void 0,timestamp:(new Date).toUTCString(),type:a.type||"TypeError"};return void utility.log(e.stack||e.message,d!==!0?"error":"warn")},extend:function(a,b){var c=Object.create(a);return b instanceof Object&&utility.merge(c,b),c["super"]=a,c},genId:function(a){var b=void 0===arguments[1]?!1:arguments[1],c=void 0;if(a&&(a.id||a instanceof Array||"string"==typeof a||a instanceof String))return a;if(b){do c=utility.domId(utility.uuid(!0));while(utility.dom("#"+c))}else c=utility.domId(utility.uuid(!0));return a&&"object"==typeof a?(a.id=c,a):c},iterate:function(a,b){return array.each(Object.keys(a),function(c){return b.call(a,a[c],c)}),a},log:function(){return"undefined"!=typeof console?function(a){var b=void 0===arguments[1]?"log":arguments[1],c="object"!=typeof a,d=c?"["+(new Date).toLocaleTimeString()+"] "+a:a;console[b](d)}:function(){}}(),merge:function(a,b){var c=array.keys(a);return utility.iterate(b,function(b,d){!array.contains(c,d)||b instanceof Function?a[d]=b:a[d]instanceof Array&&b instanceof Array?array.merge(a[d],b):b instanceof Function?a[d]=b:a[d]instanceof Object&&b instanceof Object?utility.iterate(b,function(b,c){a[d][c]=utility.clone(b)}):a[d]=utility.clone(b)}),a},parse:function(a){var d={},f={},g=void 0,h=void 0;return void 0===a&&(a=e?"":c.href),e?d=w.parse(a):(d=b.createElement("a"),d.href=a,g=d.href.match(regex.host)[1],h=d.href.match(regex.protocol)[1]),e&&utility.iterate(d,function(a,b){null===a&&(d[b]=void 0)}),f={auth:e?null:regex.auth.exec(a),protocol:d.protocol||h,hostname:d.hostname||g,port:d.port?U.parse(d.port,10):"",pathname:d.pathname,search:d.search||"",hash:d.hash||"",host:d.host||g},G.ie&&(":"===f.protocol&&(f.protocol=c.protocol),string.isEmpty(f.hostname)&&(f.hostname=c.hostname),string.isEmpty(f.host)&&(f.host=c.host),"/"!==f.pathname.charAt(0)&&(f.pathname="/"+f.pathname)),f.auth=d.auth||(null===f.auth?"":f.auth[1]),f.href=d.href||f.protocol+"//"+(string.isEmpty(f.auth)?"":f.auth+"@")+f.host+f.pathname+f.search+f.hash,f.path=d.path||f.pathname+f.search,f.query=utility.queryString(null,f.search),f},partial:function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return function(){for(var b=arguments.length,d=Array(b),e=0;b>e;e++)d[e]=arguments[e];return a.apply(a,c.concat(d))}},prevent:function(a){return"function"==typeof a.preventDefault&&a.preventDefault(),a},queryString:function(a,b){var d={},f=void 0!==b?b.indexOf("?")>-1?b.replace(/.*\?/,""):null:e||string.isEmpty(c.search)?null:c.search.replace("?","");return null===f||string.isEmpty(f)||(f=f.split("&"),array.each(f,function(a){var b=a.split("=");string.isEmpty(b[0])||(b[1]=void 0===b[1]?"":utility.coerce(decodeURIComponent(b[1])),void 0===d[b[0]]?d[b[0]]=b[1]:d[b[0]]instanceof Array?d[b[0]].push(b[1]):(d[b[0]]=[d[b[0]]],d[b[0]].push(b[1])))})),null!==a&&void 0!==a&&(d=d[a]),d},race:function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];var d=P.factory();return b[0]instanceof Array&&(b=b[0]),0===b.length?d.resolve(null):k.race(b).then(function(a){d.resolve(a)},function(a){d.reject(a)}),d},render:function(a){var b=P.factory();return x(function(c){try{b.resolve(a(c))}catch(d){b.reject(d)}}),b},repeat:function(a){var b=void 0===arguments[1]?10:arguments[1],c=void 0===arguments[2]?utility.uuid(!0):arguments[2],d=void 0===arguments[3]?!0:arguments[3];return function(){return d&&a()===!1?void 0:(utility.defer(function(){var d=function(a,b,c){a()!==!1?utility.repeating[c]=setTimeout(function(){d.call(d,a,b,c)},b):delete utility.repeating[c]};d(a,b,c)},b,c,!0),c)}()},stop:function(a){return"function"==typeof a.stopPropagation&&a.stopPropagation(),utility.prevent(a),a},target:function(a){return a.target||a.srcElement},uuid:function(a){var b=[8,9,"a","b"],c=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},d=c()+c()+"-"+c()+"-4"+c().substr(0,3)+"-"+b[Math.floor(4*Math.random())]+c().substr(0,3)+"-"+c()+c()+c();return a===!0&&(d=d.replace(/-/g,"")),d},walk:function(a,b){var c=a;return array.each(b.replace(/\]$/,"").replace(/\]/g,".").replace(/\.\./g,".").split(/\.|\[/),function(a){return void 0===c[a]||null===c[a]?(c=void 0,!1):void(c=c[a])}),c},when:function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];var d=P.factory();return b[0]instanceof Array&&(b=b[0]),0===b.length?d.resolve(null):k.all(b).then(function(a){d.resolve(a)},function(a){d.reject(a)}),d},worker:function(a){var b=new Worker(z);return b.onerror=function(c){a.reject(c),b.terminate()},b.onmessage=function(c){a.resolve(c.data),b.terminate()},b}},X=function(){var a=0,b=1,c=2,d=3,e=4,f=/ECONNREFUSED/,g=new RegExp(c+"|"+d),h={"user-agent":"keigai/1.1.4 node.js/"+process.versions.node.replace(/^v/,"")+" ("+string.capitalize(process.platform)+" V8/"+process.versions.v8+" )","content-type":"text/plain",accept:"*/*"},i=function(a,b){var c="on"+b;return"function"==typeof a[c]&&a[c](),a.dispatchEvent(b),a},k=function(a,b){return a.readyState!==b&&(a.readyState=b,i(a,"readystatechange"),a.readyState!==e||a._error||(i(a,"load"),i(a,"loadend"))),a},l=function(a,b){k(a,c),a.status=b.statusCode,a._resheaders=b.headers,a._resheaders["set-cookie"]&&a._resheaders["set-cookie"]instanceof Array&&(a._resheaders["set-cookie"]=a._resheaders["set-cookie"].join(";")),b.on("data",function(c){b.setEncoding("utf8"),a._send&&(c&&(a.responseText+=c),k(a,d))}),b.on("end",function(){a._send&&(k(a,e),a._send=!1)})},m=function(a,b){a.status=f.test(b.message)?503:500,a.statusText="",a.responseText=b.message,a._error=!0,a._send=!1,i(a,"error"),k(a,e)},n=function(d){function f(){this.onabort=null,this.onerror=null,this.onload=null,this.onloadend=null,this.onloadstart=null,this.onreadystatechange=null,this.readyState=a,this.response=null,this.responseText="",this.responseType="",this.responseXML=null,this.status=a,this.statusText="",this.observer=C.factory(),this._error=!1,this._headers={},this._params={},this._request=null,this._resheaders={},this._send=!1}return _inherits(f,d),_prototypeProperties(f,null,{abort:{value:function(){return null!==this._request&&(this._request.abort(),this._request=null,this.responseText="",this.responseXML="",this._error=!0,this._headers={},(this._send===!0||g.test(this.readyState))&&(this._send=!1,k(this,e)),i(this,"abort"),this.readyState=a),this},writable:!0,enumerable:!0,configurable:!0},getAllResponseHeaders:{value:function(){var a="";if(this.readyState<c)throw new Error(S.invalidStateNoHeaders);return utility.iterate(this._resheaders,function(b,c){a+=c+": "+b+"\n"}),a},writable:!0,enumerable:!0,configurable:!0},getResponseHeader:{value:function(a){if(this.readyState<c||this._error)throw new Error(S.invalidStateNoHeaders);return this._resheaders[a]||this._resheaders[a.toLowerCase()]},writable:!0,enumerable:!0,configurable:!0},open:{value:function(a,c,d,e,f){var g=this;if(d!==!0)throw new Error(S.invalidStateNoSync);return this.abort(),this._error=!1,this._params={method:a,url:c,async:d||!0,user:e||null,password:f||null},utility.iterate(h,function(a,b){g._headers[b]=a}),this.readyState=b,this},writable:!0,enumerable:!0,configurable:!0},overrideMimeType:{value:function(a){return this._headers["content-type"]=a,this},writable:!0,enumerable:!0,configurable:!0},send:{value:function(){var a=void 0===arguments[0]?null:arguments[0],c=this,d=void 0,e=void 0,f=void 0,g=void 0;if(this.readyState<b)throw new Error(S.invalidStateNotOpen);if(this._send)throw new Error(S.invalidStateNotSending);if(e=utility.parse(this._params.url),e.port=e.port||("https:"===e.protocol?443:80),null!==this._params.user&&null!==this._params.password&&(e.auth=this._params.user+":"+this._params.password),regex.put_post.test(this._params.method))if(null===a)this._headers["content-length"]=0;else if("string"==typeof a)this._headers["content-length"]=j.byteLength(a);else{if(!(a instanceof j||"function"==typeof a.toString))throw new Error(S.invalidArguments);a=a.toString(),this._headers["content-length"]=j.byteLength(a)}return this._headers.host=e.host,"XMLHttpRequest"===this._headers["x-requested-with"]&&delete this._headers["x-requested-with"],d={hostname:e.hostname,path:e.path,port:e.port,method:this._params.method,headers:this._headers},"https:"===e.protocol&&(d.rejectUnauthorized=!1,d.agent=!1),e.auth&&(d.auth=e.auth),this._send=!0,i(this,"readystatechange"),g="http:"===e.protocol?s:t,f=g.request(d,function(a){l(c,a)}).on("error",function(a){m(c,a)}),null===a?f.setSocketKeepAlive(!0):f.write(a,"utf8"),this._request=f,f.end(),i(this,"loadstart"),this},writable:!0,enumerable:!0,configurable:!0},setRequestHeader:{value:function(a,c){if(this.readyState!==b)throw new Error(S.invalidStateNotUsable);if(this._send)throw new Error(S.invalidStateNotSending);return this._headers[a.toLowerCase()]=c,this},writable:!0,enumerable:!0,configurable:!0}}),f}(D);return n},Y=function(){function a(){this.elements={}}return _prototypeProperties(a,null,{clear:{value:function(){this.elements={}},writable:!0,enumerable:!0,configurable:!0},"delete":{value:function(a){delete this.elements[a]},writable:!0,enumerable:!0,configurable:!0},has:{value:function(a){return void 0!==this.elements[a]},writable:!0,enumerable:!0,configurable:!0},get:{value:function(a){return this.has(a)?this.elements[a].value:void 0},writable:!0,enumerable:!0,configurable:!0},set:{value:function(a,b){return this.elements[a]={value:b},this},writable:!0,enumerable:!0,configurable:!0}}),a}(),Z={decode:function(a){return(new DOMParser).parseFromString(a,"text/xml")},encode:function(a){var b=void 0===arguments[1]?!0:arguments[1],c=void 0===arguments[2]?!0:arguments[2];try{var d=function(){var d=b?"<xml>":"",e=function(a,b){var c="<n>v</n>";return c=c.replace("v",regex.cdata.test(b)?"<![CDATA["+b+"]]>":b),c.replace(/<(\/)?n>/g,"<$1"+a+">")};return null!==a&&a.xml&&(a=a.xml),a instanceof Document&&(a=(new XMLSerializer).serializeToString(a)),regex.boolean_number_string.test(typeof a)?d+=e("item",a):"object"==typeof a&&utility.iterate(a,function(a,b){d+=Z.encode(a,"object"==typeof a,!1).replace(/item|xml/g,isNaN(b)?b:"item")}),d+=b?"</xml>":"",c&&(d='<?xml version="1.0" encoding="UTF8"?>'+d),{v:d}}();if("object"==typeof d)return d.v}catch(e){return void utility.error(e,[a,b,c],_this)}},valid:function(a){return 0===Z.decode(a).getElementsByTagName("parsererror").length}},$=function(){var b=void 0!==Object.defineProperty,c=void 0;Array.from=Array.from||function(a){return[].slice.call(a)},Array.keys=Array.keys||function(a){return Object.keys(a)},e?m=X():(G.version=G.version(),G.ie&&!function(){if(G.version<9)throw new Error(S.upgrade);c=(a.HTMLElement||a.Element).prototype;var d=function(a){function b(a){var b=string.explode(a.className," "),c=this;array.each(b,function(a){c.push(a)})}return _inherits(b,a),_prototypeProperties(b,null,{add:{value:function(a){array.contains(this,a)||(this.push(a),this.updateClassName())},writable:!0,enumerable:!0,configurable:!0},contains:{value:function(a){return array.contains(this,a)},writable:!0,enumerable:!0,configurable:!0},remove:{value:function(a){array.contains(this,a)&&(array.remove(this,a),this.updateClassName())},writable:!0,enumerable:!0,configurable:!0},toggle:{value:function(a){array[array.contains(this,a)?"remove":"add"](this,a),this.updateClassName()},writable:!0,enumerable:!0,configurable:!0},updateClassName:{value:function(){this.className=this.join(" ")},writable:!0,enumerable:!0,configurable:!0}}),b}(Array);if(b)Object.defineProperty(c,"classList",{get:function(){return new d(_this)},enumerable:!0,configurable:!0});else{if(!Object.prototype.__defineGetter__)throw new Error("Could not create classList shim");c.__defineGetter__("classList",function(){return new d(_this)})}if(b)Object.defineProperty(Element,"getElementsByClassName",{get:function(a){return _this.querySelectorAll("."+a)},enumerable:!0,configurable:!0});else{if(!Object.prototype.__defineGetter__)throw new Error("Could not create getElementsByClassName shim");c.__defineGetter__("getElementsByClassName",function(a){return _this.querySelectorAll("."+a)})}}()),null===n&&(n=Y),p&&(z=a.URL.createObjectURL(utility.blob("var "+string.fromObject(array,"array")+", "+string.fromObject(regex,"regex")+", "+string.fromObject(string,"string")+", "+string.fromObject(utility,"utility")+"; onmessage = "+store.worker.toString()+";"))),y=(new Date).getTime(),x=a.requestAnimationFrame||function(a){var b=(new Date).getTime()-y;utility.defer(function(){a(b)},16,b)}};return $(),{filter:J.factory,list:N.factory,grid:L.factory,store:store.factory,util:{$:utility.$,array:array,base:utility.base,clearTimers:utility.clearTimers,clone:utility.clone,coerce:utility.coerce,curry:utility.curry,csv:H,defer:P.factory,delay:utility.defer,element:Q,extend:utility.extend,genId:utility.genId,iterate:utility.iterate,json:R,jsonp:G.jsonp,log:utility.log,lru:A.factory,math:T,merge:utility.merge,number:U,observer:C.factory,parse:utility.parse,partial:utility.partial,prevent:utility.prevent,race:utility.race,render:utility.render,repeat:utility.repeat,request:G.request,stop:utility.stop,string:string,target:utility.target,uuid:utility.uuid,walk:utility.walk,when:utility.when},version:"1.1.4"}}();"undefined"!=typeof exports?module.exports=u:"function"==typeof define?define(function(){return u}):a.keigai=u}(this);
//# sourceMappingURL=keigai.min.js.map