{"version":3,"file":"keigai.min.js","sources":["keigai.js"],"names":["_this","this","_inherits","subClass","superClass","TypeError","prototype","Object","create","constructor","value","enumerable","writable","configurable","__proto__","_prototypeProperties","child","staticProps","instanceProps","defineProperties","global","document","location","navigator","server","process","webWorker","Blob","Worker","MAX","VERSIONS","CACHE","EVENTS","Promise","undefined","localStorage","XMLHttpRequest","WeakMap","btoa","external","format","http","https","lib","mongodb","url","RENDER","TIME","WORKER","require","MongoClient","Buffer","regex","after_space","allow","allow_cors","and","args","auth","bool","caps","cdata","checked_disabled","complete_loaded","csv_quote","del","domain","down","endslash","eol_nl","element_update","get_headers","get_remove_set","hash","header_replace","header_value_replace","html","http_body","http_ports","host","ie","ip","is_xml","json_maybe","json_wrap","klass","no","not_dotnotation","not_endpoint","null_undefined","number","number_format_1","number_format_2","number_present","number_string","number_string_object","object_type","patch","primitive","priv","protocol","put_post","radio_checkbox","root","select","selector_is","selector_complex","set_del","space_hyphen","string_object","svg","top_bottom","word","xdomainrequest","xml","LRU","max","cache","first","last","length","evict","remove","get","key","item","set","previous","next","LRUItem","lru","factory","Observable","arg","limit","listeners","hooks","dispatch","ev","_len","arguments","Array","_key","utility","iterate","i","handler","apply","scope","hook","target","addEventListener","Error","label","invalidArguments","self","obj","off","id","on","_this2","uuid","array","keys","once","_this3","_len2","_key2","unhook","removeEventListener","observable","Base","observer","listener","addListener","_len3","_key3","dispatchEvent","_len4","_key4","emit","_len5","_key5","_len6","_key6","removeListener","add","contains","push","binIndex","min","idx","val","Math","floor","cast","o","isNaN","from","chunk","size","result","nth","round","start","clear","clone","shallow","indexOf","collect","fn","each","compact","diff","filter","test","count","obj1","obj2","async","offset","call","repeat","eachReverse","empty","equal","json","encode","fill","l","flat","reduce","a","b","concat","forEach","fromObject","mingle","index","indexed","v","intersect","keepIf","keySort","query","sub","replace","queries","string","explode","map","split","sorts","braceS","braceE","s","e","sort","Function","join","n","sorted","mean","sum","median","dupe","mid","odd","merge","mode","values","k","parse","range","rassoc","reject","end","remaining","slice","removeIf","removeWhile","rest","rindex","rotate","series","ceil","types","c","d","toString","divisor","total","low","lower","lowered","stddev","sqrt","variance","prev","cur","take","toObject","ar","unique","math","sqr","zip","x","expire","uri","expired","expires","Date","getTime","href","property","permission","KXMLHttpRequest","xhr","defer","deferred","client","ab","ArrayBuffer","blob","doc","Document","userAgent","version","trim","allows","verb","toLowerCase","bit","Boolean","permissions","cors","headers","type","getAllResponseHeaders","items","header","setSeconds","getSeconds","exec","timestamp","isEmpty","responseText","decode","csv","overrideMimeType","responseXML","valid","cached","partial","read","write","delete","unknown","jsonp","callback","cbid","keigai","genId","clearTimers","resolve","element","destroy","src","dom","requestTimeout","kxhr","Deferred","_len7","_key7","request","XDomainRequest","payload","contentType","notAvailable","state","readyState","status","_resheaders","response","delay","open","toUpperCase","hasOwnProperty","etag","setRequestHeader","withCredentials","xdr","shared","r","t","redirect","serverError","isUrl","Location","then","serverUnauthorized","serverForbidden","serverInvalidMethod","send","methodNotAllowed","scroll","dest","ms","scrollPos","pos","bezier","window","scrollTo","scrollX","scrollY","delimiter","RegExp","rows","shift","row","coerce","prepare","input","output","DataListFilter","list","debounce","filters","fields","teardown","update","escape","pageIndex","refresh","ref","attr","DataGrid","store","sortable","options","filtered","sortOrder","order","class","record","error","dump","records","find","data","where","field","stop","hasClass","splice","grid","template","width","css","trimmed","el","innerHTML","capitalize","unCamelCase","unhyphenate","style","data-field","addClass","parentNode","listFiltered","listFilter","currentTarget","_len8","_key8","_len9","_key9","_len10","_key10","DataList","current","emptyMsg","noData","mutation","pageSize","pageRange","pagination","placeholder","page","pages","more","data-page","removeClass","reg","registry","ceiling","match","walk","compile","li","render","callbacks","childNodes","reverse","$","lists","nodeName","MutationObserver","observe","childList","subtree","loaded","promise","onDone","onAlways","onFail","always","done","fail","success","failure","appendTo","appendChild","namespaceURI","getAttributeNS","setAttributeNS","selected","removeAttribute","setAttribute","getAttribute","reset","frag","fragment","body","createElementNS","createElement","prependChild","after","insertBefore","nextSibling","before","toCamelCase","removeChild","disable","disabled","bubbles","cancelable","CustomEvent","createEvent","initCustomEvent","enable","querySelectorAll","createDocumentFragment","has","classList","hidden","display","is","position","left","top","right","bottom","height","offsetWidth","offsetHeight","offsetParent","offsetTop","offsetLeft","removeAttr","removeAttributeNS","serialize","children","elements","name","encodeURIComponent","paddingLeft","paddingRight","borderLeft","borderRight","paddingTop","paddingBottom","borderTop","borderBottom","text","textContent","toggleClass","toggle","expectedProperty","checked","silent","JSON","stringify","expectedNumber","expectedObject","invalidStateNoHeaders","invalidStateNoSync","invalidStateNotOpen","invalidStateNotSending","invalidStateNotUsable","datastoreNoPrevVersion","upgrade","_len11","_key11","pop","P","S0","Q0","Q1","Q2","C0","C1","C2","C3","pow","dist","num1","num2","abs","even","every","p","charAt","substring","half","base","parseFloat","parseInt","random","direction","toFixed","pCatch","pResolve","pReject","pThen","_len12","_key12","_len13","_key13","catch","DataStore","autosave","credentials","events","Accept","ignore","indexes","source","versions","versioning","views","batch","sync","deferreds","when","reindex","save","buildUri","parsed","pathname","resave","delComplete","purge","custom","f","Number","results","databaseMoreThanOne","only","storage","tmp","setIndexes","restore","_this4","functions","clauses","cond","worker","postMessage","cmd","b1","overwrite","method","odata","rdefer","ogdata","ndata","op","path","setComplete","change","setExpires","delimter","kdx","setUri","_this5","authorization","Authorization","decodeURIComponent","view","mongo","session","sessionStorage","connect","db","close","collection","_id","toArray","recs","rec","safe","w","upsert","defer2","getItem","removeItem","setItem","recordUri","undo","all","hyphenate","camel","isBoolean","isNumber","singular","toFunction","uncapitalize","timer","repeating","BlobBuilder","MSBlobBuilder","WebKitBlobBuilder","MozBlobBuilder","append","getBlob","clearTimeout","extend","pattern","modifiers","curry","_len14","_key14","cfn","_len15","_key15","setTimeout","setImmediate","nextTick","getElementById","getElementsByClassName","getElementsByTagName","domId","warning","message","stack","toUTCString","log","String","console","ts","msg","toLocaleTimeString","y","hostname","port","search","queryString","_len16","_key16","_len17","args2","_key17","prevent","preventDefault","qstring","prop","race","_len18","_key18","now","recursive","stopPropagation","srcElement","strip","substr","_len19","_key19","onerror","err","terminate","onmessage","UNSENT","OPENED","HEADERS_RECEIVED","LOADING","DONE","ERR_REFUSED","ready","user-agent","node","platform","v8","content-type","accept","_error","res","statusCode","setEncoding","_send","statusText","onabort","onload","onloadend","onloadstart","onreadystatechange","responseType","_headers","_params","_request","abort","getResponseHeader","user","password","mime","byteLength","rejectUnauthorized","agent","setSocketKeepAlive","WeakMapShim","DOMParser","parseFromString","wrap","_ret","XMLSerializer","serializeToString","boolean_number_string","bootstrap","defineProperty","HTMLElement","Element","ClassList","classes","className","updateClassName","__defineGetter__","URL","createObjectURL","requestAnimationFrame","util","exports","module","define"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _this = this;\nvar _inherits = function (subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) subClass.__proto__ = superClass;\n};\n\nvar _prototypeProperties = function (child, staticProps, instanceProps) {\n  if (staticProps) Object.defineProperties(child, staticProps);\n  if (instanceProps) Object.defineProperties(child.prototype, instanceProps);\n};\n\n/**\n * Lightweight data store library, with a utility belt\n *\n * @author Jason Mulligan <jason.mulligan@avoidwork.com>\n * @copyright 2015 Jason Mulligan\n * @license BSD-3 <https://raw.github.com/avoidwork/keigai/master/LICENSE>\n * @link http://keigai.io\n * @module keigai\n * @version 1.1.0\n */\n(function (global) {\n  var document = global.document;\n  var location = global.location;\n  var navigator = global.navigator;\n  var server = typeof process != \"undefined\";\n  var webWorker = typeof Blob != \"undefined\" && typeof Worker != \"undefined\";\n  var MAX = 10;\n  var VERSIONS = 100;\n  var CACHE = 500;\n  var EVENTS = [\"readystatechange\", \"abort\", \"load\", \"loadstart\", \"loadend\", \"error\", \"progress\", \"timeout\"];\n  var Promise = global.Promise || undefined;\n  var localStorage = global.localStorage || undefined;\n  var XMLHttpRequest = global.XMLHttpRequest || null;\n  var WeakMap = global.WeakMap || null;\n  var btoa = global.btoa || undefined;\n  var external = undefined,\n      format = undefined,\n      http = undefined,\n      https = undefined,\n      lib = undefined,\n      mongodb = undefined,\n      url = undefined,\n      RENDER = undefined,\n      TIME = undefined,\n      WORKER = undefined;\n\n  if (server) {\n    url = require(\"url\");\n    http = require(\"http\");\n    https = require(\"https\");\n    mongodb = require(\"mongodb\").MongoClient;\n    format = require(\"util\").format;\n\n    if (typeof Promise == \"undefined\") {\n      Promise = require(\"es6-promise\").Promise;\n    }\n\n    if (typeof localStorage == \"undefined\") {\n      localStorage = require(\"localStorage\");\n    }\n\n    if (typeof btoa == \"undefined\") {\n      btoa = require(\"btoa\");\n    }\n  } else if (typeof Buffer == \"undefined\") {\n    Buffer = function () {};\n  }\n\n  var lib = (function () {\n    /**\n     * Regex patterns used through keigai\n     *\n     * `url` was authored by Diego Perini\n     *\n     * @namespace regex\n     * @private\n     * @type {Object}\n     */\n    var regex = {\n      after_space: /\\s+.*/,\n      allow: /^allow$/i,\n      allow_cors: /^access-control-allow-methods$/i,\n      and: /^&/,\n      args: /\\((.*)\\)/,\n      auth: /\\/\\/(.*)\\@/,\n      bool: /^(true|false)?$/,\n      caps: /[A-Z]/,\n      cdata: /\\&|<|>|\\\"|\\'|\\t|\\r|\\n|\\@|\\$/,\n      checked_disabled: /checked|disabled/i,\n      complete_loaded: /^(complete|loaded)$/i,\n      csv_quote: /^\\s|\\\"|\\n|,|\\s$/,\n      del: /^del/,\n      domain: /^[\\w.-_]+\\.[A-Za-z]{2,}$/,\n      down: /down/,\n      endslash: /\\/$/,\n      eol_nl: /\\n$/,\n      element_update: /id|innerHTML|innerText|textContent|type|src/,\n      get_headers: /^(head|get|options)$/,\n      get_remove_set: /get|remove|set/,\n      hash: /^\\#/,\n      header_replace: /:.*/,\n      header_value_replace: /.*:\\s+/,\n      html: /^<.*>$/,\n      http_body: /200|201|202|203|206/,\n      http_ports: /80|443/,\n      host: /\\/\\/(.*)\\//,\n      ie: /msie|ie|\\.net|windows\\snt/i,\n      ip: /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,\n      is_xml: /^<\\?xml.*\\?>/,\n      json_maybe: /json|plain|javascript/,\n      json_wrap: /^[\\[\\{]/,\n      klass: /^\\./,\n      no: /no-store|no-cache/i,\n      not_dotnotation: /-|\\s/,\n      not_endpoint: /.*\\//,\n      null_undefined: /null|undefined/,\n      number: /(^-?\\d\\d*\\.\\d*$)|(^-?\\d\\d*$)|(^-?\\.\\d\\d*$)|number/,\n      number_format_1: /.*\\./,\n      number_format_2: /\\..*/,\n      number_present: /\\d{1,}/,\n      number_string: /number|string/i,\n      number_string_object: /number|object|string/i,\n      object_type: /\\[object Object\\]/,\n      patch: /^patch$/,\n      primitive: /^(boolean|function|number|string)$/,\n      priv: /private/,\n      protocol: /^(.*)\\/\\//,\n      put_post: /^(post|put)$/i,\n      radio_checkbox: /^(radio|checkbox)$/i,\n      root: /^\\/[^\\/]/,\n      select: /select/i,\n      selector_is: /^:/,\n      selector_complex: /\\s+|\\>|\\+|\\~|\\:|\\[/,\n      set_del: /^(set|del|delete)$/,\n      space_hyphen: /\\s|-/,\n      string_object: /string|object/i,\n      svg: /svg/,\n      top_bottom: /top|bottom/i,\n      url: /^(?:(?:https?|ftp):\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!10(?:\\.\\d{1,3}){3})(?!127(?:\\.\\d{1,3}){3})(?!169\\.254(?:\\.\\d{1,3}){2})(?!192\\.168(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:\\/[^\\s]*)?$/i,\n      word: /^\\w+$/,\n      xdomainrequest: /^(get|post)$/i,\n      xml: /xml/i\n    };\n\n    /**\n     * Creates a new Least Recently Used cache\n     *\n     * @constructor\n     * @memberOf keigai\n     * @param  {Number} max [Optional] Max size of cache, default is 1000\n     * @example\n     * let lru = keigai.util.lru( 50 );\n     */\n    var LRU = (function () {\n      function LRU(max) {\n        this.cache = {};\n        this.max = max || 1000;\n        this.first = null;\n        this.last = null;\n        this.length = 0;\n      }\n\n      _prototypeProperties(LRU, null, {\n        evict: {\n\n          /**\n           * Evicts the least recently used item from cache\n           *\n           * @method evict\n           * @memberOf keigai.LRU\n           * @return {Object} {@link keigai.LRU}\n           * @example\n           * lru.evict();\n           */\n          value: function evict() {\n            if (this.last !== null) {\n              this.remove(this.last);\n            }\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        get: {\n\n          /**\n           * Gets cached item and moves it to the front\n           *\n           * @method get\n           * @memberOf keigai.LRU\n           * @param  {String} key Item key\n           * @return {Object} {@link keigai.LRUItem}\n           * @example\n           * let item = lru.get( \"key\" );\n           */\n          value: function get(key) {\n            var item = this.cache[key];\n\n            if (item === undefined) {\n              return;\n            }\n\n            this.set(key, item.value);\n\n            return item.value;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        remove: {\n\n          /**\n           * Removes item from cache\n           *\n           * @method remove\n           * @memberOf keigai.LRU\n           * @param  {String} key Item key\n           * @return {Object} {@link keigai.LRUItem}\n           * @example\n           * lru.remove( \"key\" );\n           */\n          value: function remove(key) {\n            var item = this.cache[key];\n\n            if (item) {\n              delete this.cache[key];\n\n              this.length--;\n\n              if (item.previous !== null) {\n                this.cache[item.previous].next = item.next;\n              }\n\n              if (item.next !== null) {\n                this.cache[item.next].previous = item.previous;\n              }\n\n              if (this.first === key) {\n                this.first = item.previous;\n              }\n\n              if (this.last === key) {\n                this.last = item.next;\n              }\n            }\n\n            return item;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        set: {\n\n          /**\n           * Sets item in cache as `first`\n           *\n           * @method set\n           * @memberOf keigai.LRU\n           * @param  {String} key   Item key\n           * @param  {Mixed}  value Item value\n           * @return {Object} {@link keigai.LRU}\n           * @example\n           * lru.set( \"key\", {x: true} );\n           */\n          value: function set(key, value) {\n            var item = this.remove(key);\n\n            if (item === undefined) {\n              item = new LRUItem(value);\n            } else {\n              item.value = value;\n            }\n\n            item.next = null;\n            item.previous = this.first;\n            this.cache[key] = item;\n\n            if (this.first !== null) {\n              this.cache[this.first].next = key;\n            }\n\n            this.first = key;\n\n            if (this.last === null) {\n              this.last = key;\n            }\n\n            if (++this.length > this.max) {\n              this.evict();\n            }\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        }\n      });\n\n      return LRU;\n    })();\n\n    /**\n     * Creates a new LRUItem\n     *\n     * @constructor\n     * @memberOf keigai\n     * @param {Mixed} value Item value\n     * @private\n     */\n    var LRUItem = function LRUItem(value) {\n      this.next = null;\n      this.previous = null;\n      this.value = value;\n    };\n\n    /**\n     * @namespace lru\n     */\n    var lru = {\n      /**\n       * LRU factory\n       *\n       * @method factory\n       * @memberOf lru\n       * @return {Object} {@link keigai.LRU}\n       * @example\n       * let lru = keigai.util.lru( 50 );\n       */\n      factory: function (max) {\n        return new LRU(max);\n      }\n    };\n\n    var Observable = (function () {\n      /**\n       * Creates a new Observable\n       *\n       * @constructor\n       * @memberOf keigai\n       * @param  {Number} arg Maximum listeners, default is 10\n       * @example\n       * let observer = keigai.util.observer( 50 );\n       */\n      function Observable(arg) {\n        this.limit = arg || MAX;\n        this.listeners = {};\n        this.hooks = new WeakMap();\n      }\n\n      _prototypeProperties(Observable, null, {\n        dispatch: {\n\n          /**\n           * Dispatches an event, with optional arguments\n           *\n           * @method dispatch\n           * @memberOf keigai.Observable\n           * @return {Object} {@link keigai.Observable}\n           * @example\n           * observer.dispatch( \"event\", ... );\n           */\n          value: function dispatch(ev) {\n            for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n              args[_key - 1] = arguments[_key];\n            }\n\n            if (ev && this.listeners[ev]) {\n              utility.iterate(this.listeners[ev], function (i) {\n                i.handler.apply(i.scope, args);\n              });\n            }\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        hook: {\n\n          /**\n           * Hooks into `target` for a DOM event\n           *\n           * @method hook\n           * @memberOf keigai.Observable\n           * @param  {Object} target Element\n           * @param  {String} ev     Event\n           * @return {Object}        Element\n           * @example\n           * observer.hook( document.querySelector( \"a\" ), \"click\" );\n           */\n          value: function hook(target, ev) {\n            if (typeof target.addEventListener != \"function\") {\n              throw new Error(label.invalidArguments);\n            }\n\n            var self = this;\n            var obj = this.hooks.get(target) || {};\n\n            obj[ev] = function (arg) {\n              self.dispatch(ev, arg);\n            };\n\n            this.hooks.set(target, obj);\n            target.addEventListener(ev, this.hooks.get(target)[ev], false);\n\n            return target;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        off: {\n\n          /**\n           * Removes all, or a specific listener for an event\n           *\n           * @method off\n           * @memberOf keigai.Observable\n           * @param {String} ev Event name\n           * @param {String} id [Optional] Listener ID\n           * @return {Object} {@link keigai.Observable}\n           * @example\n           * observer.off( \"click\", \"myHook\" );\n           */\n          value: function off(ev, id) {\n            if (this.listeners[ev]) {\n              if (id) {\n                delete this.listeners[ev][id];\n              } else {\n                delete this.listeners[ev];\n              }\n            }\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        on: {\n\n          /**\n           * Adds a listener for an event\n           *\n           * @method on\n           * @memberOf keigai.Observable\n           * @param  {String}   ev      Event name\n           * @param  {Function} handler Handler\n           * @param  {String}   id      [Optional] Handler ID\n           * @param  {String}   scope   [Optional] Handler scope, default is `this`\n           * @return {Object} {@link keigai.Observable}\n           * @example\n           * observer.on( \"click\", function ( ev ) {\n           *   ...\n           * }, \"myHook\" );\n           */\n          value: function on(ev, handler, id, scope) {\n            var _this2 = this;\n            var id = arguments[2] === undefined ? utility.uuid() : arguments[2];\n            return (function () {\n              if (!_this2.listeners[ev]) {\n                _this2.listeners[ev] = {};\n              }\n\n              if (array.keys(_this2.listeners[ev]).length >= _this2.limit) {\n                throw new Error(\"Possible memory leak, more than \" + _this2.limit + \" listeners for event: \" + ev);\n              }\n\n              _this2.listeners[ev][id] = { scope: scope || _this2, handler: handler };\n\n              return _this2;\n            })();\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        once: {\n\n          /**\n           * Adds a short lived listener for an event\n           *\n           * @method once\n           * @memberOf keigai.Observable\n           * @param  {String}   ev      Event name\n           * @param  {Function} handler Handler\n           * @param  {String}   id      [Optional] Handler ID\n           * @param  {String}   scope   [Optional] Handler scope, default is `this`\n           * @return {Object} {@link keigai.Observable}\n           * @example\n           * observer.once( \"click\", function ( ev ) {\n           *   ...\n           * } );\n           */\n          value: function once(ev, handler, id, scope) {\n            var _this3 = this;\n            var id = arguments[2] === undefined ? utility.uuid() : arguments[2];\n            return (function () {\n              scope = scope || _this3;\n\n              var self = _this3;\n\n              return _this3.on(ev, function () {\n                for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n                  args[_key2] = arguments[_key2];\n                }\n\n                handler.apply(scope, args);\n                self.off(ev, id);\n              }, id, scope);\n            })();\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        unhook: {\n\n          /**\n           * Unhooks from `target` for a DOM event\n           *\n           * @method unhook\n           * @memberOf keigai.Observable\n           * @param  {Object} target Element\n           * @param  {String} ev     Event\n           * @return {Object}        Element\n           * @example\n           * observer.unhook( document.querySelector( \"a\" ), \"click\" );\n           */\n          value: function unhook(target, ev) {\n            var obj = this.hooks.get(target);\n\n            if (obj) {\n              target.removeEventListener(ev, obj[ev], false);\n              delete obj[ev];\n\n              if (array.keys(obj).length === 0) {\n                this.hooks[\"delete\"](target);\n              } else {\n                this.hooks.set(target, obj);\n              }\n            }\n\n            return target;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        }\n      });\n\n      return Observable;\n    })();\n\n    /**\n     * @namespace observable\n     */\n    var observable = {\n      /**\n       * Observable factory\n       *\n       * @method factory\n       * @memberOf observable\n       * @return {Object} {@link keigai.Observable}\n       * @example\n       * let observer = keigai.util.observer( 50 );\n       */\n      factory: function (arg) {\n        return new Observable(arg);\n      }\n    };\n\n    var Base = (function () {\n      /**\n       * Base Object\n       *\n       * @constructor\n       * @memberOf keigai\n       */\n      function Base() {\n        /**\n         * {@link keigai.Observable}\n         *\n         * @abstract\n         * @type {Object}\n         */\n        this.observer = null;\n      }\n\n      _prototypeProperties(Base, null, {\n        addEventListener: {\n\n          /**\n           * Adds an event listener\n           *\n           * @method addEventListener\n           * @memberOf keigai.Base\n           * @param  {String}   ev       Event name\n           * @param  {Function} listener Function to execute\n           * @param  {String}   id       [Optional] Listener ID\n           * @param  {String}   scope    [Optional] Listener scope, default is `this`\n           * @return {Object} {@link keigai.Base}\n           * @example\n           * obj.addEventListener( \"event\", function ( ev ) {\n           *   ...\n           * }, \"myHook\" );\n           */\n          value: function addEventListener(ev, listener, id, scope) {\n            this.observer.on(ev, listener, id, scope || this);\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        addListener: {\n\n          /**\n           * Adds an event listener\n           *\n           * @method addListener\n           * @memberOf keigai.Base\n           * @param  {String}   ev       Event name\n           * @param  {Function} listener Function to execute\n           * @param  {String}   id       [Optional] Listener ID\n           * @param  {String}   scope    [Optional] Listener scope, default is `this`\n           * @return {Object} {@link keigai.Base}\n           * @example\n           * obj.addEventListener( \"event\", function ( ev ) {\n           *   ...\n           * }, \"myHook\" );\n           */\n          value: function addListener(ev, listener, id, scope) {\n            this.observer.on(ev, listener, id, scope || this);\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        dispatch: {\n\n          /**\n           * Dispatches an event, with optional arguments\n           *\n           * @method dispatch\n           * @memberOf keigai.Base\n           * @return {Object} {@link keigai.Base}\n           * @example\n           * obj.dispatch( \"event\", ... );\n           */\n          value: function dispatch() {\n            for (var _len3 = arguments.length, args = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n              args[_key3] = arguments[_key3];\n            }\n\n            this.observer.dispatch.apply(this.observer, args);\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        dispatchEvent: {\n\n          /**\n           * Dispatches an event, with optional arguments\n           *\n           * @method dispatchEvent\n           * @memberOf keigai.Base\n           * @return {Object} {@link keigai.Base}\n           * @example\n           * obj.dispatchEvent( \"event\", ... );\n           */\n          value: function dispatchEvent() {\n            for (var _len4 = arguments.length, args = Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n              args[_key4] = arguments[_key4];\n            }\n\n            this.observer.dispatch.apply(this.observer, args);\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        emit: {\n\n          /**\n           * Dispatches an event, with optional arguments\n           *\n           * @method emit\n           * @memberOf keigai.Base\n           * @return {Object} {@link keigai.Base}\n           * @example\n           * obj.emit( \"event\", ... );\n           */\n          value: function emit() {\n            for (var _len5 = arguments.length, args = Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n              args[_key5] = arguments[_key5];\n            }\n\n            this.observer.dispatch.apply(this.observer, args);\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        hook: {\n\n          /**\n           * Hooks into `target` for an event\n           *\n           * @method hook\n           * @memberOf keigai.Base\n           * @return {Object} {@link keigai.Base}\n           * @example\n           * obj.hook( document.querySelector( \"a\" ), \"click\" );\n           */\n          value: function hook() {\n            for (var _len6 = arguments.length, args = Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {\n              args[_key6] = arguments[_key6];\n            }\n\n            this.observer.hook.apply(this.observer, args);\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        listeners: {\n\n          /**\n           * Gets listeners\n           *\n           * @method listeners\n           * @memberOf keigai.Base\n           * @param  {String} ev [Optional] Event name\n           * @return {Object} Listeners\n           * @example\n           * keigai.util.iterate( obj.listeners(), function ( fn, id ) {\n           *   ...\n           * } );\n           */\n          value: function listeners(ev) {\n            return ev ? this.observer.listeners[ev] : this.observer.listeners;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        off: {\n\n          /**\n           * Removes an event listener\n           *\n           * @method off\n           * @memberOf keigai.Base\n           * @param  {String} ev Event name\n           * @param  {String} id [Optional] Listener ID\n           * @return {Object} {@link keigai.Base}\n           * @example\n           * obj.off( \"event\", \"myHook\" );\n           */\n          value: function off(ev, id) {\n            this.observer.off(ev, id);\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        on: {\n\n          /**\n           * Adds an event listener\n           *\n           * @method on\n           * @memberOf keigai.Base\n           * @param  {String}   ev       Event name\n           * @param  {Function} listener Function to execute\n           * @param  {String}   id       [Optional] Listener ID\n           * @param  {String}   scope    [Optional] Listener scope, default is `this`\n           * @return {Object} {@link keigai.Base}\n           * @example\n           * obj.on( \"event\", function ( ev ) {\n           *   ...\n           * }, \"myHook\" );\n           */\n          value: function on(ev, listener, id, scope) {\n            this.observer.on(ev, listener, id, scope || this);\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        once: {\n\n          /**\n           * Adds a short lived event listener\n           *\n           * @method once\n           * @memberOf keigai.Base\n           * @param  {String}   ev       Event name\n           * @param  {Function} listener Function to execute\n           * @param  {String}   id       [Optional] Listener ID\n           * @param  {String}   scope    [Optional] Listener scope, default is `this`\n           * @return {Object} {@link keigai.Base}\n           * @example\n           * obj.once( \"event\", function ( ev ) {\n           *   ...\n           * } );\n           */\n          value: function once(ev, listener, id, scope) {\n            this.observer.once(ev, listener, id, scope || this);\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        removeEventListener: {\n\n          /**\n           * Removes an event listener\n           *\n           * @method removeEventListener\n           * @memberOf keigai.Base\n           * @param  {String} ev Event name\n           * @param  {String} id [Optional] Listener ID\n           * @return {Object} {@link keigai.Base}\n           * @example\n           * obj.removeListener( \"event\", \"myHook\" );\n           */\n          value: function removeEventListener(ev, id) {\n            this.observer.off(ev, id);\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        removeListener: {\n\n          /**\n           * Removes an event listener\n           *\n           * @method removeListener\n           * @memberOf keigai.Base\n           * @param  {String} ev Event name\n           * @param  {String} id [Optional] Listener ID\n           * @return {Object} {@link keigai.Base}\n           * @example\n           * obj.removeListener( \"event\", \"myHook\" );\n           */\n          value: function removeListener(ev, id) {\n            this.observer.off(ev, id);\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        }\n      });\n\n      return Base;\n    })();\n\n    /**\n     * @namespace base\n     * @private\n     */\n    var base = {\n      /**\n       * Base factory\n       *\n       * @memberOf base\n       * @method factory\n       * @return {Object} {@link keigai.Base}\n       */\n      factory: function () {\n        return new Base();\n      }\n    };\n\n    /**\n     * @namespace array\n     */\n    var array = {\n      /**\n       * Adds 'arg' to 'obj' if it is not found\n       *\n       * @method add\n       * @memberOf array\n       * @param  {Array} obj Array to receive 'arg'\n       * @param  {Mixed} arg Argument to set in 'obj'\n       * @return {Array}     Array that was queried\n       * @example\n       * let myArray = [1, 2];\n       *\n       * keigai.util.array.add( myArray, 3 ); // [1, 2, 3]\n       * keigai.util.array.add( myArray, 1 ); // [1, 2, 3]\n       */\n      add: function (obj, arg) {\n        if (!array.contains(obj, arg)) {\n          obj.push(arg);\n        }\n\n        return obj;\n      },\n\n      /**\n       * Preforms a binary search on a sorted Array\n       *\n       * @method binIndex\n       * @memberOf array\n       * @param  {Array} obj Array to search\n       * @param  {Mixed} arg Value to find index of\n       * @return {Number}    Index of `arg` within `obj`\n       * @example\n       * let myArray = [1, 5, 10, 15, 20, 25, ...];\n       *\n       * keigai.util.array.binIndex( myArray, 5 ); // 1\n       */\n      binIndex: function (obj, arg) {\n        var max = obj.length - 1;\n        var min = 0;\n        var idx = 0;\n        var val = 0;\n\n        while (min <= max) {\n          idx = Math.floor((min + max) / 2);\n          val = obj[idx];\n\n          if (val < arg) {\n            min = idx + 1;\n          } else if (val > arg) {\n            max = idx - 1;\n          } else {\n            return idx;\n          }\n        }\n\n        return -1;\n      },\n\n      /**\n       * Returns an Object ( NodeList, etc. ) as an Array\n       *\n       * @method cast\n       * @memberOf array\n       * @param  {Object}  obj Object to cast\n       * @param  {Boolean} key [Optional] Returns key or value, only applies to Objects without a length property\n       * @return {Array}       Object as an Array\n       * @example\n       * keigai.util.array.cast( document.querySelectorAll( \"...\" ) );\n       */\n      cast: function (obj, key) {\n        var o = [];\n\n        if (!isNaN(obj.length)) {\n          o = Array.from(obj);\n        } else if (key === true) {\n          o = array.keys(obj);\n        } else {\n          utility.iterate(obj, function (i) {\n            o.push(i);\n          });\n        }\n\n        return o;\n      },\n\n      /**\n       * Transforms an Array to a 2D Array of chunks\n       *\n       * @method chunk\n       * @memberOf array\n       * @param  {Array}  obj  Array to process\n       * @param  {Number} size Chunk size ( integer )\n       * @return {Array}       Chunked Array\n       * @example\n       * keigai.util.array.chunk( [0, 1, 2, 3], 2 ); // [[0, 1], [2, 3]]\n       */\n      chunk: function (obj, size) {\n        var result = [];\n        var nth = number.round(obj.length / size, \"up\");\n        var start = 0;\n        var i = -1;\n\n        while (++i < nth) {\n          start = i * size;\n          result.push(array.limit(obj, start, size));\n        }\n\n        return result;\n      },\n\n      /**\n       * Clears an Array without destroying it\n       *\n       * @method clear\n       * @memberOf array\n       * @param  {Array} obj Array to clear\n       * @return {Array}     Cleared Array\n       * @example\n       * let myArray = [1, 2, 3, 4, 5];\n       *\n       * keigai.util.array.clear( myArray );\n       * myArray.length; // 0\n       */\n      clear: function (obj) {\n        return obj.length > 0 ? array.remove(obj, 0, obj.length) : obj;\n      },\n\n      /**\n       * Clones an Array\n       *\n       * @method clone\n       * @memberOf array\n       * @param  {Array}   obj     Array to clone\n       * @param  {Boolean} shallow [Optional] Default is `true`\n       * @return {Array}           Clone of Array\n       * @example\n       * let myArray      = [1, 2, 3, 4, 5],\n       *     myArrayClone = keigai.util.array.clone( myArray );\n       *\n       * myArrayClone.push( 6 );\n       *\n       * myArray.length;      // 5\n       * myArrayClone.length; // 6\n       */\n      clone: function (obj, shallow) {\n        return utility.clone(obj, shallow !== false);\n      },\n\n      /**\n       * Determines if obj contains arg\n       *\n       * @method contains\n       * @memberOf array\n       * @param  {Array} obj Array to search\n       * @param  {Mixed} arg Value to look for\n       * @return {Boolean}   True if found, false if not\n       * @example\n       * if ( keigai.util.array.contains( [1], 1 ) ) { ... }\n       */\n      contains: function (obj, arg) {\n        return obj.indexOf(arg) > -1;\n      },\n\n      /**\n       * Creates a new Array of the result of `fn` executed against every index of `obj`\n       *\n       * @method collect\n       * @memberOf array\n       * @param  {Array}    obj Array to iterate\n       * @param  {Function} fn  Function to execute against indices\n       * @return {Array}        New Array\n       * @example\n       * let results = keigai.util.array.collect( [...], function ( ... ) { ... } );\n       */\n      collect: function (obj, fn) {\n        var result = [];\n\n        array.each(obj, function (i) {\n          result.push(fn(i));\n        });\n\n        return result;\n      },\n\n      /**\n       * Compacts a Array by removing `null` or `undefined` indices\n       *\n       * @method compact\n       * @memberOf array\n       * @param  {Array}   obj  Array to compact\n       * @param  {Boolean} diff Indicates to return resulting Array only if there's a difference\n       * @return {Array}        Compacted copy of `obj`, or null ( if `diff` is passed & no diff is found )\n       * @example\n       * keigai.util.array.compact( [null, \"a\", \"b\", \"c\", null, \"d\"] ); // [\"a\", \"b\", \"c\", \"d\"]\n       * keigai.util.array.compact( [\"a\", \"b\", \"c\", \"d\"], true );       // null\n       */\n      compact: function (obj, diff) {\n        var result = obj.filter(function (i) {\n          return !regex.null_undefined.test(i);\n        });\n\n        return diff !== true ? result : result.length < obj.length ? result : null;\n      },\n\n      /**\n       * Counts `value` in `obj`\n       *\n       * @method count\n       * @memberOf array\n       * @param  {Array} obj   Array to search\n       * @param  {Mixed} value Value to compare\n       * @return {Array}       Array of counts\n       * @example\n       * keigai.util.array.count( [\"apple\", \"banana\", \"orange\", \"apple\"], \"apple\" ); // 2\n       */\n      count: function (obj, value) {\n        return obj.filter(function (i) {\n          return i === value;\n        }).length;\n      },\n\n      /**\n       * Finds the difference between two Arrays\n       *\n       * @method diff\n       * @memberOf array\n       * @param  {Array} obj1 Source Array\n       * @param  {Array} obj2 Comparison Array\n       * @return {Array}      Array of the differences\n       * @example\n       * keigai.util.array.diff( [\"a\"], [\"a\", \"b\"] ); // [\"b\"]\n       */\n      diff: function (obj1, obj2) {\n        var result = [];\n\n        array.each(obj1, function (i) {\n          if (!array.contains(obj2, i)) {\n            array.add(result, i);\n          }\n        });\n\n        array.each(obj2, function (i) {\n          if (!array.contains(obj1, i)) {\n            array.add(result, i);\n          }\n        });\n\n        return result;\n      },\n\n      /**\n       * Iterates `obj` and executes `fn` with arguments [`value`, `index`].\n       * Returning `false` halts iteration.\n       *\n       * @method each\n       * @memberOf array\n       * @param  {Array}    obj   Array to iterate\n       * @param  {Function} fn    Function to execute on index values\n       * @param  {Boolean}  async [Optional] Asynchronous iteration\n       * @param  {Number}   size  [Optional] Batch size for async iteration, default is 10\n       * @return {Array}          Array\n       * @example\n       * keigai.util.array.each( [ ... ], function ( ... ) { ... } );\n       * keigai.util.array.each( [ ... ], function ( ... ) { ... }, true, 100 ); // processing batches of a 100\n       */\n      each: function (obj, fn, async, size) {\n        var nth = obj.length;\n        var i = undefined,\n            offset = undefined;\n\n        if (async !== true) {\n          i = -1;\n          while (++i < nth) {\n            if (fn.call(obj, obj[i], i) === false) {\n              break;\n            }\n          }\n        } else {\n          size = size || 10;\n          offset = 0;\n\n          if (size > nth) {\n            size = nth;\n          }\n\n          utility.repeat(function () {\n            var i = -1;\n            var idx = undefined;\n\n            while (++i < size) {\n              idx = i + offset;\n\n              if (idx === nth || fn.call(obj, obj[idx], idx) === false) {\n                return false;\n              }\n            }\n\n            offset += size;\n\n            if (offset >= nth) {\n              return false;\n            }\n          }, undefined, undefined, false);\n        }\n\n        return obj;\n      },\n\n      /**\n       * Iterates `obj` in reverse and executes `fn` with arguments [`value`, `index`].\n       * Returning `false` halts iteration.\n       *\n       * @method eachReverse\n       * @memberOf array\n       * @param  {Array}    obj   Array to iterate\n       * @param  {Function} fn    Function to execute on index values\n       * @param  {Boolean}  async [Optional] Asynchronous iteration\n       * @param  {Number}   size  [Optional] Batch size for async iteration, default is 10\n       * @return {Array}          Array\n       * @example\n       * keigai.util.array.eachReverse( [ ... ], function ( ... ) { ... } );\n       * keigai.util.array.eachReverse( [ ... ], function ( ... ) { ... }, true, 100 ); // processing batches of a 100\n       */\n      eachReverse: function (obj, fn, async, size) {\n        var nth = obj.length;\n        var i = undefined,\n            offset = undefined;\n\n        if (async !== true) {\n          i = nth;\n          while (--i > -1) {\n            if (fn.call(obj, obj[i], i) === false) {\n              break;\n            }\n          }\n        } else {\n          size = size || 10;\n          offset = nth - 1;\n\n          if (size > nth) {\n            size = nth;\n          }\n\n          utility.repeat(function () {\n            var i = -1;\n            var idx = undefined;\n\n            while (++i < size) {\n              idx = offset - i;\n\n              if (idx < 0 || fn.call(obj, obj[idx], idx) === false) {\n                return false;\n              }\n            }\n\n            offset -= size;\n\n            if (offset < 0) {\n              return false;\n            }\n          }, undefined, undefined, false);\n        }\n\n        return obj;\n      },\n\n      /**\n       * Determines if an Array is empty\n       *\n       * @method empty\n       * @memberOf array\n       * @param  {Array} obj Array to inspect\n       * @return {Boolean}   `true` if there's no indices\n       * @example\n       * keigai.util.array.empty( [] );    // true\n       * keigai.util.array.empty( [\"a\"] ); // false\n       */\n      empty: function (obj) {\n        return obj.length === 0;\n      },\n\n      /**\n       * Determines if two Arrays are equal\n       *\n       * @method equal\n       * @memberOf array\n       * @param  {Array} obj1 Array to compare\n       * @param  {Array} obj2 Array to compare\n       * @return {Boolean} `true` if the Arrays match\n       * @example\n       * keigai.util.array.equal( [\"a\"], [\"a\"] );      // true\n       * keigai.util.array.equal( [\"a\"], [\"a\", \"b\"] ); // false\n       */\n      equal: function (obj1, obj2) {\n        return json.encode(obj1) === json.encode(obj2);\n      },\n\n      /**\n       * Fills `obj` with the evalution of `arg`, optionally from `start` to `offset`\n       *\n       * @method fill\n       * @memberOf array\n       * @param  {Array}  obj   Array to fill\n       * @param  {Mixed}  arg   String, Number of Function to fill with\n       * @param  {Number} start [Optional] Index to begin filling at\n       * @param  {Number} end   [Optional] Offset from start to stop filling at\n       * @return {Array}        Filled Array\n       * @example\n       * let myArray = [\"a\", \"b\", \"c\"];\n       *\n       * keigai.util.array.fill( myArray, function ( i ) { return i + \"a\"; } );\n       * myArray[0]; // \"aa\"\n       */\n      fill: function (obj, arg, start, offset) {\n        var fn = typeof arg == \"function\";\n        var l = obj.length;\n        var i = !isNaN(start) ? start : 0;\n        var nth = !isNaN(offset) ? i + offset : l - 1;\n\n        if (nth > l - 1) {\n          nth = l - 1;\n        }\n\n        if (fn) {\n          while (i <= nth) {\n            obj[i] = arg(obj[i]);\n            i++;\n          }\n        } else {\n          while (i <= nth) {\n            obj[i] = arg;\n            i++;\n          }\n        }\n\n        return obj;\n      },\n\n      /**\n       * Returns the first Array index\n       *\n       * @method first\n       * @memberOf array\n       * @param  {Array} obj The array\n       * @return {Mixed}     The first node of the array\n       * @example\n       * keigai.util.array.first( [\"a\", \"b\"] ); // \"a\"\n       */\n      first: function (obj) {\n        return obj[0];\n      },\n\n      /**\n       * Flattens a 2D Array\n       *\n       * @method flat\n       * @memberOf array\n       * @param  {Array} obj 2D Array to flatten\n       * @return {Array}     Flatten Array\n       * @example\n       * keigai.util.array.flat( [[0, 1], [2, 3]] ); // [0, 1, 2, 3]\n       */\n      flat: function (obj) {\n        var result = [];\n\n        result = obj.reduce(function (a, b) {\n          return a.concat(b);\n        }, result);\n\n        return result;\n      },\n\n      /**\n       * Iterates `obj` and executes `fn` with arguments [`value`, `index`].\n       * Returning `false` halts iteration.\n       *\n       * @method forEach\n       * @memberOf array\n       * @see array.each\n       * @param  {Array}    obj   Array to iterate\n       * @param  {Function} fn    Function to execute on index values\n       * @param  {Boolean}  async [Optional] Asynchronous iteration\n       * @param  {Number}   size  [Optional] Batch size for async iteration, default is 10\n       * @return {Array}          Array\n       * @example\n       * keigai.util.array.forEach( [ ... ], function ( ... ) { ... } );\n       * keigai.util.array.forEach( [ ... ], function ( ... ) { ... }, true, 100 ); // processing batches of a 100\n       */\n      forEach: function (obj, fn, async, size) {\n        return array.each(obj, fn, async, size);\n      },\n\n      /**\n       * Creates a 2D Array from an Object\n       *\n       * @method fromObject\n       * @memberOf array\n       * @param  {Object} obj Object to convert\n       * @return {Array}      2D Array\n       * @example\n       * keigai.util.array.fromObject( {name: \"John\", sex: \"male\"} ); // [[\"name\", \"John\"], [\"sex\", \"male\"]]\n       */\n      fromObject: function (obj) {\n        return array.mingle(array.keys(obj), array.cast(obj));\n      },\n\n      /**\n       * Facade of indexOf\n       *\n       * @method index\n       * @memberOf array\n       * @param  {Array} obj Array to search\n       * @param  {Mixed} arg Value to find index of\n       * @return {Number}    The position of arg in instance\n       * @example\n       * keigai.util.array.index( [\"a\", \"b\", \"c\"], \"b\" ); // 1\n       */\n      index: function (obj, arg) {\n        return obj.indexOf(arg);\n      },\n\n      /**\n       * Returns an Associative Array as an Indexed Array\n       *\n       * @method indexed\n       * @memberOf array\n       * @param  {Array} obj Array to index\n       * @return {Array}     Indexed Array\n       * @example\n       * let myArray = [\"a\", \"b\", \"c\"];\n       *\n       * myArray.prop = \"d\";\n       * keigai.util.array.indexed( myArray ); [\"a\", \"b\", \"c\", \"d\"];\n       */\n      indexed: function (obj) {\n        var result = [];\n\n        utility.iterate(obj, function (v) {\n          result.push(v);\n        });\n\n        return result;\n      },\n\n      /**\n       * Finds the intersections between obj1 and obj2\n       *\n       * @method intersect\n       * @memberOf array\n       * @param  {Array} obj1 Source Array\n       * @param  {Array} obj2 Comparison Array\n       * @return {Array}      Array of the intersections\n       * @example\n       * keigai.util.array.intersect( [\"a\", \"b\", \"d\"], [\"b\", \"c\", \"d\"] ); // [\"b\", \"d\"]\n       */\n      intersect: function (obj1, obj2) {\n        var a = obj1.length > obj2.length ? obj1 : obj2;\n        var b = a === obj1 ? obj2 : obj1;\n\n        return a.filter(function (key) {\n          return array.contains(b, key);\n        });\n      },\n\n      /**\n       * Keeps every element of `obj` for which `fn` evaluates to true\n       *\n       * @method keepIf\n       * @memberOf array\n       * @param  {Array}    obj Array to iterate\n       * @param  {Function} fn  Function to test indices against\n       * @return {Array}        Array\n       * @example\n       * let myArray = [\"a\", \"b\", \"c\"];\n       *\n       * keigai.util.array.keepIf( myArray, function ( i ) { return /a|c/.test( i ); } );\n       * myArray[1]; // \"c\"\n       */\n      keepIf: function (obj, fn) {\n        var result = [];\n        var remove = [];\n\n        result = obj.filter(fn);\n        remove = array.diff(obj, result);\n\n        array.each(remove, function (i) {\n          array.remove(obj, array.index(obj, i));\n        });\n\n        return obj;\n      },\n\n      /**\n       * Returns the keys in an \"Associative Array\"\n       *\n       * @method keys\n       * @memberOf array\n       * @param  {Mixed} obj Array or Object to extract keys from\n       * @return {Array}     Array of the keys\n       * @example\n       * keigai.util.array.keys( {abc: true, xyz: false} ); // [\"abc\", \"xyz\"]\n       */\n      keys: function (obj) {\n        return Object.keys(obj);\n      },\n\n      /**\n       * Sorts an Array based on key values, like an SQL ORDER BY clause\n       *\n       * @method keySort\n       * @memberOf array\n       * @param  {Array}  obj   Array to sort\n       * @param  {String} query Sort query, e.g. \"name, age desc, country\"\n       * @param  {String} sub   [Optional] Key which holds data, e.g. \"{data: {}}\" = \"data\"\n       * @return {Array}        Sorted Array\n       * @example\n       * let myArray = [{abc: 123124, xyz: 5}, {abc: 123124, xyz: 6}, {abc: 2, xyz: 5}];\n       *\n       * keigai.util.array.keySort( myArray, \"abc\" );           // [{abc: 2, xyz: 5}, {abc: 123124, xyz: 5}, {abc: 123124, xyz: 6}];\n       * keigai.util.array.keySort( myArray, \"abc, xyz desc\" ); // [{abc: 2, xyz: 5}, {abc: 123124, xyz: 6}, {abc: 123124, xyz: 5}];\n       */\n      keySort: function (obj, query, sub) {\n        query = query.replace(/\\s*asc/ig, \"\").replace(/\\s*desc/ig, \" desc\");\n\n        var queries = string.explode(query).map(function (i) {\n          return i.split(\" \");\n        });\n        var sorts = [];\n        var braceS = \"[\\\"\";\n        var braceE = \"\\\"]\";\n\n        if (sub && sub !== \"\") {\n          sub = \".\" + sub;\n        } else {\n          sub = \"\";\n        }\n\n        array.each(queries, function (i) {\n          var s = \".\";\n          var e = \"\";\n\n          if (regex.not_dotnotation.test(i[0])) {\n            s = braceS;\n            e = braceE;\n          }\n\n          sorts.push(\"try {\");\n\n          if (i[1] === \"desc\") {\n            sorts.push(\"if ( a\" + sub + s + i[0] + e + \" < b\" + sub + s + i[0] + e + \" ) return 1;\");\n            sorts.push(\"if ( a\" + sub + s + i[0] + e + \" > b\" + sub + s + i[0] + e + \" ) return -1;\");\n          } else {\n            sorts.push(\"if ( a\" + sub + s + i[0] + e + \" < b\" + sub + s + i[0] + e + \" ) return -1;\");\n            sorts.push(\"if ( a\" + sub + s + i[0] + e + \" > b\" + sub + s + i[0] + e + \" ) return 1;\");\n          }\n\n          sorts.push(\"} catch (e) {\");\n          sorts.push(\"try {\");\n          sorts.push(\"if ( a\" + sub + s + i[0] + e + \" !== undefined ) return \" + (i[1] === \"desc\" ? \"-1\" : \"1\") + \";\");\n          sorts.push(\"} catch (e) {}\");\n          sorts.push(\"try {\");\n          sorts.push(\"if ( b\" + sub + s + i[0] + e + \" !== undefined ) return \" + (i[1] === \"desc\" ? \"1\" : \"-1\") + \";\");\n          sorts.push(\"} catch (e) {}\");\n          sorts.push(\"}\");\n        });\n\n        sorts.push(\"return 0;\");\n\n        return obj.sort(new Function(\"a\", \"b\", sorts.join(\"\\n\")));\n      },\n\n      /**\n       * Returns the last index of the Array\n       *\n       * @method last\n       * @memberOf array\n       * @param  {Array}  obj Array\n       * @param  {Number} arg [Optional] Negative offset from last index to return\n       * @return {Mixed}      Last index( s ) of Array\n       * @example\n       * let myArray = [1, 2, 3, 4];\n       *\n       * keigai.util.array.last( myArray );    // 4\n       * keigai.util.array.last( myArray, 2 ); // [3, 4]\n       */\n      last: function (obj, arg) {\n        var n = obj.length - 1;\n\n        if (arg >= n + 1) {\n          return obj;\n        } else if (isNaN(arg) || arg === 1) {\n          return obj[n];\n        } else {\n          return array.limit(obj, n - --arg, n);\n        }\n      },\n\n      /**\n       * Returns a limited range of indices from the Array\n       *\n       * @method limit\n       * @memberOf array\n       * @param  {Array}  obj    Array to iterate\n       * @param  {Number} start  Starting index\n       * @param  {Number} offset Number of indices to return\n       * @return {Array}         Array of indices\n       * @example\n       * let myArray = [1, 2, 3, 4];\n       *\n       * keigai.util.array.limit( myArray, 0, 2 ); // [1, 2]\n       * keigai.util.array.limit( myArray, 2, 2 ); // [3, 4]\n       */\n      limit: function (obj, start, offset) {\n        var result = [];\n        var i = start - 1;\n        var nth = start + offset;\n        var max = obj.length;\n\n        if (max > 0) {\n          while (++i < nth && i < max) {\n            result.push(obj[i]);\n          }\n        }\n\n        return result;\n      },\n\n      /**\n       * Finds the maximum value in an Array\n       *\n       * @method max\n       * @memberOf array\n       * @param  {Array} obj Array to process\n       * @return {Mixed}     Number, String, etc.\n       * @example\n       * keigai.util.array.max( [5, 3, 9, 1, 4] ); // 9\n       */\n      max: function (obj) {\n        return array.last(array.sorted(array.clone(obj)));\n      },\n\n      /**\n       * Finds the mean of an Array ( of numbers )\n       *\n       * @method mean\n       * @memberOf array\n       * @param  {Array} obj Array to process\n       * @return {Number}    Mean of the Array ( float or integer )\n       * @example\n       * keigai.util.array.mean( [1, 3, 5] ); // 3\n       */\n      mean: function (obj) {\n        return obj.length > 0 ? array.sum(obj) / obj.length : undefined;\n      },\n\n      /**\n       * Finds the median value of an Array ( of numbers )\n       *\n       * @method median\n       * @memberOf array\n       * @param  {Array} obj Array to process\n       * @return {Number}    Median number of the Array ( float or integer )\n       * @example\n       * keigai.util.array.median( [5, 1, 3, 8] ); // 4\n       * keigai.util.array.median( [5, 1, 3] );    // 3\n       */\n      median: function (obj) {\n        var dupe = array.sorted(array.clone(obj));\n        var nth = dupe.length;\n        var mid = number.round(nth / 2, \"down\");\n\n        return number.odd(nth) ? dupe[mid] : (dupe[mid - 1] + dupe[mid]) / 2;\n      },\n\n      /**\n       * Merges `arg` into `obj`, excluding duplicate indices\n       *\n       * @method merge\n       * @memberOf array\n       * @param  {Array} obj1 Array to receive indices\n       * @param  {Array} obj2 Array to merge\n       * @return {Array}      First argument\n       * @example\n       * let a = [\"a\", \"b\", \"c\"],\n       *     b = [\"d\"];\n       *\n       * keigai.util.array.merge( a, b );\n       * a[3]; // \"d\"\n       */\n      merge: function (obj1, obj2) {\n        array.each(obj2, function (i) {\n          array.add(obj1, i);\n        });\n\n        return obj1;\n      },\n\n      /**\n       * Finds the minimum value in an Array\n       *\n       * @method min\n       * @memberOf array\n       * @param  {Array} obj Array to process\n       * @return {Mixed}     Number, String, etc.\n       * @example\n       * keigai.util.array.min( [5, 3, 9, 1, 4] ); // 1\n       */\n      min: function (obj) {\n        return array.sorted(array.clone(obj))[0];\n      },\n\n      /**\n       * Mingles Arrays and returns a 2D Array\n       *\n       * @method mingle\n       * @memberOf array\n       * @param  {Array} obj1 Array to mingle\n       * @param  {Array} obj2 Array to mingle\n       * @return {Array}      2D Array\n       * @example\n       * let a = [\"a\", \"b\"],\n       *     b = [\"c\", \"d\"];\n       *\n       * keigai.util.array.mingle( a, b ); // [[\"a\", \"c\"], [\"b\", \"d\"]]\n       */\n      mingle: function (obj1, obj2) {\n        var result = obj1.map(function (i, idx) {\n          return [i, obj2[idx]];\n        });\n\n        return result;\n      },\n\n      /**\n       * Finds the mode value of an Array\n       *\n       * @method mode\n       * @memberOf array\n       * @param  {Array} obj Array to process\n       * @return {Mixed}     Mode value of the Array\n       * @example\n       * keigai.util.array.mode( [1, 3, 7, 1, 2, 10, 7, 7, 3, 10] );     // 7\n       * keigai.util.array.mode( [1, 3, 7, 1, 2, 10, 7, 7, 3, 10, 10] ); // [7, 10]\n       */\n      mode: function (obj) {\n        var values = {};\n        var count = 0;\n        var mode = [];\n        var nth = undefined,\n            result = undefined;\n\n        // Counting values\n        array.each(obj, function (i) {\n          if (!isNaN(values[i])) {\n            values[i]++;\n          } else {\n            values[i] = 1;\n          }\n        });\n\n        // Finding the highest occurring count\n        count = array.max(array.cast(values));\n\n        // Finding values that match the count\n        utility.iterate(values, function (v, k) {\n          if (v === count) {\n            mode.push(number.parse(k));\n          }\n        });\n\n        // Determining the result\n        nth = mode.length;\n\n        if (nth > 0) {\n          result = nth === 1 ? mode[0] : mode;\n        }\n\n        return result;\n      },\n\n      /**\n       * Finds the range of the Array ( of numbers ) values\n       *\n       * @method range\n       * @memberOf array\n       * @param  {Array} obj Array to process\n       * @return {Number}    Range of the array ( float or integer )\n       * @example\n       * keigai.util.array.range( [5, 1, 3, 8] ); // 7\n       */\n      range: function (obj) {\n        return array.max(obj) - array.min(obj);\n      },\n\n      /**\n       * Searches a 2D Array `obj` for the first match of `arg` as a second index\n       *\n       * @method rassoc\n       * @memberOf array\n       * @param  {Array} obj 2D Array to search\n       * @param  {Mixed} arg Primitive to find\n       * @return {Mixed}     Array or undefined\n       * @example\n       * keigai.util.array.rassoc( [[1, 3], [7, 2], [4, 3]], 3 ); // [1, 3]\n       */\n      rassoc: function (obj, arg) {\n        var result = undefined;\n\n        array.each(obj, function (i, idx) {\n          if (i[1] === arg) {\n            result = utility.clone(obj[idx], true);\n\n            return false;\n          }\n        });\n\n        return result;\n      },\n\n      /**\n       * Returns Array containing the items in `obj` for which `fn()` is not true\n       *\n       * @method reject\n       * @memberOf array\n       * @param  {Array}    obj Array to iterate\n       * @param  {Function} fn  Function to execute against `obj` indices\n       * @return {Array}        Array of indices which fn() is not true\n       * @example\n       * keigai.util.array.reject( [0, 1, 2, 3, 4, 5], function ( i ) { return i % 2 > 0; } ); // [0, 2, 4]\n       */\n      reject: function (obj, fn) {\n        return array.diff(obj, obj.filter(fn));\n      },\n\n      /**\n       * Removes indices from an Array without recreating it\n       *\n       * @method remove\n       * @memberOf array\n       * @param  {Array}  obj   Array to remove from\n       * @param  {Mixed}  start Starting index, or value to find within obj\n       * @param  {Number} end   [Optional] Ending index\n       * @return {Array}        Modified Array\n       * @example\n       * let myArray = [\"a\", \"b\", \"c\", \"d\", \"e\"];\n       *\n       * keigai.util.array.remove( myArray, 2, 3 );\n       * myArray[2]; // \"e\"\n       */\n      remove: function (obj, start, end) {\n        if (isNaN(start)) {\n          start = array.index(obj, start);\n\n          if (start === -1) {\n            return obj;\n          }\n        } else {\n          start = start || 0;\n        }\n\n        var length = obj.length;\n        var remaining = obj.slice((end || start) + 1 || length);\n\n        obj.length = start < 0 ? length + start : start;\n        obj.push.apply(obj, remaining);\n\n        return obj;\n      },\n\n      /**\n       * Deletes every element of `obj` for which `fn` evaluates to true\n       *\n       * @method removeIf\n       * @memberOf array\n       * @param  {Array}    obj Array to iterate\n       * @param  {Function} fn  Function to test indices against\n       * @return {Array}        Array\n       * @example\n       * let myArray = [\"a\", \"b\", \"c\"];\n       *\n       * keigai.util.array.removeIf( myArray, function ( i ) { return /a|c/.test( i ); } );\n       * myArray[0]; // \"b\"\n       */\n      removeIf: function (obj, fn) {\n        var remove = obj.filter(fn);\n\n        array.each(remove, function (i) {\n          array.remove(obj, array.index(obj, i));\n        });\n\n        return obj;\n      },\n\n      /**\n       * Deletes elements of `obj` until `fn` evaluates to false\n       *\n       * @method removeWhile\n       * @memberOf array\n       * @param  {Array}    obj Array to iterate\n       * @param  {Function} fn  Function to test indices against\n       * @return {Array}        Array\n       * @example\n       * let myArray = [\"a\", \"b\", \"c\"];\n       *\n       * keigai.util.array.removeWhile( myArray, function ( i ) { return /a|c/.test( i ); } );\n       * myArray[0];     // \"b\"\n       * myArray.length; // 2\n       */\n      removeWhile: function (obj, fn) {\n        var remove = [];\n\n        array.each(obj, function (i) {\n          if (fn(i) !== false) {\n            remove.push(i);\n          } else {\n            return false;\n          }\n        });\n\n        array.each(remove, function (i) {\n          array.remove(obj, array.index(obj, i));\n        });\n\n        return obj;\n      },\n\n      /**\n       * Replaces the contents of `obj` with `arg`\n       *\n       * @method replace\n       * @memberOf array\n       * @param  {Array} obj1 Array to modify\n       * @param  {Array} obj2 Array to values to push into `obj1`\n       * @return {Array}      Array to modify\n       * @example\n       * let myArray = [\"a\", \"b\", \"c\"];\n       *\n       * keigai.util.array.replace( myArray, [true, false] );\n       * myArray[0];     // true\n       * myArray.length; // 2\n       */\n      replace: function (obj1, obj2) {\n        array.remove(obj1, 0, obj1.length);\n        array.each(obj2, function (i) {\n          obj1.push(i);\n        });\n\n        return obj1;\n      },\n\n      /**\n       * Returns the \"rest\" of `obj` from `arg`\n       *\n       * @method rest\n       * @memberOf array\n       * @param  {Array}  obj Array to process\n       * @param  {Number} arg [Optional] Start position of subset of `obj` ( positive number only )\n       * @return {Array}      Array of a subset of `obj`\n       * @example\n       * keigai.util.array.rest( [1, 2, 3, 4, 5, 6] );    // [2, 3, 4, 5, 6]\n       * keigai.util.array.rest( [1, 2, 3, 4, 5, 6], 3 ); // [4, 5, 6]\n       */\n      rest: function (obj) {\n        var arg = arguments[1] === undefined ? 1 : arguments[1];\n        if (arg < 1) {\n          arg = 1;\n        }\n\n        return array.limit(obj, arg, obj.length);\n      },\n\n      /**\n       * Finds the last index of `arg` in `obj`\n       *\n       * @method rindex\n       * @memberOf array\n       * @param  {Array} obj Array to search\n       * @param  {Mixed} arg Primitive to find\n       * @return {Mixed}     Index or undefined\n       * @example\n       * keigai.util.array.rindex( [1, 2, 3, 2, 1], 2 ); // 3\n       */\n      rindex: function (obj, arg) {\n        var result = -1;\n\n        array.each(obj, function (i, idx) {\n          if (i === arg) {\n            result = idx;\n          }\n        });\n\n        return result;\n      },\n\n      /**\n       * Returns new Array with `arg` moved to the first index\n       *\n       * @method rotate\n       * @memberOf array\n       * @param  {Array}  obj Array to rotate\n       * @param  {Number} arg Index to become the first index, if negative the rotation is in the opposite direction\n       * @return {Array}      Newly rotated Array\n       * @example\n       * keigai.util.array.rotate( [0, 1, 2, 3, 4],  3 )[0] // 2;\n       * keigai.util.array.rotate( [0, 1, 2, 3, 4], -2 )[0] // 3;\n       */\n      rotate: function (obj, arg) {\n        var nth = obj.length;\n        var result = undefined;\n\n        if (arg === 0) {\n          result = obj;\n        } else {\n          if (arg < 0) {\n            arg += nth;\n          } else {\n            arg--;\n          }\n\n          result = array.limit(obj, arg, nth);\n          result = result.concat(array.limit(obj, 0, arg));\n        }\n\n        return result;\n      },\n\n      /**\n       * Generates a series Array\n       *\n       * @method series\n       * @memberOf array\n       * @param  {Number} start  Start value the series\n       * @param  {Number} end    [Optional] The end of the series\n       * @param  {Number} offset [Optional] Offset for indices, default is 1\n       * @return {Array}         Array of new series\n       * @example\n       * keigai.util.array.series( 0, 5 );     // [0, 1, 2, 3, 4]\n       * keigai.util.array.series( 0, 25, 5 ); // [0, 5, 10, 15, 20]\n       */\n      series: function (start, end) {\n        var start = arguments[0] === undefined ? 0 : arguments[0];\n        var offset = arguments[2] === undefined ? 1 : arguments[2];\n        end = end || start;\n\n        var result = [];\n        var n = -1;\n        var nth = Math.max(0, Math.ceil((end - start) / offset));\n\n        while (++n < nth) {\n          result[n] = start;\n          start += offset;\n        }\n\n        return result;\n      },\n\n      /**\n       * Sorts the Array by parsing values\n       *\n       * @method sort\n       * @memberOf array\n       * @param  {Mixed} a Argument to compare\n       * @param  {Mixed} b Argument to compare\n       * @return {Number}  Number indicating sort order\n       * @example\n       * keigai.util.array.sort( 2, 3 ); // -1\n       */\n      sort: function (a, b) {\n        var types = { a: typeof a, b: typeof b };\n        var c = undefined,\n            d = undefined,\n            result = undefined;\n\n        if (types.a == \"number\" && types.b == \"number\") {\n          result = a - b;\n        } else {\n          c = a.toString();\n          d = b.toString();\n\n          if (c < d) {\n            result = -1;\n          } else if (c > d) {\n            result = 1;\n          } else if (types.a == types.b) {\n            result = 0;\n          } else if (types.a == \"boolean\") {\n            result = -1;\n          } else {\n            result = 1;\n          }\n        }\n\n        return result;\n      },\n\n      /**\n       * Sorts `obj` using `array.sort`\n       *\n       * @method sorted\n       * @memberOf array\n       * @param  {Array} obj Array to sort\n       * @return {Array}     Sorted Array\n       * @example\n       * let myArray = [5, 9, 2, 4];\n       *\n       * keigai.util.array.sorted( myArray );\n       * myArray[0]; // 2\n       */\n      sorted: function (obj) {\n        return obj.sort(array.sort);\n      },\n\n      /**\n       * Splits an Array by divisor\n       *\n       * @method split\n       * @memberOf array\n       * @param  {Array}  obj     Array to process\n       * @param  {Number} divisor Integer to divide the Array by\n       * @return {Array}          Split Array\n       * @example\n       * let myArray = [],\n       *     i       = -1,\n       *     results;\n       *\n       * while ( ++i < 100 ) {\n      \t *   myArray.push( i + 1 );\n      \t * }\n       *\n       * results = keigai.util.array.split( myArray, 21 );\n       * results.length;     // 21\n       * results[0].length;  // 5\n       * results[19].length; // 4\n       * results[19][0];     // 99\n       * results[20].length; // 1\n       * results[20][0];     // 100\n       */\n      split: function (obj, divisor) {\n        var result = [];\n        var total = obj.length;\n        var nth = Math.ceil(total / divisor);\n        var low = Math.floor(total / divisor);\n        var lower = Math.ceil(total / nth);\n        var lowered = false;\n        var start = 0;\n        var i = -1;\n\n        // Finding the fold\n        if (number.diff(total, divisor * nth) > nth) {\n          lower = total - low * divisor + low - 1;\n        } else if (total % divisor > 0 && lower * nth >= total) {\n          lower--;\n        }\n\n        while (++i < divisor) {\n          if (i > 0) {\n            start = start + nth;\n          }\n\n          if (!lowered && lower < divisor && i === lower) {\n            --nth;\n            lowered = true;\n          }\n\n          result.push(array.limit(obj, start, nth));\n        }\n\n        return result;\n      },\n\n      /**\n       * Finds the standard deviation of an Array ( of numbers )\n       *\n       * @method stddev\n       * @memberOf array\n       * @param  {Array} obj Array to process\n       * @return {Number}    Standard deviation of the Array ( float or integer )\n       * @example\n       * keigai.util.array.stddev( [1, 3, 5] ); // 1.632993161855452\n       */\n      stddev: function (obj) {\n        return Math.sqrt(array.variance(obj));\n      },\n\n      /**\n       * Gets the summation of an Array of numbers\n       *\n       * @method sum\n       * @memberOf array\n       * @param  {Array} obj Array to sum\n       * @return {Number}    Summation of Array\n       * @example\n       * keigai.util.array.sum( [2, 4, 3, 1] ); // 10\n       */\n      sum: function (obj) {\n        var result = 0;\n\n        if (obj.length > 0) {\n          result = obj.reduce(function (prev, cur) {\n            return prev + cur;\n          });\n        }\n\n        return result;\n      },\n\n      /**\n       * Takes the first `n` indices from `obj`\n       *\n       * @method take\n       * @memberOf array\n       * @param  {Array}  obj Array to process\n       * @param  {Number} n   Offset from 0 to return\n       * @return {Array}      Subset of `obj`\n       * @example\n       * keigai.util.array.take( [1, 2, 3, 4], 2 ); // [1, 2]\n       */\n      take: function (obj, n) {\n        return array.limit(obj, 0, n);\n      },\n\n      /**\n       * Casts an Array to Object\n       *\n       * @method toObject\n       * @memberOf array\n       * @param  {Array} ar Array to transform\n       * @return {Object}   New object\n       * @example\n       * keigai.util.array.toObject( [\"abc\", \"def\"] ); // {0: \"abc\", 1: \"def\"}\n       */\n      toObject: function (ar) {\n        var obj = {};\n        var i = ar.length;\n\n        while (i--) {\n          obj[i.toString()] = ar[i];\n        }\n\n        return obj;\n      },\n\n      /**\n       * Gets the total keys in an Array\n       *\n       * @method total\n       * @memberOf array\n       * @param  {Array} obj Array to find the length of\n       * @return {Number}    Number of keys in Array\n       * @example\n       * let myArray = [true, true, false];\n       *\n       * myArray.extra = true;\n       * keigai.util.array.total( myArray ); // 4\n       */\n      total: function (obj) {\n        return array.indexed(obj).length;\n      },\n\n      /**\n       * Returns an Array of unique indices of `obj`\n       *\n       * @method unique\n       * @memberOf array\n       * @param  {Array} obj Array to process\n       * @return {Array}     Array of unique indices\n       * @example\n       * keigai.util.array.unique( [\"a\", \"b\", \"a\", \"c\", \"b\", \"d\"] ); // [\"a\", \"b\", \"c\", \"d\"]\n       */\n      unique: function (obj) {\n        var result = [];\n\n        array.each(obj, function (i) {\n          array.add(result, i);\n        });\n\n        return result;\n      },\n\n      /**\n       * Finds the variance of an Array ( of numbers )\n       *\n       * @method variance\n       * @memberOf array\n       * @param  {Array} obj Array to process\n       * @return {Number}    Variance of the Array ( float or integer )\n       * @example\n       * keigai.util.array.variance( [1, 3, 5] ); // 2.6666666666666665\n       */\n      variance: function (obj) {\n        var nth = obj.length;\n        var n = 0;\n        var mean = undefined;\n\n        if (nth > 0) {\n          mean = array.mean(obj);\n\n          array.each(obj, function (i) {\n            n += math.sqr(i - mean);\n          });\n\n          return n / nth;\n        } else {\n          return n;\n        }\n      },\n\n      /**\n       * Converts any arguments to Arrays, then merges elements of `obj` with corresponding elements from each argument\n       *\n       * @method zip\n       * @memberOf array\n       * @param  {Array} obj  Array to transform\n       * @param  {Mixed} args Argument instance or Array to merge\n       * @return {Array}      Array\n       * @example\n       * keigai.util.array.zip( [0, 1], 1 ); // [[0, 1], [1, null]]\n       */\n      zip: function (obj, args) {\n        var result = [];\n\n        // Preparing args\n        if (!(args instanceof Array)) {\n          args = typeof args == \"object\" ? array.cast(args) : [args];\n        }\n\n        array.each(args, function (i, idx) {\n          if (!(i instanceof Array)) {\n            _this[idx] = [i];\n          }\n        });\n\n        // Building result Array\n        array.each(obj, function (i, idx) {\n          result[idx] = [i];\n          array.each(args, function (x) {\n            result[idx].push(x[idx] || null);\n          });\n        });\n\n        return result;\n      }\n    };\n\n    /**\n     * @namespace cache\n     * @private\n     */\n    var cache = {\n      /**\n       * Collection URIs\n       *\n       * @memberOf cache\n       * @type {Object}\n       */\n      lru: lru.factory(CACHE),\n\n      /**\n       * Expires a URI from the local cache\n       *\n       * @method expire\n       * @memberOf cache\n       * @param  {String} uri URI of the local representation\n       * @return {Boolean} `true` if successful\n       */\n      expire: function (uri) {\n        if (cache.lru.cache[uri]) {\n          cache.lru.remove(uri);\n\n          return true;\n        }\n\n        return false;\n      },\n\n      /**\n       * Determines if a URI has expired\n       *\n       * @method expired\n       * @memberOf cache\n       * @param  {Object} uri Cached URI object\n       * @return {Boolean}    True if the URI has expired\n       */\n      expired: function (uri) {\n        var item = cache.lru.cache[uri];\n\n        return item && item.value.expires < new Date().getTime();\n      },\n\n      /**\n       * Returns the cached object {headers, response} of the URI or false\n       *\n       * @method get\n       * @memberOf cache\n       * @param  {String}  uri    URI/Identifier for the resource to retrieve from cache\n       * @param  {Boolean} expire [Optional] If 'false' the URI will not expire\n       * @param  {Boolean} silent [Optional] If 'true', the event will not fire\n       * @return {Mixed}          URI Object {headers, response} or False\n       */\n      get: function (uri, expire) {\n        uri = utility.parse(uri).href;\n        var item = cache.lru.get(uri);\n\n        if (!item) {\n          return false;\n        }\n\n        if (expire !== false && cache.expired(uri)) {\n          cache.expire(uri);\n\n          return false;\n        }\n\n        return utility.clone(item, true);\n      },\n\n      /**\n       * Sets, or updates an item in cache.items\n       *\n       * @method set\n       * @memberOf cache\n       * @param  {String} uri      URI to set or update\n       * @param  {String} property Property of the cached URI to set\n       * @param  {Mixed} value     Value to set\n       * @return {Mixed}           URI Object {headers, response} or undefined\n       */\n      set: function (uri, property, value) {\n        uri = utility.parse(uri).href;\n        var item = cache.lru.get(uri);\n\n        if (!item) {\n          item = {\n            permission: 0\n          };\n        }\n\n        if (property === \"permission\") {\n          item.permission |= value;\n        } else if (property === \"!permission\") {\n          item.permission &= ~value;\n        } else {\n          item[property] = value;\n        }\n\n        cache.lru.set(uri, item);\n\n        return item;\n      }\n    };\n\n    /**\n     * Custom Object returned from `client.request()`\n     *\n     * @constructor\n     * @memberOf keigai\n     * @extends {keigai.Base}\n     * @param {Object} xhr XMLHttpRequest\n     */\n    var KXMLHttpRequest = (function (Base) {\n      function KXMLHttpRequest(xhr) {\n        this.observer = observable.factory();\n        this.defer = deferred.factory();\n        this.xhr = xhr;\n      }\n\n      _inherits(KXMLHttpRequest, Base);\n\n      return KXMLHttpRequest;\n    })(Base);\n\n    /**\n     * @namespace client\n     */\n    var client = {\n      /**\n       * Array Buffer is available\n       *\n       * @memberOf client\n       * @type {Boolean}\n       * @private\n       */\n      ab: typeof ArrayBuffer != \"undefined\",\n\n      /**\n       * Blob is available\n       *\n       * @memberOf client\n       * @type {Boolean}\n       * @private\n       */\n      blob: typeof Blob != \"undefined\",\n\n      /**\n       * Document is available\n       *\n       * @memberOf client\n       * @type {Boolean}\n       * @private\n       */\n      doc: typeof Document != \"undefined\",\n\n      /**\n       * Internet Explorer browser\n       *\n       * @memberOf client\n       * @type {Boolean}\n       * @private\n       */\n      ie: (function () {\n        return !server && regex.ie.test(navigator.userAgent);\n      })(),\n\n      /**\n       * Client version\n       *\n       * @memberOf client\n       * @type {Number}\n       * @private\n       */\n      version: function () {\n        var result = 0;\n\n        if (client.ie) {\n          result = number.parse(string.trim(navigator.userAgent.replace(/( .*msie|;.*)/gi, \"\")) || 9, 10);\n        }\n\n        return result;\n      },\n\n      /**\n       * Quick way to see if a URI allows a specific verb\n       *\n       * @method allows\n       * @memberOf client\n       * @param  {String} uri  URI to query\n       * @param  {String} verb HTTP verb\n       * @return {Boolean}     `true` if the verb is allowed, undefined if unknown\n       * @private\n       */\n      allows: function (uri, verb) {\n        uri = utility.parse(uri).href;\n        verb = verb.toLowerCase();\n\n        var result = false;\n        var bit = 0;\n\n        if (!cache.get(uri, false)) {\n          result = undefined;\n        } else {\n          if (regex.del.test(verb)) {\n            bit = 1;\n          } else if (regex.get_headers.test(verb)) {\n            bit = 4;\n          } else if (regex.put_post.test(verb)) {\n            bit = 2;\n          } else if (regex.patch.test(verb)) {\n            bit = 8;\n          }\n\n          result = Boolean(client.permissions(uri, verb).bit & bit);\n        }\n\n        return result;\n      },\n\n      /**\n       * Gets bit value based on args\n       *\n       * @method bit\n       * @memberOf client\n       * @param  {Array} args Array of commands the URI accepts\n       * @return {Number} To be set as a bit\n       * @private\n       */\n      bit: function (args) {\n        var result = 0;\n\n        array.each(args, function (verb) {\n          verb = verb.toLowerCase();\n\n          if (regex.get_headers.test(verb)) {\n            result |= 4;\n          } else if (regex.put_post.test(verb)) {\n            result |= 2;\n          } else if (regex.patch.test(verb)) {\n            result |= 8;\n          } else if (regex.del.test(verb)) {\n            result |= 1;\n          }\n        });\n\n        return result;\n      },\n\n      /**\n       * Determines if a URI is a CORS end point\n       *\n       * @method cors\n       * @memberOf client\n       * @param  {String} uri  URI to parse\n       * @return {Boolean}     True if CORS\n       * @private\n       */\n      cors: function (uri) {\n        return !server && uri.indexOf(\"//\") > -1 && uri.indexOf(\"//\" + location.host) === -1;\n      },\n\n      /**\n       * Caches the headers from the XHR response\n       *\n       * @method headers\n       * @memberOf client\n       * @param  {Object} xhr  XMLHttpRequest Object\n       * @param  {String} uri  URI to request\n       * @param  {String} type Type of request\n       * @return {Object}      Cached URI representation\n       * @private\n       */\n      headers: function (xhr, uri, type) {\n        var headers = string.trim(xhr.getAllResponseHeaders()).split(\"\\n\");\n        var items = {};\n        var o = {};\n        var allow = null;\n        var expires = new Date();\n        var cors = client.cors(uri);\n\n        array.each(headers, function (i) {\n          var header = i.split(\": \");\n\n          items[header[0].toLowerCase()] = string.trim(header[1]);\n\n          if (allow === null) {\n            if (!cors && regex.allow.test(header) || cors && regex.allow_cors.test(header)) {\n              allow = header[1];\n            }\n          }\n        });\n\n        if (regex.no.test(items[\"cache-control\"])) {\n          expires = expires.getTime();\n        } else if (items[\"cache-control\"] && regex.number_present.test(items[\"cache-control\"])) {\n          expires = expires.setSeconds(expires.getSeconds() + number.parse(regex.number_present.exec(items[\"cache-control\"])[0], 10));\n        } else if (items.expires) {\n          expires = new Date(items.expires).getTime();\n        } else {\n          expires = expires.getTime();\n        }\n\n        o.expires = expires;\n        o.headers = items;\n        o.timestamp = new Date();\n        o.permission = client.bit(allow !== null ? string.explode(allow) : [type]);\n\n        if (type === \"get\") {\n          cache.set(uri, \"expires\", o.expires);\n          cache.set(uri, \"headers\", o.headers);\n          cache.set(uri, \"timestamp\", o.timestamp);\n          cache.set(uri, \"permission\", o.permission);\n        }\n\n        return o;\n      },\n\n      /**\n       * Parses an XHR response\n       *\n       * @method parse\n       * @memberOf client\n       * @param  {Object} xhr  XHR Object\n       * @param  {String} type [Optional] content-type header value\n       * @return {Mixed}       Array, Boolean, Document, Number, Object or String\n       * @private\n       */\n      parse: function (xhr) {\n        var type = arguments[1] === undefined ? \"\" : arguments[1];\n        var result = undefined,\n            obj = undefined;\n\n        if ((regex.json_maybe.test(type) || string.isEmpty(type)) && (regex.json_wrap.test(xhr.responseText) && Boolean(obj = json.decode(xhr.responseText, true)))) {\n          result = obj;\n        } else if (type === \"text/csv\") {\n          result = csv.decode(xhr.responseText);\n        } else if (type === \"text/tsv\") {\n          result = csv.decode(xhr.responseText, \"\\t\");\n        } else if (regex.xml.test(type)) {\n          if (type !== \"text/xml\") {\n            xhr.overrideMimeType(\"text/xml\");\n          }\n\n          result = xhr.responseXML;\n        } else if (type === \"text/plain\" && regex.is_xml.test(xhr.responseText) && xml.valid(xhr.responseText)) {\n          result = xml.decode(xhr.responseText);\n        } else {\n          result = xhr.responseText;\n        }\n\n        return result;\n      },\n\n      /**\n       * Returns the permission of the cached URI\n       *\n       * @method permissions\n       * @memberOf client\n       * @param  {String} uri URI to query\n       * @return {Object}     Contains an Array of available commands, the permission bit and a map\n       * @private\n       */\n      permissions: function (uri) {\n        var cached = cache.get(uri, false);\n        var bit = !cached ? 0 : cached.permission;\n        var result = { allows: [], bit: bit, map: { partial: 8, read: 4, write: 2, \"delete\": 1, unknown: 0 } };\n\n        if (bit & 1) {\n          result.allows.push(\"DELETE\");\n        }\n\n        if (bit & 2) {\n          result.allows.push(\"POST\");\n          result.allows.push(\"PUT\");\n        }\n\n        if (bit & 4) {\n          result.allows.push(\"GET\");\n        }\n\n        if (bit & 8) {\n          result.allows.push(\"PATCH\");\n        }\n\n        return result;\n      },\n\n      /**\n       * Creates a JSONP request\n       *\n       * @method jsonp\n       * @memberOf client\n       * @param  {String} uri  URI to request\n       * @param  {Mixed}  args Custom JSONP handler parameter name, default is \"callback\"; or custom headers for GET request ( CORS )\n       * @return {Object} {@link keigai.Deferred}\n       * @example\n       * keigai.util.jsonp( \"http://somedomain.com/resource?callback=\", function ( arg ) {\n       *   // `arg` is the coerced response body\n       * }, function ( err ) {\n       *   // Handle `err`\n       * } );\n       */\n      jsonp: function (uri, args) {\n        var defer = deferred.factory();\n        var callback = \"callback\";\n        var cbid = undefined,\n            s = undefined;\n\n        if (external === undefined) {\n          if (!global.keigai) {\n            global.keigai = { callback: {} };\n          }\n\n          external = \"keigai\";\n        }\n\n        if (args instanceof Object && !args.callback) {\n          callback = args.callback;\n        }\n\n        do {\n          cbid = utility.genId().slice(0, 10);\n        } while (global.callback[cbid]);\n\n        uri = uri.replace(callback + \"=?\", callback + \"=\" + external + \".callback.\" + cbid);\n\n        global.callback[cbid] = function (arg) {\n          utility.clearTimers(cbid);\n          delete global.callback[cbid];\n          defer.resolve(arg);\n          element.destroy(s);\n        };\n\n        s = element.create(\"script\", { src: uri, type: \"text/javascript\" }, utility.dom(\"head\")[0]);\n\n        utility.defer(function () {\n          defer.reject(new Error(label.requestTimeout));\n        }, 30000, cbid);\n\n        return defer;\n      },\n\n      /**\n       * KXMLHttpRequest factory\n       *\n       * @method kxhr\n       * @memberOf client\n       * @param {Object} xhr XMLHttpRequest\n       * @return {Object} {@link keigai.KXMLHttpRequest}\n       * @private\n       */\n      kxhr: function (xhr) {\n        var obj = new KXMLHttpRequest(xhr);\n\n        // Wrapping deferred methods on obj\n        array.each(array.keys(Deferred.prototype), function (i) {\n          obj[i] = function () {\n            for (var _len7 = arguments.length, args = Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {\n              args[_key7] = arguments[_key7];\n            }\n\n            return obj.defer[i].apply(obj.defer, args);\n          };\n        });\n\n        // Hooking observer for standard events\n        array.each(EVENTS, function (i) {\n          obj.hook(obj.xhr, i);\n        });\n\n        return obj;\n      },\n\n      /**\n       * Creates an XmlHttpRequest to a URI ( aliased to multiple methods )\n       *\n       * The returned Deferred will have an .xhr\n       *\n       * @method request\n       * @memberOf client\n       * @param  {String}   uri     URI to query\n       * @param  {String}   type    [Optional] Type of request ( DELETE/GET/POST/PUT/PATCH/HEAD/OPTIONS ), default is `GET`\n       * @param  {Mixed}    args    [Optional] Data to send with the request\n       * @param  {Object}   headers [Optional] Custom request headers ( can be used to set withCredentials )\n       * @return {Object}   {@link keigai.KXMLHttpRequest}\n       * @example\n       * keigai.util.request( \"http://keigai.io\" ).then( function ( arg ) {\n       *   // `arg` is the coerced response body\n       * }, function ( err ) {\n       *   // Handle `err`\n       * } );\n       */\n      request: function (uri, type, args, headers) {\n        var type = arguments[1] === undefined ? \"GET\" : arguments[1];\n        uri = utility.parse(uri).href;\n        type = type.toLowerCase();\n        headers = headers instanceof Object ? headers : null;\n\n        var cors = client.cors(uri);\n        var kxhr = client.kxhr(!client.ie || (!cors || client.version > 9) ? new XMLHttpRequest() : new XDomainRequest());\n        var payload = (regex.put_post.test(type) || regex.patch.test(type)) && args ? args : null;\n        var cached = type === \"get\" ? cache.get(uri) : false;\n        var contentType = null;\n        var doc = client.doc;\n        var ab = client.ab;\n        var blob = client.blob;\n\n        // Only GET & POST is supported by XDomainRequest (so useless!)\n        if (client.ie && client.version === 9 && cors && !regex.xdomainrequest.test(type)) {\n          throw new Error(label.notAvailable);\n        }\n\n        // Hooking custom events\n        kxhr.on(\"readystatechange\", function (ev) {\n          var state = kxhr.xhr.readyState;\n\n          if (state === 1) {\n            kxhr.dispatch(\"beforeXHR\", kxhr.xhr, ev);\n          } else if (state === 4) {\n            kxhr.dispatch(\"afterXHR\", kxhr.xhr, ev);\n          }\n        });\n\n        if (!cors && !regex.get_headers.test(type) && client.allows(uri, type) === false) {\n          kxhr.dispatch(\"beforeXHR\", kxhr.xhr, null);\n          kxhr.xhr.status = 405;\n          kxhr.reject(new Error(label.methodNotAllowed));\n          utility.delay(function () {\n            kxhr.dispatch(\"afterXHR\", kxhr.xhr, null);\n          });\n\n          return;\n        }\n\n        if (type === \"get\" && Boolean(cached)) {\n          // Decorating XHR for proxy behavior\n          if (server) {\n            kxhr.xhr.readyState = 4;\n            kxhr.xhr.status = 200;\n            kxhr.xhr._resheaders = cached.headers;\n          }\n\n          kxhr.dispatch(\"beforeXHR\", kxhr.xhr, null);\n          kxhr.resolve(cached.response);\n\n          utility.delay(function () {\n            kxhr.dispatch(\"afterXHR\", kxhr.xhr, null);\n          });\n\n          return;\n        }\n\n        utility.delay(function () {\n          kxhr.xhr.open(type.toUpperCase(), uri, true);\n\n          // Setting content-type value\n          if (headers !== null && headers.hasOwnProperty(\"content-type\")) {\n            contentType = headers[\"content-type\"];\n          }\n\n          if (cors && contentType === null) {\n            contentType = \"text/plain\";\n          }\n\n          // Transforming payload\n          if (payload !== null) {\n            if (payload.hasOwnProperty(\"xml\")) {\n              payload = payload.xml;\n            }\n\n            if (doc && payload instanceof Document) {\n              payload = xml.decode(payload);\n            }\n\n            if (typeof payload == \"string\" && regex.is_xml.test(payload)) {\n              contentType = \"application/xml\";\n            }\n\n            if (!(ab && payload instanceof ArrayBuffer) && !(blob && payload instanceof Blob) && !(payload instanceof Buffer) && payload instanceof Object) {\n              contentType = \"application/json\";\n              payload = json.encode(payload);\n            }\n\n            if (contentType === null && (ab && payload instanceof ArrayBuffer || blob && payload instanceof Blob)) {\n              contentType = \"application/octet-stream\";\n            }\n\n            if (contentType === null) {\n              contentType = \"application/x-www-form-urlencoded; charset=UTF-8\";\n            }\n          }\n\n          // Setting headers for everything except IE9 CORS requests\n          if (!client.ie || (!cors || client.version > 9)) {\n            if (headers === null) {\n              headers = {};\n            }\n\n            if (typeof cached == \"object\" && cached.headers.hasOwnProperty(\"etag\")) {\n              headers.etag = cached.headers.etag;\n            }\n\n            if (contentType !== null) {\n              headers[\"content-type\"] = contentType;\n            }\n\n            if (headers.hasOwnProperty(\"callback\")) {\n              delete headers.callback;\n            }\n\n            headers[\"x-requested-with\"] = \"XMLHttpRequest\";\n\n            utility.iterate(headers, function (v, k) {\n              if (v !== null && k !== \"withCredentials\") {\n                kxhr.xhr.setRequestHeader(k, v);\n              }\n            });\n\n            // Cross Origin Resource Sharing ( CORS )\n            if (typeof kxhr.xhr.withCredentials == \"boolean\" && headers !== null && typeof headers.withCredentials == \"boolean\") {\n              kxhr.xhr.withCredentials = headers.withCredentials;\n            }\n          }\n\n          kxhr.on(\"load\", function () {\n            var self = kxhr;\n            var xdr = client.ie && self.xhr.readyState === undefined;\n            var shared = true;\n            var o = undefined,\n                r = undefined,\n                t = undefined,\n                redirect = undefined;\n\n            if (!xdr && kxhr.xhr.readyState === 4) {\n              switch (kxhr.xhr.status) {\n                case 200:\n                case 201:\n                case 202:\n                case 203:\n                case 204:\n                case 205:\n                case 206:\n                  o = client.headers(kxhr.xhr, uri, type);\n\n                  if (type === \"head\") {\n                    return kxhr.resolve(o.headers);\n                  } else if (type === \"options\") {\n                    return kxhr.resolve(o.headers);\n                  } else if (type !== \"delete\") {\n                    if (server && regex.priv.test(o.headers[\"cache-control\"])) {\n                      shared = false;\n                    }\n\n                    if (regex.http_body.test(kxhr.xhr.status)) {\n                      t = o.headers[\"content-type\"] || \"\";\n                      r = client.parse(kxhr.xhr, t);\n\n                      if (r === undefined) {\n                        kxhr.reject(new Error(label.serverError));\n                      }\n                    }\n\n                    if (type === \"get\" && shared) {\n                      cache.set(uri, \"response\", o.response = utility.clone(r, true));\n                    } else {\n                      cache.expire(uri, true);\n                    }\n                  } else if (type === \"delete\") {\n                    cache.expire(uri, true);\n                  }\n\n                  switch (kxhr.xhr.status) {\n                    case 200:\n                    case 202:\n                    case 203:\n                    case 206:\n                      kxhr.resolve(r);\n                      break;\n                    case 201:\n                      if ((o.headers.location === undefined || string.isEmpty(o.headers.location)) && !string.isUrl(r)) {\n                        kxhr.resolve(r);\n                      } else {\n                        redirect = string.trim(o.headers.Location || r);\n                        client.request(redirect).then(function (arg) {\n                          self.resolve(arg);\n                        }, function (e) {\n                          self.reject(e);\n                        });\n                      }\n                      break;\n                    case 204:\n                    case 205:\n                      kxhr.resolve(null);\n                      break;\n                  }\n                  break;\n                case 304:\n                  kxhr.resolve(r);\n                  break;\n                case 401:\n                  kxhr.reject(new Error(kxhr.xhr.responseText || label.serverUnauthorized));\n                  break;\n                case 403:\n                  cache.set(uri, \"!permission\", client.bit([type]));\n                  kxhr.reject(new Error(kxhr.xhr.responseText || label.serverForbidden));\n                  break;\n                case 405:\n                  cache.set(uri, \"!permission\", client.bit([type]));\n                  kxhr.reject(new Error(kxhr.xhr.responseText || label.serverInvalidMethod));\n                  break;\n                default:\n                  kxhr.reject(new Error(kxhr.xhr.responseText || label.serverError));\n              }\n            } else if (xdr) {\n              r = client.parse(kxhr.xhr, \"text/plain\");\n              cache.set(uri, \"permission\", client.bit([\"get\"]));\n              cache.set(uri, \"response\", r);\n              kxhr.resolve(r);\n            }\n          });\n\n          kxhr.on(\"error\", function (e) {\n            kxhr.reject(e);\n          });\n\n          // Sending request\n          kxhr.xhr.send(payload !== null ? payload : undefined);\n        });\n\n        return kxhr;\n      },\n\n      /**\n       * Scrolls to a position in the view using a two point bezier curve\n       *\n       * @method scroll\n       * @memberOf client\n       * @param  {Array}  dest Coordinates\n       * @param  {Number} ms   [Optional] Milliseconds to scroll, default is 250, min is 100\n       * @return {Object} {@link Deferred}\n       * @private\n       */\n      scroll: function (dest, ms) {\n        var defer = deferred();\n        var start = client.scrollPos();\n        var t = 0;\n\n        ms = (!isNaN(ms) ? ms : 250) / 100;\n\n        utility.repeat(function () {\n          var pos = math.bezier(start[0], start[1], dest[0], dest[1], ++t / 100);\n\n          window.scrollTo(pos[0], pos[1]);\n\n          if (t === 100) {\n            defer.resolve(true);\n            return false;\n          }\n        }, ms, \"scrolling\");\n\n        return defer;\n      },\n\n      /**\n       * Returns the current scroll position of the View\n       *\n       * @method scrollPos\n       * @memberOf client\n       * @return {Array} Describes the scroll position\n       * @private\n       */\n      scrollPos: function () {\n        return [window.scrollX || 0, window.scrollY || 0];\n      }\n    };\n\n    /**\n     * @namespace csv\n     */\n    var csv = {\n      /**\n       * Converts CSV to an Array of Objects\n       *\n       * @method decode\n       * @memberOf csv\n       * @param  {String} arg       CSV string\n       * @param  {String} delimiter [Optional] Delimiter to split columns on, default is \",\"\n       * @return {Array}            Array of Objects\n       */\n      decode: function (arg) {\n        var delimiter = arguments[1] === undefined ? \",\" : arguments[1];\n        var regex = new RegExp(delimiter + \"(?=(?:[^\\\"]|\\\"(?:[^\\\"])[^\\\"]*\\\")*$)\");\n        var rows = string.trim(arg).split(\"\\n\");\n        var keys = rows.shift().split(delimiter);\n        var result = [];\n        var nth = rows.length;\n        var x = keys.length;\n        var i = -1;\n        var n = undefined,\n            obj = undefined,\n            row = undefined;\n\n        while (++i < nth) {\n          obj = {};\n          row = rows[i].split(regex);\n\n          n = -1;\n          while (++n < x) {\n            obj[keys[n]] = utility.coerce((row[n] || \"\").replace(/^\"|\"$/g, \"\"));\n          }\n\n          result.push(obj);\n        }\n\n        return result;\n      },\n\n      /**\n       * Encodes an Array, JSON, or Object as CSV\n       *\n       * @method encode\n       * @memberOf csv\n       * @param  {Mixed}   arg       JSON, Array or Object\n       * @param  {String}  delimiter [Optional] Character to separate fields\n       * @param  {Boolean} header    [Optional] `false` to disable keys names as first row\n       * @return {String}            CSV string\n       * @example\n       * let csv = keigai.util.csv.encode( [{prop:\"value\"}, {prop:\"value2\"}] );\n       *\n       * console.log( csv );\n       * \"prop\n       *  value\n       *  value2\"\n       */\n      encode: function (arg) {\n        var delimiter = arguments[1] === undefined ? \",\" : arguments[1];\n        var header = arguments[2] === undefined ? true : arguments[2];\n        var obj = json.decode(arg, true) || arg;\n        var result = \"\";\n\n        // Prepares input based on CSV rules\n        var prepare = function (input) {\n          var output = undefined;\n\n          if (input instanceof Array) {\n            output = \"\\\"\" + input.toString() + \"\\\"\";\n\n            if (regex.object_type.test(output)) {\n              output = \"\\\"\" + csv.encode(input, delimiter) + \"\\\"\";\n            }\n          } else if (input instanceof Object) {\n            output = \"\\\"\" + csv.encode(input, delimiter) + \"\\\"\";\n          } else if (regex.csv_quote.test(input)) {\n            output = \"\\\"\" + input.replace(/\"/g, \"\\\"\\\"\") + \"\\\"\";\n          } else {\n            output = input;\n          }\n\n          return output;\n        };\n\n        if (obj instanceof Array) {\n          if (obj[0] instanceof Object) {\n            if (header) {\n              result = array.keys(obj[0]).join(delimiter) + \"\\n\";\n            }\n\n            result += obj.map(function (i) {\n              return csv.encode(i, delimiter, false);\n            }).join(\"\\n\");\n          } else {\n            result += prepare(obj, delimiter) + \"\\n\";\n          }\n        } else {\n          if (header) {\n            result = array.keys(obj).join(delimiter) + \"\\n\";\n          }\n\n          result += array.cast(obj).map(prepare).join(delimiter) + \"\\n\";\n        }\n\n        return result.replace(regex.eol_nl, \"\");\n      }\n    };\n\n    var DataListFilter = (function (Base) {\n      /**\n       * Creates a new DataListFilter\n       *\n       * @constructor\n       * @memberOf keigai\n       * @extends {keigai.Base}\n       * @param  {Object} obj      Element to receive the filter\n       * @param  {Object} list     {@link keigai.DataList}\n       * @param  {Number} debounce [Optional] Milliseconds to debounce\n       * @example\n       * let store  = keigai.store( [...] ),\n       *     list   = keigai.list( document.querySelector( \"#list\" ), store, \"{{field}}\" ),\n       *     filter = keigai.filter( document.querySelector( \"input.filter\" ), list, \"field\" );\n       */\n      function DataListFilter(element, list, debounce) {\n        this.debounce = debounce;\n        this.element = element;\n        this.filters = {};\n        this.list = list;\n        this.observer = observable.factory();\n      }\n\n      _inherits(DataListFilter, Base);\n\n      _prototypeProperties(DataListFilter, null, {\n        set: {\n\n          /**\n           * Set the filters\n           *\n           * Create an object based on comma separated key string\n           *\n           * @method set\n           * @memberOf keigai.DataListFilter\n           * @param  {String} fields Comma separated filters\n           * @return {Object} {@link keigai.DataListFilter}\n           * @example\n           * filter.set( \"firstName, lastName, email\" );\n           */\n          value: function set(fields) {\n            var self = this;\n\n            this.filters = {};\n            array.each(string.explode(fields), function (v) {\n              self.filters[v] = \"\";\n            });\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        teardown: {\n\n          /**\n           * Removes listeners, and DOM hooks to avoid memory leaks\n           *\n           * @method teardown\n           * @memberOf keigai.DataListFilter\n           * @return {Object} {@link keigai.DataListFilter}\n           * @example\n           * filter.teardown();\n           */\n          value: function teardown() {\n            this.observer.unhook(this.element, \"keyup\");\n            this.observer.unhook(this.element, \"input\");\n            this.element = null;\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        update: {\n\n          /**\n           * Applies the input value as a filter against the DataList based on specific fields\n           *\n           * @method update\n           * @memberOf keigai.DataListFilter\n           * @fires keigai.DataList#beforeFilter Fires before filter\n           * @fires keigai.DataList#afterFilter Fires after filter\n           * @return {Object} {@link keigai.DataListFilter}\n           * @example\n           * filter.update(); // Debounced execution\n           */\n          value: function update() {\n            var self = this;\n\n            utility.defer(function () {\n              var val = element.val(self.element).toString();\n\n              self.list.dispatch(\"beforeFilter\", self.element, val);\n\n              if (!string.isEmpty(val)) {\n                utility.iterate(self.filters, function (v, k) {\n                  var queries = string.explode(val);\n\n                  // Ignoring trailing commas\n                  queries = queries.filter(function (i) {\n                    return !string.isEmpty(i);\n                  });\n\n                  // Shaping valid pattern\n                  array.each(queries, function (i, idx) {\n                    queries[idx] = \"^.*\" + string.escape(i).replace(/(^\\*|\\*$)/g, \"\").replace(/\\*/g, \".*\") + \".*\";\n                  });\n\n                  self.filters[k] = queries.join(\",\");\n                });\n\n                self.list.filter = self.filters;\n              } else {\n                self.list.filter = null;\n              }\n\n              self.list.pageIndex = 1;\n              self.list.refresh();\n              self.list.dispatch(\"afterFilter\", self.element);\n            }, this.debounce, this.element.id + \"Debounce\");\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        }\n      });\n\n      return DataListFilter;\n    })(Base);\n\n    /**\n     * @namespace filter\n     */\n    var filter = {\n      /**\n       * DataListFilter factory\n       *\n       * @method factory\n       * @memberOf filter\n       * @param  {Object} target   Element to receive the filter\n       * @param  {Object} list     {@link keigai.DataList}\n       * @param  {String} filters  Comma delimited string of fields to filter by\n       * @param  {Number} debounce [Optional] Milliseconds to debounce, default is `250`\n       * @return {Object} {@link keigai.DataListFilter}\n       * @example\n       * let store  = keigai.store( [...] ),\n       *     list   = keigai.list( document.querySelector( \"#list\" ), store, \"{{field}}\" ),\n       *     filter = keigai.filter( document.querySelector( \"input.filter\" ), list, \"field\" );\n       */\n      factory: function (target, list, filters) {\n        var debounce = arguments[3] === undefined ? 250 : arguments[3];\n        var ref = [list];\n        var obj = new DataListFilter(target, ref[0], debounce).set(filters);\n\n        // Decorating `target` with the appropriate input `type`\n        element.attr(target, \"type\", \"text\");\n\n        // Setting up a chain of Events\n        obj.observer.hook(obj.element, \"keyup\");\n        obj.observer.hook(obj.element, \"input\");\n        obj.on(\"keyup\", obj.update, \"keyup\");\n        obj.on(\"input\", obj.update, \"input\");\n\n        return obj;\n      }\n    };\n\n    var DataGrid = (function (Base) {\n      /**\n       * Creates a new DataGrid\n       *\n       * @constructor\n       * @memberOf keigai\n       * @extends {keigai.Base}\n       * @param  {Object}  target   Element to receive DataGrid\n       * @param  {Object}  store    DataStore\n       * @param  {Array}   fields   Array of fields to display\n       * @param  {Array}   sortable [Optional] Array of sortable columns/fields\n       * @param  {Object}  options  [Optional] DataList options\n       * @param  {Boolean} filtered [Optional] Create an input to filter the DataGrid\n       * @example\n       * let fields  = [\"name\", \"age\"],\n       *     options = {pageSize: 5, order: \"age desc, name\"},\n       *     store   = keigai.store( [...] ),\n       *     grid    = keigai.grid( document.querySelector( \"#grid\" ), store, fields, fields, options, true );\n       */\n      function DataGrid(target, store, fields) {\n        var sortable = arguments[3] === undefined ? [] : arguments[3];\n        var options = arguments[4] === undefined ? {} : arguments[4];\n        var filtered = arguments[5] === undefined ? false : arguments[5];\n        var sortOrder = undefined;\n\n        if (options.order && !string.isEmpty(options.order)) {\n          sortOrder = string.explode(options.order).map(function (i) {\n            return i.replace(regex.after_space, \"\");\n          });\n        }\n\n        this.element = element.create(\"section\", { \"class\": \"grid\" }, target);\n        this.fields = fields;\n        this.filtered = filtered;\n        this.list = null;\n        this.observer = observable.factory();\n        this.options = options;\n        this.store = store;\n        this.sortable = sortable;\n        this.sortOrder = sortOrder || sortable;\n      }\n\n      _inherits(DataGrid, Base);\n\n      _prototypeProperties(DataGrid, null, {\n        add: {\n\n          /**\n           * Adds an item to the DataGrid\n           *\n           * @method add\n           * @memberOf keigai.DataGrid\n           * @param {Object} record New DataStore record (shapes should match)\n           * @return {Object}       {@link keigai.DataGrid}\n           * @example\n           * grid.add( {name: \"John Doe\", age: 34} );\n           */\n          value: function add(record) {\n            var self = this;\n\n            this.store.set(null, record).then(null, function (e) {\n              utility.error(e);\n              self.dispatch(\"error\", e);\n            });\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        dump: {\n\n          /**\n           * Exports data grid records\n           *\n           * @method dump\n           * @memberOf keigai.DataGrid\n           * @return {Array} Record set\n           * @example\n           * let data = grid.dump();\n           */\n          value: function dump() {\n            return this.store.dump(this.list.records, this.fields);\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        refresh: {\n\n          /**\n           * Refreshes the DataGrid\n           *\n           * @method refresh\n           * @memberOf keigai.DataGrid\n           * @fires keigai.DataGrid#beforeRefresh Fires before refresh\n           * @fires keigai.DataGrid#afterRefresh Fires after refresh\n           * @return {Object} {@link keigai.DataGrid}\n           * @example\n           * grid.refresh();\n           */\n          value: function refresh() {\n            var sort = [];\n            var self = this;\n\n            this.dispatch(\"beforeRefresh\", this.element);\n\n            if (this.sortOrder.length > 0) {\n              array.each(this.sortOrder, function (i) {\n                var obj = element.find(self.element, \".header span[data-field='\" + i + \"']\")[0];\n\n                sort.push(string.trim(i + \" \" + (element.data(obj, \"sort\") || \"\")));\n              });\n\n              this.options.order = this.list.order = sort.join(\", \");\n            }\n\n            this.list.where = null;\n            utility.merge(this.list, this.options);\n            this.list.refresh();\n\n            this.dispatch(\"afterRefresh\", this.element);\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        remove: {\n\n          /**\n           * Removes an item from the DataGrid\n           *\n           * @method remove\n           * @memberOf keigai.DataGrid\n           * @param {Mixed} record Record, key or index\n           * @return {Object} {@link keigai.DataGrid}\n           * @example\n           * grid.remove( \"key\" );\n           */\n          value: function remove(record) {\n            var self = this;\n\n            this.store.del(record).then(null, function (e) {\n              utility.error(e);\n              self.dispatch(\"error\", e);\n            });\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        sort: {\n\n          /**\n           * Sorts the DataGrid when a column header is clicked\n           *\n           * @method sort\n           * @memberOf keigai.DataGrid\n           * @param  {Object} ev Event\n           * @return {Object} {@link keigai.DataGrid}\n           */\n          value: function sort(ev) {\n            var target = utility.target(ev);\n            var field = undefined;\n\n            // Stopping event propogation\n            utility.stop(ev);\n\n            // Refreshing list if target is sortable\n            if (element.hasClass(target, \"sortable\")) {\n              field = element.data(target, \"field\");\n              element.data(target, \"sort\", element.data(target, \"sort\") === \"asc\" ? \"desc\" : \"asc\");\n              array.remove(this.sortOrder, field);\n              this.sortOrder.splice(0, 0, field);\n              this.refresh();\n            }\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        teardown: {\n\n          /**\n           * Tears down the DataGrid\n           *\n           * @method teardown\n           * @memberOf keigai.DataGrid\n           * @return {Object} {@link keigai.DataGrid}\n           * @example\n           * grid.teardown();\n           */\n          value: function teardown() {\n            this.observer.unhook(element.find(this.element, \"ul.header\")[0], \"click\");\n            this.list.teardown();\n            element.destroy(this.element);\n            this.element = null;\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        update: {\n\n          /**\n           * Updates an item in the DataGrid\n           *\n           * @method update\n           * @memberOf keigai.DataGrid\n           * @param {Mixed}  key  Key or index\n           * @param {Object} data New property values\n           * @return {Object}     {@link keigai.DataGrid}\n           * @example\n           * grid.update( \"key\", {name: \"Jim Smith\"} );\n           */\n          value: function update(key, data) {\n            var self = this;\n\n            this.store.update(key, data).then(null, function (e) {\n              utility.error(e);\n              self.dispatch(\"error\", e);\n            });\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        }\n      });\n\n      return DataGrid;\n    })(Base);\n\n    /**\n     * @namespace grid\n     */\n    var grid = {\n      /**\n       * DataGrid factory\n       *\n       * @method factory\n       * @memberOf grid\n       * @fires keigai.DataGrid#change Fires when the DOM changes\n       * @param  {Object}  target      Element to receive DataGrid\n       * @param  {Object}  store       DataStore\n       * @param  {Array}   fields      Array of fields to display\n       * @param  {Array}   sortable    [Optional] Array of sortable columns/fields\n       * @param  {Object}  options     [Optional] DataList options\n       * @param  {Boolean} filtered    [Optional] Create an input to filter the data grid\n       * @param  {Number}  debounce    [Optional] DataListFilter input debounce, default is 250\n       * @return {Object} {@link keigai.DataGrid}\n       * @example\n       * let fields  = [\"name\", \"age\"],\n       *     options = {pageSize: 5, order: \"age desc, name\"},\n       *     store   = keigai.store(),\n       *     grid    = keigai.grid( document.querySelector( \"#grid\" ), store, fields, fields, options, true );\n       *\n       * store.setUri( \"data.json\" ).then( null, function ( e ) {\n       *   ...\n       * } );\n       */\n      factory: function (target, store, fields, sortable, options, filtered, debounce) {\n        var ref = [store];\n        var obj = new DataGrid(target, ref[0], fields, sortable, options, filtered);\n        var template = \"\";\n        var header = element.create(\"li\", {}, element.create(\"ul\", { \"class\": \"header\" }, obj.element));\n        var width = 100 / obj.fields.length + \"%\";\n        var css = \"display:inline-block;width:\" + width;\n        var sort = obj.options.order ? string.explode(obj.options.order) : [];\n\n        // Creating DataList template based on fields\n        array.each(obj.fields, function (i) {\n          var trimmed = i.replace(/.*\\./g, \"\");\n          var el = element.create(\"span\", {\n            innerHTML: string.capitalize(string.unCamelCase(string.unhyphenate(trimmed, true)).replace(/_|-/g, \" \"), true),\n            style: css,\n            \"data-field\": i\n          }, header);\n\n          // Adding CSS class if \"column\" is sortable\n          if (array.contains(obj.sortable, i)) {\n            element.addClass(el, \"sortable\");\n\n            // Applying default sort, if specified\n            if (sort.filter(function (x) {\n              return x.indexOf(i) === 0;\n            }).length > 0) {\n              element.data(el, \"sort\", array.contains(sort, i + \" desc\") ? \"desc\" : \"asc\");\n            }\n          }\n\n          template += \"<span class=\\\"\" + i + \"\\\" data-field=\\\"\" + i + \"\\\" style=\\\"\" + css + \"\\\">{{\" + i + \"}}</span>\";\n        });\n\n        // Setting click handler on sortable \"columns\"\n        if (obj.sortable.length > 0) {\n          obj.observer.hook(header.parentNode, \"click\", obj.sort, \"sort\", obj);\n        }\n\n        if (obj.filtered === true) {\n          obj.options.listFiltered = true;\n          obj.options.listFilter = obj.fields.join(\",\");\n        }\n\n        // Creating DataList\n        ref.push(list.factory(obj.element, ref[0], template, obj.options));\n\n        // Setting by-reference DataList on DataGrid\n        obj.list = ref[1];\n\n        // Setting up a chain of Events\n        obj.on(\"beforeRefresh\", function (arg) {\n          element.dispatch(arg, \"beforeRefresh\");\n        }, \"bubble\");\n\n        obj.on(\"afterRefresh\", function (arg) {\n          element.dispatch(arg, \"afterRefresh\");\n        }, \"bubble\");\n\n        obj.on(\"click\", function (e) {\n          if (element.hasClass(e.currentTarget, \"header\")) {\n            obj.sort(e);\n          }\n        }, \"header\");\n\n        obj.list.on(\"change\", function () {\n          for (var _len8 = arguments.length, args = Array(_len8), _key8 = 0; _key8 < _len8; _key8++) {\n            args[_key8] = arguments[_key8];\n          }\n\n          obj.dispatch.apply(obj, [\"change\"].concat(args));\n        }, \"change\");\n\n        obj.list.on(\"beforeFilter\", function () {\n          for (var _len9 = arguments.length, args = Array(_len9), _key9 = 0; _key9 < _len9; _key9++) {\n            args[_key9] = arguments[_key9];\n          }\n\n          obj.dispatch.apply(obj, [\"beforeFilter\"].concat(args));\n        }, \"beforeFilter\");\n\n        obj.list.on(\"afterFilter\", function () {\n          for (var _len10 = arguments.length, args = Array(_len10), _key10 = 0; _key10 < _len10; _key10++) {\n            args[_key10] = arguments[_key10];\n          }\n\n          obj.dispatch.apply(obj, [\"afterFilter\"].concat(args));\n        }, \"afterFilter\");\n\n        return obj;\n      }\n    };\n\n    var DataList = (function (Base) {\n      /**\n       * Creates a new DataList\n       *\n       * @constructor\n       * @memberOf keigai\n       * @extends {keigai.Base}\n       * @example\n       * let store = keigai.store( [...] ),\n       *     list  = keigai.list( document.querySelector(\"#list\"), store, \"{{name}}\", {order: \"name\"} );\n       */\n      function DataList(element, store, template) {\n        this.callback = null;\n        this.current = [];\n        this.element = element;\n        this.emptyMsg = label.noData;\n        this.filter = null;\n        this.filtered = [];\n        this.id = utility.genId();\n        this.items = [];\n        this.listFilter = null;\n        this.mutation = null;\n        this.observer = observable.factory();\n        this.pageIndex = 1;\n        this.pageSize = null;\n        this.pageRange = 5;\n        this.pagination = \"bottom\"; // \"top\" or \"bottom|top\" are also valid\n        this.placeholder = \"\";\n        this.order = \"\";\n        this.records = [];\n        this.template = template;\n        this.total = 0;\n        this.store = store;\n        this.where = null;\n      }\n\n      _inherits(DataList, Base);\n\n      _prototypeProperties(DataList, null, {\n        add: {\n\n          /**\n           * Adds an item to the DataList\n           *\n           * @method add\n           * @memberOf keigai.DataList\n           * @param {Object} record New DataStore record (shapes should match)\n           * @return {Object}       {@link keigai.DataList}\n           * @example\n           * list.add( {name: \"John Doe\", age: 34} );\n           */\n          value: function add(record) {\n            var self = this;\n\n            this.store.set(null, record).then(null, function (e) {\n              utility.error(e);\n              self.dispatch(\"error\", e);\n            });\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        dump: {\n\n          /**\n           * Exports data list records\n           *\n           * @method dump\n           * @memberOf keigai.DataList\n           * @return {Array} Record set\n           * @example\n           * let data = list.dump();\n           */\n          value: function dump() {\n            return this.store.dump(this.records);\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        page: {\n\n          /**\n           * Changes the page index of the DataList\n           *\n           * @method page\n           * @memberOf keigai.DataList\n           * @param  {Number} n Page to view\n           * @return {Object}   {@link keigai.DataList}\n           * @example\n           * list.page( 2 );\n           */\n          value: function page(n) {\n            this.pageIndex = n;\n\n            return this.refresh();\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        pages: {\n\n          /**\n           * Adds pagination Elements to the View, executed from `DataList.refresh()`\n           *\n           * @method pages\n           * @memberOf keigai.DataList\n           * @return {Object} {@link keigai.DataList}\n           * @example\n           * list.pages();\n           */\n          value: function pages() {\n            var self = this;\n            var obj = this.element;\n            var page = this.pageIndex;\n            var pos = this.pagination;\n            var range = this.pageRange;\n            var mid = Math.floor(range / 2);\n            var start = page - mid;\n            var end = page + mid;\n            var total = list.pages(this);\n            var diff = undefined;\n\n            // Removing the existing controls\n            array.each(utility.dom(\"#\" + obj.id + \"-pages-top, #\" + obj.id + \"-pages-bottom\"), function (i) {\n              if (i) {\n                self.observer.unhook(i, \"click\");\n                element.destroy(i);\n              }\n            });\n\n            // Halting because there's 1 page, or nothing\n            if (this.filter && this.filtered.length === 0 || this.total === 0 || total === 1) {\n              return this;\n            }\n\n            // Getting the range to display\n            if (start < 1) {\n              diff = number.diff(start, 1);\n              start = start + diff;\n              end = end + diff;\n            }\n\n            if (end > total) {\n              end = total;\n              start = end - range + 1;\n\n              if (start < 1) {\n                start = 1;\n              }\n            }\n\n            if (number.diff(start, end) >= range) {\n              --end;\n            }\n\n            array.each(string.explode(pos), function (i) {\n              var current = false;\n              var more = page > 1;\n              var next = page + 1 <= total;\n              var last = page >= total;\n              var el = undefined,\n                  n = undefined;\n\n              // Setting up the list\n              el = element.create(\"ul\", {\n                \"class\": \"list pages hidden \" + i,\n                id: obj.id + \"-pages-\" + i\n              }, obj, i === \"bottom\" ? \"after\" : \"before\");\n\n              // First page\n              element.create(more ? \"a\" : \"span\", {\n                \"class\": \"first page\",\n                \"data-page\": 1,\n                innerHTML: \"&lt;&lt;\"\n              }, element.create(\"li\", {}, el));\n\n              // Previous page\n              element.create(more ? \"a\" : \"span\", {\n                \"class\": \"prev page\",\n                \"data-page\": page - 1,\n                innerHTML: \"&lt;\"\n              }, element.create(\"li\", {}, el));\n\n              // Rendering the page range\n              n = start - 1;\n              while (++n <= end) {\n                current = n === page;\n                element.create(current ? \"span\" : \"a\", {\n                  \"class\": current ? \"current page\" : \"page\",\n                  \"data-page\": n,\n                  innerHTML: n\n                }, element.create(\"li\", {}, el));\n              }\n\n              // Next page\n              element.create(next ? \"a\" : \"span\", {\n                \"class\": \"next page\",\n                \"data-page\": next ? page + 1 : null,\n                innerHTML: \"&gt;\"\n              }, element.create(\"li\", {}, el));\n\n              // Last page\n              element.create(last ? \"span\" : \"a\", {\n                \"class\": \"last page\",\n                \"data-page\": last ? null : total,\n                innerHTML: \"&gt;&gt;\"\n              }, element.create(\"li\", {}, el));\n\n              // Adding to DOM\n              element.removeClass(el, \"hidden\");\n\n              // Pagination listener\n              self.observer.hook(el, \"click\");\n            });\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        refresh: {\n\n          /**\n           * Refreshes element\n           *\n           * @method refresh\n           * @memberOf keigai.DataList\n           * @extends {keigai.Base}\n           * @fires keigai.DataList#beforeRefresh Fires before refresh\n           * @fires keigai.DataList#afterRefresh Fires after refresh\n           * @fires keigai.DataList#error Fires on error\n           * @param  {Boolean} create [Optional] Recreates cached View of data\n           * @return {Object} {@link keigai.DataList}\n           * @example\n           * list.refresh();\n           */\n          value: function refresh(create) {\n            create = create === true;\n\n            var self = this;\n            var el = this.element;\n            var template = typeof this.template == \"object\";\n            var filter = this.filter !== null;\n            var items = [];\n            var callback = typeof this.callback == \"function\";\n            var reg = new RegExp();\n            var registry = []; // keeps track of records in the list ( for filtering )\n            var range = [];\n            var fn = undefined,\n                ceiling = undefined,\n                next = undefined;\n\n            this.dispatch(\"beforeRefresh\", el);\n\n            // Function to create templates for the html rep\n            if (!template) {\n              fn = function (i) {\n                var html = self.template;\n                var items = array.unique(html.match(/\\{\\{[\\w\\.\\-\\[\\]]+\\}\\}/g));\n\n                // Replacing record key\n                html = html.replace(\"{{\" + self.store.key + \"}}\", i.key);\n\n                // Replacing dot notation properties\n                array.each(items, function (attr) {\n                  var key = attr.replace(/\\{\\{|\\}\\}/g, \"\"),\n                      value = utility.walk(i.data, key);\n\n                  if (value === undefined) {\n                    value = \"\";\n                  }\n\n                  reg.compile(string.escape(attr), \"g\");\n                  html = html.replace(reg, value);\n                });\n\n                // Filling in placeholder value\n                html = html.replace(/\\{\\{.*\\}\\}/g, self.placeholder);\n\n                return \"<li data-key=\\\"\" + i.key + \"\\\">\" + html + \"</li>\";\n              };\n            } else {\n              fn = function (i) {\n                var obj = json.encode(self.template);\n                var items = array.unique(obj.match(/\\{\\{[\\w\\.\\-\\[\\]]+\\}\\}/g));\n\n                // Replacing record key\n                obj = obj.replace(\"{{\" + self.store.key + \"}}\", i.key);\n\n                // Replacing dot notation properties\n                array.each(items, function (attr) {\n                  var key = attr.replace(/\\{\\{|\\}\\}/g, \"\");\n                  var value = utility.walk(i.data, key) || \"\";\n\n                  reg.compile(string.escape(attr), \"g\");\n\n                  // Stripping first and last \" to concat to valid JSON\n                  obj = obj.replace(reg, json.encode(value).replace(/(^\")|(\"$)/g, \"\"));\n                });\n\n                // Filling in placeholder value\n                obj = json.decode(obj.replace(/\\{\\{.*\\}\\}/g, self.placeholder));\n\n                return { li: obj };\n              };\n            }\n\n            // Next phase\n            next = function (args) {\n              // Creating view of DataStore\n              self.records = args;\n              self.total = self.records.length;\n              self.filtered = [];\n\n              // Resetting 'view' specific arrays\n              self.current = [];\n\n              // Filtering records (if applicable)\n              if (filter) {\n                array.each(self.records, function (i) {\n                  utility.iterate(self.filter, function (v, k) {\n                    var key = undefined;\n\n                    if (array.contains(registry, i.key)) {\n                      return false;\n                    }\n\n                    key = k === self.store.key;\n\n                    array.each(string.explode(v), function (query) {\n                      var reg = new RegExp(query, \"i\");\n                      var value = !key ? utility.walk(i.data, k) : \"\";\n\n                      if (key && reg.test(i.key) || reg.test(value)) {\n                        registry.push(i.key);\n                        self.filtered.push(i);\n\n                        return false;\n                      }\n                    });\n                  });\n                });\n              }\n\n              // Pagination\n              if (self.pageSize !== null && !isNaN(self.pageIndex) && !isNaN(self.pageSize)) {\n                ceiling = list.pages(self);\n\n                // Passed the end, so putting you on the end\n                if (ceiling > 0 && self.pageIndex > ceiling) {\n                  return self.page(ceiling);\n                }\n                // Paginating the items\n                else if (self.total > 0) {\n                  range = list.range(self);\n                  self.current = array.limit(!filter ? self.records : self.filtered, range[0], range[1]);\n                }\n              } else {\n                self.current = !filter ? self.records : self.filtered;\n              }\n\n              // Processing records & generating templates\n              array.each(self.current, function (i) {\n                var html = fn(i);\n                var hash = btoa(html);\n\n                items.push({ key: i.key, template: html, hash: hash });\n              });\n\n              // Updating element\n              utility.render(function () {\n                var destroy = [];\n                var callbacks = [];\n                var i = undefined,\n                    nth = undefined;\n\n                if (items.length === 0) {\n                  element.html(el, \"<li class=\\\"empty\\\">\" + self.emptyMsg + \"</li>\");\n                } else {\n                  if (self.items.length === 0) {\n                    element.html(el, items.map(function (i) {\n                      return i.template;\n                    }).join(\"\"));\n\n                    if (callback) {\n                      array.each(array.cast(el.childNodes), function (i) {\n                        self.callback(i);\n                      });\n                    }\n                  } else {\n                    array.each(items, function (i, idx) {\n                      if (self.items[idx] !== undefined && self.items[idx].hash !== i.hash) {\n                        element.data(element.html(el.childNodes[idx], i.template.replace(/<li data-key=\\\"\\d+\\\">|<\\/li>/g, \"\")), \"key\", i.key);\n                        callbacks.push(idx);\n                      } else if (self.items[idx] === undefined) {\n                        element.create(i.template, null, el);\n                        callbacks.push(idx);\n                      }\n                    });\n\n                    if (items.length < self.items.length) {\n                      i = items.length - 1;\n                      nth = self.items.length;\n\n                      while (++i < nth) {\n                        destroy.push(i);\n                      }\n\n                      array.each(destroy.reverse(), function (i) {\n                        element.destroy(el.childNodes[i]);\n                      });\n                    }\n\n                    if (callback) {\n                      array.each(callbacks, function (i) {\n                        self.callback(el.childNodes[i]);\n                      });\n                    }\n                  }\n                }\n\n                // Updating reference for next change\n                self.items = items;\n\n                // Rendering pagination elements\n                if (self.pageSize !== null && regex.top_bottom.test(self.pagination) && !isNaN(self.pageIndex) && !isNaN(self.pageSize)) {\n                  self.pages();\n                } else {\n                  array.each(utility.$(\"#\" + el.id + \"-pages-top, #\" + el.id + \"-pages-bottom\"), function (i) {\n                    element.destroy(i);\n                  });\n                }\n\n                self.dispatch(\"afterRefresh\", el);\n              });\n            };\n\n            // Consuming records based on sort\n            if (this.where === null) {\n              string.isEmpty(this.order) ? next(this.store.get()) : this.store.sort(this.order, create).then(next, function (e) {\n                utility.error(e);\n                self.dispatch(\"error\", e);\n              });\n            } else if (string.isEmpty(this.order)) {\n              this.store.select(this.where).then(next, function (e) {\n                utility.error(e);\n                self.dispatch(\"error\", e);\n              });\n            } else {\n              this.store.sort(this.order, create, this.where).then(next, function (e) {\n                utility.error(e);\n                self.dispatch(\"error\", e);\n              });\n            }\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        remove: {\n\n          /**\n           * Removes an item from the DataList\n           *\n           * @method remove\n           * @memberOf keigai.DataList\n           * @param {Mixed} record Record, key or index\n           * @return {Object} {@link keigai.DataList}\n           * @example\n           * // Adding a click handler to 'trash' Elements\n           * keigai.util.array.cast( document.querySelectorAll( \".list .trash\" ) ).forEach( ( i ) => {\n           *   i.addEventListener( \"click\", ( ev ) => {\n           *     let key = keigai.util.element.data( keigai.util.target( ev ).parentNode, \"key\" );\n           *\n           *     list.remove( key );\n           *   }, false );\n           * } );\n           */\n          value: function remove(record) {\n            var self = this;\n\n            this.store.del(record).then(null, function (e) {\n              utility.error(e);\n              self.dispatch(\"error\", e);\n            });\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        sort: {\n\n          /**\n           * Sorts data list & refreshes element\n           *\n           * @method sort\n           * @memberOf keigai.DataList\n           * @param  {String} order SQL \"ORDER BY\" clause\n           * @return {Object} {@link keigai.DataList}\n           * @example\n           * list.sort( \"age, name\" );\n           */\n          value: function sort(order) {\n            this.order = order;\n\n            return this.refresh();\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        teardown: {\n\n          /**\n           * Tears down references to the DataList\n           *\n           * @method teardown\n           * @memberOf keigai.DataList\n           * @param  {Boolean} destroy [Optional] `true` will remove the DataList from the DOM\n           * @return {Object} {@link keigai.DataList}\n           * @example\n           * list.teardown();\n           */\n          value: function teardown(destroy) {\n            destroy = destroy === true;\n\n            var self = this;\n            var el = this.element;\n            var id = el.id;\n\n            array.each(this.store.lists, function (i, idx) {\n              if (i.id === self.id) {\n                array.remove(self.store.lists, idx);\n\n                return false;\n              }\n            });\n\n            if (this.listFilter) {\n              this.listFilter.teardown();\n            }\n\n            array.each(utility.$(\"#\" + id + \"-pages-top, #\" + id + \"-pages-bottom\"), function (i) {\n              self.observer.unhook(i, \"click\");\n\n              if (destroy) {\n                element.destroy(i);\n              }\n            });\n\n            this.observer.unhook(el, \"click\");\n\n            if (destroy) {\n              element.destroy(el);\n            }\n\n            this.element = null;\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        update: {\n\n          /**\n           * Updates an item in the DataList\n           *\n           * @method update\n           * @memberOf keigai.DataList\n           * @param {Mixed}  key  Key or index\n           * @param {Object} data New property values\n           * @return {Object}     {@link keigai.DataList}\n           * @example\n           * list.update( \"key\", {name: \"Jim Smith\"} );\n           */\n          value: function update(key, data) {\n            var self = this;\n\n            this.store.update(key, data).then(null, function (e) {\n              utility.error(e);\n              self.dispatch(\"error\", e);\n            });\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        }\n      });\n\n      return DataList;\n    })(Base);\n\n    /**\n     * @namespace list\n     */\n    var list = {\n      /**\n       * Creates an instance of DataList\n       *\n       * @method factory\n       * @memberOf list\n       * @fires keigai.DataList#change Fires when the DOM changes\n       * @param  {Object} target   Element to receive the DataList\n       * @param  {Object} store    {@link keigai.DataStore}\n       * @param  {Mixed}  template Record field, template ( $.tpl ), or String, e.g. \"<p>this is a {{field}} sample.</p>\", fields are marked with {{ }}\n       * @param  {Object} options  Optional parameters to set on the DataList\n       * @return {Object} {@link keigai.DataList}\n       * @example\n       * let store = keigai.store( [...] ),\n       *     list  = keigai.list( document.querySelector(\"#list\"), store, \"{{name}}\", {order: \"name\"} );\n       */\n      factory: function (target, store, template, options) {\n        var ref = [store];\n        var obj = new DataList(element.create(\"ul\", { \"class\": \"list\", id: utility.genId(null, true) }, target), ref[0], template);\n\n        if (options instanceof Object) {\n          if (options.listFiltered && options.listFilter) {\n            obj.listFilter = filter.factory(element.create(\"input\", {\n              id: obj.element.id + \"-filter\",\n              \"class\": \"filter\",\n              placeholder: \"Filter\"\n            }, target, \"first\"), obj, options.listFilter, options.debounce || 250);\n            delete options.listFilter;\n            delete options.listFiltered;\n            delete options.debounce;\n          }\n\n          utility.merge(obj, options);\n        }\n\n        obj.store.lists.push(obj);\n\n        // Setting up a chain of Events\n        obj.on(\"beforeRefresh\", function (arg) {\n          element.dispatch(arg, \"beforeRefresh\");\n        }, \"bubble\");\n\n        obj.on(\"afterRefresh\", function (arg) {\n          element.dispatch(arg, \"afterRefresh\");\n        }, \"bubble\");\n\n        obj.on(\"change\", function (arg) {\n          element.dispatch(obj.element, \"change\", arg);\n        }, \"change\");\n\n        obj.on(\"click\", function (e) {\n          var target = utility.target(e);\n          var page = undefined;\n\n          utility.stop(e);\n\n          if (target.nodeName === \"A\") {\n            page = element.data(target, \"page\");\n\n            if (!isNaN(page)) {\n              obj.page(page);\n            }\n          }\n        }, \"pagination\");\n\n        if (typeof MutationObserver == \"function\") {\n          obj.mutation = new MutationObserver(function (arg) {\n            obj.dispatch(\"change\", arg);\n          });\n\n          obj.mutation.observe(obj.element, { childList: true, subtree: true });\n        }\n\n        // Rendering if not tied to an API or data is ready\n        if (obj.store.uri === null || obj.store.loaded) {\n          obj.refresh();\n        }\n\n        return obj;\n      },\n\n      /**\n       * Calculates the total pages\n       *\n       * @method pages\n       * @memberOf list\n       * @return {Number} Total pages\n       * @private\n       */\n      pages: function (obj) {\n        if (isNaN(obj.pageSize)) {\n          throw new Error(label.invalidArguments);\n        }\n\n        return Math.ceil((!obj.filter ? obj.total : obj.filtered.length) / obj.pageSize);\n      },\n\n      /**\n       * Calculates the page size as an Array of start & finish\n       *\n       * @method range\n       * @memberOf list\n       * @return {Array}  Array of start & end numbers\n       * @private\n       */\n      range: function (obj) {\n        var start = obj.pageIndex * obj.pageSize - obj.pageSize;\n        var end = obj.pageSize;\n\n        return [start, end];\n      }\n    };\n\n    var Deferred = (function () {\n      /**\n       * Creates a new Deferred\n       *\n       * @constructor\n       * @memberOf keigai\n       */\n      function Deferred() {\n        var self = this;\n\n        this.promise = promise.factory();\n        this.onDone = [];\n        this.onAlways = [];\n        this.onFail = [];\n\n        // Setting handlers to execute Arrays of Functions\n        this.promise.then(function (arg) {\n          array.each(self.onDone, function (i) {\n            i(arg);\n          });\n\n          array.each(self.onAlways, function (i) {\n            i(arg);\n          });\n\n          self.onAlways = [];\n          self.onDone = [];\n          self.onFail = [];\n        }, function (arg) {\n          array.each(self.onFail, function (i) {\n            i(arg);\n          });\n\n          array.each(self.onAlways, function (i) {\n            i(arg);\n          });\n\n          self.onAlways = [];\n          self.onDone = [];\n          self.onFail = [];\n        });\n      }\n\n      _prototypeProperties(Deferred, null, {\n        always: {\n\n          /**\n           * Registers a function to execute after Promise is reconciled\n           *\n           * @method always\n           * @memberOf keigai.Deferred\n           * @param  {Function} arg Function to execute\n           * @return {Object} {@link keigai.Deferred}\n           * @example\n           * let deferred = keigai.util.defer();\n           *\n           * deferred.always( function () {\n           *     ...\n           * } ).then( function () {\n           *     ...\n           * } );\n           *\n           * ...\n           *\n           * deferred.resolve( true );\n           */\n          value: function always(arg) {\n            this.onAlways.push(arg);\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        done: {\n\n          /**\n           * Registers a function to execute after Promise is resolved\n           *\n           * @method done\n           * @memberOf keigai.Deferred\n           * @param  {Function} arg Function to execute\n           * @return {Object} {@link keigai.Deferred}\n           * @example\n           * let deferred = keigai.util.defer();\n           *\n           * deferred.done( function ( ... ) {\n           *   ...\n           * } );\n           */\n          value: function done(arg) {\n            this.onDone.push(arg);\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        fail: {\n\n          /**\n           * Registers a function to execute after Promise is rejected\n           *\n           * @method fail\n           * @memberOf keigai.Deferred\n           * @param  {Function} arg Function to execute\n           * @return {Object} {@link keigai.Deferred}\n           * @example\n           * let deferred = keigai.util.defer();\n           *\n           * deferred.fail( function ( ... ) {\n           *   ...\n           * } );\n           */\n          value: function fail(arg) {\n            this.onFail.push(arg);\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        reject: {\n\n          /**\n           * Rejects the Promise\n           *\n           * @method reject\n           * @memberOf keigai.Deferred\n           * @param  {Mixed} arg Rejection outcome\n           * @return {Object} {@link keigai.Deferred}\n           * @example\n           * let deferred = keigai.util.defer();\n           *\n           * deferred.reject( new Error( \"Something went wrong\" ) );\n           */\n          value: function reject(arg) {\n            this.promise.reject.call(this.promise, arg);\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        resolve: {\n\n          /**\n           * Resolves the Promise\n           *\n           * @method resolve\n           * @memberOf keigai.Deferred\n           * @param  {Mixed} arg Resolution outcome\n           * @return {Object} {@link keigai.Deferred}\n           * @example\n           * let deferred = keigai.util.defer();\n           *\n           * deferred.resolve( true );\n           */\n          value: function resolve(arg) {\n            this.promise.resolve.call(this.promise, arg);\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        then: {\n\n          /**\n           * Registers handler(s) for the Promise\n           *\n           * @method then\n           * @memberOf keigai.Deferred\n           * @param  {Function} success Executed when/if promise is resolved\n           * @param  {Function} failure [Optional] Executed when/if promise is broken\n           * @return {Object} {@link Promise}\n           * @example\n           * let deferred = keigai.util.defer();\n           *\n           * deferred.then( function ( ... ) { ... }, function ( err ) { ... } )\n           *         .then( function ( ... ) { ... }, function ( err ) { ... } );\n           *\n           * ...\n           *\n           * deferred.resolve( true );\n           */\n          value: function then(success, failure) {\n            return this.promise.then(success, failure);\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        }\n      });\n\n      return Deferred;\n    })();\n\n    /**\n     * @namespace deferred\n     */\n    var deferred = {\n      /**\n       * Deferred factory\n       *\n       * @method factory\n       * @memberOf deferred\n       * @return {Object} {@link keigai.Deferred}\n       * @example\n       * let deferred = keigai.util.defer();\n       *\n       * deferred.then( function ( ... ) { ... }, function ( err ) { ... } )\n       * deferred.always( function ( ... ) { ... } );\n       *\n       * ...\n       *\n       * deferred.resolve( true );\n       */\n      factory: function () {\n        return new Deferred();\n      }\n    };\n\n    /**\n     * @namespace element\n     */\n    var element = {\n      /**\n       * Adds a CSS class to an Element\n       *\n       * @method addClass\n       * @memberOf element\n       * @param  {Object} obj Element\n       * @param  {String} arg CSS class\n       * @return {Object}     Element\n       * @example\n       * keigai.util.element.addClass( document.querySelector( \"#target\" ), \"newClass\" );\n       */\n      addClass: function (obj, arg) {\n        element.klass(obj, arg, true);\n      },\n\n      /**\n       * Appends an Element to an Element\n       *\n       * @method appendTo\n       * @memberOf element\n       * @param  {Object} obj   Element\n       * @param  {Object} child Child Element\n       * @return {Object}       Element\n       * @example\n       * keigai.util.element.appendTo( document.querySelector( \"#target\" ), document.querySelector( \"#something\" ) );\n       */\n      appendTo: function (obj, child) {\n        obj.appendChild(child);\n\n        return obj;\n      },\n\n      /**\n       * Gets or sets an Element attribute\n       *\n       * @method attr\n       * @memberOf element\n       * @param  {Object} obj   Element\n       * @param  {String} name  Attribute name\n       * @param  {Mixed}  value Attribute value\n       * @return {Object}       Element\n       * @example\n       * keigai.util.element.attr( document.querySelector( \"select\" ), \"selected\", \"option 1\" );\n       */\n      attr: function (obj, key, value) {\n        var target = undefined,\n            result = undefined;\n\n        if (regex.svg.test(obj.namespaceURI)) {\n          if (value === undefined) {\n            result = obj.getAttributeNS(obj.namespaceURI, key);\n\n            if (result === null || string.isEmpty(result)) {\n              result = undefined;\n            } else {\n              result = utility.coerce(result);\n            }\n          } else {\n            obj.setAttributeNS(obj.namespaceURI, key, value);\n          }\n        } else {\n          if (typeof value == \"string\") {\n            value = string.trim(value);\n          }\n\n          if (regex.checked_disabled.test(key) && value === undefined) {\n            return utility.coerce(obj[key]);\n          } else if (regex.checked_disabled.test(key) && value !== undefined) {\n            obj[key] = value;\n          } else if (obj.nodeName === \"SELECT\" && key === \"selected\" && value === undefined) {\n            return utility.dom(\"#\" + obj.id + \" option[selected=\\\"selected\\\"]\")[0] || utility.dom(\"#\" + obj.id + \" option\")[0];\n          } else if (obj.nodeName === \"SELECT\" && key === \"selected\" && value !== undefined) {\n            target = utility.dom(\"#\" + obj.id + \" option[selected=\\\"selected\\\"]\")[0];\n\n            if (target !== undefined) {\n              target.selected = false;\n              target.removeAttribute(\"selected\");\n            }\n\n            target = utility.dom(\"#\" + obj.id + \" option[value=\\\"\" + value + \"\\\"]\")[0];\n            target.selected = true;\n            target.setAttribute(\"selected\", \"selected\");\n          } else if (value === undefined) {\n            result = obj.getAttribute(key);\n\n            if (result === null || string.isEmpty(result)) {\n              result = undefined;\n            } else {\n              result = utility.coerce(result);\n            }\n\n            return result;\n          } else {\n            obj.setAttribute(key, value);\n          }\n        }\n\n        return obj;\n      },\n\n      /**\n       * Clears an object's innerHTML, or resets it's state\n       *\n       * @method clear\n       * @memberOf element\n       * @param  {Object} obj Element\n       * @return {Object}     Element\n       * @example\n       * keigai.util.element.clear( document.querySelector( \"#something\" ) );\n       */\n      clear: function (obj) {\n        if (typeof obj.reset == \"function\") {\n          obj.reset();\n        } else if (obj.value !== undefined) {\n          element.update(obj, { innerHTML: \"\", value: \"\" });\n        } else {\n          element.update(obj, { innerHTML: \"\" });\n        }\n\n        return obj;\n      },\n\n      /**\n       * Creates an Element in document.body or a target Element.\n       * An id is generated if not specified with args.\n       *\n       * @method create\n       * @memberOf element\n       * @param  {String} type Type of Element to create, or HTML String\n       * @param  {Object} args [Optional] Properties to set\n       * @param  {Object} obj  [Optional] Target Element\n       * @param  {Mixed}  pos  [Optional] \"first\", \"last\" or Object describing how to add the new Element, e.g. {before: referenceElement}, default is \"last\"\n       * @return {Mixed}       Element that was created, or an Array if `type` is a String of multiple Elements (frag)\n       * @example\n       * keigai.util.element.create( \"div\", {innerHTML: \"Hello World!\"}, document.querySelector( \"#something\" ) );\n       * keigai.util.element.create( \"&lt;div&gt;Hello World!&lt;/div&gt;\" );\n       */\n      create: function (type, args, obj, pos) {\n        var svg = false;\n        var frag = false;\n        var fragment = undefined,\n            result = undefined;\n\n        // Removing potential HTML template formatting\n        type = type.replace(/\\t|\\n|\\r/g, \"\");\n\n        if (obj) {\n          svg = obj.namespaceURI && regex.svg.test(obj.namespaceURI);\n        } else {\n          obj = document.body;\n        }\n\n        // String injection, create a frag and apply it\n        if (regex.html.test(type)) {\n          frag = true;\n          fragment = element.frag(type);\n          result = fragment.childNodes.length === 1 ? fragment.childNodes[0] : array.cast(fragment.childNodes);\n        }\n        // Original syntax\n        else {\n          if (!svg && !regex.svg.test(type)) {\n            fragment = document.createElement(type);\n          } else {\n            fragment = document.createElementNS(\"http://www.w3.org/2000/svg\", type);\n          }\n\n          if (args instanceof Object) {\n            element.update(fragment, args);\n          }\n        }\n\n        if (!pos || pos === \"last\") {\n          obj.appendChild(fragment);\n        } else if (pos === \"first\") {\n          element.prependChild(obj, fragment);\n        } else if (pos === \"after\") {\n          pos = { after: obj };\n          obj = obj.parentNode;\n          obj.insertBefore(fragment, pos.after.nextSibling);\n        } else if (pos.after) {\n          obj.insertBefore(fragment, pos.after.nextSibling);\n        } else if (pos === \"before\") {\n          pos = { before: obj };\n          obj = obj.parentNode;\n          obj.insertBefore(fragment, pos.before);\n        } else if (pos.before) {\n          obj.insertBefore(fragment, pos.before);\n        } else {\n          obj.appendChild(fragment);\n        }\n\n        return !frag ? fragment : result;\n      },\n\n      /**\n       * Gets or sets a CSS style attribute on an Element\n       *\n       * @method css\n       * @memberOf element\n       * @param  {Object} obj   Element\n       * @param  {String} key   CSS to put in a style tag\n       * @param  {String} value [Optional] Value to set\n       * @return {Object}       Element\n       * @example\n       * keigai.util.element.css( document.querySelector( \"#something\" ), \"font-weight\", \"bold\" );\n       * keigai.util.element.css( document.querySelector( \"#something\" ), \"font-weight\" ); // \"bold\"\n       */\n      css: function (obj, key, value) {\n        if (!regex.caps.test(key)) {\n          key = string.toCamelCase(key);\n        }\n\n        if (value !== undefined) {\n          obj.style[key] = value;\n          return obj;\n        } else {\n          return obj.style[key];\n        }\n      },\n\n      /**\n       * Data attribute facade acting as a getter (with coercion) & setter\n       *\n       * @method data\n       * @memberOf element\n       * @param  {Object} obj   Element\n       * @param  {String} key   Data key\n       * @param  {Mixed}  value Boolean, Number or String to set\n       * @return {Mixed}        undefined, Element or value\n       * @example\n       * // Setting\n       * keigai.util.element.data( document.querySelector( \"#something\" ), \"id\", \"abc-1234\" );\n       *\n       * // Getting\n       * keigai.util.element.data( document.querySelector( \"#something\" ), \"id\" ); // \"abc-1234\"\n       *\n       * // Unsetting\n       * keigai.util.element.data( document.querySelector( \"#something\" ), \"id\", null );\n       *\n       * // Setting a `null` value can be done by using a String\n       * keigai.util.element.data( document.querySelector( \"#something\" ), \"id\", \"null\" );\n       */\n      data: function (obj, key, value) {\n        if (value !== undefined) {\n          obj.setAttribute(\"data-\" + key, regex.json_wrap.test(value) ? json.encode(value) : value);\n\n          return obj;\n        } else {\n          return utility.coerce(obj.getAttribute(\"data-\" + key));\n        }\n      },\n\n      /**\n       * Destroys an Element\n       *\n       * @method destroy\n       * @memberOf element\n       * @param  {Object} obj Element\n       * @return {Undefined} undefined\n       * @example\n       * keigai.util.element.destroy( document.querySelector( \"#something\" ) );\n       */\n      destroy: function (obj) {\n        if (obj.parentNode !== null) {\n          obj.parentNode.removeChild(obj);\n        }\n\n        return undefined;\n      },\n\n      /**\n       * Disables an Element\n       *\n       * @method disable\n       * @memberOf element\n       * @param  {Object} obj Element\n       * @return {Object}     Element\n       * @example\n       * keigai.util.element.disable( document.querySelector( \"#something\" ) );\n       */\n      disable: function (obj) {\n        if (typeof obj.disabled == \"boolean\" && !obj.disabled) {\n          obj.disabled = true;\n        }\n\n        return obj;\n      },\n\n      /**\n       * Dispatches a DOM Event from an Element\n       *\n       * `data` will appear as `Event.detail`\n       *\n       * @method dispatch\n       * @memberOf element\n       * @param  {Object}  obj        Element which dispatches the Event\n       * @param  {String}  type       Type of Event to dispatch\n       * @param  {Object}  data       [Optional] Data to include with the Event\n       * @param  {Boolean} bubbles    [Optional] Determines if the Event bubbles, defaults to `true`\n       * @param  {Boolean} cancelable [Optional] Determines if the Event can be canceled, defaults to `true`\n       * @return {Object}             Element which dispatches the Event\n       * @example\n       * keigai.util.element.dispatch( document.querySelector( \"#something\" ), \"click\" );\n       */\n      dispatch: function (obj, type, data, bubbles, cancelable) {\n        var ev = undefined;\n\n        if (!obj) {\n          return;\n        }\n\n        try {\n          ev = new CustomEvent(type);\n        } catch (e) {\n          ev = document.createEvent(\"CustomEvent\");\n        }\n\n        bubbles = bubbles !== false;\n        cancelable = cancelable !== false;\n\n        ev.initCustomEvent(type, bubbles, cancelable, data || {});\n        obj.dispatchEvent(ev);\n\n        return obj;\n      },\n\n      /**\n       * Enables an Element\n       *\n       * @method enable\n       * @memberOf element\n       * @param  {Object} obj Element\n       * @return {Object}     Element\n       * @example\n       * keigai.util.element.enable( document.querySelector( \"#something\" ) );\n       */\n      enable: function (obj) {\n        if (typeof obj.disabled == \"boolean\" && obj.disabled) {\n          obj.disabled = false;\n        }\n\n        return obj;\n      },\n\n      /**\n       * Finds descendant childNodes of Element matched by arg\n       *\n       * @method find\n       * @memberOf element\n       * @param  {Object} obj Element to search\n       * @param  {String} arg Comma delimited string of descendant selectors\n       * @return {Mixed}      Array of Elements or undefined\n       * @example\n       * keigai.util.element.find( document.querySelector( \"#something\" ), \"p\" );\n       */\n      find: function (obj, arg) {\n        var result = [];\n\n        array.each(string.explode(arg), function (i) {\n          result = result.concat(array.cast(obj.querySelectorAll(i)));\n        });\n\n        return result;\n      },\n\n      /**\n       * Creates a document fragment\n       *\n       * @method frag\n       * @memberOf element\n       * @param  {String} arg [Optional] innerHTML\n       * @return {Object}     Document fragment\n       * @example\n       * let frag = keigai.util.element.frag( \"Hello World!\" );\n       */\n      frag: function (arg) {\n        var obj = document.createDocumentFragment();\n\n        if (arg) {\n          array.each(array.cast(element.create(\"div\", { innerHTML: arg }, obj).childNodes), function (i) {\n            obj.appendChild(i);\n          });\n\n          obj.removeChild(obj.childNodes[0]);\n        }\n\n        return obj;\n      },\n\n      /**\n       * Determines if Element has descendants matching arg\n       *\n       * @method has\n       * @memberOf element\n       * @param  {Object} obj Element\n       * @param  {String} arg Type of Element to find\n       * @return {Boolean}    `true` if 1 or more Elements are found\n       * @example\n       * if ( keigai.util.element.has( document.querySelector( \"#something\" ), \"p\" ) ) {\n       *   ...\n       * }\n       */\n      has: function (obj, arg) {\n        var result = element.find(obj, arg);\n\n        return !isNaN(result.length) && result.length > 0;\n      },\n\n      /**\n       * Determines if obj has a specific CSS class\n       *\n       * @method hasClass\n       * @memberOf element\n       * @param  {Object} obj Element\n       * @param  {String} arg CSS class to test for\n       * @return {Boolean}    `true` if Element has `arg`\n       * @example\n       * if ( keigai.util.element.hasClass( document.querySelector( \"#something\" ), \"someClass\" ) ) {\n       *   ...\n       * }\n       */\n      hasClass: function (obj, arg) {\n        return obj.classList.contains(arg);\n      },\n\n      /**\n       * Returns a Boolean indidcating if the Object is hidden\n       *\n       * @method hidden\n       * @memberOf element\n       * @param  {Object} obj Element\n       * @return {Boolean}   `true` if hidden\n       * @example\n       * if ( keigai.util.element.hidden( document.querySelector( \"#something\" ) ) ) {\n       *   ...\n       * }\n       */\n      hidden: function (obj) {\n        return obj.style.display === \"none\" || obj.hidden === true;\n      },\n\n      /**\n       * Gets or sets an Elements innerHTML\n       *\n       * @method html\n       * @memberOf element\n       * @param  {Object} obj Element\n       * @param  {String} arg [Optional] innerHTML value\n       * @return {Object}     Element\n       * @example\n       * keigai.util.element.html( document.querySelector( \"#something\" ), \"Hello World!\" );\n       * keigai.util.element.html( document.querySelector( \"#something\" ) ); // \"Hello World!\"\n       */\n      html: function (obj, arg) {\n        if (arg === undefined) {\n          return obj.innerHTML;\n        } else {\n          obj.innerHTML = arg;\n          return obj;\n        }\n      },\n\n      /**\n       * Determines if Element is equal to `arg`, supports nodeNames & CSS2+ selectors\n       *\n       * @method is\n       * @memberOf element\n       * @param  {Object} obj Element\n       * @param  {String} arg Property to query\n       * @return {Boolean}    `true` if a match\n       * @example\n       * if ( keigai.util.element.is( document.querySelector( \"#something\" ), \"div\" ) ) {\n       *   ...\n       * }\n       *\n       * if ( keigai.util.element.is( document.querySelector( \"#something\" ), \":first-child\" ) ) {\n       *   ...\n       * }\n       */\n      is: function (obj, arg) {\n        if (regex.selector_is.test(arg)) {\n          return element.find(obj.parentNode, obj.nodeName.toLowerCase() + arg).filter(function (i) {\n            return i.id === obj.id;\n          }).length === 1;\n        } else {\n          return new RegExp(arg, \"i\").test(obj.nodeName);\n        }\n      },\n\n      /**\n       * Adds or removes a CSS class\n       *\n       * @method klass\n       * @memberOf element\n       * @param  {Object}  obj Element\n       * @param  {String}  arg Class to add or remove ( can be a wildcard )\n       * @param  {Boolean} add Boolean to add or remove, defaults to true\n       * @return {Object}      Element\n       * @example\n       * // Adding a class\n       * keigai.util.element.klass( document.querySelector( \"#something\" ), \"newClass\" );\n       *\n       * // Removing a class\n       * keigai.util.element.klass( document.querySelector( \"#something\" ), \"newClass\", false );\n       */\n      klass: function (obj, arg) {\n        var add = arguments[2] === undefined ? true : arguments[2];\n        arg = string.explode(arg, \" \");\n\n        if (add) {\n          array.each(arg, function (i) {\n            obj.classList.add(i);\n          });\n        } else {\n          array.each(arg, function (i) {\n            if (i !== \"*\") {\n              obj.classList.remove(i);\n            } else {\n              array.each(obj.classList, function (x) {\n                obj.classList.remove(x);\n              });\n\n              return false;\n            }\n          });\n        }\n\n        return obj;\n      },\n\n      /**\n       * Finds the position of an Element\n       *\n       * @method position\n       * @memberOf element\n       * @param  {Object} obj Element\n       * @return {Array}      Coordinates [left, top, right, bottom]\n       * @example\n       * let pos = keigai.util.element.position( document.querySelector( \"#something\" ) );\n       */\n      position: function (obj) {\n        obj = obj || document.body;\n        var left = undefined,\n            top = undefined,\n            right = undefined,\n            bottom = undefined,\n            height = undefined,\n            width = undefined;\n\n        left = top = 0;\n        width = obj.offsetWidth;\n        height = obj.offsetHeight;\n\n        if (obj.offsetParent) {\n          top = obj.offsetTop;\n          left = obj.offsetLeft;\n\n          while (obj = obj.offsetParent) {\n            left += obj.offsetLeft;\n            top += obj.offsetTop;\n          }\n\n          right = document.body.offsetWidth - (left + width);\n          bottom = document.body.offsetHeight - (top + height);\n        } else {\n          right = width;\n          bottom = height;\n        }\n\n        return [left, top, right, bottom];\n      },\n\n      /**\n       * Prepends an Element to an Element\n       *\n       * @method prependChild\n       * @memberOf element\n       * @param  {Object} obj   Element\n       * @param  {Object} child Child Element\n       * @return {Object}       Element\n       * @example\n       * keigai.util.element.prependChild( document.querySelector( \"#target\" ), document.querySelector( \"#something\" ) );\n       */\n      prependChild: function (obj, child) {\n        return obj.childNodes.length === 0 ? obj.appendChild(child) : obj.insertBefore(child, obj.childNodes[0]);\n      },\n\n      /**\n       * Removes an Element attribute\n       *\n       * @method removeAttr\n       * @memberOf element\n       * @param  {Object} obj Element\n       * @param  {String} key Attribute name\n       * @return {Object}     Element\n       * @example\n       * keigai.util.element.removeAttr( document.querySelector( \"a\" ), \"href\" );\n       */\n      removeAttr: function (obj, key) {\n        if (regex.svg.test(obj.namespaceURI)) {\n          obj.removeAttributeNS(obj.namespaceURI, key);\n        } else {\n          if (obj.nodeName === \"SELECT\" && key === \"selected\") {\n            array.each(element.find(obj, \"option\"), function (i) {\n              if (i.selected === true) {\n                i.selected = false;\n                i.removeAttribute(\"selected\");\n                return false;\n              }\n            });\n          } else {\n            obj.removeAttribute(key);\n          }\n        }\n\n        return obj;\n      },\n\n      /**\n       * Removes a CSS class from Element\n       *\n       * @method removeClass\n       * @memberOf element\n       * @param  {Object} obj Element\n       * @param  {String} arg CSS class\n       * @return {Object}     Element\n       * @example\n       * keigai.util.element.removeClass( document.querySelector( \"#target\" ), \"existingClass\" );\n       */\n      removeClass: function (obj, arg) {\n        element.klass(obj, arg, false);\n      },\n\n      /**\n       * Scrolls to the position of an Element\n       *\n       * @method scrollTo\n       * @memberOf element\n       * @param  {Object} obj        Element to scroll to\n       * @param  {Number} ms         [Optional] Milliseconds to scroll, default is 250, min is 100\n       * @param  {Number} offsetTop  [Optional] Offset from top of Element\n       * @param  {Number} offsetLeft [Optional] Offset from left of Element\n       * @return {Object} {@link Deferred}\n       * @example\n       * keigai.util.element.scrollTo( document.querySelector( \"#something\" ) ).then( () => {\n       *   ...\n       * } );\n       */\n      scrollTo: function (obj, ms, offsetTop, offsetLeft) {\n        var pos = array.remove(element.position(obj), 2, 3);\n\n        if (!isNaN(offsetTop)) {\n          pos[0] += offsetTop;\n        }\n\n        if (!isNaN(offsetLeft)) {\n          pos[1] += offsetLeft;\n        }\n\n        return client.scroll(pos, ms);\n      },\n\n      /**\n       * Serializes the elements of an Element\n       *\n       * @method serialize\n       * @memberOf element\n       * @param  {Object}  obj    Element\n       * @param  {Boolean} string [Optional] true if you want a query string, default is false ( JSON )\n       * @param  {Boolean} encode [Optional] true if you want to URI encode the value, default is true\n       * @return {Mixed}          String or Object\n       * @example\n       * let userInput = keigai.util.element.serialize( document.querySelector( \"form\" ) );\n       */\n      serialize: function (obj) {\n        var string = arguments[1] === undefined ? true : arguments[1];\n        var encode = arguments[2] === undefined ? true : arguments[2];\n        var registry = {};\n        var children = undefined,\n            result = undefined;\n\n        children = obj.nodeName === \"FORM\" ? obj.elements ? array.cast(obj.elements) : obj.find(\"button, input, select, textarea\") : [obj];\n\n        array.each(children, function (i) {\n          var id = i.id || i.name || i.type;\n\n          if (i.nodeName === \"FORM\") {\n            utility.merge(registry, json.decode(element.serialize(i)));\n          } else if (!registry[id]) {\n            registry[id] = element.val(i);\n          }\n        });\n\n        if (!string) {\n          result = registry;\n        } else {\n          result = \"\";\n\n          utility.iterate(registry, function (v, k) {\n            encode ? result += \"&\" + encodeURIComponent(k) + \"=\" + encodeURIComponent(v) : result += \"&\" + k + \"=\" + v;\n          });\n\n          result = result.replace(regex.and, \"?\");\n        }\n\n        return result;\n      },\n\n      /**\n       * Returns the size of the Element\n       *\n       * @method size\n       * @memberOf element\n       * @param  {Object} obj Element\n       * @return {Array}      [width, height]\n       * @example\n       * let size = keigai.util.element.size( document.querySelector( \"#something\" ) );\n       */\n      size: function (obj) {\n        return [obj.offsetWidth + number.parse(obj.style.paddingLeft || 0) + number.parse(obj.style.paddingRight || 0) + number.parse(obj.style.borderLeft || 0) + number.parse(obj.style.borderRight || 0), obj.offsetHeight + number.parse(obj.style.paddingTop || 0) + number.parse(obj.style.paddingBottom || 0) + number.parse(obj.style.borderTop || 0) + number.parse(obj.style.borderBottom || 0)];\n      },\n\n      /**\n       * Getter / setter for an Element's text\n       *\n       * @method text\n       * @memberOf element\n       * @param  {Object} obj Element\n       * @param  {String} arg [Optional] Value to set\n       * @return {Object}     Element\n       * @example\n       * let obj  = document.querySelector( \"#something\" ),\n       *     text = keigai.util.element.text( obj );\n       *\n       * keigai.util.element.text( obj, text + \", and some more text\" );\n       */\n      text: function (obj, arg) {\n        var key = obj.textContent ? \"textContent\" : \"innerText\";\n        var payload = {};\n        var set = false;\n\n        if (typeof arg != \"undefined\") {\n          set = true;\n          payload[key] = arg;\n        }\n\n        return set ? element.update(obj, payload) : obj[key];\n      },\n\n      /**\n       * Toggles a CSS class\n       *\n       * @method toggleClass\n       * @memberOf element\n       * @param  {Object} obj Element\n       * @param  {String} arg CSS class to toggle\n       * @return {Object}     Element\n       * @example\n       * let obj = document.querySelector( \"#something\" );\n       *\n       * obj.addEventListener( \"click\", ( ev ) => {\n       *   keigai.util.element.toggleClass( obj, \"active\" );\n       * }, false );\n       */\n      toggleClass: function (obj, arg) {\n        obj.classList.toggle(arg);\n\n        return obj;\n      },\n\n      /**\n       * Updates an Element\n       *\n       * @method update\n       * @memberOf element\n       * @param  {Object}  obj  Element\n       * @param  {Object} args Properties to set\n       * @return {Object}      Element\n       * @example\n       * keigai.util.element.update( document.querySelector( \"#something\" ), {innerHTML: \"Hello World!\", \"class\": \"new\"} );\n       */\n      update: function (obj, args) {\n        utility.iterate(args, function (v, k) {\n          if (regex.element_update.test(k)) {\n            obj[k] = v;\n          } else if (k === \"class\") {\n            !string.isEmpty(v) ? element.addClass(obj, v) : element.removeClass(obj, \"*\");\n          } else if (k.indexOf(\"data-\") === 0) {\n            element.data(obj, k.replace(\"data-\", \"\"), v);\n          } else {\n            element.attr(obj, k, v);\n          }\n        });\n\n        return obj;\n      },\n\n      /**\n       * Gets or sets the value of Element\n       *\n       * @method val\n       * @memberOf element\n       * @param  {Object} obj   Element\n       * @param  {Mixed}  value [Optional] Value to set\n       * @return {Object}       Element\n       * @example\n       * keigai.util.element.val( document.querySelector( \"input[type='text']\" ), \"new value\" );\n       */\n      val: function (obj, value) {\n        var ev = \"input\";\n        var output = undefined;\n\n        if (value === undefined) {\n          if (regex.radio_checkbox.test(obj.type)) {\n            if (string.isEmpty(obj.name)) {\n              throw new Error(label.expectedProperty);\n            }\n\n            array.each(utility.dom(\"input[name='\" + obj.name + \"']\"), function (i) {\n              if (i.checked) {\n                output = i.value;\n                return false;\n              }\n            });\n          } else if (regex.select.test(obj.type)) {\n            output = null;\n            array.each(element.find(obj, \"option\"), function (i) {\n              if (i.selected === true) {\n                output = i.value;\n                return false;\n              }\n            });\n          } else if (obj.value) {\n            output = obj.value;\n          } else {\n            output = element.text(obj);\n          }\n\n          if (output !== undefined) {\n            output = utility.coerce(output);\n\n            if (typeof output == \"string\") {\n              output = string.trim(output);\n            }\n          } else {\n            output = \"\";\n          }\n        } else {\n          value = value.toString();\n\n          if (regex.radio_checkbox.test(obj.type)) {\n            ev = \"click\";\n\n            array.each(utility.dom(\"input[name='\" + obj.name + \"']\"), function (i) {\n              if (i.value === value) {\n                i.checked = true;\n                output = i;\n                return false;\n              }\n            });\n          } else if (regex.select.test(obj.type)) {\n            ev = \"change\";\n\n            array.each(element.find(obj, \" option\"), function (i) {\n              if (i.value === value) {\n                i.selected = true;\n                output = i;\n                return false;\n              }\n            });\n          } else {\n            obj.value !== undefined ? obj.value = value : element.text(obj, value);\n          }\n\n          element.dispatch(obj, ev);\n\n          output = obj;\n        }\n\n        return output;\n      }\n    };\n\n    /**\n     * @namespace json\n     */\n    var json = {\n      /**\n       * Decodes the argument\n       *\n       * @method decode\n       * @memberOf json\n       * @param  {String}  arg    String to parse\n       * @param  {Boolean} silent [Optional] Silently fail\n       * @return {Mixed}          Entity resulting from parsing JSON, or undefined\n       * @example\n       * let x = keigai.util.json.decode( ..., true );\n       *\n       * if ( x ) {\n       *   ...\n       * } else {\n       *   ... // invalid JSON, with `Error` suppressed by `silent`\n       * }\n       */\n      decode: function (arg, silent) {\n        try {\n          return JSON.parse(arg);\n        } catch (e) {\n          if (silent !== true) {\n            utility.error(e, [arg, silent], _this);\n          }\n\n          return undefined;\n        }\n      },\n\n      /**\n       * Encodes `arg` as JSON\n       *\n       * @method encode\n       * @memberOf json\n       * @param  {Mixed}   arg    Primative\n       * @param  {Boolean} silent [Optional] Silently fail\n       * @return {String}         JSON, or undefined\n       * @example\n       * let x = keigai.util.json.encode( ..., true );\n       *\n       * if ( x ) {\n       *   ...\n       * } else {\n       *   ... // invalid JSON, with `Error` suppressed by `silent`\n       * }\n       */\n      encode: function (arg, silent) {\n        try {\n          return JSON.stringify(arg);\n        } catch (e) {\n          if (silent !== true) {\n            utility.error(e, [arg, silent], _this);\n          }\n\n          return undefined;\n        }\n      }\n    };\n\n    /**\n     * @namespace label\n     * @private\n     */\n    var label = {\n      /**\n       * Expected a Number\n       *\n       * @type {String}\n       * @memberOf label\n       */\n      expectedNumber: \"Expected a Number\",\n\n      /**\n       * Expected a property, and it was not set\n       *\n       * @type {String}\n       * @memberOf label\n       */\n      expectedProperty: \"Expected a property, and it was not set\",\n\n      /**\n       * Expected an Object\n       *\n       * @type {String}\n       * @memberOf label\n       */\n      expectedObject: \"Expected an Object\",\n\n      /**\n       * One or more arguments is invalid\n       *\n       * @type {String}\n       * @memberOf label\n       */\n      invalidArguments: \"One or more arguments is invalid\",\n\n      /**\n       * INVALID_STATE_ERR: Headers have not been received\n       *\n       * @type {String}\n       * @memberOf label\n       */\n      invalidStateNoHeaders: \"INVALID_STATE_ERR: Headers have not been received\",\n\n      /**\n       * Synchronous XMLHttpRequest requests are not supported\n       *\n       * @type {String}\n       * @memberOf label\n       */\n      invalidStateNoSync: \"Synchronous XMLHttpRequest requests are not supported\",\n\n      /**\n       * INVALID_STATE_ERR: Object is not open\n       *\n       * @type {String}\n       * @memberOf label\n       */\n      invalidStateNotOpen: \"INVALID_STATE_ERR: Object is not open\",\n\n      /**\n       * INVALID_STATE_ERR: Object is sending\n       *\n       * @type {String}\n       * @memberOf label\n       */\n      invalidStateNotSending: \"INVALID_STATE_ERR: Object is sending\",\n\n      /**\n       * INVALID_STATE_ERR: Object is not usable\n       *\n       * @type {String}\n       * @memberOf label\n       */\n      invalidStateNotUsable: \"INVALID_STATE_ERR: Object is not usable\",\n\n      /**\n       * Error when deferred is rejected for invalid request\n       *\n       * @type {String}\n       * @memberOf label\n       */\n      methodNotAllowed: \"Method not allowed\",\n\n      /**\n       * Default `emptyMsg` of DataLists\n       *\n       * @type {String}\n       * @memberOf label\n       */\n      noData: \"Nothing to display\",\n\n      /**\n       * Requested method is not available\n       *\n       * @type {String}\n       * @memberOf label\n       */\n      notAvailable: \"Requested method is not available\",\n\n      /**\n       * No previous version of a record\n       *\n       * @type {String}\n       * @memberOf label\n       */\n      datastoreNoPrevVersion: \"No previous version found\",\n\n      /**\n       * HTTP request timed out\n       *\n       * @type {String}\n       * @memberOf label\n       */\n      requestTimeout: \"Request timed out\",\n\n      /**\n       * Server error has occurred\n       *\n       * @type {String}\n       * @memberOf label\n       */\n      serverError: \"Server error has occurred\",\n\n      /**\n       * Forbidden to access URI\n       *\n       * @type {String}\n       * @memberOf label\n       */\n      serverForbidden: \"Forbidden to access URI\",\n\n      /**\n       * Method not allowed\n       *\n       * @type {String}\n       * @memberOf label\n       */\n      serverInvalidMethod: \"Method not allowed\",\n\n      /**\n       * Authorization required to access URI\n       *\n       * @type {String}\n       * @memberOf label\n       */\n      serverUnauthorized: \"Authorization required to access URI\",\n\n      /**\n       * Your browser is too old to use keigai, please upgrade\n       *\n       * @type {String}\n       * @memberOf label\n       */\n      upgrade: \"Your browser is too old to use keigai, please upgrade\"\n    };\n\n    /**\n     * @namespace math\n     */\n    var math = {\n      /**\n       * Generates bezier curve coordinates for up to 4 points, last parameter is `t`\n       *\n       * Two point example: (0, 10, 0, 0, 1) means move straight up\n       *\n       * @method bezier\n       * @memberOf math\n       * @return {Array} Coordinates\n       * @example\n       * // Moving straight down\n       * let p1 = keigai.util.math.bezier( 0, 10, 2000, 10, 0 ),\n       *     p2 = keigai.util.math.bezier( 0, 10, 2000, 10, 0.5 ),\n       *     p3 = keigai.util.math.bezier( 0, 10, 2000, 10, 0.75 ),\n       *     p4 = keigai.util.math.bezier( 0, 10, 2000, 10, 0.9 ),\n       *     p5 = keigai.util.math.bezier( 0, 10, 2000, 10, 1 );\n       */\n      bezier: function () {\n        for (var _len11 = arguments.length, args = Array(_len11), _key11 = 0; _key11 < _len11; _key11++) {\n          args[_key11] = arguments[_key11];\n        }\n\n        var a = array.cast(args);\n        var t = a.pop();\n        var P = array.chunk(a, 2);\n        var n = P.length;\n        var c = undefined,\n            S0 = undefined,\n            Q0 = undefined,\n            Q1 = undefined,\n            Q2 = undefined,\n            C0 = undefined,\n            C1 = undefined,\n            C2 = undefined,\n            C3 = undefined;\n\n        if (n < 2 || n > 4) {\n          throw new Error(label.invalidArguments);\n        }\n\n        // Setting variables\n        c = [];\n        S0 = 1 - t;\n        Q0 = math.sqr(S0);\n        Q1 = 2 * S0 * t;\n        Q2 = math.sqr(t);\n        C0 = Math.pow(S0, 3);\n        C1 = 3 * Q0 * t;\n        C2 = 3 * S0 * Q2;\n        C3 = Math.pow(t, 3);\n\n        // Straight\n        if (n === 2) {\n          c.push(S0 * P[0][0] + t * P[1][0]);\n          c.push(S0 * P[0][1] + t * P[1][1]);\n        }\n        // Quadratic\n        else if (n === 3) {\n          c.push(Q0 * P[0][0] + Q1 * P[1][0] + (Q2 + P[2][0]));\n          c.push(Q0 * P[0][1] + Q1 * P[1][1] + (Q2 + P[2][1]));\n        }\n        // Cubic\n        else if (n === 4) {\n          c.push(C0 * P[0][0] + C1 * P[1][0] + C2 * P[2][0] + C3 * P[3][0]);\n          c.push(C0 * P[0][1] + C1 * P[1][1] + C2 * P[2][1] + C3 * P[3][1]);\n        }\n\n        return c;\n      },\n\n      /**\n       * Finds the distance between 2 Arrays of coordinates\n       *\n       * @method dist\n       * @memberOf math\n       * @param  {Array} a Coordinates [x, y]\n       * @param  {Array} b Coordinates [x, y]\n       * @return {Number}  Distance between `a` & `b`\n       * @example\n       * let dist = keigai.util.math.dist( [4, 40], [-10, 12] );\n       */\n      dist: function (a, b) {\n        return Math.sqrt(math.sqr(b[0] - a[0]) + math.sqr(b[1] - a[1]));\n      },\n\n      /**\n       * Squares a Number\n       *\n       * @method sqr\n       * @memberOf math\n       * @param  {Number} n Number to square\n       * @return {Number}   Squared value\n       * @example\n       * let sqr = keigai.util.math.sqr( 23 );\n       */\n      sqr: function (n) {\n        return n * n;\n      }\n    };\n\n    /**\n     * @namespace number\n     */\n    var number = {\n      /**\n       * Returns the difference of arg\n       *\n       * @method diff\n       * @memberOf number\n       * @param {Number} arg Number to compare\n       * @return {Number}    The absolute difference\n       * @example\n       * keigai.util.number.diff( -3, 8 ); // 11\n       */\n      diff: function (num1, num2) {\n        return Math.abs(num1 - num2);\n      },\n\n      /**\n       * Tests if an number is even\n       *\n       * @method even\n       * @memberOf number\n       * @param {Number} arg Number to test\n       * @return {Boolean}   True if even, or undefined\n       * @example\n       * let n = keigai.util.number.random( 10 );\n       *\n       * if ( keigai.util.number.even( n ) ) {\n       *   ...\n       * }\n       */\n      even: function (arg) {\n        return arg % 2 === 0;\n      },\n\n      /**\n       * Formats a Number to a delimited String\n       *\n       * @method format\n       * @memberOf number\n       * @param  {Number} arg       Number to format\n       * @param  {String} delimiter [Optional] String to delimit the Number with\n       * @param  {String} every     [Optional] Position to insert the delimiter, default is 3\n       * @return {String}           Number represented as a comma delimited String\n       * @example\n       * keigai.util.number.format( 1000 ); // \"1,000\"\n       */\n      format: function (arg) {\n        var delimiter = arguments[1] === undefined ? \",\" : arguments[1];\n        var every = arguments[2] === undefined ? 3 : arguments[2];\n        arg = arg.toString();\n\n        var d = arg.indexOf(\".\") > -1 ? \".\" + arg.replace(regex.number_format_1, \"\") : \"\";\n        var a = arg.replace(regex.number_format_2, \"\").split(\"\").reverse();\n        var p = Math.floor(a.length / every);\n        var i = 1;\n        var n = undefined,\n            b = undefined;\n\n        for (b = 0; b < p; b++) {\n          n = i === 1 ? every : every * i + (i === 2 ? 1 : i - 1);\n          a.splice(n, 0, delimiter);\n          i++;\n        }\n\n        a = a.reverse().join(\"\");\n\n        if (a.charAt(0) === delimiter) {\n          a = a.substring(1);\n        }\n\n        return a + d;\n      },\n\n      /**\n       * Returns half of a, or true if a is half of b\n       *\n       * @method half\n       * @memberOf number\n       * @param  {Number} a Number to divide\n       * @param  {Number} b [Optional] Number to test a against\n       * @return {Mixed}    Boolean if b is passed, Number if b is undefined\n       * @example\n       * if ( keigai.util.number.half( 2, 4 ) ) {\n       *   ...\n       * } );\n       */\n      half: function (a, b) {\n        return b ? a / b === 0.5 : a / 2;\n      },\n\n      /**\n       * Tests if a number is odd\n       *\n       * @method odd\n       * @memberOf number\n       * @param  {Number} arg Number to test\n       * @return {Boolean}    True if odd, or undefined\n       * @example\n       * let n = keigai.util.number.random( 10 );\n       *\n       * if ( keigai.util.number.odd( n ) ) {\n       *   ...\n       * }\n       */\n      odd: function (arg) {\n        return !number.even(arg);\n      },\n\n      /**\n       * Parses the number\n       *\n       * @method parse\n       * @memberOf number\n       * @param  {Mixed}  arg  Number to parse\n       * @param  {Number} base Integer representing the base or radix\n       * @return {Number}      Integer or float\n       * @example\n       * // Unsure if `n` is an int or a float\n       * keigai.util.number.parse( n );\n       */\n      parse: function (arg, base) {\n        return base === undefined ? parseFloat(arg) : parseInt(arg, base);\n      },\n\n      /**\n       * Generates a random number between 0 and `arg`\n       *\n       * @method random\n       * @memberOf number\n       * @param  {Number} arg Ceiling for random number, default is 100\n       * @return {Number}     Random number\n       * @example\n       * let n = keigai.util.math.random( 10 );\n       */\n      random: function () {\n        var arg = arguments[0] === undefined ? 100 : arguments[0];\n        return Math.floor(Math.random() * (arg + 1));\n      },\n\n      /**\n       * Rounds a number up or down\n       *\n       * @method round\n       * @memberOf number\n       * @param  {Number} arg       Number to round\n       * @param  {String} direction [Optional] \"up\" or \"down\"\n       * @return {Number}           Rounded interger\n       * @example\n       * keigai.util.math.round( n, \"down\" );\n       */\n      round: function (arg, direction) {\n        arg = number.parse(arg);\n\n        if (direction === undefined || string.isEmpty(direction)) {\n          return number.parse(arg.toFixed(0));\n        } else if (regex.down.test(direction)) {\n          return ~ ~arg;\n        } else {\n          return Math.ceil(arg);\n        }\n      }\n    };\n\n    /**\n     * @namespace promise\n     */\n    var promise = {\n      /**\n       * \"Unboxed\" Promise factory\n       *\n       * @method factory\n       * @memberOf promise\n       * @return {Object} {@link Promise}\n       */\n      factory: function () {\n        var promise = undefined,\n            pCatch = undefined,\n            pResolve = undefined,\n            pReject = undefined,\n            pThen = undefined;\n\n        promise = new Promise(function (resolve, reject) {\n          pResolve = resolve;\n          pReject = reject;\n        });\n\n        pCatch = function () {\n          for (var _len12 = arguments.length, args = Array(_len12), _key12 = 0; _key12 < _len12; _key12++) {\n            args[_key12] = arguments[_key12];\n          }\n\n          return promise[\"catch\"].apply(promise, args);\n        };\n\n        pThen = function () {\n          for (var _len13 = arguments.length, args = Array(_len13), _key13 = 0; _key13 < _len13; _key13++) {\n            args[_key13] = arguments[_key13];\n          }\n\n          return promise.then.apply(promise, args);\n        };\n\n        return { \"catch\": pCatch, resolve: pResolve, reject: pReject, then: pThen };\n      }\n    };\n\n    var DataStore = (function (Base) {\n      /**\n       * Creates a new DataStore\n       *\n       * @constructor\n       * @memberOf keigai\n       * @extends {keigai.Base}\n       * @example\n       * let store = keigai.store();\n       */\n      function DataStore() {\n        this.autosave = false;\n        this.callback = null;\n        this.credentials = null;\n        this.lists = [];\n        this.events = true;\n        this.expires = null;\n        this.headers = { Accept: \"application/json\" };\n        this.ignore = [];\n        this.index = [];\n        this.indexes = { key: {} };\n        this.key = null;\n        this.loaded = false;\n        this.mongodb = \"\";\n        this.observer = observable.factory();\n        this.records = [];\n        this.source = null;\n        this.total = 0;\n        this.versions = {};\n        this.versioning = true;\n        this.views = {};\n        this.uri = null;\n      }\n\n      _inherits(DataStore, Base);\n\n      _prototypeProperties(DataStore, null, {\n        batch: {\n\n          /**\n           * Batch sets or deletes data in the store\n           *\n           * @method batch\n           * @memberOf keigai.DataStore\n           * @param  {String}  type Type of action to perform ( set/del/delete )\n           * @param  {Array}   data Array of keys or indices to delete, or Object containing multiple records to set\n           * @param  {Boolean} sync [Optional] Syncs store with data, if true everything is erased\n           * @return {Object} {@link keigai.Deferred}\n           * @fires keigai.DataStore#beforeBatch Fires before the batch is queued\n           * @fires keigai.DataStore#afterBatch Fires after the batch is queued\n           * @fires keigai.DataStore#failedBatch Fires when an exception occurs\n           * @example\n           * store.batch( \"set\", [...] ).then( ( records ) => {\n           *   ...\n           * }, ( err ) => {\n           *   ...\n           * } );\n           */\n          value: function batch(type, data) {\n            var sync = arguments[2] === undefined ? false : arguments[2];\n            var self = this;\n            var events = this.events;\n            var defer = deferred.factory();\n            var deferreds = [];\n\n            if (!regex.set_del.test(type) || sync && regex.del.test(type) || typeof data != \"object\") {\n              defer.reject(new Error(label.invalidArguments));\n            } else {\n              if (events) {\n                this.dispatch(\"beforeBatch\", data);\n              }\n\n              if (sync) {\n                this.clear(sync);\n              }\n\n              if (data.length === 0) {\n                this.loaded = true;\n\n                if (events) {\n                  this.dispatch(\"afterBatch\", this.records);\n                }\n\n                defer.resolve(this.records);\n              } else {\n                // Batch deletion will create a sparse array, which will be compacted before re-indexing\n                if (type === \"del\") {\n                  array.each(data, function (i) {\n                    deferreds.push(self.del(i, false, true));\n                  });\n                } else {\n                  array.each(data, function (i) {\n                    deferreds.push(self.set(null, i, true));\n                  });\n                }\n\n                this.loaded = false;\n\n                utility.when(deferreds).then(function (args) {\n                  self.loaded = true;\n\n                  if (events) {\n                    self.dispatch(\"afterBatch\", args);\n                  }\n\n                  // Forcing a clear of views to deal with async nature of workers & staggered loading\n                  array.each(self.lists, function (i) {\n                    i.refresh(true);\n                  });\n\n                  if (type === \"del\") {\n                    self.records = array.compact(self.records);\n                    self.reindex();\n                  }\n\n                  if (self.autosave) {\n                    self.save();\n                  }\n\n                  defer.resolve(args);\n                }, function (e) {\n                  if (events) {\n                    self.dispatch(\"failedBatch\", e);\n                  }\n\n                  defer.reject(e);\n                });\n              }\n            }\n\n            return defer;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        buildUri: {\n\n          /**\n           * Builds a URI\n           *\n           * @method buildUri\n           * @memberOf keigai.DataStore\n           * @param  {String} key Record key\n           * @return {String}     URI\n           * @example\n           * let uri = store.buildUri( \"key\" );\n           */\n          value: function buildUri(key) {\n            var parsed = utility.parse(this.uri);\n\n            return parsed.protocol + \"//\" + parsed.host + parsed.pathname + (regex.endslash.test(parsed.pathname) ? \"\" : \"/\") + key;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        clear: {\n\n          /**\n           * Clears the data object, unsets the uri property\n           *\n           * @method clear\n           * @memberOf keigai.DataStore\n           * @param  {Boolean} sync [Optional] Boolean to limit clearing of properties\n           * @return {Object} {@link keigai.DataStore}\n           * @fires keigai.DataStore#beforeClear Fires before the data is cleared\n           * @fires keigai.DataStore#afterClear Fires after the data is cleared\n           * @example\n           * // Resyncing the records, if wired to an API\n           * store.clear( true );\n           *\n           * // Resetting the store\n           * store.clear();\n           */\n          value: function clear() {\n            var sync = arguments[0] === undefined ? true : arguments[0];\n            var events = this.events === true;\n            var resave = this.autosave === true;\n\n            if (!sync) {\n              if (events) {\n                this.dispatch(\"beforeClear\");\n              }\n\n              array.each(this.lists, function (i) {\n                if (i) {\n                  i.teardown(true);\n                }\n              });\n\n              this.autosave = false;\n              this.callback = null;\n              this.credentials = null;\n              this.lists = [];\n              this.events = true;\n              this.expires = null;\n              this.headers = { Accept: \"application/json\" };\n              this.ignore = [];\n              this.index = [];\n              this.indexes = { key: {} };\n              this.key = null;\n              this.loaded = false;\n              this.records = [];\n              this.source = null;\n              this.total = 0;\n              this.versions = {};\n              this.versioning = true;\n              this.views = {};\n              this.uri = null;\n\n              if (events) {\n                this.dispatch(\"afterClear\");\n              }\n            } else {\n              this.indexes = { key: {} };\n              this.loaded = false;\n              this.records = [];\n              this.total = 0;\n              this.views = {};\n\n              array.each(this.lists, function (i) {\n                if (i) {\n                  i.refresh();\n                }\n              });\n            }\n\n            if (resave) {\n              this.save();\n            }\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        del: {\n\n          /**\n           * Deletes a record based on key or index\n           *\n           * @method del\n           * @memberOf keigai.DataStore\n           * @param  {Mixed}   record  Record, key or index\n           * @param  {Boolean} reindex [Optional] `true` if DataStore should be reindexed\n           * @param  {Boolean} batch   [Optional] `true` if part of a batch operation\n           * @return {Object} {@link keigai.Deferred}\n           * @fires keigai.DataStore#beforeDelete Fires before the record is deleted\n           * @fires keigai.DataStore#afterDelete Fires after the record is deleted\n           * @fires keigai.DataStore#failedDelete Fires if the store is RESTful and the action is denied\n           * @example\n           * store.del( \"key\" ).then( () => {\n           *   console.log( \"Successfully deleted \" + key );\n           * }, ( err ) => {\n           *   console.warn( \"Failed to delete \" + key + \": \" + err.message );\n           * } );\n           */\n          value: function del(record) {\n            var reindex = arguments[1] === undefined ? true : arguments[1];\n            var batch = arguments[2] === undefined ? false : arguments[2];\n            record = record.key ? record : this.get(record);\n\n            var self = this;\n            var defer = deferred.factory();\n\n            if (record === undefined) {\n              defer.reject(new Error(label.invalidArguments));\n            } else {\n              if (this.events) {\n                self.dispatch(\"beforeDelete\", record);\n              }\n\n              if (this.uri === null || this.callback !== null) {\n                this.delComplete(record, reindex, batch, defer);\n              } else {\n                client.request(this.buildUri(record.key), \"DELETE\", null, utility.merge({ withCredentials: this.credentials }, this.headers)).then(function () {\n                  self.delComplete(record, reindex, batch, defer);\n                }, function (e) {\n                  self.dispatch(\"failedDelete\", e);\n                  defer.reject(e);\n                });\n              }\n            }\n\n            return defer;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        delComplete: {\n\n          /**\n           * Delete completion\n           *\n           * @method delComplete\n           * @memberOf keigai.DataStore\n           * @param  {Object}  record  DataStore record\n           * @param  {Boolean} reindex `true` if DataStore should be reindexed\n           * @param  {Boolean} batch   `true` if part of a batch operation\n           * @param  {Object}  defer   Deferred instance\n           * @return {Object} {@link keigai.DataStore}\n           * @private\n           */\n          value: function delComplete(record, reindex, batch, defer) {\n            var self = this;\n\n            delete this.indexes.key[record.key];\n            delete this.versions[record.key];\n\n            this.total--;\n            this.views = {};\n\n            if (!batch) {\n              array.remove(this.records, record.index);\n\n              if (reindex) {\n                this.reindex();\n              } else {\n                array.each(record.indexes, function (i) {\n                  array.remove(self.indexes[i[0]][i[1]], record.index);\n\n                  if (self.indexes[i[0]][i[1]].length === 0) {\n                    delete self.indexes[i[0]][i[1]];\n                  }\n                });\n              }\n\n              if (this.autosave) {\n                this.purge(record.key);\n              }\n\n              if (this.events) {\n                this.dispatch(\"afterDelete\", record);\n              }\n\n              array.each(this.lists, function (i) {\n                i.refresh();\n              });\n            } else {\n              this.records[record.index] = null;\n            }\n\n            return defer.resolve(record.key);\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        dump: {\n\n          /**\n           * Exports a subset or complete record set of DataStore\n           *\n           * @method dump\n           * @memberOf keigai.DataStore\n           * @param  {Array} args   [Optional] Sub-data set of DataStore\n           * @param  {Array} fields [Optional] Fields to export, defaults to all\n           * @return {Array}        Records\n           * @example\n           * let data = store.dump();\n           */\n          value: function dump(args, fields) {\n            args = args || this.records;\n\n            var self = this;\n            var custom = fields instanceof Array && fields.length > 0;\n            var key = this.key !== null;\n            var fn = undefined;\n\n            if (custom) {\n              fn = function (i) {\n                var record = {};\n\n                array.each(fields, function (f) {\n                  record[f] = f === self.key ? isNaN(i.key) ? i.key : Number(i.key) : utility.clone(i.data[f], true);\n                });\n\n                return record;\n              };\n            } else {\n              fn = function (i) {\n                var record = {};\n\n                if (key) {\n                  record[self.key] = isNaN(i.key) ? i.key : Number(i.key);\n                }\n\n                utility.iterate(i.data, function (v, k) {\n                  record[k] = utility.clone(v, true);\n                });\n\n                return record;\n              };\n            }\n\n            return args.map(fn);\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        get: {\n\n          /**\n           * Retrieves the current version of a record(s) based on key or index\n           *\n           * If the key is an integer, cast to a string before sending as an argument!\n           *\n           * @method get\n           * @memberOf keigai.DataStore\n           * @param  {Mixed}  record Key, index or Array of pagination start & end; or comma delimited String of keys or indices\n           * @param  {Number} offset [Optional] Offset from `record` for pagination\n           * @return {Mixed}         Individual record, or Array of records\n           * @example\n           * let record = store.get( \"key\" );\n           */\n          value: function get(record, offset) {\n            var type = typeof record;\n            var self = this;\n            var result = undefined;\n\n            if (type === \"undefined\") {\n              result = this.records;\n            } else if (type === \"string\") {\n              if (record.indexOf(\",\") === -1) {\n                result = this.records[this.indexes.key[record]];\n              } else {\n                result = string.explode(record).map(function (i) {\n                  if (!isNaN(i)) {\n                    return self.records[parseInt(i, 10)];\n                  } else {\n                    return self.records[self.indexes.key[i]];\n                  }\n                });\n              }\n            } else if (type === \"number\") {\n              if (isNaN(offset)) {\n                result = this.records[parseInt(record, 10)];\n              } else {\n                result = array.limit(this.records, parseInt(record, 10), parseInt(offset, 10));\n              }\n            }\n\n            return utility.clone(result, true);\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        join: {\n\n          /**\n           * Performs an (INNER/LEFT/RIGHT) JOIN on two DataStores\n           *\n           * @method join\n           * @memberOf keigai.DataStore\n           * @param  {String} arg   DataStore to join\n           * @param  {String} field Field in both DataStores\n           * @param  {String} join  Type of JOIN to perform, defaults to `inner`\n           * @return {Object} {@link keigai.Deferred}\n           * let data = store.join( otherStore, \"commonField\" );\n           */\n          value: function join(arg, field) {\n            var join = arguments[2] === undefined ? \"inner\" : arguments[2];\n            var self = this;\n            var defer = deferred.factory();\n            var results = [];\n            var deferreds = [];\n            var key = field === this.key;\n            var keys = array.merge(array.keys(this.records[0].data), array.keys(arg.records[0].data));\n            var fn = undefined;\n\n            if (join === \"inner\") {\n              fn = function (i) {\n                var where = {},\n                    record = i.data,\n                    defer = deferred.factory();\n\n                where[field] = key ? i.key : record[field];\n\n                arg.select(where).then(function (match) {\n                  if (match.length > 2) {\n                    defer.reject(new Error(label.databaseMoreThanOne));\n                  } else if (match.length === 1) {\n                    results.push(utility.merge(record, match[0].data));\n                    defer.resolve(true);\n                  } else {\n                    defer.resolve(false);\n                  }\n                });\n\n                deferreds.push(defer);\n              };\n            } else if (join === \"left\") {\n              fn = function (i) {\n                var where = {},\n                    record = i.data,\n                    defer = deferred.factory();\n\n                where[field] = key ? i.key : record[field];\n\n                arg.select(where).then(function (match) {\n                  if (match.length > 2) {\n                    defer.reject(new Error(label.databaseMoreThanOne));\n                  } else if (match.length === 1) {\n                    results.push(utility.merge(record, match[0].data));\n                    defer.resolve(true);\n                  } else {\n                    array.each(keys, function (i) {\n                      if (record[i] === undefined) {\n                        record[i] = null;\n                      }\n                    });\n\n                    results.push(record);\n                    defer.resolve(true);\n                  }\n                });\n\n                deferreds.push(defer);\n              };\n            } else if (join === \"right\") {\n              fn = function (i) {\n                var where = {},\n                    record = i.data,\n                    defer = deferred.factory();\n\n                where[field] = key ? i.key : record[field];\n\n                self.select(where).then(function (match) {\n                  if (match.length > 2) {\n                    defer.reject(new Error(label.databaseMoreThanOne));\n                  } else if (match.length === 1) {\n                    results.push(utility.merge(record, match[0].data));\n                    defer.resolve(true);\n                  } else {\n                    array.each(keys, function (i) {\n                      if (record[i] === undefined) {\n                        record[i] = null;\n                      }\n                    });\n\n                    results.push(record);\n                    defer.resolve(true);\n                  }\n                });\n\n                deferreds.push(defer);\n              };\n            }\n\n            array.each(utility.clone(join === \"right\" ? arg.records : this.records, true), fn);\n\n            utility.when(deferreds).then(function () {\n              defer.resolve(results);\n            }, function (e) {\n              defer.reject(e);\n            });\n\n            return defer;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        only: {\n\n          /**\n           * Retrieves only 1 field/property\n           *\n           * @method only\n           * @memberOf keigai.DataStore\n           * @param  {String} arg Field/property to retrieve\n           * @return {Array}      Array of values\n           * @example\n           * let ages = store.only( \"age\" );\n           */\n          value: function only(arg) {\n            if (arg === this.key) {\n              return this.records.map(function (i) {\n                return i.key;\n              });\n            } else {\n              return this.records.map(function (i) {\n                return i.data[arg];\n              });\n            }\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        purge: {\n\n          /**\n           * Purges DataStore or record from persistant storage\n           *\n           * @method purge\n           * @memberOf keigai.DataStore\n           * @param  {Mixed} arg  [Optional] String or Number for record\n           * @return {Object}     Record or store\n           * @example\n           * store.purge();\n           */\n          value: function purge(arg) {\n            return this.storage(arg || this, \"remove\");\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        reindex: {\n\n          /**\n           * Reindexes the DataStore\n           *\n           * @method reindex\n           * @memberOf keigai.DataStore\n           * @return {Object} {@link keigai.DataStore}\n           * @example\n           * store.reindex();\n           */\n          value: function reindex() {\n            var self = this;\n            var i = -1;\n            var tmp = [];\n\n            this.views = {};\n            this.indexes = { key: {} };\n\n            if (this.total > 0) {\n              array.each(this.records, function (record) {\n                if (record !== undefined) {\n                  tmp[++i] = record;\n                  record.index = i;\n                  self.indexes.key[record.key] = i;\n                  self.setIndexes(record);\n                }\n              });\n            }\n\n            this.records = tmp;\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        restore: {\n\n          /**\n           * Restores DataStore or record persistant storage\n           *\n           * @method restore\n           * @memberOf keigai.DataStore\n           * @param  {Mixed} arg  [Optional] String or Number for record\n           * @return {Object}     Record or store\n           * @example\n           * store.restore();\n           */\n          value: function restore(arg) {\n            return this.storage(arg || this, \"get\");\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        save: {\n\n          /**\n           * Saves DataStore or record to persistant storage, or sessionStorage\n           *\n           * @method save\n           * @memberOf keigai.DataStore\n           * @param  {Mixed} arg  [Optional] String or Number for record\n           * @return {Object} {@link keigai.Deferred}\n           * @example\n           * store.save();\n           */\n          value: function save(arg) {\n            return this.storage(arg || this, \"set\");\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        select: {\n\n          /**\n           * Selects records (not by reference) based on an explicit description\n           *\n           * @method select\n           * @memberOf keigai.DataStore\n           * @param  {Object} where Object describing the WHERE clause\n           * @return {Object} {@link keigai.Deferred}\n           * @example\n           * let adults;\n           *\n           * store.select( {age: ( i ) { return i >= 21; } } ).then( function ( records ) => {\n           *   adults = records;\n           * }, ( err ) => {\n           *   ...\n           * } );\n           */\n          value: function select(where) {\n            var _this4 = this;\n            var self = this;\n            var defer = deferred.factory();\n            var functions = [];\n            var clauses = undefined,\n                cond = undefined,\n                index = undefined,\n                result = undefined,\n                sorted = undefined,\n                values = undefined,\n                worker = undefined;\n\n            if (!(where instanceof Object)) {\n              defer.reject(new Error(label.invalidArguments));\n            } else {\n              utility.iterate(where, function (v, k) {\n                if (typeof v == \"function\") {\n                  _this4[k] = v.toString();\n                  functions.push(k);\n                }\n              });\n\n              if (webWorker) {\n                try {\n                  worker = utility.worker(defer);\n                  worker.postMessage({\n                    cmd: \"select\",\n                    indexes: this.indexes,\n                    records: this.records,\n                    where: json.encode(where),\n                    functions: functions\n                  });\n                } catch (e) {\n                  // Probably IE10, which doesn't have the correct security flag for local loading\n                  webWorker = false;\n\n                  this.select(where).then(function (arg) {\n                    defer.resolve(arg);\n                  }, function (e) {\n                    defer.reject(e);\n                  });\n                }\n              } else {\n                clauses = array.fromObject(where);\n                sorted = array.flat(clauses).filter(function (i, idx) {\n                  return idx % 2 === 0;\n                }).sort(array.sort);\n                index = sorted.join(\"|\");\n                values = sorted.map(function (i) {\n                  return where[i];\n                }).join(\"|\");\n                cond = \"return ( \";\n\n                if (functions.length === 0 && this.indexes[index]) {\n                  result = (this.indexes[index][values] || []).map(function (i) {\n                    return self.records[i];\n                  });\n                } else {\n                  if (clauses.length > 1) {\n                    array.each(clauses, function (i, idx) {\n                      var b1 = \"( \";\n\n                      if (idx > 0) {\n                        b1 = \" && ( \";\n                      }\n\n                      if (i[1] instanceof Function) {\n                        cond += b1 + i[1].toString() + \"( rec.data[\\\"\" + i[0] + \"\\\"] ) )\";\n                      } else if (!isNaN(i[1])) {\n                        cond += b1 + \"rec.data[\\\"\" + i[0] + \"\\\"] === \" + i[1] + \" )\";\n                      } else {\n                        cond += b1 + \"rec.data[\\\"\" + i[0] + \"\\\"] === \\\"\" + i[1] + \"\\\" )\";\n                      }\n                    });\n                  } else {\n                    if (clauses[0][1] instanceof Function) {\n                      cond += clauses[0][1].toString() + \"( rec.data[\\\"\" + clauses[0][0] + \"\\\"] )\";\n                    } else if (!isNaN(clauses[0][1])) {\n                      cond += \"rec.data[\\\"\" + clauses[0][0] + \"\\\"] === \" + clauses[0][1];\n                    } else {\n                      cond += \"rec.data[\\\"\" + clauses[0][0] + \"\\\"] === \\\"\" + clauses[0][1] + \"\\\"\";\n                    }\n                  }\n\n                  cond += \" );\";\n\n                  result = utility.clone(this.records, true).filter(new Function(\"rec\", cond));\n                }\n\n                defer.resolve(result);\n              }\n            }\n\n            return defer;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        set: {\n\n          /**\n           * Creates or updates an existing record\n           *\n           * @method set\n           * @memberOf keigai.DataStore\n           * @param  {Mixed}   key       [Optional] Integer or String to use as a Primary Key\n           * @param  {Object}  data      Key:Value pairs to set as field values\n           * @param  {Boolean} batch     [Optional] True if called by data.batch\n           * @param  {Boolean} overwrite [Optional] Overwrites the existing record, if found\n           * @return {Object} {@link keigai.Deferred}\n           * @fires keigai.DataStore#beforeSet Fires before the record is set\n           * @fires keigai.DataStore#afterSet Fires after the record is set, the record is the argument for listeners\n           * @fires keigai.DataStore#failedSet Fires if the store is RESTful and the action is denied\n           * @example\n           * // Creating a new record\n           * store.set( null, {...} );\n           *\n           * // Updating a record\n           * store.set( \"key\", {...} );\n           */\n          value: function set(key, data) {\n            var batch = arguments[2] === undefined ? false : arguments[2];\n            var overwrite = arguments[3] === undefined ? false : arguments[3];\n            data = utility.clone(data, true);\n\n            var self = this;\n            var events = this.events;\n            var defer = deferred.factory();\n            var record = key !== null ? this.get(key) || null : data[this.key] ? this.get(data[this.key]) || null : null;\n            var method = \"POST\";\n            var parsed = utility.parse(self.uri || \"\");\n            var uri = undefined,\n                odata = undefined,\n                rdefer = undefined;\n\n            var patch = function (overwrite, data, ogdata) {\n              var ndata = [];\n\n              if (overwrite) {\n                array.each(array.keys(ogdata), function (k) {\n                  if (k !== self.key && data[k] === undefined) {\n                    ndata.push({ op: \"remove\", path: \"/\" + k });\n                  }\n                });\n              }\n\n              utility.iterate(data, function (v, k) {\n                if (k !== self.key && ogdata[k] === undefined) {\n                  ndata.push({ op: \"add\", path: \"/\" + k, value: v });\n                } else if (json.encode(ogdata[k]) !== json.encode(v)) {\n                  ndata.push({ op: \"replace\", path: \"/\" + k, value: v });\n                }\n              });\n\n              return ndata;\n            };\n\n            if (typeof data == \"string\") {\n              if (data.indexOf(\"//\") === -1) {\n                // Relative path to store, i.e. a child\n                if (data.charAt(0) !== \"/\") {\n                  uri = this.buildUri(data);\n                }\n                // Root path, relative to store, i.e. a domain\n                else if (self.uri !== null && regex.root.test(data)) {\n                  uri = parsed.protocol + \"//\" + parsed.host + data;\n                } else {\n                  uri = data;\n                }\n              } else {\n                uri = data;\n              }\n\n              key = uri.replace(regex.not_endpoint, \"\");\n\n              if (string.isEmpty(key)) {\n                defer.reject(new Error(label.invalidArguments));\n              } else {\n                if (!batch && events) {\n                  self.dispatch(\"beforeSet\", { key: key, data: data });\n                }\n\n                client.request(uri, \"GET\", null, utility.merge({ withCredentials: self.credentials }, self.headers)).then(function (arg) {\n                  self.setComplete(record, key, self.source ? utility.walk(arg, self.source) : arg, batch, overwrite, defer);\n                }, function (e) {\n                  self.dispatch(\"failedSet\", e);\n                  defer.reject(e);\n                });\n              }\n            } else {\n              if (!batch && events) {\n                self.dispatch(\"beforeSet\", { key: key, data: data });\n              }\n\n              if (batch || this.uri === null) {\n                this.setComplete(record, key, data, batch, overwrite, defer);\n              } else {\n                if (key !== null) {\n                  uri = this.buildUri(key);\n                  method = \"PATCH\";\n                  odata = utility.clone(data, true);\n                  data = patch(overwrite, data, this.dump([record])[0]);\n                } else {\n                  // Dropping query string\n                  uri = parsed.protocol + \"//\" + parsed.host + parsed.pathname;\n                }\n\n                rdefer = client.request(uri, method, data, utility.merge({ withCredentials: this.credentials }, this.headers));\n                rdefer.then(function (arg) {\n                  var change = undefined;\n\n                  if (rdefer.xhr.status !== 204 && rdefer.xhr.status < 300) {\n                    change = key === null ? self.source ? utility.walk(arg, self.source) : arg : odata;\n                  } else {\n                    change = odata;\n                  }\n\n                  self.setComplete(record, key, change, batch, overwrite, defer);\n                }, function (e) {\n                  if (method == \"PATCH\") {\n                    method = \"PUT\";\n                    data = utility.clone(odata, true);\n\n                    utility.iterate(record.data, function (v, k) {\n                      data[k] = v;\n                    });\n\n                    client.request(uri, method, data, utility.merge({ withCredentials: self.credentials }, self.headers)).then(function () {\n                      self.setComplete(record, key, odata, batch, overwrite, defer);\n                    }, function (e) {\n                      self.dispatch(\"failedSet\", e);\n                      defer.reject(e);\n                    });\n                  } else {\n                    self.dispatch(\"failedSet\", e);\n                    defer.reject(e);\n                  }\n                });\n              }\n            }\n\n            return defer;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        setComplete: {\n\n          /**\n           * Set completion\n           *\n           * @method setComplete\n           * @memberOf keigai.DataStore\n           * @param  {Mixed}   record    DataStore record, or `null` if new\n           * @param  {String}  key       Record key\n           * @param  {Object}  data      Record data\n           * @param  {Boolean} batch     `true` if part of a batch operation\n           * @param  {Boolean} overwrite Overwrites the existing record, if found\n           * @param  {Object}  defer     Deferred instance\n           * @return {Object} {@link keigai.DataStore}\n           * @private\n           */\n          value: function setComplete(record, key, data, batch, overwrite, defer) {\n            // Clearing views\n            this.views = {};\n\n            // Setting key\n            if (key === null) {\n              if (this.key !== null && data[this.key] !== undefined && data[this.key] !== null) {\n                key = data[this.key].toString();\n              } else {\n                key = utility.uuid();\n              }\n            }\n\n            // Removing primary key from data\n            if (this.key) {\n              delete data[this.key];\n            }\n\n            // Create\n            if (record === null) {\n              record = {\n                index: this.total++,\n                key: key,\n                data: data,\n                indexes: []\n              };\n\n              this.indexes.key[key] = record.index;\n              this.records[record.index] = record;\n\n              if (this.versioning) {\n                this.versions[record.key] = lru.factory(VERSIONS);\n                this.versions[record.key].nth = 0;\n              }\n            }\n            // Update\n            else {\n              if (this.versioning) {\n                if (this.versions[record.key] === undefined) {\n                  this.versions[record.key] = lru.factory(VERSIONS);\n                  this.versions[record.key].nth = 0;\n                }\n\n                this.versions[record.key].set(\"v\" + ++this.versions[record.key].nth, this.dump([record])[0]);\n              }\n\n              // By reference\n              record = this.records[record.index];\n\n              if (overwrite) {\n                record.data = {};\n              }\n\n              utility.iterate(data, function (v, k) {\n                record.data[k] = v;\n              });\n\n              // Snapshot that's safe to hand out\n              record = utility.clone(record, true);\n            }\n\n            this.setIndexes(record);\n\n            if (!batch) {\n              if (this.autosave) {\n                this.save();\n              }\n\n              if (this.events) {\n                this.dispatch(\"afterSet\", record);\n              }\n\n              array.each(this.lists, function (i) {\n                i.refresh();\n              });\n            }\n\n            defer.resolve(record);\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        setExpires: {\n\n          /**\n           * Gets or sets an explicit expiration of data\n           *\n           * @method setExpires\n           * @memberOf keigai.DataStore\n           * @param  {Number} arg Milliseconds until data is stale\n           * @return {Object} {@link keigai.DataStore}\n           * @example\n           * store.setExpires( 5 * 60 * 1000 ); // Resyncs every 5 minutes\n           */\n          value: function setExpires(arg) {\n            var id = this.id + \"Expire\";\n            var expires = arg;\n            var self = this;\n\n            // Expiry cannot be less than a second, and must be a valid scenario for consumption; null will disable repetitive expiration\n            if (arg !== null && this.uri === null || arg !== null && (isNaN(arg) || arg < 1000)) {\n              throw new Error(label.invalidArguments);\n            }\n\n            if (this.expires === arg) {\n              return;\n            }\n\n            this.expires = arg;\n\n            utility.clearTimers(id);\n\n            if (arg === null) {\n              return;\n            }\n\n            utility.repeat(function () {\n              if (self.uri === null) {\n                self.setExpires(null);\n\n                return false;\n              }\n\n              self.dispatch(\"beforeExpire\");\n              cache.expire(self.uri);\n              self.dispatch(\"expire\");\n              self.dispatch(\"afterExpire\");\n            }, expires, id, false);\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        setIndexes: {\n\n          /**\n           * Sets indexes for a record using `store.indexes`\n           *\n           * Composite indexes are supported, but require keys be in alphabetical order, e.g. \"age|name\"\n           *\n           * @method setIndexes\n           * @memberOf keigai.DataStore\n           * @param  {Object} arg DataStore Record\n           * @return {Object} {@link keigai.DataStore}\n           * @example\n           * store.setIndexes( record );\n           */\n          value: function setIndexes(arg) {\n            var self = this;\n            var delimter = \"|\";\n\n            arg.indexes = [];\n\n            array.each(this.index, function (i) {\n              var keys = i.split(delimter);\n              var values = \"\";\n\n              if (self.indexes[i] === undefined) {\n                self.indexes[i] = {};\n              }\n\n              array.each(keys, function (k, kdx) {\n                values += (kdx > 0 ? delimter : \"\") + arg.data[k];\n              });\n\n              if (self.indexes[i][values] === undefined) {\n                self.indexes[i][values] = [];\n              }\n\n              if (!array.contains(self.indexes[i][values], arg.index)) {\n                self.indexes[i][values].push(arg.index);\n                arg.indexes.push([i, values]);\n              }\n            });\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        setUri: {\n\n          /**\n           * Sets the RESTful API end point\n           *\n           * @method setUri\n           * @memberOf keigai.DataStore\n           * @param  {String} arg API collection end point\n           * @return {Object}     Deferred\n           * @example\n           * store.setUri( \"...\" ).then( ( records ) => {\n           *   ...\n           * }, ( err ) => {\n           *   ...\n           * } );\n           */\n          value: function setUri(arg) {\n            var _this5 = this;\n            var defer = deferred.factory();\n            var parsed = undefined;\n\n            if (arg !== null && string.isEmpty(arg)) {\n              defer.reject(new Error(label.invalidArguments));\n            }\n\n            if (arg === null) {\n              this.uri = arg;\n            } else {\n              parsed = utility.parse(arg);\n              this.uri = parsed.protocol + \"//\" + parsed.host + parsed.path;\n\n              if (!string.isEmpty(parsed.auth) && !this.headers.authorization && !this.headers.Authorization) {\n                this.headers.Authorization = \"Basic \" + btoa(decodeURIComponent(parsed.auth));\n              }\n\n              this.on(\"expire\", function () {\n                _this5.sync();\n              }, \"resync\", this);\n\n              cache.expire(this.uri);\n\n              this.sync().then(function (arg) {\n                defer.resolve(arg);\n              }, function (e) {\n                defer.reject(e);\n              });\n            }\n\n            return defer;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        sort: {\n\n          /**\n           * Creates, or returns a cached view of the records (not by reference)\n           *\n           * @method sort\n           * @memberOf keigai.DataStore\n           * @param  {String} query  SQL ( style ) order by\n           * @param  {String} create [Optional, default behavior is true, value is false] Boolean determines whether to recreate a view if it exists\n           * @param  {Object} where  [Optional] Object describing the WHERE clause\n           * @return {Object} {@link keigai.Deferred}\n           * @example\n           * store.sort( \"age desc, name\" ).then( ( records ) => {\n           *   ...\n           * }, ( err ) => {\n           *   ...\n           * } );\n           */\n          value: function sort(query, create, where) {\n            create = create === true || where instanceof Object;\n\n            var self = this;\n            var view = string.toCamelCase(string.explode(query).join(\" \"));\n            var defer = deferred.factory();\n\n            // Next phase\n            var next = function (records) {\n              var worker = undefined;\n\n              if (self.total === 0) {\n                defer.resolve([]);\n              } else if (!create && self.views[view]) {\n                defer.resolve(self.views[view]);\n              } else if (webWorker) {\n                defer.then(function (arg) {\n                  self.views[view] = arg;\n\n                  return self.views[view];\n                }, function (e) {\n                  utility.error(e);\n                });\n\n                try {\n                  worker = utility.worker(defer);\n                  worker.postMessage({ cmd: \"sort\", indexes: self.indexes, records: records, query: query });\n                } catch (e) {\n                  // Probably IE10, which doesn't have the correct security flag for local loading\n                  webWorker = false;\n\n                  self.views[view] = array.keySort(records, query, \"data\");\n                  defer.resolve(self.views[view]);\n                }\n              } else {\n                self.views[view] = array.keySort(records, query, \"data\");\n                defer.resolve(self.views[view]);\n              }\n            };\n\n            if (!where) {\n              next(utility.clone(this.records, true));\n            } else {\n              this.select(where).then(next, function (e) {\n                defer.reject(e);\n              });\n            }\n\n            return defer;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        storage: {\n\n          /**\n           * Storage interface\n           *\n           * SQL/NoSQL backends will be used if configured in lieu of localStorage (node.js only)\n           *\n           * @method storage\n           * @memberOf keigai.DataStore\n           * @param  {Mixed}  obj  Record ( Object, key or index ) or store\n           * @param  {Object} op   Operation to perform ( get, remove or set )\n           * @param  {String} type [Optional] Type of Storage to use ( local, session [local] )\n           * @return {Object} {@link keigai.Deferred}\n           * @example\n           * store.storage( store, \"set\" );\n           */\n          value: function storage(obj, op, type) {\n            var self = this;\n            var record = false;\n            var mongo = !string.isEmpty(this.mongodb);\n            var session = type === \"session\" && typeof sessionStorage != \"undefined\";\n            var defer = deferred.factory();\n            var data = undefined,\n                key = undefined,\n                result = undefined;\n\n            if (!regex.number_string_object.test(typeof obj) || !regex.get_remove_set.test(op)) {\n              defer.reject(new Error(label.invalidArguments));\n            } else {\n              record = regex.number_string.test(typeof obj) || obj.hasOwnProperty(\"data\");\n\n              if (op !== \"remove\") {\n                if (record && !(obj instanceof Object)) {\n                  obj = this.get(obj);\n                }\n\n                key = record ? obj.key : obj.id;\n              } else if (op === \"remove\" && record) {\n                key = obj.key || obj;\n              }\n\n              if (mongo) {\n                mongodb.connect(this.mongodb, function (e, db) {\n                  if (e) {\n                    if (db) {\n                      db.close();\n                    }\n\n                    return defer.reject(e);\n                  }\n\n                  db.collection(self.id, function (e, collection) {\n                    if (e) {\n                      db.close();\n                      return defer.reject(e);\n                    }\n\n                    if (op === \"get\") {\n                      if (record) {\n                        collection.find({ _id: obj.key }).limit(1).toArray(function (e, recs) {\n                          db.close();\n\n                          if (e) {\n                            defer.reject(e);\n                          } else if (recs.length === 0) {\n                            defer.resolve(null);\n                          } else {\n                            delete recs[0]._id;\n\n                            self.set(key, recs[0], true).then(function (rec) {\n                              defer.resolve(rec);\n                            }, function (e) {\n                              defer.reject(e);\n                            });\n                          }\n                        });\n                      } else {\n                        collection.find({}).toArray(function (e, recs) {\n                          var i = undefined,\n                              nth = undefined;\n\n                          if (e) {\n                            db.close();\n                            return defer.reject(e);\n                          }\n\n                          i = -1;\n                          nth = recs.length;\n\n                          if (nth > 0) {\n                            self.records = recs.map(function (r) {\n                              var rec = { key: r._id, index: ++i, data: {} };\n\n                              self.indexes.key[rec.key] = rec.index;\n                              rec.data = r;\n                              delete rec.data._id;\n                              self.setIndexes(rec);\n\n                              return rec;\n                            });\n\n                            self.total = nth;\n                          }\n\n                          db.close();\n                          defer.resolve(self.records);\n                        });\n                      }\n                    } else if (op === \"remove\") {\n                      collection.remove(record ? { _id: key } : {}, { safe: true }, function (e, arg) {\n                        db.close();\n\n                        if (e) {\n                          defer.reject(e);\n                        } else {\n                          defer.resolve(arg);\n                        }\n                      });\n                    } else if (op === \"set\") {\n                      if (record) {\n                        collection.update({ _id: obj.key }, obj.data, {\n                          w: 1,\n                          safe: true,\n                          upsert: true\n                        }, function (e, arg) {\n                          db.close();\n\n                          if (e) {\n                            defer.reject(e);\n                          } else {\n                            defer.resolve(arg);\n                          }\n                        });\n                      } else {\n                        // Removing all documents & re-inserting\n                        collection.remove({}, { w: 1, safe: true }, function (e) {\n                          var deferreds = undefined;\n\n                          if (e) {\n                            db.close();\n                            return defer.reject(e);\n                          } else {\n                            deferreds = [];\n\n                            array.each(self.records, function (i) {\n                              var data = {};\n                              var defer2 = deferred.factory();\n\n                              deferreds.push(defer2);\n\n                              utility.iterate(i.data, function (v, k) {\n                                data[k] = v;\n                              });\n\n                              collection.update({ _id: i.key }, data, {\n                                w: 1,\n                                safe: true,\n                                upsert: true\n                              }, function (e, arg) {\n                                if (e) {\n                                  defer2.reject(e);\n                                } else {\n                                  defer2.resolve(arg);\n                                }\n                              });\n                            });\n\n                            utility.when(deferreds).then(function (result) {\n                              db.close();\n                              defer.resolve(result);\n                            }, function (e) {\n                              db.close();\n                              defer.reject(e);\n                            });\n                          }\n                        });\n                      }\n                    } else {\n                      db.close();\n                      defer.reject(null);\n                    }\n                  });\n                });\n              } else {\n                if (op === \"get\") {\n                  result = session ? sessionStorage.getItem(key) : localStorage.getItem(key);\n\n                  if (result !== null) {\n                    result = json.decode(result);\n\n                    if (record) {\n                      self.set(key, result, true).then(function (rec) {\n                        defer.resolve(rec);\n                      }, function (e) {\n                        defer.reject(e);\n                      });\n                    } else {\n                      utility.merge(self, result);\n                      defer.resolve(self);\n                    }\n                  } else {\n                    defer.resolve(self);\n                  }\n\n                  // Decorating loaded state for various code paths\n                  defer.then(function () {\n                    self.loaded = true;\n                  }, function (e) {\n                    throw e;\n                  });\n                } else if (op === \"remove\") {\n                  session ? sessionStorage.removeItem(key) : localStorage.removeItem(key);\n                  defer.resolve(this);\n                } else if (op === \"set\") {\n                  data = json.encode(record ? obj.data : {\n                    total: this.total,\n                    index: this.index,\n                    indexes: this.indexes,\n                    records: this.records\n                  });\n                  session ? sessionStorage.setItem(key, data) : localStorage.setItem(key, data);\n                  defer.resolve(this);\n                } else {\n                  defer.reject(null);\n                }\n              }\n            }\n\n            return defer;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        sync: {\n\n          /**\n           * Syncs the DataStore with a URI representation\n           *\n           * @method sync\n           * @memberOf keigai.DataStore\n           * @return {Object} {@link keigai.Deferred}\n           * @fires keigai.DataStore#beforeSync Fires before syncing the DataStore\n           * @fires keigai.DataStore#afterSync Fires after syncing the DataStore\n           * @fires keigai.DataStore#failedSync Fires when an exception occurs\n           * @example\n           * store.sync().then( ( records ) => {\n           *   ...\n           * }, ( err ) => {\n           *   ...\n           * } );\n           */\n          value: function sync() {\n            var self = this;\n            var events = this.events === true;\n            var defer = deferred.factory();\n\n            /**\n             * Resolves public deferred\n             *\n             * @method success\n             * @memberOf keigai.DataStore.sync\n             * @private\n             * @param  {Object} arg API response\n             * @return {Undefined}  undefined\n             */\n            var success = function (arg) {\n              var data = undefined;\n\n              if (typeof arg != \"object\") {\n                return failure(new Error(label.expectedObject));\n              }\n\n              if (self.source !== null) {\n                arg = utility.walk(arg, self.source);\n              }\n\n              if (arg instanceof Array) {\n                data = arg;\n              } else {\n                data = [arg];\n              }\n\n              self.batch(\"set\", data, true).then(function (arg) {\n                if (events) {\n                  self.dispatch(\"afterSync\", arg);\n                }\n\n                defer.resolve(arg);\n              }, failure);\n            };\n\n            /**\n             * Rejects public deferred\n             *\n             * @method failure\n             * @memberOf keigai.DataStore.sync\n             * @private\n             * @param  {Object} e Error instance\n             * @return {Undefined} undefined\n             */\n            var failure = function (e) {\n              if (events) {\n                self.dispatch(\"failedSync\", e);\n              }\n\n              defer.reject(e);\n            };\n\n            if (this.uri === null || string.isEmpty(this.uri)) {\n              defer.reject(new Error(label.invalidArguments));\n            } else {\n              if (events) {\n                this.dispatch(\"beforeSync\", this.uri);\n              }\n\n              if (this.callback !== null) {\n                client.jsonp(this.uri, { callback: this.callback }).then(success, failure);\n              } else {\n                client.request(this.uri, \"GET\", null, utility.merge({ withCredentials: this.credentials }, this.headers)).then(success, failure);\n              }\n            }\n\n            return defer;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        teardown: {\n\n          /**\n           * Tears down a store & expires all records associated to an API\n           *\n           * @method teardown\n           * @memberOf keigai.DataStore\n           * @return {Object} {@link keigai.DataStore}\n           * @example\n           * store.teardown();\n           */\n          value: function teardown() {\n            var uri = this.uri;\n            var id = undefined;\n\n            if (uri !== null) {\n              cache.expire(uri, true);\n\n              id = this.id + \"DataExpire\";\n              utility.clearTimers(id);\n\n              array.each(this.records, function (i) {\n                var recordUri = uri + \"/\" + i.key;\n\n                cache.expire(recordUri, true);\n              });\n            }\n\n            array.each(this.lists, function (i) {\n              i.teardown(true);\n            });\n\n            this.clear(true);\n            this.dispatch(\"afterTeardown\");\n\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        undo: {\n\n          /**\n           * Undoes the last modification to a record, if it exists\n           *\n           * @method undo\n           * @memberOf keigai.DataStore\n           * @param  {Mixed}  key     Key or index\n           * @param  {String} version [Optional] Version to restore\n           * @return {Object}         Deferred\n           * @example\n           * // Didn't like the new version, so undo the change\n           * store.undo( \"key\", \"v1\" );\n           */\n          value: function undo(key, version) {\n            var record = this.get(key);\n            var defer = deferred.factory();\n            var versions = this.versions[record.key];\n            var previous = undefined;\n\n            if (record === undefined) {\n              defer.reject(new Error(label.invalidArguments));\n            } else {\n              if (versions) {\n                previous = versions.get(version || versions.first);\n\n                if (previous === undefined) {\n                  defer.reject(label.datastoreNoPrevVersion);\n                } else {\n                  this.set(key, previous).then(function (arg) {\n                    defer.resolve(arg);\n                  }, function (e) {\n                    defer.reject(e);\n                  });\n                }\n              } else {\n                defer.reject(label.datastoreNoPrevVersion);\n              }\n            }\n\n            return defer;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        unique: {\n\n          /**\n           * Returns Array of unique values of `key`\n           *\n           * @method unique\n           * @memberOf keigai.DataStore\n           * @param  {String} key Field to compare\n           * @return {Array}      Array of values\n           * @example\n           * let ages = store.unique( \"age\" );\n           */\n          value: function unique(key) {\n            return array.unique(this.records.map(function (i) {\n              return i.data[key];\n            }));\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        update: {\n\n          /**\n           * Applies a difference to a record\n           *\n           * Use `data.set()` if `data` is the complete field set\n           *\n           * @method update\n           * @memberOf keigai.DataStore\n           * @param  {Mixed}  key  Key or index\n           * @param  {Object} data Key:Value pairs to set as field values\n           * @return {Object} {@link keigai.Deferred}\n           * @example\n           * store.update( \"key\", {age: 34} );\n           */\n          value: function update(key, data) {\n            var record = this.get(key);\n            var defer = deferred.factory();\n\n            if (record === undefined) {\n              defer.reject(new Error(label.invalidArguments));\n            } else {\n              this.set(key, utility.merge(record.data, data)).then(function (arg) {\n                defer.resolve(arg);\n              }, function (e) {\n                defer.reject(e);\n              });\n            }\n\n            return defer;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        }\n      });\n\n      return DataStore;\n    })(Base);\n\n    /**\n     * @namespace store\n     */\n    var store = {\n      /**\n       * Decorates a DataStore on an Object\n       *\n       * @method factory\n       * @memberOf store\n       * @param  {Mixed}  recs [Optional] Data to set with this.batch\n       * @param  {Object} args [Optional] Arguments to set on the store\n       * @return {Object} {@link keigai.DataStore}\n       * @example\n       * let store = keigai.store(null, {key: \"guid\"});\n       *\n       * store.setUri( \"http://...\" ).then( ( records ) => {\n       *   // Do something with the records\n       * }, ( e ) => {\n       *   // Handle `e`\n       * } );\n       */\n      factory: function (recs, args) {\n        var obj = new DataStore();\n\n        if (args instanceof Object) {\n          utility.merge(obj, args);\n        }\n\n        if (recs !== null && typeof recs == \"object\") {\n          obj.batch(\"set\", recs);\n        }\n\n        return obj;\n      },\n\n      /**\n       * DataStore worker handler\n       *\n       * @method worker\n       * @memberOf store\n       * @param  {Object} ev Event\n       * @return {Undefined} undefined\n       * @private\n       */\n      worker: function (ev) {\n        var cmd = ev.data.cmd;\n        var records = ev.data.records;\n        var clauses = undefined,\n            cond = undefined,\n            functions = undefined,\n            indexes = undefined,\n            index = undefined,\n            result = undefined,\n            sorted = undefined,\n            where = undefined,\n            values = undefined;\n\n        if (cmd === \"select\") {\n          where = JSON.parse(ev.data.where);\n          functions = ev.data.functions;\n          clauses = array.fromObject(where);\n          sorted = array.flat(clauses).filter(function (i, idx) {\n            return idx % 2 === 0;\n          }).sort(array.sort);\n          index = sorted.join(\"|\");\n          values = sorted.map(function (i) {\n            return where[i];\n          }).join(\"|\");\n          indexes = ev.data.indexes;\n          cond = \"return ( \";\n\n          if (functions.length === 0 && indexes[index]) {\n            result = (indexes[index][values] || []).map(function (i) {\n              return records[i];\n            });\n          } else {\n            if (clauses.length > 1) {\n              array.each(clauses, function (i, idx) {\n                var b1 = \"( \";\n\n                if (idx > 0) {\n                  b1 = \" && ( \";\n                }\n\n                if (array.contains(functions, i[0])) {\n                  cond += b1 + i[1] + \"( rec.data[\\\"\" + i[0] + \"\\\"] ) )\";\n                } else if (!isNaN(i[1])) {\n                  cond += b1 + \"rec.data[\\\"\" + i[0] + \"\\\"] === \" + i[1] + \" )\";\n                } else {\n                  cond += b1 + \"rec.data[\\\"\" + i[0] + \"\\\"] === \\\"\" + i[1] + \"\\\" )\";\n                }\n              });\n            } else {\n              if (array.contains(functions, clauses[0][0])) {\n                cond += clauses[0][1] + \"( rec.data[\\\"\" + clauses[0][0] + \"\\\"] )\";\n              } else if (!isNaN(clauses[0][1])) {\n                cond += \"rec.data[\\\"\" + clauses[0][0] + \"\\\"] === \" + clauses[0][1];\n              } else {\n                cond += \"rec.data[\\\"\" + clauses[0][0] + \"\\\"] === \\\"\" + clauses[0][1] + \"\\\"\";\n              }\n            }\n\n            cond += \" );\";\n\n            result = records.filter(new Function(\"rec\", cond));\n          }\n        } else if (cmd === \"sort\") {\n          result = array.keySort(records, ev.data.query, \"data\");\n        }\n\n        postMessage(result);\n      }\n    };\n\n    /**\n     * @namespace string\n     */\n    var string = {\n      /**\n       * Capitalizes the String\n       *\n       * @method capitalize\n       * @memberOf string\n       * @param  {String}  obj String to capitalize\n       * @param  {Boolean} all [Optional] Capitalize each word\n       * @return {String}      Capitalized String\n       * @example\n       * keigai.util.string.capitalize( \"hello\" ); // \"Hello\"\n       */\n      capitalize: function (obj) {\n        var all = arguments[1] === undefined ? false : arguments[1];\n        var result = undefined;\n\n        if (all) {\n          result = string.explode(obj, \" \").map(function (i) {\n            return i.charAt(0).toUpperCase() + i.slice(1);\n          }).join(\" \");\n        } else {\n          result = obj.charAt(0).toUpperCase() + obj.slice(1);\n        }\n\n        return result;\n      },\n\n      /**\n       * Escapes meta characters within a string\n       *\n       * @method escape\n       * @memberOf string\n       * @param  {String} obj String to escape\n       * @return {String}     Escaped string\n       * @example\n       * keigai.util.string.escape( \"{hello}\" ); // \"\\{hello\\}\"\n       */\n      escape: function (obj) {\n        return obj.replace(/[\\-\\[\\]{}()*+?.,\\\\\\/\\^\\$|#\\s]/g, \"\\\\$&\");\n      },\n\n      /**\n       * Splits a string on comma, or a parameter, and trims each value in the resulting Array\n       *\n       * @method explode\n       * @memberOf string\n       * @param  {String} obj String to capitalize\n       * @param  {String} arg String to split on\n       * @return {Array}      Array of the exploded String\n       * @example\n       * keigai.util.array.each( keigai.util.string.explode( \"abc, def\" ), ( i ) => {\n       *   ...\n       * } );\n       */\n      explode: function (obj) {\n        var arg = arguments[1] === undefined ? \",\" : arguments[1];\n        return string.trim(obj).split(new RegExp(\"\\\\s*\" + arg + \"\\\\s*\"));\n      },\n\n      /**\n       * Creates a String representation of an Object, preserving Functions\n       *\n       * Nested Objects are not supported\n       *\n       * @method fromObject\n       * @memberOf string\n       * @param  {Object} obj  Object to convert\n       * @param  {String} name [Optional] Name of Object\n       * @return {String}      String representation\n       * @example\n       * keigai.util.string.fromObject( {a: true, b: false}, \"stats\" ); // \"stats = {'a': true,'b':false}\"\n       */\n      fromObject: function (obj, name) {\n        var result = (name ? name + \" = {\" : \"{\") + \"\\n\";\n\n        utility.iterate(obj, function (v, k) {\n          result += \"\\\"\" + k + \"\\\":\" + v.toString() + \",\\n\";\n        });\n\n        result = result.replace(/\\[object Object\\]/g, \"{}\").replace(/,\\n$/, \"\\n\") + \"}\";\n\n        return result;\n      },\n\n      /**\n       * Replaces all spaces in a string with dashes\n       *\n       * @method hyphenate\n       * @memberOf string\n       * @param  {String} obj   String to hyphenate\n       * @param {Boolean} camel [Optional] Hyphenate camelCase\n       * @return {String}       String with dashes instead of spaces\n       * @example\n       * keigai.util.string.hyphenate( \"hello world\" ); // \"hello-world\"\n       */\n      hyphenate: function (obj) {\n        var camel = arguments[1] === undefined ? false : arguments[1];\n        var result = string.trim(obj).replace(/\\s+/g, \"-\");\n\n        if (camel === true) {\n          result = result.replace(/([A-Z])/g, \"-$1\").toLowerCase();\n        }\n\n        return result;\n      },\n\n      /**\n       * Tests if a string is a boolean\n       *\n       * @method isBoolean\n       * @memberOf string\n       * @param  {String}  obj String to test\n       * @return {Boolean}     Result of test\n       * @example\n       * if ( keigai.util.string.isBoolean( ... ) {\n       *   ...\n       * } );\n       */\n      isBoolean: function (obj) {\n        return regex.bool.test(obj);\n      },\n\n      /**\n       * Tests if a string is empty\n       *\n       * @method isEmpty\n       * @memberOf string\n       * @param  {String}  obj String to test\n       * @return {Boolean}     Result of test\n       * @example\n       * if ( !keigai.util.string.isEmpty( ... ) {\n       *   ...\n       * } );\n       */\n      isEmpty: function (obj) {\n        return string.trim(obj) === \"\";\n      },\n\n      /**\n       * Tests if a string is a number\n       *\n       * @method isNumber\n       * @memberOf string\n       * @param  {String}  obj String to test\n       * @return {Boolean}     Result of test\n       * @example\n       * if ( keigai.util.string.isNumber( ... ) {\n       *   ...\n       * } );\n       */\n      isNumber: function (obj) {\n        return regex.number.test(obj);\n      },\n\n      /**\n       * Tests if a string is a URL\n       *\n       * @method isUrl\n       * @memberOf string\n       * @param  {String}  obj String to test\n       * @return {Boolean}     Result of test\n       * @example\n       * if ( keigai.util.string.isUrl( ... ) {\n       *   ...\n       * } );\n       */\n      isUrl: function (obj) {\n        return regex.url.test(obj);\n      },\n\n      /**\n       * Transforms the case of a String into CamelCase\n       *\n       * @method toCamelCase\n       * @memberOf string\n       * @param  {String} obj String to capitalize\n       * @return {String}     Camel case String\n       * @example\n       * keigai.util.string.toCamelCase( \"hello world\" ); // \"helloWorld\"\n       */\n      toCamelCase: function (obj) {\n        var s = string.trim(obj).replace(/\\.|_|-|\\@|\\[|\\]|\\(|\\)|\\#|\\$|\\%|\\^|\\&|\\*|\\s+/g, \" \").toLowerCase().split(regex.space_hyphen);\n        var r = [];\n\n        array.each(s, function (i, idx) {\n          r.push(idx === 0 ? i : string.capitalize(i));\n        });\n\n        return r.join(\"\");\n      },\n\n      /**\n       * Returns singular form of the string\n       *\n       * @method singular\n       * @memberOf string\n       * @param  {String} obj String to transform\n       * @return {String}     Transformed string\n       * @example\n       * keigai.util.string.singular( \"cans\" ); // \"can\"\n       */\n      singular: function (obj) {\n        return obj.replace(/oe?s$/, \"o\").replace(/ies$/, \"y\").replace(/ses$/, \"se\").replace(/s$/, \"\");\n      },\n\n      /**\n       * Casts a String to a Function\n       *\n       * @method toFunction\n       * @memberOf string\n       * @param  {String} obj String to cast\n       * @return {Function}   Function\n       * @example\n       * let fn = someFunction.toString();\n       *\n       * ...\n       *\n       * let func = keigai.util.string.toFunction( fn );\n       */\n      toFunction: function (obj) {\n        var args = string.trim(obj.replace(/^.*\\(/, \"\").replace(/[\\t|\\r|\\n|\\\"|\\']+/g, \"\").replace(/\\).*/, \"\"));\n        var body = string.trim(obj.replace(/^.*\\{/, \"\").replace(/\\}$/, \"\"));\n\n        return Function.apply(Function, string.explode(args).concat([body]));\n      },\n\n      /**\n       * Trims the whitespace around a String\n       *\n       * @method trim\n       * @memberOf string\n       * @param  {String} obj String to capitalize\n       * @return {String}     Trimmed String\n       * @example\n       * keigai.util.string.trim( \"  hello world \" ); // \"hello world\"\n       */\n      trim: function (obj) {\n        return obj.replace(/^(\\s+|\\t+|\\n+)|(\\s+|\\t+|\\n+)$/g, \"\");\n      },\n\n      /**\n       * Uncamelcases the String\n       *\n       * @method unCamelCase\n       * @memberOf string\n       * @param  {String} obj String to uncamelcase\n       * @return {String}     Uncamelcased String\n       */\n      unCamelCase: function (obj) {\n        return string.trim(obj.replace(/([A-Z])/g, \" $1\").toLowerCase());\n      },\n\n      /**\n       * Uncapitalizes the String\n       *\n       * @method uncapitalize\n       * @memberOf string\n       * @param  {String} obj String to uncapitalize\n       * @return {String}     Uncapitalized String\n       * @example\n       * keigai.util.string.uncapitalize( \"Hello\" ); // \"hello\"\n       */\n      uncapitalize: function (obj) {\n        var result = string.trim(obj);\n\n        return result.charAt(0).toLowerCase() + result.slice(1);\n      },\n\n      /**\n       * Replaces all hyphens with spaces\n       *\n       * @method unhyphenate\n       * @memberOf string\n       * @param  {String}  obj  String to unhypenate\n       * @param  {Boolean} caps [Optional] True to capitalize each word\n       * @return {String}       Unhyphenated String\n       * @example\n       * keigai.util.string.unhyphenate( \"hello-world\" );       // \"hello world\"\n       * keigai.util.string.unhyphenate( \"hello-world\", true ); // \"Hello World\"\n       */\n      unhyphenate: function (obj) {\n        var caps = arguments[1] === undefined ? false : arguments[1];\n        if (caps !== true) {\n          return string.explode(obj, \"-\").join(\" \");\n        } else {\n          return string.explode(obj, \"-\").map(function (i) {\n            return string.capitalize(i);\n          }).join(\" \");\n        }\n      }\n    };\n\n    /**\n     * @namespace utility\n     */\n    var utility = {\n      /**\n       * Collection of timers\n       *\n       * @memberOf utility\n       * @type {Object}\n       * @private\n       */\n      timer: {},\n\n      /**\n       * Collection of repeating functions\n       *\n       * @memberOf utility\n       * @type {Object}\n       * @private\n       */\n      repeating: {},\n\n      /**\n       * Creates Elements or Queries the DOM using CSS selectors\n       *\n       * @method $\n       * @memberOf utility\n       * @param  {Mixed} arg HTML, or Comma delimited string of CSS selectors\n       * @return {Array}     Array of matching Elements\n       * @example\n       * let $ = keigai.util.$;\n       *\n       * // Looking for Elements\n       * $( \".someClass\" ).forEach( ( i ) => {\n       *   ...\n       * } );\n       *\n       * // Creating an H1 Element\n       * $( \"&lt;h1&gt;\" ).forEach( ( i ) => {\n       *   ...\n       * } );\n       */\n      $: function (arg) {\n        var result = undefined;\n\n        // Nothing\n        if (!arg) {}\n        // HTML\n        else if (regex.html.test(arg)) {\n          result = [element.create(arg)];\n        }\n        // CSS selector(s)\n        else {\n          arg = string.trim(arg);\n\n          if (arg.indexOf(\",\") === -1) {\n            result = utility.dom(arg);\n\n            if (result) {\n              if (isNaN(result.length)) {\n                result = [result];\n              }\n            } else {\n              result = [];\n            }\n          } else {\n            result = [];\n\n            array.each(string.explode(arg), function (query) {\n              var obj = utility.dom(query);\n\n              if (obj instanceof Array) {\n                result = result.concat(obj);\n              } else if (obj) {\n                result.push(obj);\n              }\n            });\n          }\n        }\n\n        return result;\n      },\n\n      /**\n       * Creates an instance of Base\n       *\n       * @method base\n       * @memberOf utility\n       * @param  {Object} arg [Optional] Decorative Object\n       * @return {Object}     Instance of Base\n       */\n      base: function (arg) {\n        var obj = new Base();\n\n        if (arg instanceof Object) {\n          utility.merge(obj, arg);\n        }\n\n        obj.observer = observable.factory();\n\n        return obj;\n      },\n\n      /**\n       * Blob factory\n       *\n       * @method blob\n       * @memberOf utility\n       * @param  {String} arg String to convert to a Blob\n       * @return {Object}     Blob\n       * @private\n       */\n      blob: function (arg) {\n        var obj = undefined;\n\n        try {\n          obj = new Blob([arg], { type: \"application/javascript\" });\n        } catch (e) {\n          if (!global.BlobBuilder) {\n            global.BlobBuilder = global.MSBlobBuilder || global.WebKitBlobBuilder || global.MozBlobBuilder;\n          }\n\n          obj = new global.BlobBuilder().append(arg).getBlob();\n        }\n\n        return obj;\n      },\n\n      /**\n       * Clears deferred & repeating functions\n       *\n       * @method clearTimers\n       * @memberOf utility\n       * @param  {String} id ID of timer( s )\n       * @return {Undefined} undefined\n       * @example\n       * keigai.util.clearTimers( 'helloWorld' );\n       */\n      clearTimers: function (id) {\n        // deferred\n        if (utility.timer[id]) {\n          clearTimeout(utility.timer[id]);\n          delete utility.timer[id];\n        }\n\n        // repeating\n        if (utility.repeating[id]) {\n          clearTimeout(utility.repeating[id]);\n          delete utility.repeating[id];\n        }\n      },\n\n      /**\n       * Clones an Object\n       *\n       * @method clone\n       * @memberOf utility\n       * @param  {Object}  obj     Object to clone\n       * @param  {Boolean} shallow [Optional] Create a shallow clone, which doesn't maintain prototypes, default is `false`\n       * @return {Object}          Clone of obj\n       * @example\n       * let x = {a: true, b: false},\n       *     y = keigai.util.clone( x, true );\n       *\n       * y.a; // true\n       */\n      clone: function (obj, shallow) {\n        var clone = undefined,\n            result = undefined;\n\n        if (shallow === true) {\n          return obj !== undefined && obj !== null ? json.decode(json.encode(obj)) : obj;\n        } else if (!obj || regex.primitive.test(typeof obj) || obj instanceof RegExp) {\n          return obj;\n        } else if (obj instanceof Array) {\n          result = [];\n\n          array.each(obj, function (i, idx) {\n            result[idx] = utility.clone(i);\n          });\n\n          return result;\n        } else if (!server && !client.ie && obj instanceof Document) {\n          return xml.decode(xml.encode(obj));\n        } else if (typeof obj.__proto__ != \"undefined\") {\n          return utility.extend(obj.__proto__, obj);\n        } else if (obj instanceof Object) {\n          // If JSON encoding fails due to recursion, the original Object is returned because it's assumed this is for decoration\n          clone = json.encode(obj, true);\n\n          if (clone !== undefined) {\n            clone = json.decode(clone);\n\n            // Decorating Functions that would be lost with JSON encoding/decoding\n            utility.iterate(obj, function (v, k) {\n              if (typeof v == \"function\") {\n                clone[k] = v;\n              }\n            });\n          } else {\n            clone = obj;\n          }\n\n          return clone;\n        } else {\n          return obj;\n        }\n      },\n\n      /**\n       * Coerces a String to a Type\n       *\n       * @method coerce\n       * @memberOf utility\n       * @param  {String} value String to coerce\n       * @return {Mixed}        Primitive version of the String\n       * @example\n       * keigai.util.coerce( \"1\" ); // 1\n       */\n      coerce: function (value) {\n        var tmp = undefined;\n\n        if (value === null || value === undefined) {\n          return undefined;\n        } else if (value === \"true\") {\n          return true;\n        } else if (value === \"false\") {\n          return false;\n        } else if (value === \"null\") {\n          return null;\n        } else if (value === \"undefined\") {\n          return undefined;\n        } else if (value === \"\") {\n          return value;\n        } else if (!isNaN(tmp = Number(value))) {\n          return tmp;\n        } else if (regex.json_wrap.test(value)) {\n          return json.decode(value, true) || value;\n        } else {\n          return value;\n        }\n      },\n\n      /**\n       * Recompiles a RegExp by reference\n       *\n       * This is ideal when you need to recompile a regex for use within a conditional statement\n       *\n       * @method compile\n       * @memberOf utility\n       * @param  {Object} regex     RegExp\n       * @param  {String} pattern   Regular expression pattern\n       * @param  {String} modifiers Modifiers to apply to the pattern\n       * @return {Boolean}          true\n       * @private\n       */\n      compile: function (reg, pattern, modifiers) {\n        reg.compile(pattern, modifiers);\n\n        return true;\n      },\n\n      /**\n       * Curries a Function\n       *\n       * Note: Function to curry must return a Function\n       *\n       * @method curry\n       * @memberOf utility\n       * @return {Function} Curried Function\n       * @example\n       * function f ( a, b ) {\n       *   return ( n ) => {\n       *     return ( a + b ) * n;\n       *   };\n       * }\n       *\n       * let g = keigai.util.curry( f, 2, 8 );\n       *\n       * g( 5 ); // 50\n       */\n      curry: function (fn) {\n        for (var _len14 = arguments.length, args = Array(_len14 > 1 ? _len14 - 1 : 0), _key14 = 1; _key14 < _len14; _key14++) {\n          args[_key14 - 1] = arguments[_key14];\n        }\n\n        var cfn = fn.apply(fn, args);\n\n        return function () {\n          for (var _len15 = arguments.length, args = Array(_len15), _key15 = 0; _key15 < _len15; _key15++) {\n            args[_key15] = arguments[_key15];\n          }\n\n          return cfn.apply(cfn, args);\n        };\n      },\n\n      /**\n       * Defers the execution of Function by at least the supplied milliseconds.\n       * Timing may vary under \"heavy load\" relative to the CPU & client JavaScript engine.\n       *\n       * @method defer\n       * @memberOf utility\n       * @param  {Function} fn     Function to defer execution of\n       * @param  {Number}   ms     Milliseconds to defer execution\n       * @param  {Number}   id     [Optional] ID of the deferred function\n       * @param  {Boolean}  repeat [Optional] Describes the execution, default is `false`\n       * @return {String}          ID of the timer\n       * @example\n       * keigai.util.defer( () => {\n       *   console.log( 'hello world' );\n       * }, 1000, 'helloWorld', true );\n       */\n      defer: function (fn, ms, id) {\n        var ms = arguments[1] === undefined ? 0 : arguments[1];\n        var repeat = arguments[3] === undefined ? false : arguments[3];\n        var op = undefined;\n\n        if (id !== undefined) {\n          utility.clearTimers(id);\n        } else {\n          id = utility.uuid(true);\n        }\n\n        op = function () {\n          utility.clearTimers(id);\n          fn();\n        };\n\n        utility[repeat ? \"repeating\" : \"timer\"][id] = setTimeout(op, ms);\n\n        return id;\n      },\n\n      /**\n       * Async delay strategy\n       *\n       * @method delay\n       * @memberOf promise\n       * @return {Function} Delay method\n       * @private\n       */\n      delay: (function () {\n        if (typeof setImmediate != \"undefined\") {\n          return function (arg) {\n            setImmediate(arg);\n          };\n        } else if (typeof process != \"undefined\") {\n          return process.nextTick;\n        } else {\n          return function (arg) {\n            setTimeout(arg, 0);\n          };\n        }\n      })(),\n\n      /**\n       * Queries DOM with fastest method\n       *\n       * @method dom\n       * @memberOf utility\n       * @param  {String} arg DOM query\n       * @return {Mixed}      undefined, Element, or Array of Elements\n       * @private\n       */\n      dom: function (arg) {\n        var result = undefined;\n\n        if (!regex.selector_complex.test(arg)) {\n          if (regex.hash.test(arg)) {\n            result = document.getElementById(arg.replace(regex.hash, \"\")) || undefined;\n          } else if (regex.klass.test(arg)) {\n            result = array.cast(document.getElementsByClassName(arg.replace(regex.klass, \"\")));\n          } else if (regex.word.test(arg)) {\n            result = array.cast(document.getElementsByTagName(arg));\n          } else {\n            result = array.cast(document.querySelectorAll(arg));\n          }\n        } else {\n          result = array.cast(document.querySelectorAll(arg));\n        }\n\n        return result;\n      },\n\n      /**\n       * Encodes a UUID to a DOM friendly ID\n       *\n       * @method domId\n       * @memberOf utility\n       * @param  {String} UUID\n       * @return {String} DOM friendly ID\n       * @private\n       */\n      domId: function (arg) {\n        return \"a\" + arg.replace(/-/g, \"\").slice(1);\n      },\n\n      /**\n       * Error handling, with history in `error.log`\n       *\n       * @method error\n       * @memberOf utility\n       * @param  {Mixed}   e       Error object or message to display\n       * @param  {Array}   args    Array of arguments from the callstack\n       * @param  {Mixed}   scope   Entity that was \"this\"\n       * @param  {Boolean} warning [Optional] Will display as console warning if true\n       * @return {Undefined}       undefined\n       * @private\n       */\n      error: function (e, args, scope, warning) {\n        var o = {\n          arguments: args ? array.cast(args) : [],\n          message: e.message || e,\n          number: e.number ? e.number & 65535 : undefined,\n          scope: scope,\n          stack: e.stack || undefined,\n          timestamp: new Date().toUTCString(),\n          type: e.type || \"TypeError\"\n        };\n\n        utility.log(o.stack || o.message, warning !== true ? \"error\" : \"warn\");\n\n        return undefined;\n      },\n\n      /**\n       * Creates a \"class\" extending Object, with optional decoration. SuperClass can be called from `super` property.\n       *\n       * @method extend\n       * @memberOf utility\n       * @param  {Object} obj Object to extend\n       * @param  {Object} arg [Optional] Object for decoration\n       * @return {Object}     Decorated obj\n       * @example\n       * let extendObj = keigai.util.extend( someObj, {newProperty: value} );\n       */\n      extend: function (obj, arg) {\n        var o = Object.create(obj);\n\n        if (arg instanceof Object) {\n          utility.merge(o, arg);\n        }\n\n        o[\"super\"] = obj;\n\n        return o;\n      },\n\n      /**\n       * Generates an ID value\n       *\n       * @method genId\n       * @memberOf utility\n       * @param  {Mixed}   obj [Optional] Object to receive id\n       * @param  {Boolean} dom [Optional] Verify the ID is unique in the DOM, default is false\n       * @return {Mixed}       Object or id\n       * @example\n       * let id = keigai.util.genId();\n       */\n      genId: function (obj) {\n        var dom = arguments[1] === undefined ? false : arguments[1];\n        var id = undefined;\n\n        if (obj && (obj.id || obj instanceof Array || (typeof obj == \"string\" || obj instanceof String))) {\n          return obj;\n        }\n\n        if (dom) {\n          do {\n            id = utility.domId(utility.uuid(true));\n          } while (utility.dom(\"#\" + id));\n        } else {\n          id = utility.domId(utility.uuid(true));\n        }\n\n        if (obj && typeof obj == \"object\") {\n          obj.id = id;\n\n          return obj;\n        } else {\n          return id;\n        }\n      },\n\n      /**\n       * Iterates an Object and executes a function against the properties.\n       * Returning `false` halts iteration.\n       *\n       * @method iterate\n       * @memberOf utility\n       * @param  {Object}   obj Object to iterate\n       * @param  {Function} fn  Function to execute against properties\n       * @return {Object}       Object\n       * @example\n       * keigai.util.iterate( {...}, ( value, key ) => {\n       *   ...\n       * } );\n       */\n      iterate: function (obj, fn) {\n        array.each(Object.keys(obj), function (i) {\n          return fn.call(obj, obj[i], i);\n        });\n\n        return obj;\n      },\n\n      /**\n       * Writes argument to the console\n       *\n       * @method log\n       * @memberOf utility\n       * @param  {String} arg    String to write to the console\n       * @param  {String} target [Optional] Target console, default is \"log\"\n       * @return {Undefined}     undefined\n       * @example\n       * keigai.util.log( \"Something bad happened\", \"warn\" );\n       */\n      log: (function () {\n        if (typeof console != \"undefined\") {\n          return function (arg) {\n            var target = arguments[1] === undefined ? \"log\" : arguments[1];\n            var ts = typeof arg != \"object\";\n            var msg = ts ? \"[\" + new Date().toLocaleTimeString() + \"] \" + arg : arg;\n\n            console[target](msg);\n          };\n        } else {\n          return function () {};\n        }\n      })(),\n\n      /**\n       * Merges obj with arg\n       *\n       * @method merge\n       * @memberOf utility\n       * @param  {Object} obj Object to decorate\n       * @param  {Object} arg Decoration\n       * @return {Object}     Decorated Object\n       * @example\n       * let obj = {a: true};\n       *\n       * keigai.util.merge( obj, {b: false} )\n       * console.log(obj); // {a: true, b: false}\n       */\n      merge: function (obj, arg) {\n        var keys = array.keys(obj);\n\n        utility.iterate(arg, function (v, k) {\n          if (!array.contains(keys, k) || v instanceof Function) {\n            obj[k] = v;\n          } else if (obj[k] instanceof Array && v instanceof Array) {\n            array.merge(obj[k], v);\n          } else if (v instanceof Function) {\n            obj[k] = v;\n          } else if (obj[k] instanceof Object && v instanceof Object) {\n            utility.iterate(v, function (x, y) {\n              obj[k][y] = utility.clone(x);\n            });\n          } else {\n            obj[k] = utility.clone(v);\n          }\n        });\n\n        return obj;\n      },\n\n      /**\n       * Parses a URI into an Object\n       *\n       * @method parse\n       * @memberOf utility\n       * @param  {String} uri URI to parse\n       * @return {Object}     Parsed URI\n       * @example\n       * let parsed = keigai.util.parse( location.href );\n       *\n       * parsed;\n       * {\n       *   auth     : \"\",\n       *   hash     : \"\",\n       *   host     : \"\",\n       *   hostname : \"\",\n       *   query    : {},\n       *   pathname : \"\",\n       *   port     : n,\n       *   protocol : \"\",\n       *   search   : \"\",\n       * }\n       */\n      parse: function (uri) {\n        var obj = {};\n        var parsed = {};\n        var host = undefined,\n            protocol = undefined;\n\n        if (uri === undefined) {\n          uri = !server ? location.href : \"\";\n        }\n\n        if (!server) {\n          obj = document.createElement(\"a\");\n          obj.href = uri;\n          host = obj.href.match(regex.host)[1];\n          protocol = obj.href.match(regex.protocol)[1];\n        } else {\n          obj = url.parse(uri);\n        }\n\n        if (server) {\n          utility.iterate(obj, function (v, k) {\n            if (v === null) {\n              obj[k] = undefined;\n            }\n          });\n        }\n\n        parsed = {\n          auth: server ? null : regex.auth.exec(uri),\n          protocol: obj.protocol || protocol,\n          hostname: obj.hostname || host,\n          port: obj.port ? number.parse(obj.port, 10) : \"\",\n          pathname: obj.pathname,\n          search: obj.search || \"\",\n          hash: obj.hash || \"\",\n          host: obj.host || host\n        };\n\n        // 'cause IE is ... IE; required for data.batch()\n        if (client.ie) {\n          if (parsed.protocol === \":\") {\n            parsed.protocol = location.protocol;\n          }\n\n          if (string.isEmpty(parsed.hostname)) {\n            parsed.hostname = location.hostname;\n          }\n\n          if (string.isEmpty(parsed.host)) {\n            parsed.host = location.host;\n          }\n\n          if (parsed.pathname.charAt(0) !== \"/\") {\n            parsed.pathname = \"/\" + parsed.pathname;\n          }\n        }\n\n        parsed.auth = obj.auth || (parsed.auth === null ? \"\" : parsed.auth[1]);\n        parsed.href = obj.href || parsed.protocol + \"//\" + (string.isEmpty(parsed.auth) ? \"\" : parsed.auth + \"@\") + parsed.host + parsed.pathname + parsed.search + parsed.hash;\n        parsed.path = obj.path || parsed.pathname + parsed.search;\n        parsed.query = utility.queryString(null, parsed.search);\n\n        return parsed;\n      },\n\n      /**\n       * Creates a partially applied Function\n       *\n       * @method partial\n       * @memberOf utility\n       * @return {Function} Partial Function\n       * @example\n       * function f ( a, b ) {\n       *   return a + b;\n       * }\n       *\n       * let g = keigai.util.partial( f, 2 );\n       *\n       * g( 2 ); // 4\n       */\n      partial: function (fn) {\n        for (var _len16 = arguments.length, args = Array(_len16 > 1 ? _len16 - 1 : 0), _key16 = 1; _key16 < _len16; _key16++) {\n          args[_key16 - 1] = arguments[_key16];\n        }\n\n        return function () {\n          for (var _len17 = arguments.length, args2 = Array(_len17), _key17 = 0; _key17 < _len17; _key17++) {\n            args2[_key17] = arguments[_key17];\n          }\n\n          return fn.apply(fn, args.concat(args2));\n        };\n      },\n\n      /**\n       * Prevents default behavior of an Event\n       *\n       * @method prevent\n       * @memberOf utility\n       * @param  {Object} ev Event\n       * @return {Object}    Event\n       * @example\n       * keigai.util.prevent( Event );\n       */\n      prevent: function (ev) {\n        if (typeof ev.preventDefault == \"function\") {\n          ev.preventDefault();\n        }\n\n        return ev;\n      },\n\n      /**\n       * Parses a query string & coerces values\n       *\n       * @method queryString\n       * @memberOf utility\n       * @param  {String} arg     [Optional] Key to find in the querystring\n       * @param  {String} qstring [Optional] Query string to parse\n       * @return {Mixed}          Value or Object of key:value pairs\n       * @private\n       */\n      queryString: function (arg, qstring) {\n        var obj = {};\n        var result = qstring !== undefined ? qstring.indexOf(\"?\") > -1 ? qstring.replace(/.*\\?/, \"\") : null : server || string.isEmpty(location.search) ? null : location.search.replace(\"?\", \"\");\n\n        if (result !== null && !string.isEmpty(result)) {\n          result = result.split(\"&\");\n          array.each(result, function (prop) {\n            var item = prop.split(\"=\");\n\n            if (string.isEmpty(item[0])) {\n              return;\n            }\n\n            if (item[1] === undefined) {\n              item[1] = \"\";\n            } else {\n              item[1] = utility.coerce(decodeURIComponent(item[1]));\n            }\n\n            if (obj[item[0]] === undefined) {\n              obj[item[0]] = item[1];\n            } else if (!(obj[item[0]] instanceof Array)) {\n              obj[item[0]] = [obj[item[0]]];\n              obj[item[0]].push(item[1]);\n            } else {\n              obj[item[0]].push(item[1]);\n            }\n          });\n        }\n\n        if (arg !== null && arg !== undefined) {\n          obj = obj[arg];\n        }\n\n        return obj;\n      },\n\n      /**\n       * Accepts Deferreds or Promises as arguments, or an Array of either\n       *\n       * @method race\n       * @memberOf utility\n       * @return {Object} {@link keigai.Deferred}\n       * @example\n       * let deferreds = [],\n       *     defer1    = keigai.util.defer(),\n       *     defer2    = keigai.util.defer();\n       *\n       * deferreds.push( defer1 );\n       * deferreds.push( defer2 );\n       *\n       * // Executes when one deferred is resolved or rejected\n       * keigai.util.race( deferreds ).then( ( arg ) ) => {\n       *   ...\n       * }, ( err ) => {\n       *   ...\n       * } );\n       *\n       * ...\n       *\n       * defer1.resolve( true );\n       * defer2.resolve( true );\n       */\n      race: function () {\n        for (var _len18 = arguments.length, args = Array(_len18), _key18 = 0; _key18 < _len18; _key18++) {\n          args[_key18] = arguments[_key18];\n        }\n\n        var defer = deferred.factory();\n\n        // Did we receive an Array? if so it overrides any other arguments\n        if (args[0] instanceof Array) {\n          args = args[0];\n        }\n\n        // None, end on next tick\n        if (args.length === 0) {\n          defer.resolve(null);\n        }\n        // Setup and wait\n        else {\n          Promise.race(args).then(function (results) {\n            defer.resolve(results);\n          }, function (e) {\n            defer.reject(e);\n          });\n        }\n\n        return defer;\n      },\n\n      /**\n       * Asynchronous DOM rendering (cannot be cancelled, suggested for reactive behavior)\n       *\n       * @method render\n       * @memberOf utility\n       * @param  {Function} fn Function to execute on next 'frame'\n       * @return {Object} {@link keigai.Deferred}\n       * @example\n       * keigai.util.render( () => {\n       *     return keitai.util.element.html( document.querySelector( \"#id\" ), \"Hello World\" )\n       * } ).then( ( arg ) => {\n       *     // arg is the return value of your function\n       * }, ( e ) => {\n       *     // Handle e\n       * } );\n       */\n      render: function (fn) {\n        var defer = deferred.factory();\n\n        RENDER(function (arg) {\n          try {\n            defer.resolve(fn(arg));\n          } catch (e) {\n            defer.reject(e);\n          }\n        });\n\n        return defer;\n      },\n\n      /**\n       * Creates a recursive function. Return false from the function to halt recursion.\n       *\n       * @method repeat\n       * @memberOf utility\n       * @param  {Function} fn  Function to execute repeatedly\n       * @param  {Number}   ms  Milliseconds to stagger the execution\n       * @param  {String}   id  [Optional] Timeout ID\n       * @param  {Boolean}  now Executes `fn` and then setup repetition, default is `true`\n       * @return {String}       Timeout ID\n       * @example\n       * keigai.util.repeat( () => {\n       *   ...\n       *\n       *   // Cancelling repetition at some point in the future\n       *   if ( someCondition ) {\n       *     return false;\n       *   }\n       * }, 1000, \"repeating\" );\n       */\n      repeat: function (fn) {\n        var ms = arguments[1] === undefined ? 10 : arguments[1];\n        var id = arguments[2] === undefined ? utility.uuid(true) : arguments[2];\n        var now = arguments[3] === undefined ? true : arguments[3];\n        return (function () {\n          // Could be valid to return false from initial execution\n          if (now && fn() === false) {\n            return;\n          }\n\n          // Creating repeating execution\n          utility.defer(function () {\n            var recursive = function (fn, ms, id) {\n              if (fn() !== false) {\n                utility.repeating[id] = setTimeout(function () {\n                  recursive.call(recursive, fn, ms, id);\n                }, ms);\n              } else {\n                delete utility.repeating[id];\n              }\n            };\n\n            recursive(fn, ms, id);\n          }, ms, id, true);\n\n          return id;\n        })();\n      },\n\n      /**\n       * Stops an Event from bubbling, & prevents default behavior\n       *\n       * @method stop\n       * @memberOf utility\n       * @param  {Object} ev Event\n       * @return {Object}    Event\n       * @example\n       * keigai.util.stop( Event );\n       */\n      stop: function (ev) {\n        if (typeof ev.stopPropagation == \"function\") {\n          ev.stopPropagation();\n        }\n\n        utility.prevent(ev);\n\n        return ev;\n      },\n\n      /**\n       * Returns the Event target\n       *\n       * @method target\n       * @memberOf utility\n       * @param  {Object} ev Event\n       * @return {Object}    Event target\n       * @example\n       * let target = keigai.util.target( Event );\n       */\n      target: function (ev) {\n        return ev.target || ev.srcElement;\n      },\n\n      /**\n       * Generates a version 4 UUID\n       *\n       * @method uuid\n       * @memberOf utility\n       * @param  {Boolean} strip [Optional] Strips - from UUID\n       * @return {String}        UUID\n       * @example\n       * let uuid4 = keigai.util.uuid();\n       */\n      uuid: function (strip) {\n        var r = [8, 9, \"a\", \"b\"];\n        var s = function () {\n          return ((1 + Math.random()) * 65536 | 0).toString(16).substring(1);\n        };\n        var o = s() + s() + \"-\" + s() + \"-4\" + s().substr(0, 3) + \"-\" + r[Math.floor(Math.random() * 4)] + s().substr(0, 3) + \"-\" + s() + s() + s();\n\n        if (strip === true) {\n          o = o.replace(/-/g, \"\");\n        }\n\n        return o;\n      },\n\n      /**\n       * Walks `obj` and returns `arg`, for when you can't easily access `arg`\n       *\n       * @method  walk\n       * @memberOf utility\n       * @param  {Mixed}  obj  Object or Array\n       * @param  {String} arg  String describing the property to return\n       * @return {Mixed}       Target or undefined\n       * @example\n       * let obj = {a: [{b: true}]};\n       *\n       * keigai.util.walk( obj, \"a[0].b\" ); // true\n       */\n      walk: function (obj, arg) {\n        var output = obj;\n\n        array.each(arg.replace(/\\]$/, \"\").replace(/\\]/g, \".\").replace(/\\.\\./g, \".\").split(/\\.|\\[/), function (i) {\n          if (output[i] === undefined || output[i] === null) {\n            output = undefined;\n            return false;\n          }\n\n          output = output[i];\n        });\n\n        return output;\n      },\n\n      /**\n       * Accepts Deferreds or Promises as arguments, or an Array of either\n       *\n       * @method when\n       * @memberOf utility\n       * @return {Object} {@link keigai.Deferred}\n       * @example\n       * let deferreds = [],\n       *     defer1    = keigai.util.defer(),\n       *     defer2    = keigai.util.defer();\n       *\n       * deferreds.push( defer1 );\n       * deferreds.push( defer2 );\n       *\n       * // Executes when both deferreds have resolved or one has rejected\n       * keigai.util.when( deferreds ).then( ( args ) ) => {\n       *   ...\n       * }, ( err ) => {\n       *   ...\n       * } );\n       *\n       * ...\n       *\n       * defer1.resolve( true );\n       * defer2.resolve( true );\n       */\n      when: function () {\n        for (var _len19 = arguments.length, args = Array(_len19), _key19 = 0; _key19 < _len19; _key19++) {\n          args[_key19] = arguments[_key19];\n        }\n\n        var defer = deferred.factory();\n\n        // Did we receive an Array? if so it overrides any other arguments\n        if (args[0] instanceof Array) {\n          args = args[0];\n        }\n\n        // None, end on next tick\n        if (args.length === 0) {\n          defer.resolve(null);\n        }\n        // Setup and wait\n        else {\n          Promise.all(args).then(function (results) {\n            defer.resolve(results);\n          }, function (e) {\n            defer.reject(e);\n          });\n        }\n\n        return defer;\n      },\n\n      /**\n       * Worker factory\n       *\n       * @method worker\n       * @memberOf utility\n       * @param  {Object} defer Deferred to receive message from Worker\n       * @return {Object}       Worker\n       * @private\n       */\n      worker: function (defer) {\n        var obj = new Worker(WORKER);\n\n        obj.onerror = function (err) {\n          defer.reject(err);\n          obj.terminate();\n        };\n\n        obj.onmessage = function (ev) {\n          defer.resolve(ev.data);\n          obj.terminate();\n        };\n\n        return obj;\n      }\n    };\n\n    /**\n     * XMLHttpRequest shim for node.js\n     *\n     * @method xhr\n     * @private\n     * @return {Object} XMLHttpRequest instance\n     */\n    var xhr = function () {\n      var UNSENT = 0;\n      var OPENED = 1;\n      var HEADERS_RECEIVED = 2;\n      var LOADING = 3;\n      var DONE = 4;\n      var ERR_REFUSED = /ECONNREFUSED/;\n      var ready = new RegExp(HEADERS_RECEIVED + \"|\" + LOADING);\n\n      var headers = {\n        \"user-agent\": \"keigai/1.1.0 node.js/\" + process.versions.node.replace(/^v/, \"\") + \" (\" + string.capitalize(process.platform) + \" V8/\" + process.versions.v8 + \" )\",\n        \"content-type\": \"text/plain\",\n        accept: \"*/*\"\n      };\n\n      /**\n       * Dispatches an event\n       *\n       * @method dispatch\n       * @memberOf xhr\n       * @param  {String} arg Event to dispatch\n       * @return {Object}     XMLHttpRequest instance\n       */\n      var dispatch = function (obj, arg) {\n        var fn = \"on\" + arg;\n\n        if (typeof obj[fn] == \"function\") {\n          obj[fn]();\n        }\n\n        obj.dispatchEvent(arg);\n\n        return obj;\n      };\n\n      /**\n       * Changes the readyState of an XMLHttpRequest\n       *\n       * @method state\n       * @memberOf xhr\n       * @param  {String} arg New readyState\n       * @return {Object}     XMLHttpRequest instance\n       */\n      var state = function (obj, arg) {\n        if (obj.readyState !== arg) {\n          obj.readyState = arg;\n          dispatch(obj, \"readystatechange\");\n\n          if (obj.readyState === DONE && !obj._error) {\n            dispatch(obj, \"load\");\n            dispatch(obj, \"loadend\");\n          }\n        }\n\n        return obj;\n      };\n\n      /**\n       * Response handler\n       *\n       * @method success\n       * @memberOf xhr\n       * @param  {Object} res HTTP(S) Response Object\n       * @return {Undefined}  undefined\n       */\n      var success = function (obj, res) {\n        state(obj, HEADERS_RECEIVED);\n        obj.status = res.statusCode;\n        obj._resheaders = res.headers;\n\n        if (obj._resheaders[\"set-cookie\"] && obj._resheaders[\"set-cookie\"] instanceof Array) {\n          obj._resheaders[\"set-cookie\"] = obj._resheaders[\"set-cookie\"].join(\";\");\n        }\n\n        res.on(\"data\", function (arg) {\n          res.setEncoding(\"utf8\");\n\n          if (obj._send) {\n            if (arg) {\n              obj.responseText += arg;\n            }\n\n            state(obj, LOADING);\n          }\n        });\n\n        res.on(\"end\", function () {\n          if (obj._send) {\n            state(obj, DONE);\n            obj._send = false;\n          }\n        });\n      };\n\n      /**\n       * Response error handler\n       *\n       * @method failure\n       * @memberOf xhr\n       * @param  {Object} e Error\n       * @return {Undefined} undefined\n       */\n      var failure = function (obj, e) {\n        obj.status = ERR_REFUSED.test(e.message) ? 503 : 500;\n        obj.statusText = \"\";\n        obj.responseText = e.message;\n        obj._error = true;\n        obj._send = false;\n        dispatch(obj, \"error\");\n        state(obj, DONE);\n      };\n\n      var XMLHttpRequest = (function (Base) {\n        /**\n         * Creates a new XMLHttpRequest\n         *\n         * @constructor\n         * @private\n         * @memberOf xhr\n         * @return {Object} XMLHttpRequest instance\n         */\n        function XMLHttpRequest() {\n          this.onabort = null;\n          this.onerror = null;\n          this.onload = null;\n          this.onloadend = null;\n          this.onloadstart = null;\n          this.onreadystatechange = null;\n          this.readyState = UNSENT;\n          this.response = null;\n          this.responseText = \"\";\n          this.responseType = \"\";\n          this.responseXML = null;\n          this.status = UNSENT;\n          this.statusText = \"\";\n          this.observer = observable.factory();\n\n          // Psuedo private for prototype chain\n          this._error = false;\n          this._headers = {};\n          this._params = {};\n          this._request = null;\n          this._resheaders = {};\n          this._send = false;\n        }\n\n        _inherits(XMLHttpRequest, Base);\n\n        _prototypeProperties(XMLHttpRequest, null, {\n          abort: {\n\n            /**\n             * Aborts a request\n             *\n             * @method abort\n             * @memberOf XMLHttpRequest\n             * @return {Object} XMLHttpRequest instance\n             */\n            value: function abort() {\n              if (this._request !== null) {\n                this._request.abort();\n                this._request = null;\n                this.responseText = \"\";\n                this.responseXML = \"\";\n                this._error = true;\n                this._headers = {};\n\n                if (this._send === true || ready.test(this.readyState)) {\n                  this._send = false;\n                  state(this, DONE);\n                }\n\n                dispatch(this, \"abort\");\n                this.readyState = UNSENT;\n              }\n\n              return this;\n            },\n            writable: true,\n            enumerable: true,\n            configurable: true\n          },\n          getAllResponseHeaders: {\n\n            /**\n             * Gets all response headers\n             *\n             * @method getAllResponseHeaders\n             * @memberOf XMLHttpRequest\n             * @return {Object} Response headers\n             */\n            value: function getAllResponseHeaders() {\n              var result = \"\";\n\n              if (this.readyState < HEADERS_RECEIVED) {\n                throw new Error(label.invalidStateNoHeaders);\n              }\n\n              utility.iterate(this._resheaders, function (v, k) {\n                result += k + \": \" + v + \"\\n\";\n              });\n\n              return result;\n            },\n            writable: true,\n            enumerable: true,\n            configurable: true\n          },\n          getResponseHeader: {\n\n            /**\n             * Gets a specific response header\n             *\n             * @method getResponseHeader\n             * @memberOf XMLHttpRequest\n             * @param  {String} header Header to get\n             * @return {String}        Response header value\n             */\n            value: function getResponseHeader(header) {\n              if (this.readyState < HEADERS_RECEIVED || this._error) {\n                throw new Error(label.invalidStateNoHeaders);\n              }\n\n              return this._resheaders[header] || this._resheaders[header.toLowerCase()];\n            },\n            writable: true,\n            enumerable: true,\n            configurable: true\n          },\n          open: {\n\n            /**\n             * Prepares an XMLHttpRequest instance to make a request\n             *\n             * @method open\n             * @memberOf XMLHttpRequest\n             * @param  {String}  method   HTTP method\n             * @param  {String}  url      URL to receive request\n             * @param  {Boolean} async    [Optional] Asynchronous request\n             * @param  {String}  user     [Optional] Basic auth username\n             * @param  {String}  password [Optional] Basic auth password\n             * @return {Object}           XMLHttpRequest instance\n             */\n            value: function open(method, url, async, user, password) {\n              var self = this;\n\n              if (async !== true) {\n                throw new Error(label.invalidStateNoSync);\n              }\n\n              this.abort();\n              this._error = false;\n              this._params = {\n                method: method,\n                url: url,\n                async: async || true,\n                user: user || null,\n                password: password || null\n              };\n\n              utility.iterate(headers, function (v, k) {\n                self._headers[k] = v;\n              });\n\n              this.readyState = OPENED;\n\n              return this;\n            },\n            writable: true,\n            enumerable: true,\n            configurable: true\n          },\n          overrideMimeType: {\n\n            /**\n             * Overrides the Content-Type of the request\n             *\n             * @method overrideMimeType\n             * @memberOf XMLHttpRequest\n             * @param  {String} mime Mime type of the request ( media type )\n             * @return {Object}      XMLHttpRequest instance\n             */\n            value: function overrideMimeType(mime) {\n              this._headers[\"content-type\"] = mime;\n\n              return this;\n            },\n            writable: true,\n            enumerable: true,\n            configurable: true\n          },\n          send: {\n\n            /**\n             * Sends an XMLHttpRequest request\n             *\n             * @method send\n             * @memberOf XMLHttpRequest\n             * @param  {Mixed} data [Optional] Payload to send with the request\n             * @return {Object}     XMLHttpRequest instance\n             */\n            value: function send() {\n              var data = arguments[0] === undefined ? null : arguments[0];\n              var self = this;\n              var options = undefined,\n                  parsed = undefined,\n                  request = undefined,\n                  obj = undefined;\n\n              if (this.readyState < OPENED) {\n                throw new Error(label.invalidStateNotOpen);\n              } else if (this._send) {\n                throw new Error(label.invalidStateNotSending);\n              }\n\n              parsed = utility.parse(this._params.url);\n              parsed.port = parsed.port || (parsed.protocol === \"https:\" ? 443 : 80);\n\n              if (this._params.user !== null && this._params.password !== null) {\n                parsed.auth = this._params.user + \":\" + this._params.password;\n              }\n\n              // Specifying Content-Length accordingly\n              if (regex.put_post.test(this._params.method)) {\n                if (data === null) {\n                  this._headers[\"content-length\"] = 0;\n                } else if (typeof data == \"string\") {\n                  this._headers[\"content-length\"] = Buffer.byteLength(data);\n                } else if (data instanceof Buffer || typeof data.toString == \"function\") {\n                  data = data.toString();\n                  this._headers[\"content-length\"] = Buffer.byteLength(data);\n                } else {\n                  throw new Error(label.invalidArguments);\n                }\n              }\n\n              this._headers.host = parsed.host;\n\n              if (this._headers[\"x-requested-with\"] === \"XMLHttpRequest\") {\n                delete this._headers[\"x-requested-with\"];\n              }\n\n              options = {\n                hostname: parsed.hostname,\n                path: parsed.path,\n                port: parsed.port,\n                method: this._params.method,\n                headers: this._headers\n              };\n\n              if (parsed.protocol === \"https:\") {\n                options.rejectUnauthorized = false;\n                options.agent = false;\n              }\n\n              if (parsed.auth) {\n                options.auth = parsed.auth;\n              }\n\n              this._send = true;\n              dispatch(this, \"readystatechange\");\n\n              obj = parsed.protocol === \"http:\" ? http : https;\n\n              request = obj.request(options, function (arg) {\n                success(self, arg);\n              }).on(\"error\", function (e) {\n                failure(self, e);\n              });\n\n              data === null ? request.setSocketKeepAlive(true) : request.write(data, \"utf8\");\n              this._request = request;\n              request.end();\n\n              dispatch(this, \"loadstart\");\n\n              return this;\n            },\n            writable: true,\n            enumerable: true,\n            configurable: true\n          },\n          setRequestHeader: {\n\n            /**\n             * Sets a request header of an XMLHttpRequest instance\n             *\n             * @method setRequestHeader\n             * @memberOf XMLHttpRequest\n             * @param {String} header HTTP header\n             * @param {String} value  Header value\n             * @return {Object}       XMLHttpRequest instance\n             */\n            value: function setRequestHeader(header, value) {\n              if (this.readyState !== OPENED) {\n                throw new Error(label.invalidStateNotUsable);\n              } else if (this._send) {\n                throw new Error(label.invalidStateNotSending);\n              }\n\n              this._headers[header.toLowerCase()] = value;\n\n              return this;\n            },\n            writable: true,\n            enumerable: true,\n            configurable: true\n          }\n        });\n\n        return XMLHttpRequest;\n      })(Base);\n\n      return XMLHttpRequest;\n    };\n\n    /**\n     * WeakMap shim\n     *\n     * @class\n     * @private\n     */\n    var WeakMapShim = (function () {\n      function WeakMapShim() {\n        this.elements = {};\n      }\n\n      _prototypeProperties(WeakMapShim, null, {\n        clear: {\n          value: function clear() {\n            this.elements = {};\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        \"delete\": {\n          value: function _delete(arg) {\n            delete this.elements[arg];\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        has: {\n          value: function has(arg) {\n            return this.elements[arg] !== undefined;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        get: {\n          value: function get(arg) {\n            return this.has(arg) ? this.elements[arg].value : undefined;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        },\n        set: {\n          value: function set(arg, value) {\n            this.elements[arg] = { value: value };\n            return this;\n          },\n          writable: true,\n          enumerable: true,\n          configurable: true\n        }\n      });\n\n      return WeakMapShim;\n    })();\n\n    /**\n     * @namespace xml\n     * @private\n     */\n    var xml = {\n      /**\n       * Returns XML (Document) Object from a String\n       *\n       * @method decode\n       * @memberOf xml\n       * @param  {String} arg XML String\n       * @return {Object}     XML Object or undefined\n       */\n      decode: function (arg) {\n        return new DOMParser().parseFromString(arg, \"text/xml\");\n      },\n\n      /**\n       * Returns XML String from an Object or Array\n       *\n       * @method encode\n       * @memberOf xml\n       * @param  {Mixed} arg Object or Array to cast to XML String\n       * @return {String}    XML String or undefined\n       */\n      encode: function (arg) {\n        var wrap = arguments[1] === undefined ? true : arguments[1];\n        var top = arguments[2] === undefined ? true : arguments[2];\n        try {\n          var _ret = (function () {\n            var x = wrap ? \"<xml>\" : \"\";\n\n            /**\n             * Encodes a value as a node\n             *\n             * @method node\n             * @memberOf xml.encode\n             * @private\n             * @param  {String} name  Node name\n             * @param  {String} value Node value\n             * @return {String}       Node\n             */\n            var node = function (name, value) {\n              var output = \"<n>v</n>\";\n\n              output = output.replace(\"v\", regex.cdata.test(value) ? \"<![CDATA[\" + value + \"]]>\" : value);\n              return output.replace(/<(\\/)?n>/g, \"<$1\" + name + \">\");\n            };\n\n            if (arg !== null && arg.xml) {\n              arg = arg.xml;\n            }\n\n            if (arg instanceof Document) {\n              arg = new XMLSerializer().serializeToString(arg);\n            }\n\n            if (regex.boolean_number_string.test(typeof arg)) {\n              x += node(\"item\", arg);\n            } else if (typeof arg == \"object\") {\n              utility.iterate(arg, function (v, k) {\n                x += xml.encode(v, typeof v == \"object\", false).replace(/item|xml/g, isNaN(k) ? k : \"item\");\n              });\n            }\n\n            x += wrap ? \"</xml>\" : \"\";\n\n            if (top) {\n              x = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF8\\\"?>\" + x;\n            }\n\n            return {\n              v: x\n            };\n          })();\n\n          if (typeof _ret === \"object\") return _ret.v;\n        } catch (e) {\n          utility.error(e, [arg, wrap, top], _this);\n\n          return undefined;\n        }\n      },\n\n      /**\n       * Validates `arg` is XML\n       *\n       * @method valid\n       * @memberOf xml\n       * @param  {String} arg String to validate\n       * @return {Boolean}    `true` if valid XML\n       */\n      valid: function (arg) {\n        return xml.decode(arg).getElementsByTagName(\"parsererror\").length === 0;\n      }\n    };\n\n    /**\n     * Bootstraps environment\n     *\n     * @method bootstrap\n     * @private\n     * @return {Undefined} undefined\n     */\n    var bootstrap = function () {\n      var defineProperty = Object.defineProperty !== undefined;\n      var target = undefined;\n\n      Array.from = Array.from || function (arg) {\n        return [].slice.call(arg);\n      };\n\n      // Describing the Client\n      if (!server) {\n        client.version = client.version();\n\n        if (client.ie) {\n          (function () {\n            // IE8 and older is not supported\n            if (client.version < 9) {\n              throw new Error(label.upgrade);\n            }\n\n            target = (global.HTMLElement || global.Element).prototype;\n\n            var ClassList = (function (Array) {\n              function ClassList(obj) {\n                var classes = string.explode(obj.className, \" \");\n                var self = this;\n\n                array.each(classes, function (i) {\n                  self.push(i);\n                });\n              }\n\n              _inherits(ClassList, Array);\n\n              _prototypeProperties(ClassList, null, {\n                add: {\n                  value: function add(arg) {\n                    if (!array.contains(this, arg)) {\n                      this.push(arg);\n                      this.updateClassName();\n                    }\n                  },\n                  writable: true,\n                  enumerable: true,\n                  configurable: true\n                },\n                contains: {\n                  value: function contains(arg) {\n                    return array.contains(this, arg);\n                  },\n                  writable: true,\n                  enumerable: true,\n                  configurable: true\n                },\n                remove: {\n                  value: function remove(arg) {\n                    if (array.contains(this, arg)) {\n                      array.remove(this, arg);\n                      this.updateClassName();\n                    }\n                  },\n                  writable: true,\n                  enumerable: true,\n                  configurable: true\n                },\n                toggle: {\n                  value: function toggle(arg) {\n                    array[array.contains(this, arg) ? \"remove\" : \"add\"](this, arg);\n                    this.updateClassName();\n                  },\n                  writable: true,\n                  enumerable: true,\n                  configurable: true\n                },\n                updateClassName: {\n                  value: function updateClassName() {\n                    this.className = this.join(\" \");\n                  },\n                  writable: true,\n                  enumerable: true,\n                  configurable: true\n                }\n              });\n\n              return ClassList;\n            })(Array);\n\n            if (defineProperty) {\n              Object.defineProperty(target, \"classList\", {\n                get: function () {\n                  return new ClassList(_this);\n                },\n                enumerable: true,\n                configurable: true\n              });\n            } else if (Object.prototype.__defineGetter__) {\n              target.__defineGetter__(\"classList\", function () {\n                return new ClassList(_this);\n              });\n            } else {\n              throw new Error(\"Could not create classList shim\");\n            }\n\n            if (defineProperty) {\n              Object.defineProperty(Element, \"getElementsByClassName\", {\n                get: function (arg) {\n                  return _this.querySelectorAll(\".\" + arg);\n                },\n                enumerable: true,\n                configurable: true\n              });\n            } else if (Object.prototype.__defineGetter__) {\n              target.__defineGetter__(\"getElementsByClassName\", function (arg) {\n                return _this.querySelectorAll(\".\" + arg);\n              });\n            } else {\n              throw new Error(\"Could not create getElementsByClassName shim\");\n            }\n          })();\n        }\n      } else {\n        // XHR shim\n        XMLHttpRequest = xhr();\n      }\n\n      // WeakMap shim for client & server\n      if (WeakMap === null) {\n        WeakMap = WeakMapShim;\n      }\n\n      // DataStore Worker \"script\"\n      if (webWorker) {\n        WORKER = global.URL.createObjectURL(utility.blob(\"var \" + string.fromObject(array, \"array\") + \", \" + string.fromObject(regex, \"regex\") + \", \" + string.fromObject(string, \"string\") + \", \" + string.fromObject(utility, \"utility\") + \"; onmessage = \" + store.worker.toString() + \";\"));\n      }\n\n      TIME = new Date().getTime();\n\n      // Setting up `utility.render()`\n      RENDER = global.requestAnimationFrame || function (fn) {\n        var offset = new Date().getTime() - TIME;\n\n        utility.defer(function () {\n          fn(offset);\n        }, 16, offset);\n      };\n    };\n\n    // Bootstrapping\n    bootstrap();\n\n    // Interface\n    return {\n      filter: filter.factory,\n      list: list.factory,\n      grid: grid.factory,\n      store: store.factory,\n      util: {\n        $: utility.$,\n        array: array,\n        base: utility.base,\n        clearTimers: utility.clearTimers,\n        clone: utility.clone,\n        coerce: utility.coerce,\n        curry: utility.curry,\n        csv: csv,\n        defer: deferred.factory,\n        delay: utility.defer,\n        element: element,\n        extend: utility.extend,\n        genId: utility.genId,\n        iterate: utility.iterate,\n        json: json,\n        jsonp: client.jsonp,\n        log: utility.log,\n        lru: lru.factory,\n        math: math,\n        merge: utility.merge,\n        number: number,\n        observer: observable.factory,\n        parse: utility.parse,\n        partial: utility.partial,\n        prevent: utility.prevent,\n        race: utility.race,\n        render: utility.render,\n        repeat: utility.repeat,\n        request: client.request,\n        stop: utility.stop,\n        string: string,\n        target: utility.target,\n        uuid: utility.uuid,\n        walk: utility.walk,\n        when: utility.when\n      },\n      version: \"1.1.0\"\n    };\n  })();\n\n  // Node, AMD & window supported\n  if (typeof exports != \"undefined\") {\n    module.exports = lib;\n  } else if (typeof define == \"function\") {\n    define(function () {\n      return lib;\n    });\n  } else {\n    global.keigai = lib;\n  }\n})(this);"]}