{"version":3,"file":"keigai.min.js","sources":["keigai.js"],"names":["_inherits","subClass","superClass","TypeError","prototype","Object","create","constructor","value","enumerable","writable","configurable","__proto__","_prototypeProperties","child","staticProps","instanceProps","defineProperties","_classCallCheck","instance","Constructor","global","document","location","navigator","server","process","MAX","VERSIONS","CACHE","EVENTS","Buffer","Promise","undefined","localStorage","XMLHttpRequest","WeakMap","btoa","webWorker","Blob","Worker","external","format","http","https","mongodb","url","RENDER","TIME","WORKER","require","MongoClient","lib","regex","after_space","allow","allow_cors","and","args","auth","bool","caps","cdata","checked_disabled","complete_loaded","csv_quote","del","domain","down","endslash","eol_nl","element_update","get_headers","get_remove_set","hash","header_replace","header_value_replace","html","http_body","http_ports","host","ie","ip","is_xml","json_maybe","json_wrap","klass","no","not_dotnotation","not_endpoint","null_undefined","number","number_format_1","number_format_2","number_present","number_string","number_string_object","object_type","patch","primitive","priv","protocol","put_post","radio_checkbox","root","select","selector_is","selector_complex","set_del","space_hyphen","string_object","svg","top_bottom","word","xdomainrequest","xml","LRU","max","arguments","this","cache","first","last","length","evict","remove","get","key","item","set","previous","next","LRUItem","lru","factory","Observable","arg","limit","listeners","hooks","dispatch","ev","_len","Array","_key","utility","iterate","i","handler","apply","scope","hook","target","addEventListener","Error","label","invalidArguments","self","obj","off","id","on","_x","uuid","array","keys","once","unhook","removeEventListener","observable","Base","observer","listener","addListener","dispatchEvent","emit","removeListener","add","contains","push","binIndex","min","idx","val","Math","floor","cast","o","isNaN","from","chunk","size","result","nth","round","start","clear","clone","shallow","indexOf","collect","fn","map","compact","diff","filter","test","count","obj1","obj2","each","async","offset","call","repeat","eachReverse","empty","equal","json","encode","fill","l","flat","reduce","a","b","concat","forEach","fromObject","mingle","index","indexed","v","intersect","itr","iterator","done","keepIf","keySort","query","sub","replace","queries","string","explode","split","sorts","braceS","braceE","s","e","sort","Function","join","n","sorted","mean","sum","median","dupe","mid","odd","merge","mode","values","k","parse","range","rassoc","reject","end","remaining","slice","removeIf","removeWhile","rest","rindex","rotate","series","ceil","types","c","d","toString","divisor","total","low","lower","lowered","stddev","sqrt","variance","prev","cur","take","toObject","ar","unique","math","sqr","zip","x","expire","uri","expired","expires","Date","getTime","href","property","permission","KXMLHttpRequest","xhr","defer","deferred","client","ab","ArrayBuffer","blob","doc","Document","userAgent","version","trim","allows","verb","toLowerCase","bit","Boolean","permissions","cors","headers","type","getAllResponseHeaders","items","header","setSeconds","getSeconds","exec","timestamp","isEmpty","responseText","decode","csv","overrideMimeType","responseXML","valid","cached","partial","read","write","delete","unknown","jsonp","callback","cbid","keigai","genId","clearTimers","resolve","element","destroy","src","dom","requestTimeout","kxhr","Deferred","request","XDomainRequest","payload","contentType","notAvailable","state","readyState","status","_resheaders","response","delay","open","toUpperCase","hasOwnProperty","etag","setRequestHeader","withCredentials","xdr","shared","r","t","redirect","serverError","isUrl","Location","then","serverUnauthorized","serverForbidden","serverInvalidMethod","send","methodNotAllowed","scroll","dest","ms","scrollPos","pos","bezier","window","scrollTo","scrollX","scrollY","delimiter","RegExp","rows","shift","row","coerce","prepare","input","output","DataListFilter","list","debounce","filters","fields","teardown","update","escape","pageIndex","refresh","ref","attr","DataGrid","store","sortable","options","filtered","sortOrder","order","class","record","error","dump","records","find","data","where","field","stop","hasClass","splice","grid","template","width","css","trimmed","el","innerHTML","capitalize","unCamelCase","unhyphenate","style","data-field","addClass","parentNode","listFiltered","listFilter","currentTarget","DataList","current","emptyMsg","noData","mutation","pageSize","pageRange","pagination","placeholder","page","pages","more","data-page","removeClass","reg","registry","ceiling","match","walk","compile","li","render","callbacks","childNodes","reverse","$","lists","nodeName","MutationObserver","observe","childList","subtree","loaded","promise","onDone","onAlways","onFail","always","fail","success","failure","appendTo","appendChild","namespaceURI","getAttributeNS","setAttributeNS","selected","removeAttribute","setAttribute","getAttribute","reset","frag","fragment","body","createElementNS","createElement","prependChild","after","insertBefore","nextSibling","before","toCamelCase","removeChild","disable","disabled","bubbles","cancelable","CustomEvent","createEvent","initCustomEvent","enable","querySelectorAll","createDocumentFragment","has","classList","hidden","display","is","position","left","top","right","bottom","height","offsetWidth","offsetHeight","offsetParent","offsetTop","offsetLeft","removeAttr","removeAttributeNS","serialize","children","elements","name","encodeURIComponent","paddingLeft","paddingRight","borderLeft","borderRight","paddingTop","paddingBottom","borderTop","borderBottom","text","textContent","toggleClass","toggle","expectedProperty","checked","silent","JSON","stringify","expectedNumber","expectedObject","invalidStateNoHeaders","invalidStateNoSync","invalidStateNotOpen","invalidStateNotSending","invalidStateNotUsable","datastoreNoPrevVersion","upgrade","pop","P","S0","Q0","Q1","Q2","C0","C1","C2","C3","pow","dist","num1","num2","abs","even","every","p","charAt","substring","half","base","parseFloat","parseInt","random","direction","toFixed","pCatch","pResolve","pReject","pThen","catch","DataStore","autosave","credentials","events","Accept","ignore","indexes","source","versions","versioning","views","batch","sync","deferreds","when","reindex","save","buildUri","parsed","pathname","resave","delComplete","purge","custom","f","Number","results","databaseMoreThanOne","only","storage","tmp","setIndexes","restore","_this","functions","clauses","cond","worker","postMessage","cmd","b1","overwrite","method","odata","rdefer","ogdata","ndata","op","path","setComplete","change","setExpires","delimter","kdx","setUri","authorization","Authorization","decodeURIComponent","view","mongo","session","sessionStorage","connect","db","close","collection","_id","toArray","recs","rec","safe","w","upsert","defer2","getItem","removeItem","setItem","recordUri","undo","all","hyphenate","camel","isBoolean","isNumber","singular","toFunction","uncapitalize","timer","repeating","BlobBuilder","MSBlobBuilder","WebKitBlobBuilder","MozBlobBuilder","append","getBlob","clearTimeout","extend","pattern","modifiers","curry","cfn","_len2","_key2","setTimeout","setImmediate","nextTick","getElementById","getElementsByClassName","getElementsByTagName","domId","warning","message","stack","toUTCString","log","String","console","ts","msg","toLocaleTimeString","y","hostname","port","search","queryString","args2","prevent","preventDefault","qstring","prop","race","now","recursive","stopPropagation","srcElement","strip","substr","onerror","err","terminate","onmessage","UNSENT","OPENED","HEADERS_RECEIVED","LOADING","DONE","ERR_REFUSED","ready","user-agent","node","platform","v8","content-type","accept","_error","res","statusCode","setEncoding","_send","statusText","onabort","onload","onloadend","onloadstart","onreadystatechange","responseType","_headers","_params","_request","abort","getResponseHeader","user","password","mime","byteLength","rejectUnauthorized","agent","setSocketKeepAlive","WeakMapShim","DOMParser","parseFromString","wrap","_ret","XMLSerializer","serializeToString","boolean_number_string","bootstrap","defineProperty","HTMLElement","Element","ClassList","classes","className","updateClassName","__defineGetter__","URL","createObjectURL","requestAnimationFrame","util","exports","module","define"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _inherits = function (subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) subClass.__proto__ = superClass; };\n\nvar _prototypeProperties = function (child, staticProps, instanceProps) { if (staticProps) Object.defineProperties(child, staticProps); if (instanceProps) Object.defineProperties(child.prototype, instanceProps); };\n\nvar _classCallCheck = function (instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } };\n\n/**\n * Lightweight data store library, with a utility belt\n *\n * @author Jason Mulligan <jason.mulligan@avoidwork.com>\n * @copyright 2015 Jason Mulligan\n * @license BSD-3 <https://raw.github.com/avoidwork/keigai/master/LICENSE>\n * @link http://keigai.io\n * @module keigai\n * @version 1.1.5\n */\n(function (global) {\n\tvar document = global.document;\n\tvar location = global.location;\n\tvar navigator = global.navigator;\n\tvar server = typeof process != \"undefined\";\n\tvar MAX = 10;\n\tvar VERSIONS = 100;\n\tvar CACHE = 500;\n\tvar EVENTS = [\"readystatechange\", \"abort\", \"load\", \"loadstart\", \"loadend\", \"error\", \"progress\", \"timeout\"];\n\n\tvar Buffer = function () {};\n\tvar Promise = global.Promise || undefined;\n\tvar localStorage = global.localStorage || undefined;\n\tvar XMLHttpRequest = global.XMLHttpRequest || null;\n\tvar WeakMap = global.WeakMap || null;\n\tvar btoa = global.btoa || undefined;\n\tvar webWorker = typeof Blob != \"undefined\" && typeof Worker != \"undefined\";\n\tvar external = undefined,\n\t    format = undefined,\n\t    http = undefined,\n\t    https = undefined,\n\t    mongodb = undefined,\n\t    url = undefined,\n\t    RENDER = undefined,\n\t    TIME = undefined,\n\t    WORKER = undefined;\n\n\tif (server) {\n\t\turl = require(\"url\");\n\t\thttp = require(\"http\");\n\t\thttps = require(\"https\");\n\t\tmongodb = require(\"mongodb\").MongoClient;\n\t\tformat = require(\"util\").format;\n\t\tBuffer = require(\"buffer\").Buffer;\n\n\t\tif (typeof Promise === \"undefined\") {\n\t\t\tPromise = require(\"es6-promise\").Promise;\n\t\t}\n\n\t\tif (typeof localStorage === \"undefined\") {\n\t\t\tlocalStorage = require(\"localStorage\");\n\t\t}\n\n\t\tif (typeof btoa === \"undefined\") {\n\t\t\tbtoa = require(\"btoa\");\n\t\t}\n\t}\n\n\tvar lib = (function () {\n\t\t/**\n   * Regex patterns used through keigai\n   *\n   * `url` was authored by Diego Perini\n   *\n   * @namespace regex\n   * @private\n   * @type {Object}\n   */\n\t\tvar regex = {\n\t\t\tafter_space: /\\s+.*/,\n\t\t\tallow: /^allow$/i,\n\t\t\tallow_cors: /^access-control-allow-methods$/i,\n\t\t\tand: /^&/,\n\t\t\targs: /\\((.*)\\)/,\n\t\t\tauth: /\\/\\/(.*)\\@/,\n\t\t\tbool: /^(true|false)?$/,\n\t\t\tcaps: /[A-Z]/,\n\t\t\tcdata: /\\&|<|>|\\\"|\\'|\\t|\\r|\\n|\\@|\\$/,\n\t\t\tchecked_disabled: /checked|disabled/i,\n\t\t\tcomplete_loaded: /^(complete|loaded)$/i,\n\t\t\tcsv_quote: /^\\s|\\\"|\\n|,|\\s$/,\n\t\t\tdel: /^del/,\n\t\t\tdomain: /^[\\w.-_]+\\.[A-Za-z]{2,}$/,\n\t\t\tdown: /down/,\n\t\t\tendslash: /\\/$/,\n\t\t\teol_nl: /\\n$/,\n\t\t\telement_update: /id|innerHTML|innerText|textContent|type|src/,\n\t\t\tget_headers: /^(head|get|options)$/,\n\t\t\tget_remove_set: /get|remove|set/,\n\t\t\thash: /^\\#/,\n\t\t\theader_replace: /:.*/,\n\t\t\theader_value_replace: /.*:\\s+/,\n\t\t\thtml: /^<.*>$/,\n\t\t\thttp_body: /200|201|202|203|206/,\n\t\t\thttp_ports: /80|443/,\n\t\t\thost: /\\/\\/(.*)\\//,\n\t\t\tie: /msie|ie|\\.net|windows\\snt/i,\n\t\t\tip: /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,\n\t\t\tis_xml: /^<\\?xml.*\\?>/,\n\t\t\tjson_maybe: /json|plain|javascript/,\n\t\t\tjson_wrap: /^[\\[\\{]/,\n\t\t\tklass: /^\\./,\n\t\t\tno: /no-store|no-cache/i,\n\t\t\tnot_dotnotation: /-|\\s/,\n\t\t\tnot_endpoint: /.*\\//,\n\t\t\tnull_undefined: /null|undefined/,\n\t\t\tnumber: /(^-?\\d\\d*\\.\\d*$)|(^-?\\d\\d*$)|(^-?\\.\\d\\d*$)|number/,\n\t\t\tnumber_format_1: /.*\\./,\n\t\t\tnumber_format_2: /\\..*/,\n\t\t\tnumber_present: /\\d{1,}/,\n\t\t\tnumber_string: /number|string/i,\n\t\t\tnumber_string_object: /number|object|string/i,\n\t\t\tobject_type: /\\[object Object\\]/,\n\t\t\tpatch: /^patch$/,\n\t\t\tprimitive: /^(boolean|function|number|string)$/,\n\t\t\tpriv: /private/,\n\t\t\tprotocol: /^(.*)\\/\\//,\n\t\t\tput_post: /^(post|put)$/i,\n\t\t\tradio_checkbox: /^(radio|checkbox)$/i,\n\t\t\troot: /^\\/[^\\/]/,\n\t\t\tselect: /select/i,\n\t\t\tselector_is: /^:/,\n\t\t\tselector_complex: /\\s+|\\>|\\+|\\~|\\:|\\[/,\n\t\t\tset_del: /^(set|del|delete)$/,\n\t\t\tspace_hyphen: /\\s|-/,\n\t\t\tstring_object: /string|object/i,\n\t\t\tsvg: /svg/,\n\t\t\ttop_bottom: /top|bottom/i,\n\t\t\turl: /^(?:(?:https?|ftp):\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!10(?:\\.\\d{1,3}){3})(?!127(?:\\.\\d{1,3}){3})(?!169\\.254(?:\\.\\d{1,3}){2})(?!192\\.168(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:\\/[^\\s]*)?$/i,\n\t\t\tword: /^\\w+$/,\n\t\t\txdomainrequest: /^(get|post)$/i,\n\t\t\txml: /xml/i\n\t\t};\n\n\t\tvar LRU = (function () {\n\t\t\t/**\n    * Creates a new Least Recently Used cache\n    *\n    * @constructor\n    * @memberOf keigai\n    * @param  {Number} max [Optional] Max size of cache, default is 1000\n    * @example\n    * let lru = keigai.util.lru( 50 );\n    */\n\t\t\tfunction LRU() {\n\t\t\t\tvar max = arguments[0] === undefined ? 1000 : arguments[0];\n\t\t\t\t_classCallCheck(this, LRU);\n\n\t\t\t\tthis.cache = {};\n\t\t\t\tthis.max = max;\n\t\t\t\tthis.first = null;\n\t\t\t\tthis.last = null;\n\t\t\t\tthis.length = 0;\n\t\t\t}\n\n\t\t\t_prototypeProperties(LRU, null, {\n\t\t\t\tevict: {\n\n\t\t\t\t\t/**\n      * Evicts the least recently used item from cache\n      *\n      * @method evict\n      * @memberOf keigai.LRU\n      * @return {Object} {@link keigai.LRU}\n      * @example\n      * lru.evict();\n      */\n\t\t\t\t\tvalue: function evict() {\n\t\t\t\t\t\tif (this.last !== null) {\n\t\t\t\t\t\t\tthis.remove(this.last);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tget: {\n\n\t\t\t\t\t/**\n      * Gets cached item and moves it to the front\n      *\n      * @method get\n      * @memberOf keigai.LRU\n      * @param  {String} key Item key\n      * @return {Object} {@link keigai.LRUItem}\n      * @example\n      * let item = lru.get( \"key\" );\n      */\n\t\t\t\t\tvalue: function get(key) {\n\t\t\t\t\t\tvar item = this.cache[key];\n\n\t\t\t\t\t\tif (item === undefined) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.set(key, item.value);\n\n\t\t\t\t\t\treturn item.value;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tremove: {\n\n\t\t\t\t\t/**\n      * Removes item from cache\n      *\n      * @method remove\n      * @memberOf keigai.LRU\n      * @param  {String} key Item key\n      * @return {Object} {@link keigai.LRUItem}\n      * @example\n      * lru.remove( \"key\" );\n      */\n\t\t\t\t\tvalue: function remove(key) {\n\t\t\t\t\t\tvar item = this.cache[key];\n\n\t\t\t\t\t\tif (item) {\n\t\t\t\t\t\t\tdelete this.cache[key];\n\n\t\t\t\t\t\t\tthis.length--;\n\n\t\t\t\t\t\t\tif (item.previous !== null) {\n\t\t\t\t\t\t\t\tthis.cache[item.previous].next = item.next;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (item.next !== null) {\n\t\t\t\t\t\t\t\tthis.cache[item.next].previous = item.previous;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (this.first === key) {\n\t\t\t\t\t\t\t\tthis.first = item.previous;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (this.last === key) {\n\t\t\t\t\t\t\t\tthis.last = item.next;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn item;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tset: {\n\n\t\t\t\t\t/**\n      * Sets item in cache as `first`\n      *\n      * @method set\n      * @memberOf keigai.LRU\n      * @param  {String} key   Item key\n      * @param  {Mixed}  value Item value\n      * @return {Object} {@link keigai.LRU}\n      * @example\n      * lru.set( \"key\", {x: true} );\n      */\n\t\t\t\t\tvalue: function set(key, value) {\n\t\t\t\t\t\tvar item = this.remove(key);\n\n\t\t\t\t\t\tif (item === undefined) {\n\t\t\t\t\t\t\titem = new LRUItem(value);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\titem.value = value;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\titem.next = null;\n\t\t\t\t\t\titem.previous = this.first;\n\t\t\t\t\t\tthis.cache[key] = item;\n\n\t\t\t\t\t\tif (this.first !== null) {\n\t\t\t\t\t\t\tthis.cache[this.first].next = key;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.first = key;\n\n\t\t\t\t\t\tif (this.last === null) {\n\t\t\t\t\t\t\tthis.last = key;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (++this.length > this.max) {\n\t\t\t\t\t\t\tthis.evict();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn LRU;\n\t\t})();\n\n\t\t/**\n   * Creates a new LRUItem\n   *\n   * @constructor\n   * @memberOf keigai\n   * @param {Mixed} value Item value\n   * @private\n   */\n\t\tvar LRUItem = function LRUItem(value) {\n\t\t\t_classCallCheck(this, LRUItem);\n\n\t\t\tthis.next = null;\n\t\t\tthis.previous = null;\n\t\t\tthis.value = value;\n\t\t};\n\n\t\t/**\n   * @namespace lru\n   */\n\t\tvar lru = {\n\t\t\t/**\n    * LRU factory\n    *\n    * @method factory\n    * @memberOf lru\n    * @return {Object} {@link keigai.LRU}\n    * @example\n    * let lru = keigai.util.lru( 50 );\n    */\n\t\t\tfactory: function (max) {\n\t\t\t\treturn new LRU(max);\n\t\t\t}\n\t\t};\n\n\t\tvar Observable = (function () {\n\t\t\t/**\n    * Creates a new Observable\n    *\n    * @constructor\n    * @memberOf keigai\n    * @param  {Number} arg Maximum listeners, default is 10\n    * @example\n    * let observer = keigai.util.observer( 50 );\n    */\n\t\t\tfunction Observable() {\n\t\t\t\tvar arg = arguments[0] === undefined ? MAX : arguments[0];\n\t\t\t\t_classCallCheck(this, Observable);\n\n\t\t\t\tthis.limit = arg;\n\t\t\t\tthis.listeners = {};\n\t\t\t\tthis.hooks = new WeakMap();\n\t\t\t}\n\n\t\t\t_prototypeProperties(Observable, null, {\n\t\t\t\tdispatch: {\n\n\t\t\t\t\t/**\n      * Dispatches an event, with optional arguments\n      *\n      * @method dispatch\n      * @memberOf keigai.Observable\n      * @return {Object} {@link keigai.Observable}\n      * @example\n      * observer.dispatch( \"event\", ... );\n      */\n\t\t\t\t\tvalue: function dispatch(ev) {\n\t\t\t\t\t\tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n\t\t\t\t\t\t\targs[_key - 1] = arguments[_key];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (ev && this.listeners[ev]) {\n\t\t\t\t\t\t\tutility.iterate(this.listeners[ev], function (i) {\n\t\t\t\t\t\t\t\ti.handler.apply(i.scope, args);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\thook: {\n\n\t\t\t\t\t/**\n      * Hooks into `target` for a DOM event\n      *\n      * @method hook\n      * @memberOf keigai.Observable\n      * @param  {Object} target Element\n      * @param  {String} ev     Event\n      * @return {Object}        Element\n      * @example\n      * observer.hook( document.querySelector( \"a\" ), \"click\" );\n      */\n\t\t\t\t\tvalue: function hook(target, ev) {\n\t\t\t\t\t\tif (typeof target.addEventListener != \"function\") {\n\t\t\t\t\t\t\tthrow new Error(label.invalidArguments);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\tvar obj = this.hooks.get(target) || {};\n\n\t\t\t\t\t\tobj[ev] = function (arg) {\n\t\t\t\t\t\t\tself.dispatch(ev, arg);\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tthis.hooks.set(target, obj);\n\t\t\t\t\t\ttarget.addEventListener(ev, this.hooks.get(target)[ev], false);\n\n\t\t\t\t\t\treturn target;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\toff: {\n\n\t\t\t\t\t/**\n      * Removes all, or a specific listener for an event\n      *\n      * @method off\n      * @memberOf keigai.Observable\n      * @param {String} ev Event name\n      * @param {String} id [Optional] Listener ID\n      * @return {Object} {@link keigai.Observable}\n      * @example\n      * observer.off( \"click\", \"myHook\" );\n      */\n\t\t\t\t\tvalue: function off(ev, id) {\n\t\t\t\t\t\tif (this.listeners[ev]) {\n\t\t\t\t\t\t\tif (id) {\n\t\t\t\t\t\t\t\tdelete this.listeners[ev][id];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdelete this.listeners[ev];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\ton: {\n\n\t\t\t\t\t/**\n      * Adds a listener for an event\n      *\n      * @method on\n      * @memberOf keigai.Observable\n      * @param  {String}   ev      Event name\n      * @param  {Function} handler Handler\n      * @param  {String}   id      [Optional] Handler ID\n      * @param  {String}   scope   [Optional] Handler scope, default is `this`\n      * @return {Object} {@link keigai.Observable}\n      * @example\n      * observer.on( \"click\", function ( ev ) {\n      *   ...\n      * }, \"myHook\" );\n      */\n\t\t\t\t\tvalue: function on(ev, handler, _x, scope) {\n\t\t\t\t\t\tvar id = arguments[2] === undefined ? utility.uuid() : arguments[2];\n\t\t\t\t\t\tif (!this.listeners[ev]) {\n\t\t\t\t\t\t\tthis.listeners[ev] = {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (array.keys(this.listeners[ev]).length >= this.limit) {\n\t\t\t\t\t\t\tthrow new Error(\"Possible memory leak, more than \" + this.limit + \" listeners for event: \" + ev);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.listeners[ev][id] = { scope: scope || this, handler: handler };\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tonce: {\n\n\t\t\t\t\t/**\n      * Adds a short lived listener for an event\n      *\n      * @method once\n      * @memberOf keigai.Observable\n      * @param  {String}   ev      Event name\n      * @param  {Function} handler Handler\n      * @param  {String}   id      [Optional] Handler ID\n      * @param  {String}   scope   [Optional] Handler scope, default is `this`\n      * @return {Object} {@link keigai.Observable}\n      * @example\n      * observer.once( \"click\", function ( ev ) {\n      *   ...\n      * } );\n      */\n\t\t\t\t\tvalue: function once(ev, handler, _x, scope) {\n\t\t\t\t\t\tvar id = arguments[2] === undefined ? utility.uuid() : arguments[2];\n\t\t\t\t\t\tscope = scope || this;\n\n\t\t\t\t\t\tvar self = this;\n\n\t\t\t\t\t\treturn this.on(ev, function () {\n\t\t\t\t\t\t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\t\t\t\t\t\targs[_key] = arguments[_key];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\thandler.apply(scope, args);\n\t\t\t\t\t\t\tself.off(ev, id);\n\t\t\t\t\t\t}, id, scope);\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tunhook: {\n\n\t\t\t\t\t/**\n      * Unhooks from `target` for a DOM event\n      *\n      * @method unhook\n      * @memberOf keigai.Observable\n      * @param  {Object} target Element\n      * @param  {String} ev     Event\n      * @return {Object}        Element\n      * @example\n      * observer.unhook( document.querySelector( \"a\" ), \"click\" );\n      */\n\t\t\t\t\tvalue: function unhook(target, ev) {\n\t\t\t\t\t\tvar obj = this.hooks.get(target);\n\n\t\t\t\t\t\tif (obj) {\n\t\t\t\t\t\t\ttarget.removeEventListener(ev, obj[ev], false);\n\t\t\t\t\t\t\tdelete obj[ev];\n\n\t\t\t\t\t\t\tif (array.keys(obj).length === 0) {\n\t\t\t\t\t\t\t\tthis.hooks[\"delete\"](target);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.hooks.set(target, obj);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn target;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn Observable;\n\t\t})();\n\n\t\t/**\n   * @namespace observable\n   */\n\t\tvar observable = {\n\t\t\t/**\n    * Observable factory\n    *\n    * @method factory\n    * @memberOf observable\n    * @return {Object} {@link keigai.Observable}\n    * @example\n    * let observer = keigai.util.observer( 50 );\n    */\n\t\t\tfactory: function (arg) {\n\t\t\t\treturn new Observable(arg);\n\t\t\t}\n\t\t};\n\n\t\tvar Base = (function () {\n\t\t\t/**\n    * Base Object\n    *\n    * @constructor\n    * @memberOf keigai\n    */\n\t\t\tfunction Base() {\n\t\t\t\t_classCallCheck(this, Base);\n\n\t\t\t\t/**\n     * {@link keigai.Observable}\n     *\n     * @abstract\n     * @type {Object}\n     */\n\t\t\t\tthis.observer = null;\n\t\t\t}\n\n\t\t\t_prototypeProperties(Base, null, {\n\t\t\t\taddEventListener: {\n\n\t\t\t\t\t/**\n      * Adds an event listener\n      *\n      * @method addEventListener\n      * @memberOf keigai.Base\n      * @param  {String}   ev       Event name\n      * @param  {Function} listener Function to execute\n      * @param  {String}   id       [Optional] Listener ID\n      * @param  {String}   scope    [Optional] Listener scope, default is `this`\n      * @return {Object} {@link keigai.Base}\n      * @example\n      * obj.addEventListener( \"event\", function ( ev ) {\n      *   ...\n      * }, \"myHook\" );\n      */\n\t\t\t\t\tvalue: function addEventListener(ev, listener, id, scope) {\n\t\t\t\t\t\tthis.observer.on(ev, listener, id, scope || this);\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\taddListener: {\n\n\t\t\t\t\t/**\n      * Adds an event listener\n      *\n      * @method addListener\n      * @memberOf keigai.Base\n      * @param  {String}   ev       Event name\n      * @param  {Function} listener Function to execute\n      * @param  {String}   id       [Optional] Listener ID\n      * @param  {String}   scope    [Optional] Listener scope, default is `this`\n      * @return {Object} {@link keigai.Base}\n      * @example\n      * obj.addEventListener( \"event\", function ( ev ) {\n      *   ...\n      * }, \"myHook\" );\n      */\n\t\t\t\t\tvalue: function addListener(ev, listener, id, scope) {\n\t\t\t\t\t\tthis.observer.on(ev, listener, id, scope || this);\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tdispatch: {\n\n\t\t\t\t\t/**\n      * Dispatches an event, with optional arguments\n      *\n      * @method dispatch\n      * @memberOf keigai.Base\n      * @return {Object} {@link keigai.Base}\n      * @example\n      * obj.dispatch( \"event\", ... );\n      */\n\t\t\t\t\tvalue: function dispatch() {\n\t\t\t\t\t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\t\t\t\t\targs[_key] = arguments[_key];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.observer.dispatch.apply(this.observer, args);\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tdispatchEvent: {\n\n\t\t\t\t\t/**\n      * Dispatches an event, with optional arguments\n      *\n      * @method dispatchEvent\n      * @memberOf keigai.Base\n      * @return {Object} {@link keigai.Base}\n      * @example\n      * obj.dispatchEvent( \"event\", ... );\n      */\n\t\t\t\t\tvalue: function dispatchEvent() {\n\t\t\t\t\t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\t\t\t\t\targs[_key] = arguments[_key];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.observer.dispatch.apply(this.observer, args);\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\temit: {\n\n\t\t\t\t\t/**\n      * Dispatches an event, with optional arguments\n      *\n      * @method emit\n      * @memberOf keigai.Base\n      * @return {Object} {@link keigai.Base}\n      * @example\n      * obj.emit( \"event\", ... );\n      */\n\t\t\t\t\tvalue: function emit() {\n\t\t\t\t\t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\t\t\t\t\targs[_key] = arguments[_key];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.observer.dispatch.apply(this.observer, args);\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\thook: {\n\n\t\t\t\t\t/**\n      * Hooks into `target` for an event\n      *\n      * @method hook\n      * @memberOf keigai.Base\n      * @return {Object} {@link keigai.Base}\n      * @example\n      * obj.hook( document.querySelector( \"a\" ), \"click\" );\n      */\n\t\t\t\t\tvalue: function hook() {\n\t\t\t\t\t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\t\t\t\t\targs[_key] = arguments[_key];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.observer.hook.apply(this.observer, args);\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tlisteners: {\n\n\t\t\t\t\t/**\n      * Gets listeners\n      *\n      * @method listeners\n      * @memberOf keigai.Base\n      * @param  {String} ev [Optional] Event name\n      * @return {Object} Listeners\n      * @example\n      * keigai.util.iterate( obj.listeners(), function ( fn, id ) {\n      *   ...\n      * } );\n      */\n\t\t\t\t\tvalue: function listeners(ev) {\n\t\t\t\t\t\treturn ev ? this.observer.listeners[ev] : this.observer.listeners;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\toff: {\n\n\t\t\t\t\t/**\n      * Removes an event listener\n      *\n      * @method off\n      * @memberOf keigai.Base\n      * @param  {String} ev Event name\n      * @param  {String} id [Optional] Listener ID\n      * @return {Object} {@link keigai.Base}\n      * @example\n      * obj.off( \"event\", \"myHook\" );\n      */\n\t\t\t\t\tvalue: function off(ev, id) {\n\t\t\t\t\t\tthis.observer.off(ev, id);\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\ton: {\n\n\t\t\t\t\t/**\n      * Adds an event listener\n      *\n      * @method on\n      * @memberOf keigai.Base\n      * @param  {String}   ev       Event name\n      * @param  {Function} listener Function to execute\n      * @param  {String}   id       [Optional] Listener ID\n      * @param  {String}   scope    [Optional] Listener scope, default is `this`\n      * @return {Object} {@link keigai.Base}\n      * @example\n      * obj.on( \"event\", function ( ev ) {\n      *   ...\n      * }, \"myHook\" );\n      */\n\t\t\t\t\tvalue: function on(ev, listener, id, scope) {\n\t\t\t\t\t\tthis.observer.on(ev, listener, id, scope || this);\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tonce: {\n\n\t\t\t\t\t/**\n      * Adds a short lived event listener\n      *\n      * @method once\n      * @memberOf keigai.Base\n      * @param  {String}   ev       Event name\n      * @param  {Function} listener Function to execute\n      * @param  {String}   id       [Optional] Listener ID\n      * @param  {String}   scope    [Optional] Listener scope, default is `this`\n      * @return {Object} {@link keigai.Base}\n      * @example\n      * obj.once( \"event\", function ( ev ) {\n      *   ...\n      * } );\n      */\n\t\t\t\t\tvalue: function once(ev, listener, id, scope) {\n\t\t\t\t\t\tthis.observer.once(ev, listener, id, scope || this);\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tremoveEventListener: {\n\n\t\t\t\t\t/**\n      * Removes an event listener\n      *\n      * @method removeEventListener\n      * @memberOf keigai.Base\n      * @param  {String} ev Event name\n      * @param  {String} id [Optional] Listener ID\n      * @return {Object} {@link keigai.Base}\n      * @example\n      * obj.removeListener( \"event\", \"myHook\" );\n      */\n\t\t\t\t\tvalue: function removeEventListener(ev, id) {\n\t\t\t\t\t\tthis.observer.off(ev, id);\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tremoveListener: {\n\n\t\t\t\t\t/**\n      * Removes an event listener\n      *\n      * @method removeListener\n      * @memberOf keigai.Base\n      * @param  {String} ev Event name\n      * @param  {String} id [Optional] Listener ID\n      * @return {Object} {@link keigai.Base}\n      * @example\n      * obj.removeListener( \"event\", \"myHook\" );\n      */\n\t\t\t\t\tvalue: function removeListener(ev, id) {\n\t\t\t\t\t\tthis.observer.off(ev, id);\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn Base;\n\t\t})();\n\n\t\t/**\n   * @namespace base\n   * @private\n   */\n\t\tvar base = {\n\t\t\t/**\n    * Base factory\n    *\n    * @memberOf base\n    * @method factory\n    * @return {Object} {@link keigai.Base}\n    */\n\t\t\tfactory: function () {\n\t\t\t\treturn new Base();\n\t\t\t}\n\t\t};\n\n\t\t/**\n   * @namespace array\n   */\n\t\tvar array = {\n\t\t\t/**\n    * Adds 'arg' to 'obj' if it is not found\n    *\n    * @method add\n    * @memberOf array\n    * @param  {Array} obj Array to receive 'arg'\n    * @param  {Mixed} arg Argument to set in 'obj'\n    * @return {Array}     Array that was queried\n    * @example\n    * let myArray = [1, 2];\n    *\n    * keigai.util.array.add( myArray, 3 ); // [1, 2, 3]\n    * keigai.util.array.add( myArray, 1 ); // [1, 2, 3]\n    */\n\t\t\tadd: function (obj, arg) {\n\t\t\t\tif (!array.contains(obj, arg)) {\n\t\t\t\t\tobj.push(arg);\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Preforms a binary search on a sorted Array\n    *\n    * @method binIndex\n    * @memberOf array\n    * @param  {Array} obj Array to search\n    * @param  {Mixed} arg Value to find index of\n    * @return {Number}    Index of `arg` within `obj`\n    * @example\n    * let myArray = [1, 5, 10, 15, 20, 25, ...];\n    *\n    * keigai.util.array.binIndex( myArray, 5 ); // 1\n    */\n\t\t\tbinIndex: function (obj, arg) {\n\t\t\t\tvar max = obj.length - 1;\n\t\t\t\tvar min = 0;\n\t\t\t\tvar idx = 0;\n\t\t\t\tvar val = 0;\n\n\t\t\t\twhile (min <= max) {\n\t\t\t\t\tidx = Math.floor((min + max) / 2);\n\t\t\t\t\tval = obj[idx];\n\n\t\t\t\t\tif (val < arg) {\n\t\t\t\t\t\tmin = idx + 1;\n\t\t\t\t\t} else if (val > arg) {\n\t\t\t\t\t\tmax = idx - 1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn idx;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn -1;\n\t\t\t},\n\n\t\t\t/**\n    * Returns an Object ( NodeList, etc. ) as an Array\n    *\n    * @method cast\n    * @memberOf array\n    * @param  {Object}  obj Object to cast\n    * @param  {Boolean} key [Optional] Returns key or value, only applies to Objects without a length property\n    * @return {Array}       Object as an Array\n    * @example\n    * keigai.util.array.cast( document.querySelectorAll( \"...\" ) );\n    */\n\t\t\tcast: function (obj, key) {\n\t\t\t\tvar o = [];\n\n\t\t\t\tif (!isNaN(obj.length)) {\n\t\t\t\t\to = Array.from(obj);\n\t\t\t\t} else if (key === true) {\n\t\t\t\t\to = array.keys(obj);\n\t\t\t\t} else {\n\t\t\t\t\tutility.iterate(obj, function (i) {\n\t\t\t\t\t\to.push(i);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn o;\n\t\t\t},\n\n\t\t\t/**\n    * Transforms an Array to a 2D Array of chunks\n    *\n    * @method chunk\n    * @memberOf array\n    * @param  {Array}  obj  Array to process\n    * @param  {Number} size Chunk size ( integer )\n    * @return {Array}       Chunked Array\n    * @example\n    * keigai.util.array.chunk( [0, 1, 2, 3], 2 ); // [[0, 1], [2, 3]]\n    */\n\t\t\tchunk: function (obj, size) {\n\t\t\t\tvar result = [];\n\t\t\t\tvar nth = number.round(obj.length / size, \"up\");\n\t\t\t\tvar start = 0;\n\t\t\t\tvar i = -1;\n\n\t\t\t\twhile (++i < nth) {\n\t\t\t\t\tstart = i * size;\n\t\t\t\t\tresult.push(array.limit(obj, start, size));\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Clears an Array without destroying it\n    *\n    * @method clear\n    * @memberOf array\n    * @param  {Array} obj Array to clear\n    * @return {Array}     Cleared Array\n    * @example\n    * let myArray = [1, 2, 3, 4, 5];\n    *\n    * keigai.util.array.clear( myArray );\n    * myArray.length; // 0\n    */\n\t\t\tclear: function (obj) {\n\t\t\t\treturn obj.length > 0 ? array.remove(obj, 0, obj.length) : obj;\n\t\t\t},\n\n\t\t\t/**\n    * Clones an Array\n    *\n    * @method clone\n    * @memberOf array\n    * @param  {Array}   obj     Array to clone\n    * @param  {Boolean} shallow [Optional] Default is `true`\n    * @return {Array}           Clone of Array\n    * @example\n    * let myArray      = [1, 2, 3, 4, 5],\n    *     myArrayClone = keigai.util.array.clone( myArray );\n    *\n    * myArrayClone.push( 6 );\n    *\n    * myArray.length;      // 5\n    * myArrayClone.length; // 6\n    */\n\t\t\tclone: function (obj) {\n\t\t\t\tvar shallow = arguments[1] === undefined ? true : arguments[1];\n\t\t\t\treturn utility.clone(obj, shallow);\n\t\t\t},\n\n\t\t\t/**\n    * Determines if obj contains arg\n    *\n    * @method contains\n    * @memberOf array\n    * @param  {Array} obj Array to search\n    * @param  {Mixed} arg Value to look for\n    * @return {Boolean}   True if found, false if not\n    * @example\n    * if ( keigai.util.array.contains( [1], 1 ) ) { ... }\n    */\n\t\t\tcontains: function (obj, arg) {\n\t\t\t\treturn obj.indexOf(arg) > -1;\n\t\t\t},\n\n\t\t\t/**\n    * Facade of `Array.map()`\n    *\n    * @method collect\n    * @memberOf array\n    * @param  {Array}    obj Array to iterate\n    * @param  {Function} fn  Function to execute against indices\n    * @return {Array}        New Array\n    * @example\n    * let results = keigai.util.array.collect( [...], function ( ... ) { ... } );\n    */\n\t\t\tcollect: function (obj, fn) {\n\t\t\t\treturn obj.map(fn);\n\t\t\t},\n\n\t\t\t/**\n    * Compacts a Array by removing `null` or `undefined` indices\n    *\n    * @method compact\n    * @memberOf array\n    * @param  {Array}   obj  Array to compact\n    * @param  {Boolean} diff Indicates to return resulting Array only if there's a difference\n    * @return {Array}        Compacted copy of `obj`, or null ( if `diff` is passed & no diff is found )\n    * @example\n    * keigai.util.array.compact( [null, \"a\", \"b\", \"c\", null, \"d\"] ); // [\"a\", \"b\", \"c\", \"d\"]\n    * keigai.util.array.compact( [\"a\", \"b\", \"c\", \"d\"], true );       // null\n    */\n\t\t\tcompact: function (obj, diff) {\n\t\t\t\tvar result = obj.filter(function (i) {\n\t\t\t\t\treturn !regex.null_undefined.test(i);\n\t\t\t\t});\n\n\t\t\t\treturn diff !== true ? result : result.length < obj.length ? result : null;\n\t\t\t},\n\n\t\t\t/**\n    * Counts `value` in `obj`\n    *\n    * @method count\n    * @memberOf array\n    * @param  {Array} obj   Array to search\n    * @param  {Mixed} value Value to compare\n    * @return {Array}       Array of counts\n    * @example\n    * keigai.util.array.count( [\"apple\", \"banana\", \"orange\", \"apple\"], \"apple\" ); // 2\n    */\n\t\t\tcount: function (obj, value) {\n\t\t\t\treturn obj.filter(function (i) {\n\t\t\t\t\treturn i === value;\n\t\t\t\t}).length;\n\t\t\t},\n\n\t\t\t/**\n    * Finds the difference between two Arrays\n    *\n    * @method diff\n    * @memberOf array\n    * @param  {Array} obj1 Source Array\n    * @param  {Array} obj2 Comparison Array\n    * @return {Array}      Array of the differences\n    * @example\n    * keigai.util.array.diff( [\"a\"], [\"a\", \"b\"] ); // [\"b\"]\n    */\n\t\t\tdiff: function (obj1, obj2) {\n\t\t\t\tvar result = [];\n\n\t\t\t\tarray.each(obj1, function (i) {\n\t\t\t\t\tif (!array.contains(obj2, i)) {\n\t\t\t\t\t\tarray.add(result, i);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tarray.each(obj2, function (i) {\n\t\t\t\t\tif (!array.contains(obj1, i)) {\n\t\t\t\t\t\tarray.add(result, i);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Iterates `obj` and executes `fn` with arguments [`value`, `index`].\n    * Returning `false` halts iteration.\n    *\n    * @method each\n    * @memberOf array\n    * @param  {Array}    obj   Array to iterate\n    * @param  {Function} fn    Function to execute on index values\n    * @param  {Boolean}  async [Optional] Asynchronous iteration\n    * @param  {Number}   size  [Optional] Batch size for async iteration, default is 10\n    * @return {Array}          Array\n    * @example\n    * keigai.util.array.each( [ ... ], function ( ... ) { ... } );\n    * keigai.util.array.each( [ ... ], function ( ... ) { ... }, true, 100 ); // processing batches of a 100\n    */\n\t\t\teach: function (obj, fn, async) {\n\t\t\t\tvar size = arguments[3] === undefined ? 10 : arguments[3];\n\t\t\t\tvar nth = obj.length;\n\t\t\t\tvar i = undefined,\n\t\t\t\t    offset = undefined;\n\n\t\t\t\tif (async !== true) {\n\t\t\t\t\ti = -1;\n\t\t\t\t\twhile (++i < nth) {\n\t\t\t\t\t\tif (fn.call(obj, obj[i], i) === false) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\toffset = 0;\n\n\t\t\t\t\tif (size > nth) {\n\t\t\t\t\t\tsize = nth;\n\t\t\t\t\t}\n\n\t\t\t\t\tutility.repeat(function () {\n\t\t\t\t\t\tvar i = -1;\n\t\t\t\t\t\tvar idx = undefined;\n\n\t\t\t\t\t\twhile (++i < size) {\n\t\t\t\t\t\t\tidx = i + offset;\n\n\t\t\t\t\t\t\tif (idx === nth || fn.call(obj, obj[idx], idx) === false) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\toffset += size;\n\n\t\t\t\t\t\tif (offset >= nth) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}, undefined, undefined, false);\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Iterates `obj` in reverse and executes `fn` with arguments [`value`, `index`].\n    * Returning `false` halts iteration.\n    *\n    * @method eachReverse\n    * @memberOf array\n    * @param  {Array}    obj   Array to iterate\n    * @param  {Function} fn    Function to execute on index values\n    * @param  {Boolean}  async [Optional] Asynchronous iteration\n    * @param  {Number}   size  [Optional] Batch size for async iteration, default is 10\n    * @return {Array}          Array\n    * @example\n    * keigai.util.array.eachReverse( [ ... ], function ( ... ) { ... } );\n    * keigai.util.array.eachReverse( [ ... ], function ( ... ) { ... }, true, 100 ); // processing batches of a 100\n    */\n\t\t\teachReverse: function (obj, fn, async, size) {\n\t\t\t\tvar nth = obj.length;\n\t\t\t\tvar i = undefined,\n\t\t\t\t    offset = undefined;\n\n\t\t\t\tif (async !== true) {\n\t\t\t\t\ti = nth;\n\t\t\t\t\twhile (--i > -1) {\n\t\t\t\t\t\tif (fn.call(obj, obj[i], i) === false) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tsize = size || 10;\n\t\t\t\t\toffset = nth - 1;\n\n\t\t\t\t\tif (size > nth) {\n\t\t\t\t\t\tsize = nth;\n\t\t\t\t\t}\n\n\t\t\t\t\tutility.repeat(function () {\n\t\t\t\t\t\tvar i = -1;\n\t\t\t\t\t\tvar idx = undefined;\n\n\t\t\t\t\t\twhile (++i < size) {\n\t\t\t\t\t\t\tidx = offset - i;\n\n\t\t\t\t\t\t\tif (idx < 0 || fn.call(obj, obj[idx], idx) === false) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\toffset -= size;\n\n\t\t\t\t\t\tif (offset < 0) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}, undefined, undefined, false);\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Determines if an Array is empty\n    *\n    * @method empty\n    * @memberOf array\n    * @param  {Array} obj Array to inspect\n    * @return {Boolean}   `true` if there's no indices\n    * @example\n    * keigai.util.array.empty( [] );    // true\n    * keigai.util.array.empty( [\"a\"] ); // false\n    */\n\t\t\tempty: function (obj) {\n\t\t\t\treturn obj.length === 0;\n\t\t\t},\n\n\t\t\t/**\n    * Determines if two Arrays are equal\n    *\n    * @method equal\n    * @memberOf array\n    * @param  {Array} obj1 Array to compare\n    * @param  {Array} obj2 Array to compare\n    * @return {Boolean} `true` if the Arrays match\n    * @example\n    * keigai.util.array.equal( [\"a\"], [\"a\"] );      // true\n    * keigai.util.array.equal( [\"a\"], [\"a\", \"b\"] ); // false\n    */\n\t\t\tequal: function (obj1, obj2) {\n\t\t\t\treturn json.encode(obj1) === json.encode(obj2);\n\t\t\t},\n\n\t\t\t/**\n    * Fills `obj` with the evalution of `arg`, optionally from `start` to `offset`\n    *\n    * @method fill\n    * @memberOf array\n    * @param  {Array}  obj   Array to fill\n    * @param  {Mixed}  arg   String, Number of Function to fill with\n    * @param  {Number} start [Optional] Index to begin filling at\n    * @param  {Number} end   [Optional] Offset from start to stop filling at\n    * @return {Array}        Filled Array\n    * @example\n    * let myArray = [\"a\", \"b\", \"c\"];\n    *\n    * keigai.util.array.fill( myArray, function ( i ) { return i + \"a\"; } );\n    * myArray[0]; // \"aa\"\n    */\n\t\t\tfill: function (obj, arg, start, offset) {\n\t\t\t\tvar fn = typeof arg === \"function\";\n\t\t\t\tvar l = obj.length;\n\t\t\t\tvar i = !isNaN(start) ? start : 0;\n\t\t\t\tvar nth = !isNaN(offset) ? i + offset : l - 1;\n\n\t\t\t\tif (nth > l - 1) {\n\t\t\t\t\tnth = l - 1;\n\t\t\t\t}\n\n\t\t\t\tif (fn) {\n\t\t\t\t\twhile (i <= nth) {\n\t\t\t\t\t\tobj[i] = arg(obj[i]);\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\twhile (i <= nth) {\n\t\t\t\t\t\tobj[i] = arg;\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Returns the first Array index\n    *\n    * @method first\n    * @memberOf array\n    * @param  {Array} obj The array\n    * @return {Mixed}     The first node of the array\n    * @example\n    * keigai.util.array.first( [\"a\", \"b\"] ); // \"a\"\n    */\n\t\t\tfirst: function (obj) {\n\t\t\t\treturn obj[0];\n\t\t\t},\n\n\t\t\t/**\n    * Flattens a 2D Array\n    *\n    * @method flat\n    * @memberOf array\n    * @param  {Array} obj 2D Array to flatten\n    * @return {Array}     Flatten Array\n    * @example\n    * keigai.util.array.flat( [[0, 1], [2, 3]] ); // [0, 1, 2, 3]\n    */\n\t\t\tflat: function (obj) {\n\t\t\t\tvar result = [];\n\n\t\t\t\tresult = obj.reduce(function (a, b) {\n\t\t\t\t\treturn a.concat(b);\n\t\t\t\t}, result);\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Iterates `obj` and executes `fn` with arguments [`value`, `index`].\n    * Returning `false` halts iteration.\n    *\n    * @method forEach\n    * @memberOf array\n    * @see array.each\n    * @param  {Array}    obj   Array to iterate\n    * @param  {Function} fn    Function to execute on index values\n    * @param  {Boolean}  async [Optional] Asynchronous iteration\n    * @param  {Number}   size  [Optional] Batch size for async iteration, default is 10\n    * @return {Array}          Array\n    * @example\n    * keigai.util.array.forEach( [ ... ], function ( ... ) { ... } );\n    * keigai.util.array.forEach( [ ... ], function ( ... ) { ... }, true, 100 ); // processing batches of a 100\n    */\n\t\t\tforEach: function (obj, fn, async, size) {\n\t\t\t\treturn array.each(obj, fn, async, size);\n\t\t\t},\n\n\t\t\t/**\n    * Creates a 2D Array from an Object\n    *\n    * @method fromObject\n    * @memberOf array\n    * @param  {Object} obj Object to convert\n    * @return {Array}      2D Array\n    * @example\n    * keigai.util.array.fromObject( {name: \"John\", sex: \"male\"} ); // [[\"name\", \"John\"], [\"sex\", \"male\"]]\n    */\n\t\t\tfromObject: function (obj) {\n\t\t\t\treturn array.mingle(array.keys(obj), array.cast(obj));\n\t\t\t},\n\n\t\t\t/**\n    * Facade of indexOf\n    *\n    * @method index\n    * @memberOf array\n    * @param  {Array} obj Array to search\n    * @param  {Mixed} arg Value to find index of\n    * @return {Number}    The position of arg in instance\n    * @example\n    * keigai.util.array.index( [\"a\", \"b\", \"c\"], \"b\" ); // 1\n    */\n\t\t\tindex: function (obj, arg) {\n\t\t\t\treturn obj.indexOf(arg);\n\t\t\t},\n\n\t\t\t/**\n    * Returns an Associative Array as an Indexed Array\n    *\n    * @method indexed\n    * @memberOf array\n    * @param  {Array} obj Array to index\n    * @return {Array}     Indexed Array\n    * @example\n    * let myArray = [\"a\", \"b\", \"c\"];\n    *\n    * myArray.prop = \"d\";\n    * keigai.util.array.indexed( myArray ); [\"a\", \"b\", \"c\", \"d\"];\n    */\n\t\t\tindexed: function (obj) {\n\t\t\t\tvar result = [];\n\n\t\t\t\tutility.iterate(obj, function (v) {\n\t\t\t\t\tresult.push(v);\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Finds the intersections between obj1 and obj2\n    *\n    * @method intersect\n    * @memberOf array\n    * @param  {Array} obj1 Source Array\n    * @param  {Array} obj2 Comparison Array\n    * @return {Array}      Array of the intersections\n    * @example\n    * keigai.util.array.intersect( [\"a\", \"b\", \"d\"], [\"b\", \"c\", \"d\"] ); // [\"b\", \"d\"]\n    */\n\t\t\tintersect: function (obj1, obj2) {\n\t\t\t\tvar a = obj1.length > obj2.length ? obj1 : obj2;\n\t\t\t\tvar b = a === obj1 ? obj2 : obj1;\n\n\t\t\t\treturn a.filter(function (key) {\n\t\t\t\t\treturn array.contains(b, key);\n\t\t\t\t});\n\t\t\t},\n\n\t\t\t/**\n    * Iterates an Array using an Iterator\n    *\n    * @method iterate\n    * @memberOf array\n    * @param  {Array} obj Array to iterate\n    * @return {Array}     Array to iterate\n    */\n\t\t\titerate: function (obj, fn) {\n\t\t\t\tvar itr = array.iterator(obj);\n\t\t\t\tvar item = undefined;\n\n\t\t\t\tdo {\n\t\t\t\t\titem = itr.next();\n\n\t\t\t\t\tif (!item.done) {\n\t\t\t\t\t\tfn(item.value);\n\t\t\t\t\t}\n\t\t\t\t} while (!item.done);\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Creates an Array generator to iterate the indices\n    * \n    * @method iterator\n    * @memberOf array\n    * @param  {Array} obj Array to iterate\n    * @return {Function}  Generator\n    */\n\t\t\titerator: function (obj) {\n\t\t\t\tvar i = -1;\n\n\t\t\t\treturn {\n\t\t\t\t\tnext: function next() {\n\t\t\t\t\t\tif (++i < obj.length) {\n\t\t\t\t\t\t\treturn { done: false, value: obj[i] };\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn { done: true };\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t},\n\n\t\t\t/**\n    * Keeps every element of `obj` for which `fn` evaluates to true\n    *\n    * @method keepIf\n    * @memberOf array\n    * @param  {Array}    obj Array to iterate\n    * @param  {Function} fn  Function to test indices against\n    * @return {Array}        Array\n    * @example\n    * let myArray = [\"a\", \"b\", \"c\"];\n    *\n    * keigai.util.array.keepIf( myArray, function ( i ) { return /a|c/.test( i ); } );\n    * myArray[1]; // \"c\"\n    */\n\t\t\tkeepIf: function (obj, fn) {\n\t\t\t\tvar result = [];\n\t\t\t\tvar remove = [];\n\n\t\t\t\tresult = obj.filter(fn);\n\t\t\t\tremove = array.diff(obj, result);\n\n\t\t\t\tarray.each(remove, function (i) {\n\t\t\t\t\tarray.remove(obj, array.index(obj, i));\n\t\t\t\t});\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Returns the keys in an \"Associative Array\"\n    *\n    * @method keys\n    * @memberOf array\n    * @param  {Mixed} obj Array or Object to extract keys from\n    * @return {Array}     Array of the keys\n    * @example\n    * keigai.util.array.keys( {abc: true, xyz: false} ); // [\"abc\", \"xyz\"]\n    */\n\t\t\tkeys: function (obj) {\n\t\t\t\treturn Array.keys(obj);\n\t\t\t},\n\n\t\t\t/**\n    * Sorts an Array based on key values, like an SQL ORDER BY clause\n    *\n    * @method keySort\n    * @memberOf array\n    * @param  {Array}  obj   Array to sort\n    * @param  {String} query Sort query, e.g. \"name, age desc, country\"\n    * @param  {String} sub   [Optional] Key which holds data, e.g. \"{data: {}}\" = \"data\"\n    * @return {Array}        Sorted Array\n    * @example\n    * let myArray = [{abc: 123124, xyz: 5}, {abc: 123124, xyz: 6}, {abc: 2, xyz: 5}];\n    *\n    * keigai.util.array.keySort( myArray, \"abc\" );           // [{abc: 2, xyz: 5}, {abc: 123124, xyz: 5}, {abc: 123124, xyz: 6}];\n    * keigai.util.array.keySort( myArray, \"abc, xyz desc\" ); // [{abc: 2, xyz: 5}, {abc: 123124, xyz: 6}, {abc: 123124, xyz: 5}];\n    */\n\t\t\tkeySort: function (obj, query, sub) {\n\t\t\t\tquery = query.replace(/\\s*asc/ig, \"\").replace(/\\s*desc/ig, \" desc\");\n\n\t\t\t\tvar queries = string.explode(query).map(function (i) {\n\t\t\t\t\treturn i.split(\" \");\n\t\t\t\t});\n\t\t\t\tvar sorts = [];\n\t\t\t\tvar braceS = \"[\\\"\";\n\t\t\t\tvar braceE = \"\\\"]\";\n\n\t\t\t\tif (sub && sub !== \"\") {\n\t\t\t\t\tsub = \".\" + sub;\n\t\t\t\t} else {\n\t\t\t\t\tsub = \"\";\n\t\t\t\t}\n\n\t\t\t\tarray.each(queries, function (i) {\n\t\t\t\t\tvar s = \".\";\n\t\t\t\t\tvar e = \"\";\n\n\t\t\t\t\tif (regex.not_dotnotation.test(i[0])) {\n\t\t\t\t\t\ts = braceS;\n\t\t\t\t\t\te = braceE;\n\t\t\t\t\t}\n\n\t\t\t\t\tsorts.push(\"try {\");\n\n\t\t\t\t\tif (i[1] === \"desc\") {\n\t\t\t\t\t\tsorts.push(\"if ( a\" + sub + s + i[0] + e + \" < b\" + sub + s + i[0] + e + \" ) return 1;\");\n\t\t\t\t\t\tsorts.push(\"if ( a\" + sub + s + i[0] + e + \" > b\" + sub + s + i[0] + e + \" ) return -1;\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsorts.push(\"if ( a\" + sub + s + i[0] + e + \" < b\" + sub + s + i[0] + e + \" ) return -1;\");\n\t\t\t\t\t\tsorts.push(\"if ( a\" + sub + s + i[0] + e + \" > b\" + sub + s + i[0] + e + \" ) return 1;\");\n\t\t\t\t\t}\n\n\t\t\t\t\tsorts.push(\"} catch (e) {\");\n\t\t\t\t\tsorts.push(\"try {\");\n\t\t\t\t\tsorts.push(\"if ( a\" + sub + s + i[0] + e + \" !== undefined ) return \" + (i[1] === \"desc\" ? \"-1\" : \"1\") + \";\");\n\t\t\t\t\tsorts.push(\"} catch (e) {}\");\n\t\t\t\t\tsorts.push(\"try {\");\n\t\t\t\t\tsorts.push(\"if ( b\" + sub + s + i[0] + e + \" !== undefined ) return \" + (i[1] === \"desc\" ? \"1\" : \"-1\") + \";\");\n\t\t\t\t\tsorts.push(\"} catch (e) {}\");\n\t\t\t\t\tsorts.push(\"}\");\n\t\t\t\t});\n\n\t\t\t\tsorts.push(\"return 0;\");\n\n\t\t\t\treturn obj.sort(new Function(\"a\", \"b\", sorts.join(\"\\n\")));\n\t\t\t},\n\n\t\t\t/**\n    * Returns the last index of the Array\n    *\n    * @method last\n    * @memberOf array\n    * @param  {Array}  obj Array\n    * @param  {Number} arg [Optional] Negative offset from last index to return\n    * @return {Mixed}      Last index( s ) of Array\n    * @example\n    * let myArray = [1, 2, 3, 4];\n    *\n    * keigai.util.array.last( myArray );    // 4\n    * keigai.util.array.last( myArray, 2 ); // [3, 4]\n    */\n\t\t\tlast: function (obj, arg) {\n\t\t\t\tvar n = obj.length - 1;\n\n\t\t\t\tif (arg >= n + 1) {\n\t\t\t\t\treturn obj;\n\t\t\t\t} else if (isNaN(arg) || arg === 1) {\n\t\t\t\t\treturn obj[n];\n\t\t\t\t} else {\n\t\t\t\t\treturn array.limit(obj, n - --arg, n);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n    * Returns a limited range of indices from the Array\n    *\n    * @method limit\n    * @memberOf array\n    * @param  {Array}  obj    Array to iterate\n    * @param  {Number} start  Starting index\n    * @param  {Number} offset Number of indices to return\n    * @return {Array}         Array of indices\n    * @example\n    * let myArray = [1, 2, 3, 4];\n    *\n    * keigai.util.array.limit( myArray, 0, 2 ); // [1, 2]\n    * keigai.util.array.limit( myArray, 2, 2 ); // [3, 4]\n    */\n\t\t\tlimit: function (obj, start, offset) {\n\t\t\t\tvar result = [];\n\t\t\t\tvar i = start - 1;\n\t\t\t\tvar nth = start + offset;\n\t\t\t\tvar max = obj.length;\n\n\t\t\t\tif (max > 0) {\n\t\t\t\t\twhile (++i < nth && i < max) {\n\t\t\t\t\t\tresult.push(obj[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Finds the maximum value in an Array\n    *\n    * @method max\n    * @memberOf array\n    * @param  {Array} obj Array to process\n    * @return {Mixed}     Number, String, etc.\n    * @example\n    * keigai.util.array.max( [5, 3, 9, 1, 4] ); // 9\n    */\n\t\t\tmax: function (obj) {\n\t\t\t\treturn array.last(array.sorted(array.clone(obj)));\n\t\t\t},\n\n\t\t\t/**\n    * Finds the mean of an Array ( of numbers )\n    *\n    * @method mean\n    * @memberOf array\n    * @param  {Array} obj Array to process\n    * @return {Number}    Mean of the Array ( float or integer )\n    * @example\n    * keigai.util.array.mean( [1, 3, 5] ); // 3\n    */\n\t\t\tmean: function (obj) {\n\t\t\t\treturn obj.length > 0 ? array.sum(obj) / obj.length : undefined;\n\t\t\t},\n\n\t\t\t/**\n    * Finds the median value of an Array ( of numbers )\n    *\n    * @method median\n    * @memberOf array\n    * @param  {Array} obj Array to process\n    * @return {Number}    Median number of the Array ( float or integer )\n    * @example\n    * keigai.util.array.median( [5, 1, 3, 8] ); // 4\n    * keigai.util.array.median( [5, 1, 3] );    // 3\n    */\n\t\t\tmedian: function (obj) {\n\t\t\t\tvar dupe = array.sorted(array.clone(obj));\n\t\t\t\tvar nth = dupe.length;\n\t\t\t\tvar mid = number.round(nth / 2, \"down\");\n\n\t\t\t\treturn number.odd(nth) ? dupe[mid] : (dupe[mid - 1] + dupe[mid]) / 2;\n\t\t\t},\n\n\t\t\t/**\n    * Merges `arg` into `obj`, excluding duplicate indices\n    *\n    * @method merge\n    * @memberOf array\n    * @param  {Array} obj1 Array to receive indices\n    * @param  {Array} obj2 Array to merge\n    * @return {Array}      First argument\n    * @example\n    * let a = [\"a\", \"b\", \"c\"],\n    *     b = [\"d\"];\n    *\n    * keigai.util.array.merge( a, b );\n    * a[3]; // \"d\"\n    */\n\t\t\tmerge: function (obj1, obj2) {\n\t\t\t\tarray.each(obj2, function (i) {\n\t\t\t\t\tarray.add(obj1, i);\n\t\t\t\t});\n\n\t\t\t\treturn obj1;\n\t\t\t},\n\n\t\t\t/**\n    * Finds the minimum value in an Array\n    *\n    * @method min\n    * @memberOf array\n    * @param  {Array} obj Array to process\n    * @return {Mixed}     Number, String, etc.\n    * @example\n    * keigai.util.array.min( [5, 3, 9, 1, 4] ); // 1\n    */\n\t\t\tmin: function (obj) {\n\t\t\t\treturn array.sorted(array.clone(obj))[0];\n\t\t\t},\n\n\t\t\t/**\n    * Mingles Arrays and returns a 2D Array\n    *\n    * @method mingle\n    * @memberOf array\n    * @param  {Array} obj1 Array to mingle\n    * @param  {Array} obj2 Array to mingle\n    * @return {Array}      2D Array\n    * @example\n    * let a = [\"a\", \"b\"],\n    *     b = [\"c\", \"d\"];\n    *\n    * keigai.util.array.mingle( a, b ); // [[\"a\", \"c\"], [\"b\", \"d\"]]\n    */\n\t\t\tmingle: function (obj1, obj2) {\n\t\t\t\tvar result = obj1.map(function (i, idx) {\n\t\t\t\t\treturn [i, obj2[idx]];\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Finds the mode value of an Array\n    *\n    * @method mode\n    * @memberOf array\n    * @param  {Array} obj Array to process\n    * @return {Mixed}     Mode value of the Array\n    * @example\n    * keigai.util.array.mode( [1, 3, 7, 1, 2, 10, 7, 7, 3, 10] );     // 7\n    * keigai.util.array.mode( [1, 3, 7, 1, 2, 10, 7, 7, 3, 10, 10] ); // [7, 10]\n    */\n\t\t\tmode: function (obj) {\n\t\t\t\tvar values = {};\n\t\t\t\tvar count = 0;\n\t\t\t\tvar mode = [];\n\t\t\t\tvar nth = undefined,\n\t\t\t\t    result = undefined;\n\n\t\t\t\t// Counting values\n\t\t\t\tarray.each(obj, function (i) {\n\t\t\t\t\tif (!isNaN(values[i])) {\n\t\t\t\t\t\tvalues[i]++;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalues[i] = 1;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Finding the highest occurring count\n\t\t\t\tcount = array.max(array.cast(values));\n\n\t\t\t\t// Finding values that match the count\n\t\t\t\tutility.iterate(values, function (v, k) {\n\t\t\t\t\tif (v === count) {\n\t\t\t\t\t\tmode.push(number.parse(k));\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Determining the result\n\t\t\t\tnth = mode.length;\n\n\t\t\t\tif (nth > 0) {\n\t\t\t\t\tresult = nth === 1 ? mode[0] : mode;\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Finds the range of the Array ( of numbers ) values\n    *\n    * @method range\n    * @memberOf array\n    * @param  {Array} obj Array to process\n    * @return {Number}    Range of the array ( float or integer )\n    * @example\n    * keigai.util.array.range( [5, 1, 3, 8] ); // 7\n    */\n\t\t\trange: function (obj) {\n\t\t\t\treturn array.max(obj) - array.min(obj);\n\t\t\t},\n\n\t\t\t/**\n    * Searches a 2D Array `obj` for the first match of `arg` as a second index\n    *\n    * @method rassoc\n    * @memberOf array\n    * @param  {Array} obj 2D Array to search\n    * @param  {Mixed} arg Primitive to find\n    * @return {Mixed}     Array or undefined\n    * @example\n    * keigai.util.array.rassoc( [[1, 3], [7, 2], [4, 3]], 3 ); // [1, 3]\n    */\n\t\t\trassoc: function (obj, arg) {\n\t\t\t\tvar result = undefined;\n\n\t\t\t\tarray.each(obj, function (i, idx) {\n\t\t\t\t\tif (i[1] === arg) {\n\t\t\t\t\t\tresult = utility.clone(obj[idx], true);\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Returns Array containing the items in `obj` for which `fn()` is not true\n    *\n    * @method reject\n    * @memberOf array\n    * @param  {Array}    obj Array to iterate\n    * @param  {Function} fn  Function to execute against `obj` indices\n    * @return {Array}        Array of indices which fn() is not true\n    * @example\n    * keigai.util.array.reject( [0, 1, 2, 3, 4, 5], function ( i ) { return i % 2 > 0; } ); // [0, 2, 4]\n    */\n\t\t\treject: function (obj, fn) {\n\t\t\t\treturn array.diff(obj, obj.filter(fn));\n\t\t\t},\n\n\t\t\t/**\n    * Removes indices from an Array without recreating it\n    *\n    * @method remove\n    * @memberOf array\n    * @param  {Array}  obj   Array to remove from\n    * @param  {Mixed}  start Starting index, or value to find within obj\n    * @param  {Number} end   [Optional] Ending index\n    * @return {Array}        Modified Array\n    * @example\n    * let myArray = [\"a\", \"b\", \"c\", \"d\", \"e\"];\n    *\n    * keigai.util.array.remove( myArray, 2, 3 );\n    * myArray[2]; // \"e\"\n    */\n\t\t\tremove: function (obj, start, end) {\n\t\t\t\tif (isNaN(start)) {\n\t\t\t\t\tstart = array.index(obj, start);\n\n\t\t\t\t\tif (start === -1) {\n\t\t\t\t\t\treturn obj;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tstart = start || 0;\n\t\t\t\t}\n\n\t\t\t\tvar length = obj.length;\n\t\t\t\tvar remaining = obj.slice((end || start) + 1 || length);\n\n\t\t\t\tobj.length = start < 0 ? length + start : start;\n\t\t\t\tobj.push.apply(obj, remaining);\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Deletes every element of `obj` for which `fn` evaluates to true\n    *\n    * @method removeIf\n    * @memberOf array\n    * @param  {Array}    obj Array to iterate\n    * @param  {Function} fn  Function to test indices against\n    * @return {Array}        Array\n    * @example\n    * let myArray = [\"a\", \"b\", \"c\"];\n    *\n    * keigai.util.array.removeIf( myArray, function ( i ) { return /a|c/.test( i ); } );\n    * myArray[0]; // \"b\"\n    */\n\t\t\tremoveIf: function (obj, fn) {\n\t\t\t\tvar remove = obj.filter(fn);\n\n\t\t\t\tarray.each(remove, function (i) {\n\t\t\t\t\tarray.remove(obj, array.index(obj, i));\n\t\t\t\t});\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Deletes elements of `obj` until `fn` evaluates to false\n    *\n    * @method removeWhile\n    * @memberOf array\n    * @param  {Array}    obj Array to iterate\n    * @param  {Function} fn  Function to test indices against\n    * @return {Array}        Array\n    * @example\n    * let myArray = [\"a\", \"b\", \"c\"];\n    *\n    * keigai.util.array.removeWhile( myArray, function ( i ) { return /a|c/.test( i ); } );\n    * myArray[0];     // \"b\"\n    * myArray.length; // 2\n    */\n\t\t\tremoveWhile: function (obj, fn) {\n\t\t\t\tvar remove = [];\n\n\t\t\t\tarray.each(obj, function (i) {\n\t\t\t\t\tif (fn(i) !== false) {\n\t\t\t\t\t\tremove.push(i);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tarray.each(remove, function (i) {\n\t\t\t\t\tarray.remove(obj, array.index(obj, i));\n\t\t\t\t});\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Replaces the contents of `obj` with `arg`\n    *\n    * @method replace\n    * @memberOf array\n    * @param  {Array} obj1 Array to modify\n    * @param  {Array} obj2 Array to values to push into `obj1`\n    * @return {Array}      Array to modify\n    * @example\n    * let myArray = [\"a\", \"b\", \"c\"];\n    *\n    * keigai.util.array.replace( myArray, [true, false] );\n    * myArray[0];     // true\n    * myArray.length; // 2\n    */\n\t\t\treplace: function (obj1, obj2) {\n\t\t\t\tarray.remove(obj1, 0, obj1.length);\n\t\t\t\tarray.each(obj2, function (i) {\n\t\t\t\t\tobj1.push(i);\n\t\t\t\t});\n\n\t\t\t\treturn obj1;\n\t\t\t},\n\n\t\t\t/**\n    * Returns the \"rest\" of `obj` from `arg`\n    *\n    * @method rest\n    * @memberOf array\n    * @param  {Array}  obj Array to process\n    * @param  {Number} arg [Optional] Start position of subset of `obj` ( positive number only )\n    * @return {Array}      Array of a subset of `obj`\n    * @example\n    * keigai.util.array.rest( [1, 2, 3, 4, 5, 6] );    // [2, 3, 4, 5, 6]\n    * keigai.util.array.rest( [1, 2, 3, 4, 5, 6], 3 ); // [4, 5, 6]\n    */\n\t\t\trest: function (obj) {\n\t\t\t\tvar arg = arguments[1] === undefined ? 1 : arguments[1];\n\t\t\t\tif (arg < 1) {\n\t\t\t\t\targ = 1;\n\t\t\t\t}\n\n\t\t\t\treturn array.limit(obj, arg, obj.length);\n\t\t\t},\n\n\t\t\t/**\n    * Finds the last index of `arg` in `obj`\n    *\n    * @method rindex\n    * @memberOf array\n    * @param  {Array} obj Array to search\n    * @param  {Mixed} arg Primitive to find\n    * @return {Mixed}     Index or undefined\n    * @example\n    * keigai.util.array.rindex( [1, 2, 3, 2, 1], 2 ); // 3\n    */\n\t\t\trindex: function (obj, arg) {\n\t\t\t\tvar result = -1;\n\n\t\t\t\tarray.each(obj, function (i, idx) {\n\t\t\t\t\tif (i === arg) {\n\t\t\t\t\t\tresult = idx;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Returns new Array with `arg` moved to the first index\n    *\n    * @method rotate\n    * @memberOf array\n    * @param  {Array}  obj Array to rotate\n    * @param  {Number} arg Index to become the first index, if negative the rotation is in the opposite direction\n    * @return {Array}      Newly rotated Array\n    * @example\n    * keigai.util.array.rotate( [0, 1, 2, 3, 4],  3 )[0] // 2;\n    * keigai.util.array.rotate( [0, 1, 2, 3, 4], -2 )[0] // 3;\n    */\n\t\t\trotate: function (obj, arg) {\n\t\t\t\tvar nth = obj.length;\n\t\t\t\tvar result = undefined;\n\n\t\t\t\tif (arg === 0) {\n\t\t\t\t\tresult = obj;\n\t\t\t\t} else {\n\t\t\t\t\tif (arg < 0) {\n\t\t\t\t\t\targ += nth;\n\t\t\t\t\t} else {\n\t\t\t\t\t\targ--;\n\t\t\t\t\t}\n\n\t\t\t\t\tresult = array.limit(obj, arg, nth);\n\t\t\t\t\tresult = result.concat(array.limit(obj, 0, arg));\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Generates a series Array\n    *\n    * @method series\n    * @memberOf array\n    * @param  {Number} start  Start value the series\n    * @param  {Number} end    [Optional] The end of the series\n    * @param  {Number} offset [Optional] Offset for indices, default is 1\n    * @return {Array}         Array of new series\n    * @example\n    * keigai.util.array.series( 0, 5 );     // [0, 1, 2, 3, 4]\n    * keigai.util.array.series( 0, 25, 5 ); // [0, 5, 10, 15, 20]\n    */\n\t\t\tseries: function (_x, end) {\n\t\t\t\tvar start = arguments[0] === undefined ? 0 : arguments[0];\n\t\t\t\tvar offset = arguments[2] === undefined ? 1 : arguments[2];\n\t\t\t\tend = end || start;\n\n\t\t\t\tvar result = [];\n\t\t\t\tvar n = -1;\n\t\t\t\tvar nth = Math.max(0, Math.ceil((end - start) / offset));\n\n\t\t\t\twhile (++n < nth) {\n\t\t\t\t\tresult[n] = start;\n\t\t\t\t\tstart += offset;\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Sorts the Array by parsing values\n    *\n    * @method sort\n    * @memberOf array\n    * @param  {Mixed} a Argument to compare\n    * @param  {Mixed} b Argument to compare\n    * @return {Number}  Number indicating sort order\n    * @example\n    * keigai.util.array.sort( 2, 3 ); // -1\n    */\n\t\t\tsort: function (a, b) {\n\t\t\t\tvar types = { a: typeof a, b: typeof b };\n\t\t\t\tvar c = undefined,\n\t\t\t\t    d = undefined,\n\t\t\t\t    result = undefined;\n\n\t\t\t\tif (types.a === \"number\" && types.b === \"number\") {\n\t\t\t\t\tresult = a - b;\n\t\t\t\t} else {\n\t\t\t\t\tc = a.toString();\n\t\t\t\t\td = b.toString();\n\n\t\t\t\t\tif (c < d) {\n\t\t\t\t\t\tresult = -1;\n\t\t\t\t\t} else if (c > d) {\n\t\t\t\t\t\tresult = 1;\n\t\t\t\t\t} else if (types.a === types.b) {\n\t\t\t\t\t\tresult = 0;\n\t\t\t\t\t} else if (types.a === \"boolean\") {\n\t\t\t\t\t\tresult = -1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult = 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Sorts `obj` using `array.sort`\n    *\n    * @method sorted\n    * @memberOf array\n    * @param  {Array} obj Array to sort\n    * @return {Array}     Sorted Array\n    * @example\n    * let myArray = [5, 9, 2, 4];\n    *\n    * keigai.util.array.sorted( myArray );\n    * myArray[0]; // 2\n    */\n\t\t\tsorted: function (obj) {\n\t\t\t\treturn obj.sort(array.sort);\n\t\t\t},\n\n\t\t\t/**\n    * Splits an Array by divisor\n    *\n    * @method split\n    * @memberOf array\n    * @param  {Array}  obj     Array to process\n    * @param  {Number} divisor Integer to divide the Array by\n    * @return {Array}          Split Array\n    * @example\n    * let myArray = [],\n    *     i       = -1,\n    *     results;\n    *\n    * while ( ++i < 100 ) {\n   \t *   myArray.push( i + 1 );\n   \t * }\n    *\n    * results = keigai.util.array.split( myArray, 21 );\n    * results.length;     // 21\n    * results[0].length;  // 5\n    * results[19].length; // 4\n    * results[19][0];     // 99\n    * results[20].length; // 1\n    * results[20][0];     // 100\n    */\n\t\t\tsplit: function (obj, divisor) {\n\t\t\t\tvar result = [];\n\t\t\t\tvar total = obj.length;\n\t\t\t\tvar nth = Math.ceil(total / divisor);\n\t\t\t\tvar low = Math.floor(total / divisor);\n\t\t\t\tvar lower = Math.ceil(total / nth);\n\t\t\t\tvar lowered = false;\n\t\t\t\tvar start = 0;\n\t\t\t\tvar i = -1;\n\n\t\t\t\t// Finding the fold\n\t\t\t\tif (number.diff(total, divisor * nth) > nth) {\n\t\t\t\t\tlower = total - low * divisor + low - 1;\n\t\t\t\t} else if (total % divisor > 0 && lower * nth >= total) {\n\t\t\t\t\tlower--;\n\t\t\t\t}\n\n\t\t\t\twhile (++i < divisor) {\n\t\t\t\t\tif (i > 0) {\n\t\t\t\t\t\tstart = start + nth;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!lowered && lower < divisor && i === lower) {\n\t\t\t\t\t\t--nth;\n\t\t\t\t\t\tlowered = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tresult.push(array.limit(obj, start, nth));\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Finds the standard deviation of an Array ( of numbers )\n    *\n    * @method stddev\n    * @memberOf array\n    * @param  {Array} obj Array to process\n    * @return {Number}    Standard deviation of the Array ( float or integer )\n    * @example\n    * keigai.util.array.stddev( [1, 3, 5] ); // 1.632993161855452\n    */\n\t\t\tstddev: function (obj) {\n\t\t\t\treturn Math.sqrt(array.variance(obj));\n\t\t\t},\n\n\t\t\t/**\n    * Gets the summation of an Array of numbers\n    *\n    * @method sum\n    * @memberOf array\n    * @param  {Array} obj Array to sum\n    * @return {Number}    Summation of Array\n    * @example\n    * keigai.util.array.sum( [2, 4, 3, 1] ); // 10\n    */\n\t\t\tsum: function (obj) {\n\t\t\t\tvar result = 0;\n\n\t\t\t\tif (obj.length > 0) {\n\t\t\t\t\tresult = obj.reduce(function (prev, cur) {\n\t\t\t\t\t\treturn prev + cur;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Takes the first `n` indices from `obj`\n    *\n    * @method take\n    * @memberOf array\n    * @param  {Array}  obj Array to process\n    * @param  {Number} n   Offset from 0 to return\n    * @return {Array}      Subset of `obj`\n    * @example\n    * keigai.util.array.take( [1, 2, 3, 4], 2 ); // [1, 2]\n    */\n\t\t\ttake: function (obj, n) {\n\t\t\t\treturn array.limit(obj, 0, n);\n\t\t\t},\n\n\t\t\t/**\n    * Casts an Array to Object\n    *\n    * @method toObject\n    * @memberOf array\n    * @param  {Array} ar Array to transform\n    * @return {Object}   New object\n    * @example\n    * keigai.util.array.toObject( [\"abc\", \"def\"] ); // {0: \"abc\", 1: \"def\"}\n    */\n\t\t\ttoObject: function (ar) {\n\t\t\t\tvar obj = {};\n\t\t\t\tvar i = ar.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tobj[i.toString()] = ar[i];\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Gets the total keys in an Array\n    *\n    * @method total\n    * @memberOf array\n    * @param  {Array} obj Array to find the length of\n    * @return {Number}    Number of keys in Array\n    * @example\n    * let myArray = [true, true, false];\n    *\n    * myArray.extra = true;\n    * keigai.util.array.total( myArray ); // 4\n    */\n\t\t\ttotal: function (obj) {\n\t\t\t\treturn array.indexed(obj).length;\n\t\t\t},\n\n\t\t\t/**\n    * Returns an Array of unique indices of `obj`\n    *\n    * @method unique\n    * @memberOf array\n    * @param  {Array} obj Array to process\n    * @return {Array}     Array of unique indices\n    * @example\n    * keigai.util.array.unique( [\"a\", \"b\", \"a\", \"c\", \"b\", \"d\"] ); // [\"a\", \"b\", \"c\", \"d\"]\n    */\n\t\t\tunique: function (obj) {\n\t\t\t\tvar result = [];\n\n\t\t\t\tarray.each(obj, function (i) {\n\t\t\t\t\tarray.add(result, i);\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Finds the variance of an Array ( of numbers )\n    *\n    * @method variance\n    * @memberOf array\n    * @param  {Array} obj Array to process\n    * @return {Number}    Variance of the Array ( float or integer )\n    * @example\n    * keigai.util.array.variance( [1, 3, 5] ); // 2.6666666666666665\n    */\n\t\t\tvariance: function (obj) {\n\t\t\t\tvar nth = obj.length;\n\t\t\t\tvar n = 0;\n\t\t\t\tvar mean = undefined;\n\n\t\t\t\tif (nth > 0) {\n\t\t\t\t\tmean = array.mean(obj);\n\n\t\t\t\t\tarray.each(obj, function (i) {\n\t\t\t\t\t\tn += math.sqr(i - mean);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn n / nth;\n\t\t\t\t} else {\n\t\t\t\t\treturn n;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n    * Converts any arguments to Arrays, then merges elements of `obj` with corresponding elements from each argument\n    *\n    * @method zip\n    * @memberOf array\n    * @param  {Array} obj  Array to transform\n    * @param  {Mixed} args Argument instance or Array to merge\n    * @return {Array}      Array\n    * @example\n    * keigai.util.array.zip( [0, 1], 1 ); // [[0, 1], [1, null]]\n    */\n\t\t\tzip: function (obj, args) {\n\t\t\t\tvar result = [];\n\n\t\t\t\t// Preparing args\n\t\t\t\tif (!(args instanceof Array)) {\n\t\t\t\t\targs = typeof args === \"object\" ? array.cast(args) : [args];\n\t\t\t\t}\n\n\t\t\t\tarray.each(args, function (i, idx) {\n\t\t\t\t\tif (!(i instanceof Array)) {\n\t\t\t\t\t\targs[idx] = [i];\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Building result Array\n\t\t\t\tarray.each(obj, function (i, idx) {\n\t\t\t\t\tresult[idx] = [i];\n\t\t\t\t\tarray.each(args, function (x) {\n\t\t\t\t\t\tresult[idx].push(x[idx] || null);\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t}\n\t\t};\n\n\t\t/**\n   * @namespace cache\n   * @private\n   */\n\t\tvar cache = {\n\t\t\t/**\n    * Collection URIs\n    *\n    * @memberOf cache\n    * @type {Object}\n    */\n\t\t\tlru: lru.factory(CACHE),\n\n\t\t\t/**\n    * Expires a URI from the local cache\n    *\n    * @method expire\n    * @memberOf cache\n    * @param  {String} uri URI of the local representation\n    * @return {Boolean} `true` if successful\n    */\n\t\t\texpire: function (uri) {\n\t\t\t\tif (cache.lru.cache[uri]) {\n\t\t\t\t\tcache.lru.remove(uri);\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\n\t\t\t/**\n    * Determines if a URI has expired\n    *\n    * @method expired\n    * @memberOf cache\n    * @param  {Object} uri Cached URI object\n    * @return {Boolean}    True if the URI has expired\n    */\n\t\t\texpired: function (uri) {\n\t\t\t\tvar item = cache.lru.cache[uri];\n\n\t\t\t\treturn item && item.value.expires < new Date().getTime();\n\t\t\t},\n\n\t\t\t/**\n    * Returns the cached object {headers, response} of the URI or false\n    *\n    * @method get\n    * @memberOf cache\n    * @param  {String}  uri    URI/Identifier for the resource to retrieve from cache\n    * @param  {Boolean} expire [Optional] If 'false' the URI will not expire\n    * @param  {Boolean} silent [Optional] If 'true', the event will not fire\n    * @return {Mixed}          URI Object {headers, response} or False\n    */\n\t\t\tget: function (uri, expire) {\n\t\t\t\turi = utility.parse(uri).href;\n\t\t\t\tvar item = cache.lru.get(uri);\n\n\t\t\t\tif (!item) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (expire !== false && cache.expired(uri)) {\n\t\t\t\t\tcache.expire(uri);\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn utility.clone(item, true);\n\t\t\t},\n\n\t\t\t/**\n    * Sets, or updates an item in cache.items\n    *\n    * @method set\n    * @memberOf cache\n    * @param  {String} uri      URI to set or update\n    * @param  {String} property Property of the cached URI to set\n    * @param  {Mixed} value     Value to set\n    * @return {Mixed}           URI Object {headers, response} or undefined\n    */\n\t\t\tset: function (uri, property, value) {\n\t\t\t\turi = utility.parse(uri).href;\n\t\t\t\tvar item = cache.lru.get(uri);\n\n\t\t\t\tif (!item) {\n\t\t\t\t\titem = {\n\t\t\t\t\t\tpermission: 0\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (property === \"permission\") {\n\t\t\t\t\titem.permission |= value;\n\t\t\t\t} else if (property === \"!permission\") {\n\t\t\t\t\titem.permission &= ~value;\n\t\t\t\t} else {\n\t\t\t\t\titem[property] = value;\n\t\t\t\t}\n\n\t\t\t\tcache.lru.set(uri, item);\n\n\t\t\t\treturn item;\n\t\t\t}\n\t\t};\n\n\t\t/**\n   * Custom Object returned from `client.request()`\n   *\n   * @constructor\n   * @memberOf keigai\n   * @extends {keigai.Base}\n   * @param {Object} xhr XMLHttpRequest\n   */\n\t\tvar KXMLHttpRequest = (function (Base) {\n\t\t\tfunction KXMLHttpRequest(xhr) {\n\t\t\t\t_classCallCheck(this, KXMLHttpRequest);\n\n\t\t\t\tthis.observer = observable.factory();\n\t\t\t\tthis.defer = deferred.factory();\n\t\t\t\tthis.xhr = xhr;\n\t\t\t}\n\n\t\t\t_inherits(KXMLHttpRequest, Base);\n\n\t\t\treturn KXMLHttpRequest;\n\t\t})(Base);\n\n\t\t/**\n   * @namespace client\n   */\n\t\tvar client = {\n\t\t\t/**\n    * Array Buffer is available\n    *\n    * @memberOf client\n    * @type {Boolean}\n    * @private\n    */\n\t\t\tab: typeof ArrayBuffer != \"undefined\",\n\n\t\t\t/**\n    * Blob is available\n    *\n    * @memberOf client\n    * @type {Boolean}\n    * @private\n    */\n\t\t\tblob: typeof Blob != \"undefined\",\n\n\t\t\t/**\n    * Document is available\n    *\n    * @memberOf client\n    * @type {Boolean}\n    * @private\n    */\n\t\t\tdoc: typeof Document != \"undefined\",\n\n\t\t\t/**\n    * Internet Explorer browser\n    *\n    * @memberOf client\n    * @type {Boolean}\n    * @private\n    */\n\t\t\tie: (function () {\n\t\t\t\treturn !server && regex.ie.test(navigator.userAgent);\n\t\t\t})(),\n\n\t\t\t/**\n    * Client version\n    *\n    * @memberOf client\n    * @type {Number}\n    * @private\n    */\n\t\t\tversion: function () {\n\t\t\t\tvar result = 0;\n\n\t\t\t\tif (client.ie) {\n\t\t\t\t\tresult = number.parse(string.trim(navigator.userAgent.replace(/( .*msie|;.*)/gi, \"\")) || 9, 10);\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Quick way to see if a URI allows a specific verb\n    *\n    * @method allows\n    * @memberOf client\n    * @param  {String} uri  URI to query\n    * @param  {String} verb HTTP verb\n    * @return {Boolean}     `true` if the verb is allowed, undefined if unknown\n    * @private\n    */\n\t\t\tallows: function (uri, verb) {\n\t\t\t\turi = utility.parse(uri).href;\n\t\t\t\tverb = verb.toLowerCase();\n\n\t\t\t\tvar result = false;\n\t\t\t\tvar bit = 0;\n\n\t\t\t\tif (!cache.get(uri, false)) {\n\t\t\t\t\tresult = undefined;\n\t\t\t\t} else {\n\t\t\t\t\tif (regex.del.test(verb)) {\n\t\t\t\t\t\tbit = 1;\n\t\t\t\t\t} else if (regex.get_headers.test(verb)) {\n\t\t\t\t\t\tbit = 4;\n\t\t\t\t\t} else if (regex.put_post.test(verb)) {\n\t\t\t\t\t\tbit = 2;\n\t\t\t\t\t} else if (regex.patch.test(verb)) {\n\t\t\t\t\t\tbit = 8;\n\t\t\t\t\t}\n\n\t\t\t\t\tresult = Boolean(client.permissions(uri, verb).bit & bit);\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Gets bit value based on args\n    *\n    * @method bit\n    * @memberOf client\n    * @param  {Array} args Array of commands the URI accepts\n    * @return {Number} To be set as a bit\n    * @private\n    */\n\t\t\tbit: function (args) {\n\t\t\t\tvar result = 0;\n\n\t\t\t\tarray.each(args, function (verb) {\n\t\t\t\t\tverb = verb.toLowerCase();\n\n\t\t\t\t\tif (regex.get_headers.test(verb)) {\n\t\t\t\t\t\tresult |= 4;\n\t\t\t\t\t} else if (regex.put_post.test(verb)) {\n\t\t\t\t\t\tresult |= 2;\n\t\t\t\t\t} else if (regex.patch.test(verb)) {\n\t\t\t\t\t\tresult |= 8;\n\t\t\t\t\t} else if (regex.del.test(verb)) {\n\t\t\t\t\t\tresult |= 1;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Determines if a URI is a CORS end point\n    *\n    * @method cors\n    * @memberOf client\n    * @param  {String} uri  URI to parse\n    * @return {Boolean}     True if CORS\n    * @private\n    */\n\t\t\tcors: function (uri) {\n\t\t\t\treturn !server && uri.indexOf(\"//\") > -1 && uri.indexOf(\"//\" + location.host) === -1;\n\t\t\t},\n\n\t\t\t/**\n    * Caches the headers from the XHR response\n    *\n    * @method headers\n    * @memberOf client\n    * @param  {Object} xhr  XMLHttpRequest Object\n    * @param  {String} uri  URI to request\n    * @param  {String} type Type of request\n    * @return {Object}      Cached URI representation\n    * @private\n    */\n\t\t\theaders: function (xhr, uri, type) {\n\t\t\t\tvar headers = string.trim(xhr.getAllResponseHeaders()).split(\"\\n\");\n\t\t\t\tvar items = {};\n\t\t\t\tvar o = {};\n\t\t\t\tvar allow = null;\n\t\t\t\tvar expires = new Date();\n\t\t\t\tvar cors = client.cors(uri);\n\n\t\t\t\tarray.each(headers, function (i) {\n\t\t\t\t\tvar header = i.split(\": \");\n\n\t\t\t\t\titems[header[0].toLowerCase()] = string.trim(header[1]);\n\n\t\t\t\t\tif (allow === null) {\n\t\t\t\t\t\tif (!cors && regex.allow.test(header) || cors && regex.allow_cors.test(header)) {\n\t\t\t\t\t\t\tallow = header[1];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (regex.no.test(items[\"cache-control\"])) {\n\t\t\t\t\texpires = expires.getTime();\n\t\t\t\t} else if (items[\"cache-control\"] && regex.number_present.test(items[\"cache-control\"])) {\n\t\t\t\t\texpires = expires.setSeconds(expires.getSeconds() + number.parse(regex.number_present.exec(items[\"cache-control\"])[0], 10));\n\t\t\t\t} else if (items.expires) {\n\t\t\t\t\texpires = new Date(items.expires).getTime();\n\t\t\t\t} else {\n\t\t\t\t\texpires = expires.getTime();\n\t\t\t\t}\n\n\t\t\t\to.expires = expires;\n\t\t\t\to.headers = items;\n\t\t\t\to.timestamp = new Date();\n\t\t\t\to.permission = client.bit(allow !== null ? string.explode(allow) : [type]);\n\n\t\t\t\tif (type === \"get\") {\n\t\t\t\t\tcache.set(uri, \"expires\", o.expires);\n\t\t\t\t\tcache.set(uri, \"headers\", o.headers);\n\t\t\t\t\tcache.set(uri, \"timestamp\", o.timestamp);\n\t\t\t\t\tcache.set(uri, \"permission\", o.permission);\n\t\t\t\t}\n\n\t\t\t\treturn o;\n\t\t\t},\n\n\t\t\t/**\n    * Parses an XHR response\n    *\n    * @method parse\n    * @memberOf client\n    * @param  {Object} xhr  XHR Object\n    * @param  {String} type [Optional] content-type header value\n    * @return {Mixed}       Array, Boolean, Document, Number, Object or String\n    * @private\n    */\n\t\t\tparse: function (xhr) {\n\t\t\t\tvar type = arguments[1] === undefined ? \"\" : arguments[1];\n\t\t\t\tvar result = undefined,\n\t\t\t\t    obj = undefined;\n\n\t\t\t\tif ((regex.json_maybe.test(type) || string.isEmpty(type)) && (regex.json_wrap.test(xhr.responseText) && Boolean(obj = json.decode(xhr.responseText, true)))) {\n\t\t\t\t\tresult = obj;\n\t\t\t\t} else if (type === \"text/csv\") {\n\t\t\t\t\tresult = csv.decode(xhr.responseText);\n\t\t\t\t} else if (type === \"text/tsv\") {\n\t\t\t\t\tresult = csv.decode(xhr.responseText, \"\\t\");\n\t\t\t\t} else if (regex.xml.test(type)) {\n\t\t\t\t\tif (type !== \"text/xml\") {\n\t\t\t\t\t\txhr.overrideMimeType(\"text/xml\");\n\t\t\t\t\t}\n\n\t\t\t\t\tresult = xhr.responseXML;\n\t\t\t\t} else if (type === \"text/plain\" && regex.is_xml.test(xhr.responseText) && xml.valid(xhr.responseText)) {\n\t\t\t\t\tresult = xml.decode(xhr.responseText);\n\t\t\t\t} else {\n\t\t\t\t\tresult = xhr.responseText;\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Returns the permission of the cached URI\n    *\n    * @method permissions\n    * @memberOf client\n    * @param  {String} uri URI to query\n    * @return {Object}     Contains an Array of available commands, the permission bit and a map\n    * @private\n    */\n\t\t\tpermissions: function (uri) {\n\t\t\t\tvar cached = cache.get(uri, false);\n\t\t\t\tvar bit = !cached ? 0 : cached.permission;\n\t\t\t\tvar result = { allows: [], bit: bit, map: { partial: 8, read: 4, write: 2, \"delete\": 1, unknown: 0 } };\n\n\t\t\t\tif (bit & 1) {\n\t\t\t\t\tresult.allows.push(\"DELETE\");\n\t\t\t\t}\n\n\t\t\t\tif (bit & 2) {\n\t\t\t\t\tresult.allows.push(\"POST\");\n\t\t\t\t\tresult.allows.push(\"PUT\");\n\t\t\t\t}\n\n\t\t\t\tif (bit & 4) {\n\t\t\t\t\tresult.allows.push(\"GET\");\n\t\t\t\t}\n\n\t\t\t\tif (bit & 8) {\n\t\t\t\t\tresult.allows.push(\"PATCH\");\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Creates a JSONP request\n    *\n    * @method jsonp\n    * @memberOf client\n    * @param  {String} uri  URI to request\n    * @param  {Mixed}  args Custom JSONP handler parameter name, default is \"callback\"; or custom headers for GET request ( CORS )\n    * @return {Object} {@link keigai.Deferred}\n    * @example\n    * keigai.util.jsonp( \"http://somedomain.com/resource?callback=\", function ( arg ) {\n    *   // `arg` is the coerced response body\n    * }, function ( err ) {\n    *   // Handle `err`\n    * } );\n    */\n\t\t\tjsonp: function (uri, args) {\n\t\t\t\tvar defer = deferred.factory();\n\t\t\t\tvar callback = \"callback\";\n\t\t\t\tvar cbid = undefined,\n\t\t\t\t    s = undefined;\n\n\t\t\t\tif (external === undefined) {\n\t\t\t\t\tif (!global.keigai) {\n\t\t\t\t\t\tglobal.keigai = { callback: {} };\n\t\t\t\t\t}\n\n\t\t\t\t\texternal = \"keigai\";\n\t\t\t\t}\n\n\t\t\t\tif (args instanceof Object && !args.callback) {\n\t\t\t\t\tcallback = args.callback;\n\t\t\t\t}\n\n\t\t\t\tdo {\n\t\t\t\t\tcbid = utility.genId().slice(0, 10);\n\t\t\t\t} while (global.callback[cbid]);\n\n\t\t\t\turi = uri.replace(callback + \"=?\", callback + \"=\" + external + \".callback.\" + cbid);\n\n\t\t\t\tglobal.callback[cbid] = function (arg) {\n\t\t\t\t\tutility.clearTimers(cbid);\n\t\t\t\t\tdelete global.callback[cbid];\n\t\t\t\t\tdefer.resolve(arg);\n\t\t\t\t\telement.destroy(s);\n\t\t\t\t};\n\n\t\t\t\ts = element.create(\"script\", { src: uri, type: \"text/javascript\" }, utility.dom(\"head\")[0]);\n\n\t\t\t\tutility.defer(function () {\n\t\t\t\t\tdefer.reject(new Error(label.requestTimeout));\n\t\t\t\t}, 30000, cbid);\n\n\t\t\t\treturn defer;\n\t\t\t},\n\n\t\t\t/**\n    * KXMLHttpRequest factory\n    *\n    * @method kxhr\n    * @memberOf client\n    * @param {Object} xhr XMLHttpRequest\n    * @return {Object} {@link keigai.KXMLHttpRequest}\n    * @private\n    */\n\t\t\tkxhr: function (xhr) {\n\t\t\t\tvar obj = new KXMLHttpRequest(xhr);\n\n\t\t\t\t// Wrapping deferred methods on obj\n\t\t\t\tarray.each(array.keys(Deferred.prototype), function (i) {\n\t\t\t\t\tobj[i] = function () {\n\t\t\t\t\t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\t\t\t\t\targs[_key] = arguments[_key];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn obj.defer[i].apply(obj.defer, args);\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\t// Hooking observer for standard events\n\t\t\t\tarray.each(EVENTS, function (i) {\n\t\t\t\t\tobj.hook(obj.xhr, i);\n\t\t\t\t});\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Creates an XmlHttpRequest to a URI ( aliased to multiple methods )\n    *\n    * The returned Deferred will have an .xhr\n    *\n    * @method request\n    * @memberOf client\n    * @param  {String}   uri     URI to query\n    * @param  {String}   type    [Optional] Type of request ( DELETE/GET/POST/PUT/PATCH/HEAD/OPTIONS ), default is `GET`\n    * @param  {Mixed}    args    [Optional] Data to send with the request\n    * @param  {Object}   headers [Optional] Custom request headers ( can be used to set withCredentials )\n    * @return {Object}   {@link keigai.KXMLHttpRequest}\n    * @example\n    * keigai.util.request( \"http://keigai.io\" ).then( function ( arg ) {\n    *   // `arg` is the coerced response body\n    * }, function ( err ) {\n    *   // Handle `err`\n    * } );\n    */\n\t\t\trequest: function (uri, _x, args, headers) {\n\t\t\t\tvar type = arguments[1] === undefined ? \"GET\" : arguments[1];\n\t\t\t\turi = utility.parse(uri).href;\n\t\t\t\ttype = type.toLowerCase();\n\t\t\t\theaders = headers instanceof Object ? headers : null;\n\n\t\t\t\tvar cors = client.cors(uri);\n\t\t\t\tvar kxhr = client.kxhr(!client.ie || (!cors || client.version > 9) ? new XMLHttpRequest() : new XDomainRequest());\n\t\t\t\tvar payload = (regex.put_post.test(type) || regex.patch.test(type)) && args ? args : null;\n\t\t\t\tvar cached = type === \"get\" ? cache.get(uri) : false;\n\t\t\t\tvar contentType = null;\n\t\t\t\tvar doc = client.doc;\n\t\t\t\tvar ab = client.ab;\n\t\t\t\tvar blob = client.blob;\n\n\t\t\t\t// Only GET & POST is supported by XDomainRequest (so useless!)\n\t\t\t\tif (client.ie && client.version === 9 && cors && !regex.xdomainrequest.test(type)) {\n\t\t\t\t\tthrow new Error(label.notAvailable);\n\t\t\t\t}\n\n\t\t\t\t// Hooking custom events\n\t\t\t\tkxhr.on(\"readystatechange\", function (ev) {\n\t\t\t\t\tvar state = kxhr.xhr.readyState;\n\n\t\t\t\t\tif (state === 1) {\n\t\t\t\t\t\tkxhr.dispatch(\"beforeXHR\", kxhr.xhr, ev);\n\t\t\t\t\t} else if (state === 4) {\n\t\t\t\t\t\tkxhr.dispatch(\"afterXHR\", kxhr.xhr, ev);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (!cors && !regex.get_headers.test(type) && client.allows(uri, type) === false) {\n\t\t\t\t\tkxhr.dispatch(\"beforeXHR\", kxhr.xhr, null);\n\t\t\t\t\tkxhr.xhr.status = 405;\n\t\t\t\t\tkxhr.reject(new Error(label.methodNotAllowed));\n\t\t\t\t\tutility.delay(function () {\n\t\t\t\t\t\tkxhr.dispatch(\"afterXHR\", kxhr.xhr, null);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (type === \"get\" && Boolean(cached)) {\n\t\t\t\t\t// Decorating XHR for proxy behavior\n\t\t\t\t\tif (server) {\n\t\t\t\t\t\tkxhr.xhr.readyState = 4;\n\t\t\t\t\t\tkxhr.xhr.status = 200;\n\t\t\t\t\t\tkxhr.xhr._resheaders = cached.headers;\n\t\t\t\t\t}\n\n\t\t\t\t\tkxhr.dispatch(\"beforeXHR\", kxhr.xhr, null);\n\t\t\t\t\tkxhr.resolve(cached.response);\n\n\t\t\t\t\tutility.delay(function () {\n\t\t\t\t\t\tkxhr.dispatch(\"afterXHR\", kxhr.xhr, null);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tutility.delay(function () {\n\t\t\t\t\tkxhr.xhr.open(type.toUpperCase(), uri, true);\n\n\t\t\t\t\t// Setting content-type value\n\t\t\t\t\tif (headers !== null && headers.hasOwnProperty(\"content-type\")) {\n\t\t\t\t\t\tcontentType = headers[\"content-type\"];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (cors && contentType === null) {\n\t\t\t\t\t\tcontentType = \"text/plain\";\n\t\t\t\t\t}\n\n\t\t\t\t\t// Transforming payload\n\t\t\t\t\tif (payload !== null) {\n\t\t\t\t\t\tif (payload.hasOwnProperty(\"xml\")) {\n\t\t\t\t\t\t\tpayload = payload.xml;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (doc && payload instanceof Document) {\n\t\t\t\t\t\t\tpayload = xml.decode(payload);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (typeof payload === \"string\" && regex.is_xml.test(payload)) {\n\t\t\t\t\t\t\tcontentType = \"application/xml\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!(ab && payload instanceof ArrayBuffer) && !(blob && payload instanceof Blob) && !(payload instanceof Buffer) && payload instanceof Object) {\n\t\t\t\t\t\t\tcontentType = \"application/json\";\n\t\t\t\t\t\t\tpayload = json.encode(payload);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (contentType === null && (ab && payload instanceof ArrayBuffer || blob && payload instanceof Blob)) {\n\t\t\t\t\t\t\tcontentType = \"application/octet-stream\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (contentType === null) {\n\t\t\t\t\t\t\tcontentType = \"application/x-www-form-urlencoded; charset=UTF-8\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Setting headers for everything except IE9 CORS requests\n\t\t\t\t\tif (!client.ie || (!cors || client.version > 9)) {\n\t\t\t\t\t\tif (headers === null) {\n\t\t\t\t\t\t\theaders = {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (typeof cached === \"object\" && cached.headers.hasOwnProperty(\"etag\")) {\n\t\t\t\t\t\t\theaders.etag = cached.headers.etag;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (contentType !== null) {\n\t\t\t\t\t\t\theaders[\"content-type\"] = contentType;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (headers.hasOwnProperty(\"callback\")) {\n\t\t\t\t\t\t\tdelete headers.callback;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\theaders[\"x-requested-with\"] = \"XMLHttpRequest\";\n\n\t\t\t\t\t\tutility.iterate(headers, function (v, k) {\n\t\t\t\t\t\t\tif (v !== null && k !== \"withCredentials\") {\n\t\t\t\t\t\t\t\tkxhr.xhr.setRequestHeader(k, v);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Cross Origin Resource Sharing ( CORS )\n\t\t\t\t\t\tif (typeof kxhr.xhr.withCredentials === \"boolean\" && headers !== null && typeof headers.withCredentials === \"boolean\") {\n\t\t\t\t\t\t\tkxhr.xhr.withCredentials = headers.withCredentials;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tkxhr.on(\"load\", function () {\n\t\t\t\t\t\tvar self = kxhr;\n\t\t\t\t\t\tvar xdr = client.ie && self.xhr.readyState === undefined;\n\t\t\t\t\t\tvar shared = true;\n\t\t\t\t\t\tvar o = undefined,\n\t\t\t\t\t\t    r = undefined,\n\t\t\t\t\t\t    t = undefined,\n\t\t\t\t\t\t    redirect = undefined;\n\n\t\t\t\t\t\tif (!xdr && kxhr.xhr.readyState === 4) {\n\t\t\t\t\t\t\tswitch (kxhr.xhr.status) {\n\t\t\t\t\t\t\t\tcase 200:\n\t\t\t\t\t\t\t\tcase 201:\n\t\t\t\t\t\t\t\tcase 202:\n\t\t\t\t\t\t\t\tcase 203:\n\t\t\t\t\t\t\t\tcase 204:\n\t\t\t\t\t\t\t\tcase 205:\n\t\t\t\t\t\t\t\tcase 206:\n\t\t\t\t\t\t\t\t\to = client.headers(kxhr.xhr, uri, type);\n\n\t\t\t\t\t\t\t\t\tif (type === \"head\") {\n\t\t\t\t\t\t\t\t\t\treturn kxhr.resolve(o.headers);\n\t\t\t\t\t\t\t\t\t} else if (type === \"options\") {\n\t\t\t\t\t\t\t\t\t\treturn kxhr.resolve(o.headers);\n\t\t\t\t\t\t\t\t\t} else if (type !== \"delete\") {\n\t\t\t\t\t\t\t\t\t\tif (server && regex.priv.test(o.headers[\"cache-control\"])) {\n\t\t\t\t\t\t\t\t\t\t\tshared = false;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (regex.http_body.test(kxhr.xhr.status)) {\n\t\t\t\t\t\t\t\t\t\t\tt = o.headers[\"content-type\"] || \"\";\n\t\t\t\t\t\t\t\t\t\t\tr = client.parse(kxhr.xhr, t);\n\n\t\t\t\t\t\t\t\t\t\t\tif (r === undefined) {\n\t\t\t\t\t\t\t\t\t\t\t\tkxhr.reject(new Error(label.serverError));\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (type === \"get\" && shared) {\n\t\t\t\t\t\t\t\t\t\t\tcache.set(uri, \"response\", o.response = utility.clone(r, true));\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tcache.expire(uri, true);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else if (type === \"delete\") {\n\t\t\t\t\t\t\t\t\t\tcache.expire(uri, true);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tswitch (kxhr.xhr.status) {\n\t\t\t\t\t\t\t\t\t\tcase 200:\n\t\t\t\t\t\t\t\t\t\tcase 202:\n\t\t\t\t\t\t\t\t\t\tcase 203:\n\t\t\t\t\t\t\t\t\t\tcase 206:\n\t\t\t\t\t\t\t\t\t\t\tkxhr.resolve(r);\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\tcase 201:\n\t\t\t\t\t\t\t\t\t\t\tif ((o.headers.location === undefined || string.isEmpty(o.headers.location)) && !string.isUrl(r)) {\n\t\t\t\t\t\t\t\t\t\t\t\tkxhr.resolve(r);\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tredirect = string.trim(o.headers.Location || r);\n\t\t\t\t\t\t\t\t\t\t\t\tclient.request(redirect).then(function (arg) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tself.resolve(arg);\n\t\t\t\t\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tself.reject(e);\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\tcase 204:\n\t\t\t\t\t\t\t\t\t\tcase 205:\n\t\t\t\t\t\t\t\t\t\t\tkxhr.resolve(null);\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 304:\n\t\t\t\t\t\t\t\t\tkxhr.resolve(r);\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 401:\n\t\t\t\t\t\t\t\t\tkxhr.reject(new Error(kxhr.xhr.responseText || label.serverUnauthorized));\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 403:\n\t\t\t\t\t\t\t\t\tcache.set(uri, \"!permission\", client.bit([type]));\n\t\t\t\t\t\t\t\t\tkxhr.reject(new Error(kxhr.xhr.responseText || label.serverForbidden));\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 405:\n\t\t\t\t\t\t\t\t\tcache.set(uri, \"!permission\", client.bit([type]));\n\t\t\t\t\t\t\t\t\tkxhr.reject(new Error(kxhr.xhr.responseText || label.serverInvalidMethod));\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\tkxhr.reject(new Error(kxhr.xhr.responseText || label.serverError));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (xdr) {\n\t\t\t\t\t\t\tr = client.parse(kxhr.xhr, \"text/plain\");\n\t\t\t\t\t\t\tcache.set(uri, \"permission\", client.bit([\"get\"]));\n\t\t\t\t\t\t\tcache.set(uri, \"response\", r);\n\t\t\t\t\t\t\tkxhr.resolve(r);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tkxhr.on(\"error\", function (e) {\n\t\t\t\t\t\tkxhr.reject(e);\n\t\t\t\t\t});\n\n\t\t\t\t\t// Sending request\n\t\t\t\t\tkxhr.xhr.send(payload !== null ? payload : undefined);\n\t\t\t\t});\n\n\t\t\t\treturn kxhr;\n\t\t\t},\n\n\t\t\t/**\n    * Scrolls to a position in the view using a two point bezier curve\n    *\n    * @method scroll\n    * @memberOf client\n    * @param  {Array}  dest Coordinates\n    * @param  {Number} ms   [Optional] Milliseconds to scroll, default is 250, min is 100\n    * @return {Object} {@link Deferred}\n    * @private\n    */\n\t\t\tscroll: function (dest, ms) {\n\t\t\t\tvar defer = deferred();\n\t\t\t\tvar start = client.scrollPos();\n\t\t\t\tvar t = 0;\n\n\t\t\t\tms = (!isNaN(ms) ? ms : 250) / 100;\n\n\t\t\t\tutility.repeat(function () {\n\t\t\t\t\tvar pos = math.bezier(start[0], start[1], dest[0], dest[1], ++t / 100);\n\n\t\t\t\t\twindow.scrollTo(pos[0], pos[1]);\n\n\t\t\t\t\tif (t === 100) {\n\t\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}, ms, \"scrolling\");\n\n\t\t\t\treturn defer;\n\t\t\t},\n\n\t\t\t/**\n    * Returns the current scroll position of the View\n    *\n    * @method scrollPos\n    * @memberOf client\n    * @return {Array} Describes the scroll position\n    * @private\n    */\n\t\t\tscrollPos: function () {\n\t\t\t\treturn [window.scrollX || 0, window.scrollY || 0];\n\t\t\t}\n\t\t};\n\n\t\t/**\n   * @namespace csv\n   */\n\t\tvar csv = {\n\t\t\t/**\n    * Converts CSV to an Array of Objects\n    *\n    * @method decode\n    * @memberOf csv\n    * @param  {String} arg       CSV string\n    * @param  {String} delimiter [Optional] Delimiter to split columns on, default is \",\"\n    * @return {Array}            Array of Objects\n    */\n\t\t\tdecode: function (arg) {\n\t\t\t\tvar delimiter = arguments[1] === undefined ? \",\" : arguments[1];\n\t\t\t\tvar regex = new RegExp(delimiter + \"(?=(?:[^\\\"]|\\\"(?:[^\\\"])[^\\\"]*\\\")*$)\");\n\t\t\t\tvar rows = string.trim(arg).split(\"\\n\");\n\t\t\t\tvar keys = rows.shift().split(delimiter);\n\t\t\t\tvar result = [];\n\t\t\t\tvar nth = rows.length;\n\t\t\t\tvar x = keys.length;\n\t\t\t\tvar i = -1;\n\t\t\t\tvar n = undefined,\n\t\t\t\t    obj = undefined,\n\t\t\t\t    row = undefined;\n\n\t\t\t\twhile (++i < nth) {\n\t\t\t\t\tobj = {};\n\t\t\t\t\trow = rows[i].split(regex);\n\n\t\t\t\t\tn = -1;\n\t\t\t\t\twhile (++n < x) {\n\t\t\t\t\t\tobj[keys[n]] = utility.coerce((row[n] || \"\").replace(/^\"|\"$/g, \"\"));\n\t\t\t\t\t}\n\n\t\t\t\t\tresult.push(obj);\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Encodes an Array, JSON, or Object as CSV\n    *\n    * @method encode\n    * @memberOf csv\n    * @param  {Mixed}   arg       JSON, Array or Object\n    * @param  {String}  delimiter [Optional] Character to separate fields\n    * @param  {Boolean} header    [Optional] `false` to disable keys names as first row\n    * @return {String}            CSV string\n    * @example\n    * let csv = keigai.util.csv.encode( [{prop:\"value\"}, {prop:\"value2\"}] );\n    *\n    * console.log( csv );\n    * \"prop\n    *  value\n    *  value2\"\n    */\n\t\t\tencode: function (arg) {\n\t\t\t\tvar delimiter = arguments[1] === undefined ? \",\" : arguments[1];\n\t\t\t\tvar header = arguments[2] === undefined ? true : arguments[2];\n\t\t\t\tvar obj = json.decode(arg, true) || arg;\n\t\t\t\tvar result = \"\";\n\n\t\t\t\t// Prepares input based on CSV rules\n\t\t\t\tvar prepare = function (input) {\n\t\t\t\t\tvar output = undefined;\n\n\t\t\t\t\tif (input instanceof Array) {\n\t\t\t\t\t\toutput = \"\\\"\" + input.toString() + \"\\\"\";\n\n\t\t\t\t\t\tif (regex.object_type.test(output)) {\n\t\t\t\t\t\t\toutput = \"\\\"\" + csv.encode(input, delimiter) + \"\\\"\";\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (input instanceof Object) {\n\t\t\t\t\t\toutput = \"\\\"\" + csv.encode(input, delimiter) + \"\\\"\";\n\t\t\t\t\t} else if (regex.csv_quote.test(input)) {\n\t\t\t\t\t\toutput = \"\\\"\" + input.replace(/\"/g, \"\\\"\\\"\") + \"\\\"\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\toutput = input;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn output;\n\t\t\t\t};\n\n\t\t\t\tif (obj instanceof Array) {\n\t\t\t\t\tif (obj[0] instanceof Object) {\n\t\t\t\t\t\tif (header) {\n\t\t\t\t\t\t\tresult = array.keys(obj[0]).join(delimiter) + \"\\n\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresult += obj.map(function (i) {\n\t\t\t\t\t\t\treturn csv.encode(i, delimiter, false);\n\t\t\t\t\t\t}).join(\"\\n\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult += prepare(obj, delimiter) + \"\\n\";\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (header) {\n\t\t\t\t\t\tresult = array.keys(obj).join(delimiter) + \"\\n\";\n\t\t\t\t\t}\n\n\t\t\t\t\tresult += array.cast(obj).map(prepare).join(delimiter) + \"\\n\";\n\t\t\t\t}\n\n\t\t\t\treturn result.replace(regex.eol_nl, \"\");\n\t\t\t}\n\t\t};\n\n\t\tvar DataListFilter = (function (Base) {\n\t\t\t/**\n    * Creates a new DataListFilter\n    *\n    * @constructor\n    * @memberOf keigai\n    * @extends {keigai.Base}\n    * @param  {Object} obj      Element to receive the filter\n    * @param  {Object} list     {@link keigai.DataList}\n    * @param  {Number} debounce [Optional] Milliseconds to debounce\n    * @example\n    * let store  = keigai.store( [...] ),\n    *     list   = keigai.list( document.querySelector( \"#list\" ), store, \"{{field}}\" ),\n    *     filter = keigai.filter( document.querySelector( \"input.filter\" ), list, \"field\" );\n    */\n\t\t\tfunction DataListFilter(element, list, debounce) {\n\t\t\t\t_classCallCheck(this, DataListFilter);\n\n\t\t\t\tthis.debounce = debounce;\n\t\t\t\tthis.element = element;\n\t\t\t\tthis.filters = {};\n\t\t\t\tthis.list = list;\n\t\t\t\tthis.observer = observable.factory();\n\t\t\t}\n\n\t\t\t_inherits(DataListFilter, Base);\n\n\t\t\t_prototypeProperties(DataListFilter, null, {\n\t\t\t\tset: {\n\n\t\t\t\t\t/**\n      * Set the filters\n      *\n      * Create an object based on comma separated key string\n      *\n      * @method set\n      * @memberOf keigai.DataListFilter\n      * @param  {String} fields Comma separated filters\n      * @return {Object} {@link keigai.DataListFilter}\n      * @example\n      * filter.set( \"firstName, lastName, email\" );\n      */\n\t\t\t\t\tvalue: function set(fields) {\n\t\t\t\t\t\tvar self = this;\n\n\t\t\t\t\t\tthis.filters = {};\n\t\t\t\t\t\tarray.each(string.explode(fields), function (v) {\n\t\t\t\t\t\t\tself.filters[v] = \"\";\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tteardown: {\n\n\t\t\t\t\t/**\n      * Removes listeners, and DOM hooks to avoid memory leaks\n      *\n      * @method teardown\n      * @memberOf keigai.DataListFilter\n      * @return {Object} {@link keigai.DataListFilter}\n      * @example\n      * filter.teardown();\n      */\n\t\t\t\t\tvalue: function teardown() {\n\t\t\t\t\t\tthis.observer.unhook(this.element, \"keyup\");\n\t\t\t\t\t\tthis.observer.unhook(this.element, \"input\");\n\t\t\t\t\t\tthis.element = null;\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tupdate: {\n\n\t\t\t\t\t/**\n      * Applies the input value as a filter against the DataList based on specific fields\n      *\n      * @method update\n      * @memberOf keigai.DataListFilter\n      * @fires keigai.DataList#beforeFilter Fires before filter\n      * @fires keigai.DataList#afterFilter Fires after filter\n      * @return {Object} {@link keigai.DataListFilter}\n      * @example\n      * filter.update(); // Debounced execution\n      */\n\t\t\t\t\tvalue: function update() {\n\t\t\t\t\t\tvar self = this;\n\n\t\t\t\t\t\tutility.defer(function () {\n\t\t\t\t\t\t\tvar val = element.val(self.element).toString();\n\n\t\t\t\t\t\t\tself.list.dispatch(\"beforeFilter\", self.element, val);\n\n\t\t\t\t\t\t\tif (!string.isEmpty(val)) {\n\t\t\t\t\t\t\t\tutility.iterate(self.filters, function (v, k) {\n\t\t\t\t\t\t\t\t\tvar queries = string.explode(val);\n\n\t\t\t\t\t\t\t\t\t// Ignoring trailing commas\n\t\t\t\t\t\t\t\t\tqueries = queries.filter(function (i) {\n\t\t\t\t\t\t\t\t\t\treturn !string.isEmpty(i);\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t// Shaping valid pattern\n\t\t\t\t\t\t\t\t\tarray.each(queries, function (i, idx) {\n\t\t\t\t\t\t\t\t\t\tqueries[idx] = \"^.*\" + string.escape(i).replace(/(^\\*|\\*$)/g, \"\").replace(/\\*/g, \".*\") + \".*\";\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tself.filters[k] = queries.join(\",\");\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tself.list.filter = self.filters;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tself.list.filter = null;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tself.list.pageIndex = 1;\n\t\t\t\t\t\t\tself.list.refresh();\n\t\t\t\t\t\t\tself.list.dispatch(\"afterFilter\", self.element);\n\t\t\t\t\t\t}, this.debounce, this.element.id + \"Debounce\");\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn DataListFilter;\n\t\t})(Base);\n\n\t\t/**\n   * @namespace filter\n   */\n\t\tvar filter = {\n\t\t\t/**\n    * DataListFilter factory\n    *\n    * @method factory\n    * @memberOf filter\n    * @param  {Object} target   Element to receive the filter\n    * @param  {Object} list     {@link keigai.DataList}\n    * @param  {String} filters  Comma delimited string of fields to filter by\n    * @param  {Number} debounce [Optional] Milliseconds to debounce, default is `250`\n    * @return {Object} {@link keigai.DataListFilter}\n    * @example\n    * let store  = keigai.store( [...] ),\n    *     list   = keigai.list( document.querySelector( \"#list\" ), store, \"{{field}}\" ),\n    *     filter = keigai.filter( document.querySelector( \"input.filter\" ), list, \"field\" );\n    */\n\t\t\tfactory: function (target, list, filters) {\n\t\t\t\tvar debounce = arguments[3] === undefined ? 250 : arguments[3];\n\t\t\t\tvar ref = [list];\n\t\t\t\tvar obj = new DataListFilter(target, ref[0], debounce).set(filters);\n\n\t\t\t\t// Decorating `target` with the appropriate input `type`\n\t\t\t\telement.attr(target, \"type\", \"text\");\n\n\t\t\t\t// Setting up a chain of Events\n\t\t\t\tobj.observer.hook(obj.element, \"keyup\");\n\t\t\t\tobj.observer.hook(obj.element, \"input\");\n\t\t\t\tobj.on(\"keyup\", obj.update, \"keyup\");\n\t\t\t\tobj.on(\"input\", obj.update, \"input\");\n\n\t\t\t\treturn obj;\n\t\t\t}\n\t\t};\n\n\t\tvar DataGrid = (function (Base) {\n\t\t\t/**\n    * Creates a new DataGrid\n    *\n    * @constructor\n    * @memberOf keigai\n    * @extends {keigai.Base}\n    * @param  {Object}  target   Element to receive DataGrid\n    * @param  {Object}  store    DataStore\n    * @param  {Array}   fields   Array of fields to display\n    * @param  {Array}   sortable [Optional] Array of sortable columns/fields\n    * @param  {Object}  options  [Optional] DataList options\n    * @param  {Boolean} filtered [Optional] Create an input to filter the DataGrid\n    * @example\n    * let fields  = [\"name\", \"age\"],\n    *     options = {pageSize: 5, order: \"age desc, name\"},\n    *     store   = keigai.store( [...] ),\n    *     grid    = keigai.grid( document.querySelector( \"#grid\" ), store, fields, fields, options, true );\n    */\n\t\t\tfunction DataGrid(target, store, fields) {\n\t\t\t\tvar sortable = arguments[3] === undefined ? [] : arguments[3];\n\t\t\t\tvar options = arguments[4] === undefined ? {} : arguments[4];\n\t\t\t\tvar filtered = arguments[5] === undefined ? false : arguments[5];\n\t\t\t\t_classCallCheck(this, DataGrid);\n\n\t\t\t\tvar sortOrder = undefined;\n\n\t\t\t\tif (options.order && !string.isEmpty(options.order)) {\n\t\t\t\t\tsortOrder = string.explode(options.order).map(function (i) {\n\t\t\t\t\t\treturn i.replace(regex.after_space, \"\");\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.element = element.create(\"section\", { \"class\": \"grid\" }, target);\n\t\t\t\tthis.fields = fields;\n\t\t\t\tthis.filtered = filtered;\n\t\t\t\tthis.list = null;\n\t\t\t\tthis.observer = observable.factory();\n\t\t\t\tthis.options = options;\n\t\t\t\tthis.store = store;\n\t\t\t\tthis.sortable = sortable;\n\t\t\t\tthis.sortOrder = sortOrder || sortable;\n\t\t\t}\n\n\t\t\t_inherits(DataGrid, Base);\n\n\t\t\t_prototypeProperties(DataGrid, null, {\n\t\t\t\tadd: {\n\n\t\t\t\t\t/**\n      * Adds an item to the DataGrid\n      *\n      * @method add\n      * @memberOf keigai.DataGrid\n      * @param {Object} record New DataStore record (shapes should match)\n      * @return {Object}       {@link keigai.DataGrid}\n      * @example\n      * grid.add( {name: \"John Doe\", age: 34} );\n      */\n\t\t\t\t\tvalue: function add(record) {\n\t\t\t\t\t\tvar self = this;\n\n\t\t\t\t\t\tthis.store.set(null, record).then(null, function (e) {\n\t\t\t\t\t\t\tutility.error(e);\n\t\t\t\t\t\t\tself.dispatch(\"error\", e);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tdump: {\n\n\t\t\t\t\t/**\n      * Exports data grid records\n      *\n      * @method dump\n      * @memberOf keigai.DataGrid\n      * @return {Array} Record set\n      * @example\n      * let data = grid.dump();\n      */\n\t\t\t\t\tvalue: function dump() {\n\t\t\t\t\t\treturn this.store.dump(this.list.records, this.fields);\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\trefresh: {\n\n\t\t\t\t\t/**\n      * Refreshes the DataGrid\n      *\n      * @method refresh\n      * @memberOf keigai.DataGrid\n      * @fires keigai.DataGrid#beforeRefresh Fires before refresh\n      * @fires keigai.DataGrid#afterRefresh Fires after refresh\n      * @return {Object} {@link keigai.DataGrid}\n      * @example\n      * grid.refresh();\n      */\n\t\t\t\t\tvalue: function refresh() {\n\t\t\t\t\t\tvar sort = [];\n\t\t\t\t\t\tvar self = this;\n\n\t\t\t\t\t\tthis.dispatch(\"beforeRefresh\", this.element);\n\n\t\t\t\t\t\tif (this.sortOrder.length > 0) {\n\t\t\t\t\t\t\tarray.each(this.sortOrder, function (i) {\n\t\t\t\t\t\t\t\tvar obj = element.find(self.element, \".header span[data-field='\" + i + \"']\")[0];\n\n\t\t\t\t\t\t\t\tsort.push(string.trim(i + \" \" + (element.data(obj, \"sort\") || \"\")));\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tthis.options.order = this.list.order = sort.join(\", \");\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.list.where = null;\n\t\t\t\t\t\tutility.merge(this.list, this.options);\n\t\t\t\t\t\tthis.list.refresh();\n\n\t\t\t\t\t\tthis.dispatch(\"afterRefresh\", this.element);\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tremove: {\n\n\t\t\t\t\t/**\n      * Removes an item from the DataGrid\n      *\n      * @method remove\n      * @memberOf keigai.DataGrid\n      * @param {Mixed} record Record, key or index\n      * @return {Object} {@link keigai.DataGrid}\n      * @example\n      * grid.remove( \"key\" );\n      */\n\t\t\t\t\tvalue: function remove(record) {\n\t\t\t\t\t\tvar self = this;\n\n\t\t\t\t\t\tthis.store.del(record).then(null, function (e) {\n\t\t\t\t\t\t\tutility.error(e);\n\t\t\t\t\t\t\tself.dispatch(\"error\", e);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tsort: {\n\n\t\t\t\t\t/**\n      * Sorts the DataGrid when a column header is clicked\n      *\n      * @method sort\n      * @memberOf keigai.DataGrid\n      * @param  {Object} ev Event\n      * @return {Object} {@link keigai.DataGrid}\n      */\n\t\t\t\t\tvalue: function sort(ev) {\n\t\t\t\t\t\tvar target = utility.target(ev);\n\t\t\t\t\t\tvar field = undefined;\n\n\t\t\t\t\t\t// Stopping event propogation\n\t\t\t\t\t\tutility.stop(ev);\n\n\t\t\t\t\t\t// Refreshing list if target is sortable\n\t\t\t\t\t\tif (element.hasClass(target, \"sortable\")) {\n\t\t\t\t\t\t\tfield = element.data(target, \"field\");\n\t\t\t\t\t\t\telement.data(target, \"sort\", element.data(target, \"sort\") === \"asc\" ? \"desc\" : \"asc\");\n\t\t\t\t\t\t\tarray.remove(this.sortOrder, field);\n\t\t\t\t\t\t\tthis.sortOrder.splice(0, 0, field);\n\t\t\t\t\t\t\tthis.refresh();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tteardown: {\n\n\t\t\t\t\t/**\n      * Tears down the DataGrid\n      *\n      * @method teardown\n      * @memberOf keigai.DataGrid\n      * @return {Object} {@link keigai.DataGrid}\n      * @example\n      * grid.teardown();\n      */\n\t\t\t\t\tvalue: function teardown() {\n\t\t\t\t\t\tthis.observer.unhook(element.find(this.element, \"ul.header\")[0], \"click\");\n\t\t\t\t\t\tthis.list.teardown();\n\t\t\t\t\t\telement.destroy(this.element);\n\t\t\t\t\t\tthis.element = null;\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tupdate: {\n\n\t\t\t\t\t/**\n      * Updates an item in the DataGrid\n      *\n      * @method update\n      * @memberOf keigai.DataGrid\n      * @param {Mixed}  key  Key or index\n      * @param {Object} data New property values\n      * @return {Object}     {@link keigai.DataGrid}\n      * @example\n      * grid.update( \"key\", {name: \"Jim Smith\"} );\n      */\n\t\t\t\t\tvalue: function update(key, data) {\n\t\t\t\t\t\tvar self = this;\n\n\t\t\t\t\t\tthis.store.update(key, data).then(null, function (e) {\n\t\t\t\t\t\t\tutility.error(e);\n\t\t\t\t\t\t\tself.dispatch(\"error\", e);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn DataGrid;\n\t\t})(Base);\n\n\t\t/**\n   * @namespace grid\n   */\n\t\tvar grid = {\n\t\t\t/**\n    * DataGrid factory\n    *\n    * @method factory\n    * @memberOf grid\n    * @fires keigai.DataGrid#change Fires when the DOM changes\n    * @param  {Object}  target      Element to receive DataGrid\n    * @param  {Object}  store       DataStore\n    * @param  {Array}   fields      Array of fields to display\n    * @param  {Array}   sortable    [Optional] Array of sortable columns/fields\n    * @param  {Object}  options     [Optional] DataList options\n    * @param  {Boolean} filtered    [Optional] Create an input to filter the data grid\n    * @param  {Number}  debounce    [Optional] DataListFilter input debounce, default is 250\n    * @return {Object} {@link keigai.DataGrid}\n    * @example\n    * let fields  = [\"name\", \"age\"],\n    *     options = {pageSize: 5, order: \"age desc, name\"},\n    *     store   = keigai.store(),\n    *     grid    = keigai.grid( document.querySelector( \"#grid\" ), store, fields, fields, options, true );\n    *\n    * store.setUri( \"data.json\" ).then( null, function ( e ) {\n    *   ...\n    * } );\n    */\n\t\t\tfactory: function (target, store, fields, sortable, options, filtered, debounce) {\n\t\t\t\tvar ref = [store];\n\t\t\t\tvar obj = new DataGrid(target, ref[0], fields, sortable, options, filtered);\n\t\t\t\tvar template = \"\";\n\t\t\t\tvar header = element.create(\"li\", {}, element.create(\"ul\", { \"class\": \"header\" }, obj.element));\n\t\t\t\tvar width = 100 / obj.fields.length + \"%\";\n\t\t\t\tvar css = \"display:inline-block;width:\" + width;\n\t\t\t\tvar sort = obj.options.order ? string.explode(obj.options.order) : [];\n\n\t\t\t\t// Creating DataList template based on fields\n\t\t\t\tarray.each(obj.fields, function (i) {\n\t\t\t\t\tvar trimmed = i.replace(/.*\\./g, \"\");\n\t\t\t\t\tvar el = element.create(\"span\", {\n\t\t\t\t\t\tinnerHTML: string.capitalize(string.unCamelCase(string.unhyphenate(trimmed, true)).replace(/_|-/g, \" \"), true),\n\t\t\t\t\t\tstyle: css,\n\t\t\t\t\t\t\"data-field\": i\n\t\t\t\t\t}, header);\n\n\t\t\t\t\t// Adding CSS class if \"column\" is sortable\n\t\t\t\t\tif (array.contains(obj.sortable, i)) {\n\t\t\t\t\t\telement.addClass(el, \"sortable\");\n\n\t\t\t\t\t\t// Applying default sort, if specified\n\t\t\t\t\t\tif (sort.filter(function (x) {\n\t\t\t\t\t\t\treturn x.indexOf(i) === 0;\n\t\t\t\t\t\t}).length > 0) {\n\t\t\t\t\t\t\telement.data(el, \"sort\", array.contains(sort, i + \" desc\") ? \"desc\" : \"asc\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\ttemplate += \"<span class=\\\"\" + i + \"\\\" data-field=\\\"\" + i + \"\\\" style=\\\"\" + css + \"\\\">{{\" + i + \"}}</span>\";\n\t\t\t\t});\n\n\t\t\t\t// Setting click handler on sortable \"columns\"\n\t\t\t\tif (obj.sortable.length > 0) {\n\t\t\t\t\tobj.observer.hook(header.parentNode, \"click\", obj.sort, \"sort\", obj);\n\t\t\t\t}\n\n\t\t\t\tif (obj.filtered === true) {\n\t\t\t\t\tobj.options.listFiltered = true;\n\t\t\t\t\tobj.options.listFilter = obj.fields.join(\",\");\n\t\t\t\t}\n\n\t\t\t\t// Creating DataList\n\t\t\t\tref.push(list.factory(obj.element, ref[0], template, obj.options));\n\n\t\t\t\t// Setting by-reference DataList on DataGrid\n\t\t\t\tobj.list = ref[1];\n\n\t\t\t\t// Setting up a chain of Events\n\t\t\t\tobj.on(\"beforeRefresh\", function (arg) {\n\t\t\t\t\telement.dispatch(arg, \"beforeRefresh\");\n\t\t\t\t}, \"bubble\");\n\n\t\t\t\tobj.on(\"afterRefresh\", function (arg) {\n\t\t\t\t\telement.dispatch(arg, \"afterRefresh\");\n\t\t\t\t}, \"bubble\");\n\n\t\t\t\tobj.on(\"click\", function (e) {\n\t\t\t\t\tif (element.hasClass(e.currentTarget, \"header\")) {\n\t\t\t\t\t\tobj.sort(e);\n\t\t\t\t\t}\n\t\t\t\t}, \"header\");\n\n\t\t\t\tobj.list.on(\"change\", function () {\n\t\t\t\t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\t\t\t\targs[_key] = arguments[_key];\n\t\t\t\t\t}\n\n\t\t\t\t\tobj.dispatch.apply(obj, [\"change\"].concat(args));\n\t\t\t\t}, \"change\");\n\n\t\t\t\tobj.list.on(\"beforeFilter\", function () {\n\t\t\t\t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\t\t\t\targs[_key] = arguments[_key];\n\t\t\t\t\t}\n\n\t\t\t\t\tobj.dispatch.apply(obj, [\"beforeFilter\"].concat(args));\n\t\t\t\t}, \"beforeFilter\");\n\n\t\t\t\tobj.list.on(\"afterFilter\", function () {\n\t\t\t\t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\t\t\t\targs[_key] = arguments[_key];\n\t\t\t\t\t}\n\n\t\t\t\t\tobj.dispatch.apply(obj, [\"afterFilter\"].concat(args));\n\t\t\t\t}, \"afterFilter\");\n\n\t\t\t\treturn obj;\n\t\t\t}\n\t\t};\n\n\t\tvar DataList = (function (Base) {\n\t\t\t/**\n    * Creates a new DataList\n    *\n    * @constructor\n    * @memberOf keigai\n    * @extends {keigai.Base}\n    * @example\n    * let store = keigai.store( [...] ),\n    *     list  = keigai.list( document.querySelector(\"#list\"), store, \"{{name}}\", {order: \"name\"} );\n    */\n\t\t\tfunction DataList(element, store, template) {\n\t\t\t\t_classCallCheck(this, DataList);\n\n\t\t\t\tthis.callback = null;\n\t\t\t\tthis.current = [];\n\t\t\t\tthis.element = element;\n\t\t\t\tthis.emptyMsg = label.noData;\n\t\t\t\tthis.filter = null;\n\t\t\t\tthis.filtered = [];\n\t\t\t\tthis.id = utility.genId();\n\t\t\t\tthis.items = [];\n\t\t\t\tthis.listFilter = null;\n\t\t\t\tthis.mutation = null;\n\t\t\t\tthis.observer = observable.factory();\n\t\t\t\tthis.pageIndex = 1;\n\t\t\t\tthis.pageSize = null;\n\t\t\t\tthis.pageRange = 5;\n\t\t\t\tthis.pagination = \"bottom\"; // \"top\" or \"bottom|top\" are also valid\n\t\t\t\tthis.placeholder = \"\";\n\t\t\t\tthis.order = \"\";\n\t\t\t\tthis.records = [];\n\t\t\t\tthis.template = template;\n\t\t\t\tthis.total = 0;\n\t\t\t\tthis.store = store;\n\t\t\t\tthis.where = null;\n\t\t\t}\n\n\t\t\t_inherits(DataList, Base);\n\n\t\t\t_prototypeProperties(DataList, null, {\n\t\t\t\tadd: {\n\n\t\t\t\t\t/**\n      * Adds an item to the DataList\n      *\n      * @method add\n      * @memberOf keigai.DataList\n      * @param {Object} record New DataStore record (shapes should match)\n      * @return {Object}       {@link keigai.DataList}\n      * @example\n      * list.add( {name: \"John Doe\", age: 34} );\n      */\n\t\t\t\t\tvalue: function add(record) {\n\t\t\t\t\t\tvar self = this;\n\n\t\t\t\t\t\tthis.store.set(null, record).then(null, function (e) {\n\t\t\t\t\t\t\tutility.error(e);\n\t\t\t\t\t\t\tself.dispatch(\"error\", e);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tdump: {\n\n\t\t\t\t\t/**\n      * Exports data list records\n      *\n      * @method dump\n      * @memberOf keigai.DataList\n      * @return {Array} Record set\n      * @example\n      * let data = list.dump();\n      */\n\t\t\t\t\tvalue: function dump() {\n\t\t\t\t\t\treturn this.store.dump(this.records);\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tpage: {\n\n\t\t\t\t\t/**\n      * Changes the page index of the DataList\n      *\n      * @method page\n      * @memberOf keigai.DataList\n      * @param  {Number} n Page to view\n      * @return {Object}   {@link keigai.DataList}\n      * @example\n      * list.page( 2 );\n      */\n\t\t\t\t\tvalue: function page(n) {\n\t\t\t\t\t\tthis.pageIndex = n;\n\n\t\t\t\t\t\treturn this.refresh();\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tpages: {\n\n\t\t\t\t\t/**\n      * Adds pagination Elements to the View, executed from `DataList.refresh()`\n      *\n      * @method pages\n      * @memberOf keigai.DataList\n      * @return {Object} {@link keigai.DataList}\n      * @example\n      * list.pages();\n      */\n\t\t\t\t\tvalue: function pages() {\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\tvar obj = this.element;\n\t\t\t\t\t\tvar page = this.pageIndex;\n\t\t\t\t\t\tvar pos = this.pagination;\n\t\t\t\t\t\tvar range = this.pageRange;\n\t\t\t\t\t\tvar mid = Math.floor(range / 2);\n\t\t\t\t\t\tvar start = page - mid;\n\t\t\t\t\t\tvar end = page + mid;\n\t\t\t\t\t\tvar total = list.pages(this);\n\t\t\t\t\t\tvar diff = undefined;\n\n\t\t\t\t\t\t// Removing the existing controls\n\t\t\t\t\t\tarray.each(utility.dom(\"#\" + obj.id + \"-pages-top, #\" + obj.id + \"-pages-bottom\"), function (i) {\n\t\t\t\t\t\t\tif (i) {\n\t\t\t\t\t\t\t\tself.observer.unhook(i, \"click\");\n\t\t\t\t\t\t\t\telement.destroy(i);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Halting because there's 1 page, or nothing\n\t\t\t\t\t\tif (this.filter && this.filtered.length === 0 || this.total === 0 || total === 1) {\n\t\t\t\t\t\t\treturn this;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Getting the range to display\n\t\t\t\t\t\tif (start < 1) {\n\t\t\t\t\t\t\tdiff = number.diff(start, 1);\n\t\t\t\t\t\t\tstart = start + diff;\n\t\t\t\t\t\t\tend = end + diff;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (end > total) {\n\t\t\t\t\t\t\tend = total;\n\t\t\t\t\t\t\tstart = end - range + 1;\n\n\t\t\t\t\t\t\tif (start < 1) {\n\t\t\t\t\t\t\t\tstart = 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (number.diff(start, end) >= range) {\n\t\t\t\t\t\t\t--end;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tarray.each(string.explode(pos), function (i) {\n\t\t\t\t\t\t\tvar current = false;\n\t\t\t\t\t\t\tvar more = page > 1;\n\t\t\t\t\t\t\tvar next = page + 1 <= total;\n\t\t\t\t\t\t\tvar last = page >= total;\n\t\t\t\t\t\t\tvar el = undefined,\n\t\t\t\t\t\t\t    n = undefined;\n\n\t\t\t\t\t\t\t// Setting up the list\n\t\t\t\t\t\t\tel = element.create(\"ul\", {\n\t\t\t\t\t\t\t\t\"class\": \"list pages hidden \" + i,\n\t\t\t\t\t\t\t\tid: obj.id + \"-pages-\" + i\n\t\t\t\t\t\t\t}, obj, i === \"bottom\" ? \"after\" : \"before\");\n\n\t\t\t\t\t\t\t// First page\n\t\t\t\t\t\t\telement.create(more ? \"a\" : \"span\", {\n\t\t\t\t\t\t\t\t\"class\": \"first page\",\n\t\t\t\t\t\t\t\t\"data-page\": 1,\n\t\t\t\t\t\t\t\tinnerHTML: \"&lt;&lt;\"\n\t\t\t\t\t\t\t}, element.create(\"li\", {}, el));\n\n\t\t\t\t\t\t\t// Previous page\n\t\t\t\t\t\t\telement.create(more ? \"a\" : \"span\", {\n\t\t\t\t\t\t\t\t\"class\": \"prev page\",\n\t\t\t\t\t\t\t\t\"data-page\": page - 1,\n\t\t\t\t\t\t\t\tinnerHTML: \"&lt;\"\n\t\t\t\t\t\t\t}, element.create(\"li\", {}, el));\n\n\t\t\t\t\t\t\t// Rendering the page range\n\t\t\t\t\t\t\tn = start - 1;\n\t\t\t\t\t\t\twhile (++n <= end) {\n\t\t\t\t\t\t\t\tcurrent = n === page;\n\t\t\t\t\t\t\t\telement.create(current ? \"span\" : \"a\", {\n\t\t\t\t\t\t\t\t\t\"class\": current ? \"current page\" : \"page\",\n\t\t\t\t\t\t\t\t\t\"data-page\": n,\n\t\t\t\t\t\t\t\t\tinnerHTML: n\n\t\t\t\t\t\t\t\t}, element.create(\"li\", {}, el));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Next page\n\t\t\t\t\t\t\telement.create(next ? \"a\" : \"span\", {\n\t\t\t\t\t\t\t\t\"class\": \"next page\",\n\t\t\t\t\t\t\t\t\"data-page\": next ? page + 1 : null,\n\t\t\t\t\t\t\t\tinnerHTML: \"&gt;\"\n\t\t\t\t\t\t\t}, element.create(\"li\", {}, el));\n\n\t\t\t\t\t\t\t// Last page\n\t\t\t\t\t\t\telement.create(last ? \"span\" : \"a\", {\n\t\t\t\t\t\t\t\t\"class\": \"last page\",\n\t\t\t\t\t\t\t\t\"data-page\": last ? null : total,\n\t\t\t\t\t\t\t\tinnerHTML: \"&gt;&gt;\"\n\t\t\t\t\t\t\t}, element.create(\"li\", {}, el));\n\n\t\t\t\t\t\t\t// Adding to DOM\n\t\t\t\t\t\t\telement.removeClass(el, \"hidden\");\n\n\t\t\t\t\t\t\t// Pagination listener\n\t\t\t\t\t\t\tself.observer.hook(el, \"click\");\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\trefresh: {\n\n\t\t\t\t\t/**\n      * Refreshes element\n      *\n      * @method refresh\n      * @memberOf keigai.DataList\n      * @extends {keigai.Base}\n      * @fires keigai.DataList#beforeRefresh Fires before refresh\n      * @fires keigai.DataList#afterRefresh Fires after refresh\n      * @fires keigai.DataList#error Fires on error\n      * @param  {Boolean} create [Optional] Recreates cached View of data\n      * @return {Object} {@link keigai.DataList}\n      * @example\n      * list.refresh();\n      */\n\t\t\t\t\tvalue: function refresh(create) {\n\t\t\t\t\t\tcreate = create === true;\n\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\tvar el = this.element;\n\t\t\t\t\t\tvar template = typeof this.template === \"object\";\n\t\t\t\t\t\tvar filter = this.filter !== null;\n\t\t\t\t\t\tvar items = [];\n\t\t\t\t\t\tvar callback = typeof this.callback === \"function\";\n\t\t\t\t\t\tvar reg = new RegExp();\n\t\t\t\t\t\tvar registry = []; // keeps track of records in the list ( for filtering )\n\t\t\t\t\t\tvar range = [];\n\t\t\t\t\t\tvar fn = undefined,\n\t\t\t\t\t\t    ceiling = undefined,\n\t\t\t\t\t\t    next = undefined;\n\n\t\t\t\t\t\tthis.dispatch(\"beforeRefresh\", el);\n\n\t\t\t\t\t\t// Function to create templates for the html rep\n\t\t\t\t\t\tif (!template) {\n\t\t\t\t\t\t\tfn = function (i) {\n\t\t\t\t\t\t\t\tvar html = self.template;\n\t\t\t\t\t\t\t\tvar items = array.unique(html.match(/\\{\\{[\\w\\.\\-\\[\\]]+\\}\\}/g));\n\n\t\t\t\t\t\t\t\t// Replacing record key\n\t\t\t\t\t\t\t\thtml = html.replace(\"{{\" + self.store.key + \"}}\", i.key);\n\n\t\t\t\t\t\t\t\t// Replacing dot notation properties\n\t\t\t\t\t\t\t\tarray.each(items, function (attr) {\n\t\t\t\t\t\t\t\t\tvar key = attr.replace(/\\{\\{|\\}\\}/g, \"\"),\n\t\t\t\t\t\t\t\t\t    value = utility.walk(i.data, key);\n\n\t\t\t\t\t\t\t\t\tif (value === undefined) {\n\t\t\t\t\t\t\t\t\t\tvalue = \"\";\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\treg.compile(string.escape(attr), \"g\");\n\t\t\t\t\t\t\t\t\thtml = html.replace(reg, value);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t// Filling in placeholder value\n\t\t\t\t\t\t\t\thtml = html.replace(/\\{\\{.*\\}\\}/g, self.placeholder);\n\n\t\t\t\t\t\t\t\treturn \"<li data-key=\\\"\" + i.key + \"\\\">\" + html + \"</li>\";\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfn = function (i) {\n\t\t\t\t\t\t\t\tvar obj = json.encode(self.template);\n\t\t\t\t\t\t\t\tvar items = array.unique(obj.match(/\\{\\{[\\w\\.\\-\\[\\]]+\\}\\}/g));\n\n\t\t\t\t\t\t\t\t// Replacing record key\n\t\t\t\t\t\t\t\tobj = obj.replace(\"{{\" + self.store.key + \"}}\", i.key);\n\n\t\t\t\t\t\t\t\t// Replacing dot notation properties\n\t\t\t\t\t\t\t\tarray.each(items, function (attr) {\n\t\t\t\t\t\t\t\t\tvar key = attr.replace(/\\{\\{|\\}\\}/g, \"\");\n\t\t\t\t\t\t\t\t\tvar value = utility.walk(i.data, key) || \"\";\n\n\t\t\t\t\t\t\t\t\treg.compile(string.escape(attr), \"g\");\n\n\t\t\t\t\t\t\t\t\t// Stripping first and last \" to concat to valid JSON\n\t\t\t\t\t\t\t\t\tobj = obj.replace(reg, json.encode(value).replace(/(^\")|(\"$)/g, \"\"));\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t// Filling in placeholder value\n\t\t\t\t\t\t\t\tobj = json.decode(obj.replace(/\\{\\{.*\\}\\}/g, self.placeholder));\n\n\t\t\t\t\t\t\t\treturn { li: obj };\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Next phase\n\t\t\t\t\t\tnext = function (args) {\n\t\t\t\t\t\t\t// Creating view of DataStore\n\t\t\t\t\t\t\tself.records = args;\n\t\t\t\t\t\t\tself.total = self.records.length;\n\t\t\t\t\t\t\tself.filtered = [];\n\n\t\t\t\t\t\t\t// Resetting 'view' specific arrays\n\t\t\t\t\t\t\tself.current = [];\n\n\t\t\t\t\t\t\t// Filtering records (if applicable)\n\t\t\t\t\t\t\tif (filter) {\n\t\t\t\t\t\t\t\tarray.each(self.records, function (i) {\n\t\t\t\t\t\t\t\t\tutility.iterate(self.filter, function (v, k) {\n\t\t\t\t\t\t\t\t\t\tvar key = undefined;\n\n\t\t\t\t\t\t\t\t\t\tif (array.contains(registry, i.key)) {\n\t\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tkey = k === self.store.key;\n\n\t\t\t\t\t\t\t\t\t\tarray.each(string.explode(v), function (query) {\n\t\t\t\t\t\t\t\t\t\t\tvar reg = new RegExp(query, \"i\");\n\t\t\t\t\t\t\t\t\t\t\tvar value = !key ? utility.walk(i.data, k) : \"\";\n\n\t\t\t\t\t\t\t\t\t\t\tif (key && reg.test(i.key) || reg.test(value)) {\n\t\t\t\t\t\t\t\t\t\t\t\tregistry.push(i.key);\n\t\t\t\t\t\t\t\t\t\t\t\tself.filtered.push(i);\n\n\t\t\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Pagination\n\t\t\t\t\t\t\tif (self.pageSize !== null && !isNaN(self.pageIndex) && !isNaN(self.pageSize)) {\n\t\t\t\t\t\t\t\tceiling = list.pages(self);\n\n\t\t\t\t\t\t\t\t// Passed the end, so putting you on the end\n\t\t\t\t\t\t\t\tif (ceiling > 0 && self.pageIndex > ceiling) {\n\t\t\t\t\t\t\t\t\treturn self.page(ceiling);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// Paginating the items\n\t\t\t\t\t\t\t\telse if (self.total > 0) {\n\t\t\t\t\t\t\t\t\trange = list.range(self);\n\t\t\t\t\t\t\t\t\tself.current = array.limit(!filter ? self.records : self.filtered, range[0], range[1]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tself.current = !filter ? self.records : self.filtered;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Processing records & generating templates\n\t\t\t\t\t\t\tarray.each(self.current, function (i) {\n\t\t\t\t\t\t\t\tvar html = fn(i);\n\t\t\t\t\t\t\t\tvar hash = btoa(html);\n\n\t\t\t\t\t\t\t\titems.push({ key: i.key, template: html, hash: hash });\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// Updating element\n\t\t\t\t\t\t\tutility.render(function () {\n\t\t\t\t\t\t\t\tvar destroy = [];\n\t\t\t\t\t\t\t\tvar callbacks = [];\n\t\t\t\t\t\t\t\tvar i = undefined,\n\t\t\t\t\t\t\t\t    nth = undefined;\n\n\t\t\t\t\t\t\t\tif (items.length === 0) {\n\t\t\t\t\t\t\t\t\telement.html(el, \"<li class=\\\"empty\\\">\" + self.emptyMsg + \"</li>\");\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (self.items.length === 0) {\n\t\t\t\t\t\t\t\t\t\telement.html(el, items.map(function (i) {\n\t\t\t\t\t\t\t\t\t\t\treturn i.template;\n\t\t\t\t\t\t\t\t\t\t}).join(\"\"));\n\n\t\t\t\t\t\t\t\t\t\tif (callback) {\n\t\t\t\t\t\t\t\t\t\t\tarray.each(array.cast(el.childNodes), function (i) {\n\t\t\t\t\t\t\t\t\t\t\t\tself.callback(i);\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tarray.each(items, function (i, idx) {\n\t\t\t\t\t\t\t\t\t\t\tif (self.items[idx] !== undefined && self.items[idx].hash !== i.hash) {\n\t\t\t\t\t\t\t\t\t\t\t\telement.data(element.html(el.childNodes[idx], i.template.replace(/<li data-key=\\\"\\d+\\\">|<\\/li>/g, \"\")), \"key\", i.key);\n\t\t\t\t\t\t\t\t\t\t\t\tcallbacks.push(idx);\n\t\t\t\t\t\t\t\t\t\t\t} else if (self.items[idx] === undefined) {\n\t\t\t\t\t\t\t\t\t\t\t\telement.create(i.template, null, el);\n\t\t\t\t\t\t\t\t\t\t\t\tcallbacks.push(idx);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\tif (items.length < self.items.length) {\n\t\t\t\t\t\t\t\t\t\t\ti = items.length - 1;\n\t\t\t\t\t\t\t\t\t\t\tnth = self.items.length;\n\n\t\t\t\t\t\t\t\t\t\t\twhile (++i < nth) {\n\t\t\t\t\t\t\t\t\t\t\t\tdestroy.push(i);\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tarray.each(destroy.reverse(), function (i) {\n\t\t\t\t\t\t\t\t\t\t\t\telement.destroy(el.childNodes[i]);\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (callback) {\n\t\t\t\t\t\t\t\t\t\t\tarray.each(callbacks, function (i) {\n\t\t\t\t\t\t\t\t\t\t\t\tself.callback(el.childNodes[i]);\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Updating reference for next change\n\t\t\t\t\t\t\t\tself.items = items;\n\n\t\t\t\t\t\t\t\t// Rendering pagination elements\n\t\t\t\t\t\t\t\tif (self.pageSize !== null && regex.top_bottom.test(self.pagination) && !isNaN(self.pageIndex) && !isNaN(self.pageSize)) {\n\t\t\t\t\t\t\t\t\tself.pages();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tarray.each(utility.$(\"#\" + el.id + \"-pages-top, #\" + el.id + \"-pages-bottom\"), function (i) {\n\t\t\t\t\t\t\t\t\t\telement.destroy(i);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tself.dispatch(\"afterRefresh\", el);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Consuming records based on sort\n\t\t\t\t\t\tif (this.where === null) {\n\t\t\t\t\t\t\tstring.isEmpty(this.order) ? next(this.store.get()) : this.store.sort(this.order, create).then(next, function (e) {\n\t\t\t\t\t\t\t\tutility.error(e);\n\t\t\t\t\t\t\t\tself.dispatch(\"error\", e);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if (string.isEmpty(this.order)) {\n\t\t\t\t\t\t\tthis.store.select(this.where).then(next, function (e) {\n\t\t\t\t\t\t\t\tutility.error(e);\n\t\t\t\t\t\t\t\tself.dispatch(\"error\", e);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.store.sort(this.order, create, this.where).then(next, function (e) {\n\t\t\t\t\t\t\t\tutility.error(e);\n\t\t\t\t\t\t\t\tself.dispatch(\"error\", e);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tremove: {\n\n\t\t\t\t\t/**\n      * Removes an item from the DataList\n      *\n      * @method remove\n      * @memberOf keigai.DataList\n      * @param {Mixed} record Record, key or index\n      * @return {Object} {@link keigai.DataList}\n      * @example\n      * // Adding a click handler to 'trash' Elements\n      * keigai.util.array.cast( document.querySelectorAll( \".list .trash\" ) ).forEach( ( i ) => {\n      *   i.addEventListener( \"click\", ( ev ) => {\n      *     let key = keigai.util.element.data( keigai.util.target( ev ).parentNode, \"key\" );\n      *\n      *     list.remove( key );\n      *   }, false );\n      * } );\n      */\n\t\t\t\t\tvalue: function remove(record) {\n\t\t\t\t\t\tvar self = this;\n\n\t\t\t\t\t\tthis.store.del(record).then(null, function (e) {\n\t\t\t\t\t\t\tutility.error(e);\n\t\t\t\t\t\t\tself.dispatch(\"error\", e);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tsort: {\n\n\t\t\t\t\t/**\n      * Sorts data list & refreshes element\n      *\n      * @method sort\n      * @memberOf keigai.DataList\n      * @param  {String} order SQL \"ORDER BY\" clause\n      * @return {Object} {@link keigai.DataList}\n      * @example\n      * list.sort( \"age, name\" );\n      */\n\t\t\t\t\tvalue: function sort(order) {\n\t\t\t\t\t\tthis.order = order;\n\n\t\t\t\t\t\treturn this.refresh();\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tteardown: {\n\n\t\t\t\t\t/**\n      * Tears down references to the DataList\n      *\n      * @method teardown\n      * @memberOf keigai.DataList\n      * @param  {Boolean} destroy [Optional] `true` will remove the DataList from the DOM\n      * @return {Object} {@link keigai.DataList}\n      * @example\n      * list.teardown();\n      */\n\t\t\t\t\tvalue: function teardown(destroy) {\n\t\t\t\t\t\tdestroy = destroy === true;\n\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\tvar el = this.element;\n\t\t\t\t\t\tvar id = el.id;\n\n\t\t\t\t\t\tarray.each(this.store.lists, function (i, idx) {\n\t\t\t\t\t\t\tif (i.id === self.id) {\n\t\t\t\t\t\t\t\tarray.remove(self.store.lists, idx);\n\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (this.listFilter) {\n\t\t\t\t\t\t\tthis.listFilter.teardown();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tarray.each(utility.$(\"#\" + id + \"-pages-top, #\" + id + \"-pages-bottom\"), function (i) {\n\t\t\t\t\t\t\tself.observer.unhook(i, \"click\");\n\n\t\t\t\t\t\t\tif (destroy) {\n\t\t\t\t\t\t\t\telement.destroy(i);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.observer.unhook(el, \"click\");\n\n\t\t\t\t\t\tif (destroy) {\n\t\t\t\t\t\t\telement.destroy(el);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.element = null;\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tupdate: {\n\n\t\t\t\t\t/**\n      * Updates an item in the DataList\n      *\n      * @method update\n      * @memberOf keigai.DataList\n      * @param {Mixed}  key  Key or index\n      * @param {Object} data New property values\n      * @return {Object}     {@link keigai.DataList}\n      * @example\n      * list.update( \"key\", {name: \"Jim Smith\"} );\n      */\n\t\t\t\t\tvalue: function update(key, data) {\n\t\t\t\t\t\tvar self = this;\n\n\t\t\t\t\t\tthis.store.update(key, data).then(null, function (e) {\n\t\t\t\t\t\t\tutility.error(e);\n\t\t\t\t\t\t\tself.dispatch(\"error\", e);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn DataList;\n\t\t})(Base);\n\n\t\t/**\n   * @namespace list\n   */\n\t\tvar list = {\n\t\t\t/**\n    * Creates an instance of DataList\n    *\n    * @method factory\n    * @memberOf list\n    * @fires keigai.DataList#change Fires when the DOM changes\n    * @param  {Object} target   Element to receive the DataList\n    * @param  {Object} store    {@link keigai.DataStore}\n    * @param  {Mixed}  template Record field, template ( $.tpl ), or String, e.g. \"<p>this is a {{field}} sample.</p>\", fields are marked with {{ }}\n    * @param  {Object} options  Optional parameters to set on the DataList\n    * @return {Object} {@link keigai.DataList}\n    * @example\n    * let store = keigai.store( [...] ),\n    *     list  = keigai.list( document.querySelector(\"#list\"), store, \"{{name}}\", {order: \"name\"} );\n    */\n\t\t\tfactory: function (target, store, template, options) {\n\t\t\t\tvar ref = [store];\n\t\t\t\tvar obj = new DataList(element.create(\"ul\", { \"class\": \"list\", id: utility.genId(null, true) }, target), ref[0], template);\n\n\t\t\t\tif (options instanceof Object) {\n\t\t\t\t\tif (options.listFiltered && options.listFilter) {\n\t\t\t\t\t\tobj.listFilter = filter.factory(element.create(\"input\", {\n\t\t\t\t\t\t\tid: obj.element.id + \"-filter\",\n\t\t\t\t\t\t\t\"class\": \"filter\",\n\t\t\t\t\t\t\tplaceholder: \"Filter\"\n\t\t\t\t\t\t}, target, \"first\"), obj, options.listFilter, options.debounce || 250);\n\t\t\t\t\t\tdelete options.listFilter;\n\t\t\t\t\t\tdelete options.listFiltered;\n\t\t\t\t\t\tdelete options.debounce;\n\t\t\t\t\t}\n\n\t\t\t\t\tutility.merge(obj, options);\n\t\t\t\t}\n\n\t\t\t\tobj.store.lists.push(obj);\n\n\t\t\t\t// Setting up a chain of Events\n\t\t\t\tobj.on(\"beforeRefresh\", function (arg) {\n\t\t\t\t\telement.dispatch(arg, \"beforeRefresh\");\n\t\t\t\t}, \"bubble\");\n\n\t\t\t\tobj.on(\"afterRefresh\", function (arg) {\n\t\t\t\t\telement.dispatch(arg, \"afterRefresh\");\n\t\t\t\t}, \"bubble\");\n\n\t\t\t\tobj.on(\"change\", function (arg) {\n\t\t\t\t\telement.dispatch(obj.element, \"change\", arg);\n\t\t\t\t}, \"change\");\n\n\t\t\t\tobj.on(\"click\", function (e) {\n\t\t\t\t\tvar target = utility.target(e);\n\t\t\t\t\tvar page = undefined;\n\n\t\t\t\t\tutility.stop(e);\n\n\t\t\t\t\tif (target.nodeName === \"A\") {\n\t\t\t\t\t\tpage = element.data(target, \"page\");\n\n\t\t\t\t\t\tif (!isNaN(page)) {\n\t\t\t\t\t\t\tobj.page(page);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, \"pagination\");\n\n\t\t\t\tif (typeof MutationObserver === \"function\") {\n\t\t\t\t\tobj.mutation = new MutationObserver(function (arg) {\n\t\t\t\t\t\tobj.dispatch(\"change\", arg);\n\t\t\t\t\t});\n\n\t\t\t\t\tobj.mutation.observe(obj.element, { childList: true, subtree: true });\n\t\t\t\t}\n\n\t\t\t\t// Rendering if not tied to an API or data is ready\n\t\t\t\tif (obj.store.uri === null || obj.store.loaded) {\n\t\t\t\t\tobj.refresh();\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Calculates the total pages\n    *\n    * @method pages\n    * @memberOf list\n    * @return {Number} Total pages\n    * @private\n    */\n\t\t\tpages: function (obj) {\n\t\t\t\tif (isNaN(obj.pageSize)) {\n\t\t\t\t\tthrow new Error(label.invalidArguments);\n\t\t\t\t}\n\n\t\t\t\treturn Math.ceil((!obj.filter ? obj.total : obj.filtered.length) / obj.pageSize);\n\t\t\t},\n\n\t\t\t/**\n    * Calculates the page size as an Array of start & finish\n    *\n    * @method range\n    * @memberOf list\n    * @return {Array}  Array of start & end numbers\n    * @private\n    */\n\t\t\trange: function (obj) {\n\t\t\t\tvar start = obj.pageIndex * obj.pageSize - obj.pageSize;\n\t\t\t\tvar end = obj.pageSize;\n\n\t\t\t\treturn [start, end];\n\t\t\t}\n\t\t};\n\n\t\tvar Deferred = (function () {\n\t\t\t/**\n    * Creates a new Deferred\n    *\n    * @constructor\n    * @memberOf keigai\n    */\n\t\t\tfunction Deferred() {\n\t\t\t\t_classCallCheck(this, Deferred);\n\n\t\t\t\tvar self = this;\n\n\t\t\t\tthis.promise = promise.factory();\n\t\t\t\tthis.onDone = [];\n\t\t\t\tthis.onAlways = [];\n\t\t\t\tthis.onFail = [];\n\n\t\t\t\t// Setting handlers to execute Arrays of Functions\n\t\t\t\tthis.promise.then(function (arg) {\n\t\t\t\t\tarray.each(self.onDone, function (i) {\n\t\t\t\t\t\ti(arg);\n\t\t\t\t\t});\n\n\t\t\t\t\tarray.each(self.onAlways, function (i) {\n\t\t\t\t\t\ti(arg);\n\t\t\t\t\t});\n\n\t\t\t\t\tself.onAlways = [];\n\t\t\t\t\tself.onDone = [];\n\t\t\t\t\tself.onFail = [];\n\t\t\t\t}, function (arg) {\n\t\t\t\t\tarray.each(self.onFail, function (i) {\n\t\t\t\t\t\ti(arg);\n\t\t\t\t\t});\n\n\t\t\t\t\tarray.each(self.onAlways, function (i) {\n\t\t\t\t\t\ti(arg);\n\t\t\t\t\t});\n\n\t\t\t\t\tself.onAlways = [];\n\t\t\t\t\tself.onDone = [];\n\t\t\t\t\tself.onFail = [];\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t_prototypeProperties(Deferred, null, {\n\t\t\t\talways: {\n\n\t\t\t\t\t/**\n      * Registers a function to execute after Promise is reconciled\n      *\n      * @method always\n      * @memberOf keigai.Deferred\n      * @param  {Function} arg Function to execute\n      * @return {Object} {@link keigai.Deferred}\n      * @example\n      * let deferred = keigai.util.defer();\n      *\n      * deferred.always( function () {\n      *     ...\n      * } ).then( function () {\n      *     ...\n      * } );\n      *\n      * ...\n      *\n      * deferred.resolve( true );\n      */\n\t\t\t\t\tvalue: function always(arg) {\n\t\t\t\t\t\tthis.onAlways.push(arg);\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tdone: {\n\n\t\t\t\t\t/**\n      * Registers a function to execute after Promise is resolved\n      *\n      * @method done\n      * @memberOf keigai.Deferred\n      * @param  {Function} arg Function to execute\n      * @return {Object} {@link keigai.Deferred}\n      * @example\n      * let deferred = keigai.util.defer();\n      *\n      * deferred.done( function ( ... ) {\n      *   ...\n      * } );\n      */\n\t\t\t\t\tvalue: function done(arg) {\n\t\t\t\t\t\tthis.onDone.push(arg);\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tfail: {\n\n\t\t\t\t\t/**\n      * Registers a function to execute after Promise is rejected\n      *\n      * @method fail\n      * @memberOf keigai.Deferred\n      * @param  {Function} arg Function to execute\n      * @return {Object} {@link keigai.Deferred}\n      * @example\n      * let deferred = keigai.util.defer();\n      *\n      * deferred.fail( function ( ... ) {\n      *   ...\n      * } );\n      */\n\t\t\t\t\tvalue: function fail(arg) {\n\t\t\t\t\t\tthis.onFail.push(arg);\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\treject: {\n\n\t\t\t\t\t/**\n      * Rejects the Promise\n      *\n      * @method reject\n      * @memberOf keigai.Deferred\n      * @param  {Mixed} arg Rejection outcome\n      * @return {Object} {@link keigai.Deferred}\n      * @example\n      * let deferred = keigai.util.defer();\n      *\n      * deferred.reject( new Error( \"Something went wrong\" ) );\n      */\n\t\t\t\t\tvalue: function reject(arg) {\n\t\t\t\t\t\tthis.promise.reject.call(this.promise, arg);\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tresolve: {\n\n\t\t\t\t\t/**\n      * Resolves the Promise\n      *\n      * @method resolve\n      * @memberOf keigai.Deferred\n      * @param  {Mixed} arg Resolution outcome\n      * @return {Object} {@link keigai.Deferred}\n      * @example\n      * let deferred = keigai.util.defer();\n      *\n      * deferred.resolve( true );\n      */\n\t\t\t\t\tvalue: function resolve(arg) {\n\t\t\t\t\t\tthis.promise.resolve.call(this.promise, arg);\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tthen: {\n\n\t\t\t\t\t/**\n      * Registers handler(s) for the Promise\n      *\n      * @method then\n      * @memberOf keigai.Deferred\n      * @param  {Function} success Executed when/if promise is resolved\n      * @param  {Function} failure [Optional] Executed when/if promise is broken\n      * @return {Object} {@link Promise}\n      * @example\n      * let deferred = keigai.util.defer();\n      *\n      * deferred.then( function ( ... ) { ... }, function ( err ) { ... } )\n      *         .then( function ( ... ) { ... }, function ( err ) { ... } );\n      *\n      * ...\n      *\n      * deferred.resolve( true );\n      */\n\t\t\t\t\tvalue: function then(success, failure) {\n\t\t\t\t\t\treturn this.promise.then(success, failure);\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn Deferred;\n\t\t})();\n\n\t\t/**\n   * @namespace deferred\n   */\n\t\tvar deferred = {\n\t\t\t/**\n    * Deferred factory\n    *\n    * @method factory\n    * @memberOf deferred\n    * @return {Object} {@link keigai.Deferred}\n    * @example\n    * let deferred = keigai.util.defer();\n    *\n    * deferred.then( function ( ... ) { ... }, function ( err ) { ... } )\n    * deferred.always( function ( ... ) { ... } );\n    *\n    * ...\n    *\n    * deferred.resolve( true );\n    */\n\t\t\tfactory: function () {\n\t\t\t\treturn new Deferred();\n\t\t\t}\n\t\t};\n\n\t\t/**\n   * @namespace element\n   */\n\t\tvar element = {\n\t\t\t/**\n    * Adds a CSS class to an Element\n    *\n    * @method addClass\n    * @memberOf element\n    * @param  {Object} obj Element\n    * @param  {String} arg CSS class\n    * @return {Object}     Element\n    * @example\n    * keigai.util.element.addClass( document.querySelector( \"#target\" ), \"newClass\" );\n    */\n\t\t\taddClass: function (obj, arg) {\n\t\t\t\telement.klass(obj, arg, true);\n\t\t\t},\n\n\t\t\t/**\n    * Appends an Element to an Element\n    *\n    * @method appendTo\n    * @memberOf element\n    * @param  {Object} obj   Element\n    * @param  {Object} child Child Element\n    * @return {Object}       Element\n    * @example\n    * keigai.util.element.appendTo( document.querySelector( \"#target\" ), document.querySelector( \"#something\" ) );\n    */\n\t\t\tappendTo: function (obj, child) {\n\t\t\t\tobj.appendChild(child);\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Gets or sets an Element attribute\n    *\n    * @method attr\n    * @memberOf element\n    * @param  {Object} obj   Element\n    * @param  {String} name  Attribute name\n    * @param  {Mixed}  value Attribute value\n    * @return {Object}       Element\n    * @example\n    * keigai.util.element.attr( document.querySelector( \"select\" ), \"selected\", \"option 1\" );\n    */\n\t\t\tattr: function (obj, key, value) {\n\t\t\t\tvar target = undefined,\n\t\t\t\t    result = undefined;\n\n\t\t\t\tif (regex.svg.test(obj.namespaceURI)) {\n\t\t\t\t\tif (value === undefined) {\n\t\t\t\t\t\tresult = obj.getAttributeNS(obj.namespaceURI, key);\n\n\t\t\t\t\t\tif (result === null || string.isEmpty(result)) {\n\t\t\t\t\t\t\tresult = undefined;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult = utility.coerce(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobj.setAttributeNS(obj.namespaceURI, key, value);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (typeof value === \"string\") {\n\t\t\t\t\t\tvalue = string.trim(value);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (regex.checked_disabled.test(key) && value === undefined) {\n\t\t\t\t\t\treturn utility.coerce(obj[key]);\n\t\t\t\t\t} else if (regex.checked_disabled.test(key) && value !== undefined) {\n\t\t\t\t\t\tobj[key] = value;\n\t\t\t\t\t} else if (obj.nodeName === \"SELECT\" && key === \"selected\" && value === undefined) {\n\t\t\t\t\t\treturn utility.dom(\"#\" + obj.id + \" option[selected=\\\"selected\\\"]\")[0] || utility.dom(\"#\" + obj.id + \" option\")[0];\n\t\t\t\t\t} else if (obj.nodeName === \"SELECT\" && key === \"selected\" && value !== undefined) {\n\t\t\t\t\t\ttarget = utility.dom(\"#\" + obj.id + \" option[selected=\\\"selected\\\"]\")[0];\n\n\t\t\t\t\t\tif (target !== undefined) {\n\t\t\t\t\t\t\ttarget.selected = false;\n\t\t\t\t\t\t\ttarget.removeAttribute(\"selected\");\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttarget = utility.dom(\"#\" + obj.id + \" option[value=\\\"\" + value + \"\\\"]\")[0];\n\t\t\t\t\t\ttarget.selected = true;\n\t\t\t\t\t\ttarget.setAttribute(\"selected\", \"selected\");\n\t\t\t\t\t} else if (value === undefined) {\n\t\t\t\t\t\tresult = obj.getAttribute(key);\n\n\t\t\t\t\t\tif (result === null || string.isEmpty(result)) {\n\t\t\t\t\t\t\tresult = undefined;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult = utility.coerce(result);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobj.setAttribute(key, value);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Clears an object's innerHTML, or resets it's state\n    *\n    * @method clear\n    * @memberOf element\n    * @param  {Object} obj Element\n    * @return {Object}     Element\n    * @example\n    * keigai.util.element.clear( document.querySelector( \"#something\" ) );\n    */\n\t\t\tclear: function (obj) {\n\t\t\t\tif (typeof obj.reset === \"function\") {\n\t\t\t\t\tobj.reset();\n\t\t\t\t} else if (obj.value !== undefined) {\n\t\t\t\t\telement.update(obj, { innerHTML: \"\", value: \"\" });\n\t\t\t\t} else {\n\t\t\t\t\telement.update(obj, { innerHTML: \"\" });\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Creates an Element in document.body or a target Element.\n    * An id is generated if not specified with args.\n    *\n    * @method create\n    * @memberOf element\n    * @param  {String} type Type of Element to create, or HTML String\n    * @param  {Object} args [Optional] Properties to set\n    * @param  {Object} obj  [Optional] Target Element\n    * @param  {Mixed}  pos  [Optional] \"first\", \"last\" or Object describing how to add the new Element, e.g. {before: referenceElement}, default is \"last\"\n    * @return {Mixed}       Element that was created, or an Array if `type` is a String of multiple Elements (frag)\n    * @example\n    * keigai.util.element.create( \"div\", {innerHTML: \"Hello World!\"}, document.querySelector( \"#something\" ) );\n    * keigai.util.element.create( \"&lt;div&gt;Hello World!&lt;/div&gt;\" );\n    */\n\t\t\tcreate: function (type, args, obj, pos) {\n\t\t\t\tvar svg = false;\n\t\t\t\tvar frag = false;\n\t\t\t\tvar fragment = undefined,\n\t\t\t\t    result = undefined;\n\n\t\t\t\t// Removing potential HTML template formatting\n\t\t\t\ttype = type.replace(/\\t|\\n|\\r/g, \"\");\n\n\t\t\t\tif (obj) {\n\t\t\t\t\tsvg = obj.namespaceURI && regex.svg.test(obj.namespaceURI);\n\t\t\t\t} else {\n\t\t\t\t\tobj = document.body;\n\t\t\t\t}\n\n\t\t\t\t// String injection, create a frag and apply it\n\t\t\t\tif (regex.html.test(type)) {\n\t\t\t\t\tfrag = true;\n\t\t\t\t\tfragment = element.frag(type);\n\t\t\t\t\tresult = fragment.childNodes.length === 1 ? fragment.childNodes[0] : array.cast(fragment.childNodes);\n\t\t\t\t}\n\t\t\t\t// Original syntax\n\t\t\t\telse {\n\t\t\t\t\tif (!svg && !regex.svg.test(type)) {\n\t\t\t\t\t\tfragment = document.createElement(type);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfragment = document.createElementNS(\"http://www.w3.org/2000/svg\", type);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (args instanceof Object) {\n\t\t\t\t\t\telement.update(fragment, args);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!pos || pos === \"last\") {\n\t\t\t\t\tobj.appendChild(fragment);\n\t\t\t\t} else if (pos === \"first\") {\n\t\t\t\t\telement.prependChild(obj, fragment);\n\t\t\t\t} else if (pos === \"after\") {\n\t\t\t\t\tpos = { after: obj };\n\t\t\t\t\tobj = obj.parentNode;\n\t\t\t\t\tobj.insertBefore(fragment, pos.after.nextSibling);\n\t\t\t\t} else if (pos.after) {\n\t\t\t\t\tobj.insertBefore(fragment, pos.after.nextSibling);\n\t\t\t\t} else if (pos === \"before\") {\n\t\t\t\t\tpos = { before: obj };\n\t\t\t\t\tobj = obj.parentNode;\n\t\t\t\t\tobj.insertBefore(fragment, pos.before);\n\t\t\t\t} else if (pos.before) {\n\t\t\t\t\tobj.insertBefore(fragment, pos.before);\n\t\t\t\t} else {\n\t\t\t\t\tobj.appendChild(fragment);\n\t\t\t\t}\n\n\t\t\t\treturn !frag ? fragment : result;\n\t\t\t},\n\n\t\t\t/**\n    * Gets or sets a CSS style attribute on an Element\n    *\n    * @method css\n    * @memberOf element\n    * @param  {Object} obj   Element\n    * @param  {String} key   CSS to put in a style tag\n    * @param  {String} value [Optional] Value to set\n    * @return {Object}       Element\n    * @example\n    * keigai.util.element.css( document.querySelector( \"#something\" ), \"font-weight\", \"bold\" );\n    * keigai.util.element.css( document.querySelector( \"#something\" ), \"font-weight\" ); // \"bold\"\n    */\n\t\t\tcss: function (obj, key, value) {\n\t\t\t\tif (!regex.caps.test(key)) {\n\t\t\t\t\tkey = string.toCamelCase(key);\n\t\t\t\t}\n\n\t\t\t\tif (value !== undefined) {\n\t\t\t\t\tobj.style[key] = value;\n\t\t\t\t\treturn obj;\n\t\t\t\t} else {\n\t\t\t\t\treturn obj.style[key];\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n    * Data attribute facade acting as a getter (with coercion) & setter\n    *\n    * @method data\n    * @memberOf element\n    * @param  {Object} obj   Element\n    * @param  {String} key   Data key\n    * @param  {Mixed}  value Boolean, Number or String to set\n    * @return {Mixed}        undefined, Element or value\n    * @example\n    * // Setting\n    * keigai.util.element.data( document.querySelector( \"#something\" ), \"id\", \"abc-1234\" );\n    *\n    * // Getting\n    * keigai.util.element.data( document.querySelector( \"#something\" ), \"id\" ); // \"abc-1234\"\n    *\n    * // Unsetting\n    * keigai.util.element.data( document.querySelector( \"#something\" ), \"id\", null );\n    *\n    * // Setting a `null` value can be done by using a String\n    * keigai.util.element.data( document.querySelector( \"#something\" ), \"id\", \"null\" );\n    */\n\t\t\tdata: function (obj, key, value) {\n\t\t\t\tif (value !== undefined) {\n\t\t\t\t\tobj.setAttribute(\"data-\" + key, regex.json_wrap.test(value) ? json.encode(value) : value);\n\n\t\t\t\t\treturn obj;\n\t\t\t\t} else {\n\t\t\t\t\treturn utility.coerce(obj.getAttribute(\"data-\" + key));\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n    * Destroys an Element\n    *\n    * @method destroy\n    * @memberOf element\n    * @param  {Object} obj Element\n    * @return {Undefined} undefined\n    * @example\n    * keigai.util.element.destroy( document.querySelector( \"#something\" ) );\n    */\n\t\t\tdestroy: function (obj) {\n\t\t\t\tif (obj.parentNode !== null) {\n\t\t\t\t\tobj.parentNode.removeChild(obj);\n\t\t\t\t}\n\n\t\t\t\treturn undefined;\n\t\t\t},\n\n\t\t\t/**\n    * Disables an Element\n    *\n    * @method disable\n    * @memberOf element\n    * @param  {Object} obj Element\n    * @return {Object}     Element\n    * @example\n    * keigai.util.element.disable( document.querySelector( \"#something\" ) );\n    */\n\t\t\tdisable: function (obj) {\n\t\t\t\tif (typeof obj.disabled === \"boolean\" && !obj.disabled) {\n\t\t\t\t\tobj.disabled = true;\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Dispatches a DOM Event from an Element\n    *\n    * `data` will appear as `Event.detail`\n    *\n    * @method dispatch\n    * @memberOf element\n    * @param  {Object}  obj        Element which dispatches the Event\n    * @param  {String}  type       Type of Event to dispatch\n    * @param  {Object}  data       [Optional] Data to include with the Event\n    * @param  {Boolean} bubbles    [Optional] Determines if the Event bubbles, defaults to `true`\n    * @param  {Boolean} cancelable [Optional] Determines if the Event can be canceled, defaults to `true`\n    * @return {Object}             Element which dispatches the Event\n    * @example\n    * keigai.util.element.dispatch( document.querySelector( \"#something\" ), \"click\" );\n    */\n\t\t\tdispatch: function (obj, type) {\n\t\t\t\tvar data = arguments[2] === undefined ? {} : arguments[2];\n\t\t\t\tvar bubbles = arguments[3] === undefined ? true : arguments[3];\n\t\t\t\tvar cancelable = arguments[4] === undefined ? true : arguments[4];\n\t\t\t\tvar ev = undefined;\n\n\t\t\t\tif (!obj) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tev = new CustomEvent(type);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tev = document.createEvent(\"CustomEvent\");\n\t\t\t\t}\n\n\t\t\t\tev.initCustomEvent(type, bubbles, cancelable, data);\n\t\t\t\tobj.dispatchEvent(ev);\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Enables an Element\n    *\n    * @method enable\n    * @memberOf element\n    * @param  {Object} obj Element\n    * @return {Object}     Element\n    * @example\n    * keigai.util.element.enable( document.querySelector( \"#something\" ) );\n    */\n\t\t\tenable: function (obj) {\n\t\t\t\tif (typeof obj.disabled === \"boolean\" && obj.disabled) {\n\t\t\t\t\tobj.disabled = false;\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Finds descendant childNodes of Element matched by arg\n    *\n    * @method find\n    * @memberOf element\n    * @param  {Object} obj Element to search\n    * @param  {String} arg Comma delimited string of descendant selectors\n    * @return {Mixed}      Array of Elements or undefined\n    * @example\n    * keigai.util.element.find( document.querySelector( \"#something\" ), \"p\" );\n    */\n\t\t\tfind: function (obj, arg) {\n\t\t\t\tvar result = [];\n\n\t\t\t\tarray.each(string.explode(arg), function (i) {\n\t\t\t\t\tresult = result.concat(array.cast(obj.querySelectorAll(i)));\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Creates a document fragment\n    *\n    * @method frag\n    * @memberOf element\n    * @param  {String} arg [Optional] innerHTML\n    * @return {Object}     Document fragment\n    * @example\n    * let frag = keigai.util.element.frag( \"Hello World!\" );\n    */\n\t\t\tfrag: function (arg) {\n\t\t\t\tvar obj = document.createDocumentFragment();\n\n\t\t\t\tif (arg) {\n\t\t\t\t\tarray.each(array.cast(element.create(\"div\", { innerHTML: arg }, obj).childNodes), function (i) {\n\t\t\t\t\t\tobj.appendChild(i);\n\t\t\t\t\t});\n\n\t\t\t\t\tobj.removeChild(obj.childNodes[0]);\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Determines if Element has descendants matching arg\n    *\n    * @method has\n    * @memberOf element\n    * @param  {Object} obj Element\n    * @param  {String} arg Type of Element to find\n    * @return {Boolean}    `true` if 1 or more Elements are found\n    * @example\n    * if ( keigai.util.element.has( document.querySelector( \"#something\" ), \"p\" ) ) {\n    *   ...\n    * }\n    */\n\t\t\thas: function (obj, arg) {\n\t\t\t\tvar result = element.find(obj, arg);\n\n\t\t\t\treturn !isNaN(result.length) && result.length > 0;\n\t\t\t},\n\n\t\t\t/**\n    * Determines if obj has a specific CSS class\n    *\n    * @method hasClass\n    * @memberOf element\n    * @param  {Object} obj Element\n    * @param  {String} arg CSS class to test for\n    * @return {Boolean}    `true` if Element has `arg`\n    * @example\n    * if ( keigai.util.element.hasClass( document.querySelector( \"#something\" ), \"someClass\" ) ) {\n    *   ...\n    * }\n    */\n\t\t\thasClass: function (obj, arg) {\n\t\t\t\treturn obj.classList.contains(arg);\n\t\t\t},\n\n\t\t\t/**\n    * Returns a Boolean indidcating if the Object is hidden\n    *\n    * @method hidden\n    * @memberOf element\n    * @param  {Object} obj Element\n    * @return {Boolean}   `true` if hidden\n    * @example\n    * if ( keigai.util.element.hidden( document.querySelector( \"#something\" ) ) ) {\n    *   ...\n    * }\n    */\n\t\t\thidden: function (obj) {\n\t\t\t\treturn obj.style.display === \"none\" || obj.hidden === true;\n\t\t\t},\n\n\t\t\t/**\n    * Gets or sets an Elements innerHTML\n    *\n    * @method html\n    * @memberOf element\n    * @param  {Object} obj Element\n    * @param  {String} arg [Optional] innerHTML value\n    * @return {Object}     Element\n    * @example\n    * keigai.util.element.html( document.querySelector( \"#something\" ), \"Hello World!\" );\n    * keigai.util.element.html( document.querySelector( \"#something\" ) ); // \"Hello World!\"\n    */\n\t\t\thtml: function (obj, arg) {\n\t\t\t\tif (arg === undefined) {\n\t\t\t\t\treturn obj.innerHTML;\n\t\t\t\t} else {\n\t\t\t\t\tobj.innerHTML = arg;\n\t\t\t\t\treturn obj;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n    * Determines if Element is equal to `arg`, supports nodeNames & CSS2+ selectors\n    *\n    * @method is\n    * @memberOf element\n    * @param  {Object} obj Element\n    * @param  {String} arg Property to query\n    * @return {Boolean}    `true` if a match\n    * @example\n    * if ( keigai.util.element.is( document.querySelector( \"#something\" ), \"div\" ) ) {\n    *   ...\n    * }\n    *\n    * if ( keigai.util.element.is( document.querySelector( \"#something\" ), \":first-child\" ) ) {\n    *   ...\n    * }\n    */\n\t\t\tis: function (obj, arg) {\n\t\t\t\tif (regex.selector_is.test(arg)) {\n\t\t\t\t\treturn element.find(obj.parentNode, obj.nodeName.toLowerCase() + arg).filter(function (i) {\n\t\t\t\t\t\treturn i.id === obj.id;\n\t\t\t\t\t}).length === 1;\n\t\t\t\t} else {\n\t\t\t\t\treturn new RegExp(arg, \"i\").test(obj.nodeName);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n    * Adds or removes a CSS class\n    *\n    * @method klass\n    * @memberOf element\n    * @param  {Object}  obj Element\n    * @param  {String}  arg Class to add or remove ( can be a wildcard )\n    * @param  {Boolean} add Boolean to add or remove, defaults to true\n    * @return {Object}      Element\n    * @example\n    * // Adding a class\n    * keigai.util.element.klass( document.querySelector( \"#something\" ), \"newClass\" );\n    *\n    * // Removing a class\n    * keigai.util.element.klass( document.querySelector( \"#something\" ), \"newClass\", false );\n    */\n\t\t\tklass: function (obj, arg) {\n\t\t\t\tvar add = arguments[2] === undefined ? true : arguments[2];\n\t\t\t\targ = string.explode(arg, \" \");\n\n\t\t\t\tif (add) {\n\t\t\t\t\tarray.each(arg, function (i) {\n\t\t\t\t\t\tobj.classList.add(i);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tarray.each(arg, function (i) {\n\t\t\t\t\t\tif (i !== \"*\") {\n\t\t\t\t\t\t\tobj.classList.remove(i);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tarray.each(obj.classList, function (x) {\n\t\t\t\t\t\t\t\tobj.classList.remove(x);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Finds the position of an Element\n    *\n    * @method position\n    * @memberOf element\n    * @param  {Object} obj Element\n    * @return {Array}      Coordinates [left, top, right, bottom]\n    * @example\n    * let pos = keigai.util.element.position( document.querySelector( \"#something\" ) );\n    */\n\t\t\tposition: function () {\n\t\t\t\tvar obj = arguments[0] === undefined ? document.body : arguments[0];\n\t\t\t\tvar left = undefined,\n\t\t\t\t    top = undefined,\n\t\t\t\t    right = undefined,\n\t\t\t\t    bottom = undefined,\n\t\t\t\t    height = undefined,\n\t\t\t\t    width = undefined;\n\n\t\t\t\tleft = top = 0;\n\t\t\t\twidth = obj.offsetWidth;\n\t\t\t\theight = obj.offsetHeight;\n\n\t\t\t\tif (obj.offsetParent) {\n\t\t\t\t\ttop = obj.offsetTop;\n\t\t\t\t\tleft = obj.offsetLeft;\n\n\t\t\t\t\twhile (obj = obj.offsetParent) {\n\t\t\t\t\t\tleft += obj.offsetLeft;\n\t\t\t\t\t\ttop += obj.offsetTop;\n\t\t\t\t\t}\n\n\t\t\t\t\tright = document.body.offsetWidth - (left + width);\n\t\t\t\t\tbottom = document.body.offsetHeight - (top + height);\n\t\t\t\t} else {\n\t\t\t\t\tright = width;\n\t\t\t\t\tbottom = height;\n\t\t\t\t}\n\n\t\t\t\treturn [left, top, right, bottom];\n\t\t\t},\n\n\t\t\t/**\n    * Prepends an Element to an Element\n    *\n    * @method prependChild\n    * @memberOf element\n    * @param  {Object} obj   Element\n    * @param  {Object} child Child Element\n    * @return {Object}       Element\n    * @example\n    * keigai.util.element.prependChild( document.querySelector( \"#target\" ), document.querySelector( \"#something\" ) );\n    */\n\t\t\tprependChild: function (obj, child) {\n\t\t\t\treturn obj.childNodes.length === 0 ? obj.appendChild(child) : obj.insertBefore(child, obj.childNodes[0]);\n\t\t\t},\n\n\t\t\t/**\n    * Removes an Element attribute\n    *\n    * @method removeAttr\n    * @memberOf element\n    * @param  {Object} obj Element\n    * @param  {String} key Attribute name\n    * @return {Object}     Element\n    * @example\n    * keigai.util.element.removeAttr( document.querySelector( \"a\" ), \"href\" );\n    */\n\t\t\tremoveAttr: function (obj, key) {\n\t\t\t\tif (regex.svg.test(obj.namespaceURI)) {\n\t\t\t\t\tobj.removeAttributeNS(obj.namespaceURI, key);\n\t\t\t\t} else {\n\t\t\t\t\tif (obj.nodeName === \"SELECT\" && key === \"selected\") {\n\t\t\t\t\t\tarray.each(element.find(obj, \"option\"), function (i) {\n\t\t\t\t\t\t\tif (i.selected === true) {\n\t\t\t\t\t\t\t\ti.selected = false;\n\t\t\t\t\t\t\t\ti.removeAttribute(\"selected\");\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobj.removeAttribute(key);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Removes a CSS class from Element\n    *\n    * @method removeClass\n    * @memberOf element\n    * @param  {Object} obj Element\n    * @param  {String} arg CSS class\n    * @return {Object}     Element\n    * @example\n    * keigai.util.element.removeClass( document.querySelector( \"#target\" ), \"existingClass\" );\n    */\n\t\t\tremoveClass: function (obj, arg) {\n\t\t\t\telement.klass(obj, arg, false);\n\t\t\t},\n\n\t\t\t/**\n    * Scrolls to the position of an Element\n    *\n    * @method scrollTo\n    * @memberOf element\n    * @param  {Object} obj        Element to scroll to\n    * @param  {Number} ms         [Optional] Milliseconds to scroll, default is 250, min is 100\n    * @param  {Number} offsetTop  [Optional] Offset from top of Element\n    * @param  {Number} offsetLeft [Optional] Offset from left of Element\n    * @return {Object} {@link Deferred}\n    * @example\n    * keigai.util.element.scrollTo( document.querySelector( \"#something\" ) ).then( () => {\n    *   ...\n    * } );\n    */\n\t\t\tscrollTo: function (obj, ms, offsetTop, offsetLeft) {\n\t\t\t\tvar pos = array.remove(element.position(obj), 2, 3);\n\n\t\t\t\tif (!isNaN(offsetTop)) {\n\t\t\t\t\tpos[0] += offsetTop;\n\t\t\t\t}\n\n\t\t\t\tif (!isNaN(offsetLeft)) {\n\t\t\t\t\tpos[1] += offsetLeft;\n\t\t\t\t}\n\n\t\t\t\treturn client.scroll(pos, ms);\n\t\t\t},\n\n\t\t\t/**\n    * Serializes the elements of an Element\n    *\n    * @method serialize\n    * @memberOf element\n    * @param  {Object}  obj    Element\n    * @param  {Boolean} string [Optional] true if you want a query string, default is false ( JSON )\n    * @param  {Boolean} encode [Optional] true if you want to URI encode the value, default is true\n    * @return {Mixed}          String or Object\n    * @example\n    * let userInput = keigai.util.element.serialize( document.querySelector( \"form\" ) );\n    */\n\t\t\tserialize: function (obj) {\n\t\t\t\tvar string = arguments[1] === undefined ? true : arguments[1];\n\t\t\t\tvar encode = arguments[2] === undefined ? true : arguments[2];\n\t\t\t\tvar registry = {};\n\t\t\t\tvar children = undefined,\n\t\t\t\t    result = undefined;\n\n\t\t\t\tchildren = obj.nodeName === \"FORM\" ? obj.elements ? array.cast(obj.elements) : obj.find(\"button, input, select, textarea\") : [obj];\n\n\t\t\t\tarray.each(children, function (i) {\n\t\t\t\t\tvar id = i.id || i.name || i.type;\n\n\t\t\t\t\tif (i.nodeName === \"FORM\") {\n\t\t\t\t\t\tutility.merge(registry, json.decode(element.serialize(i)));\n\t\t\t\t\t} else if (!registry[id]) {\n\t\t\t\t\t\tregistry[id] = element.val(i);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (!string) {\n\t\t\t\t\tresult = registry;\n\t\t\t\t} else {\n\t\t\t\t\tresult = \"\";\n\n\t\t\t\t\tutility.iterate(registry, function (v, k) {\n\t\t\t\t\t\tencode ? result += \"&\" + encodeURIComponent(k) + \"=\" + encodeURIComponent(v) : result += \"&\" + k + \"=\" + v;\n\t\t\t\t\t});\n\n\t\t\t\t\tresult = result.replace(regex.and, \"?\");\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Returns the size of the Element\n    *\n    * @method size\n    * @memberOf element\n    * @param  {Object} obj Element\n    * @return {Array}      [width, height]\n    * @example\n    * let size = keigai.util.element.size( document.querySelector( \"#something\" ) );\n    */\n\t\t\tsize: function (obj) {\n\t\t\t\treturn [obj.offsetWidth + number.parse(obj.style.paddingLeft || 0) + number.parse(obj.style.paddingRight || 0) + number.parse(obj.style.borderLeft || 0) + number.parse(obj.style.borderRight || 0), obj.offsetHeight + number.parse(obj.style.paddingTop || 0) + number.parse(obj.style.paddingBottom || 0) + number.parse(obj.style.borderTop || 0) + number.parse(obj.style.borderBottom || 0)];\n\t\t\t},\n\n\t\t\t/**\n    * Getter / setter for an Element's text\n    *\n    * @method text\n    * @memberOf element\n    * @param  {Object} obj Element\n    * @param  {String} arg [Optional] Value to set\n    * @return {Object}     Element\n    * @example\n    * let obj  = document.querySelector( \"#something\" ),\n    *     text = keigai.util.element.text( obj );\n    *\n    * keigai.util.element.text( obj, text + \", and some more text\" );\n    */\n\t\t\ttext: function (obj, arg) {\n\t\t\t\tvar key = obj.textContent ? \"textContent\" : \"innerText\";\n\t\t\t\tvar payload = {};\n\t\t\t\tvar set = false;\n\n\t\t\t\tif (typeof arg != \"undefined\") {\n\t\t\t\t\tset = true;\n\t\t\t\t\tpayload[key] = arg;\n\t\t\t\t}\n\n\t\t\t\treturn set ? element.update(obj, payload) : obj[key];\n\t\t\t},\n\n\t\t\t/**\n    * Toggles a CSS class\n    *\n    * @method toggleClass\n    * @memberOf element\n    * @param  {Object} obj Element\n    * @param  {String} arg CSS class to toggle\n    * @return {Object}     Element\n    * @example\n    * let obj = document.querySelector( \"#something\" );\n    *\n    * obj.addEventListener( \"click\", ( ev ) => {\n    *   keigai.util.element.toggleClass( obj, \"active\" );\n    * }, false );\n    */\n\t\t\ttoggleClass: function (obj, arg) {\n\t\t\t\tobj.classList.toggle(arg);\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Updates an Element\n    *\n    * @method update\n    * @memberOf element\n    * @param  {Object}  obj  Element\n    * @param  {Object} args Properties to set\n    * @return {Object}      Element\n    * @example\n    * keigai.util.element.update( document.querySelector( \"#something\" ), {innerHTML: \"Hello World!\", \"class\": \"new\"} );\n    */\n\t\t\tupdate: function (obj, args) {\n\t\t\t\tutility.iterate(args, function (v, k) {\n\t\t\t\t\tif (regex.element_update.test(k)) {\n\t\t\t\t\t\tobj[k] = v;\n\t\t\t\t\t} else if (k === \"class\") {\n\t\t\t\t\t\t!string.isEmpty(v) ? element.addClass(obj, v) : element.removeClass(obj, \"*\");\n\t\t\t\t\t} else if (k.indexOf(\"data-\") === 0) {\n\t\t\t\t\t\telement.data(obj, k.replace(\"data-\", \"\"), v);\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.attr(obj, k, v);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Gets or sets the value of Element\n    *\n    * @method val\n    * @memberOf element\n    * @param  {Object} obj   Element\n    * @param  {Mixed}  value [Optional] Value to set\n    * @return {Object}       Element\n    * @example\n    * keigai.util.element.val( document.querySelector( \"input[type='text']\" ), \"new value\" );\n    */\n\t\t\tval: function (obj, value) {\n\t\t\t\tvar ev = \"input\";\n\t\t\t\tvar output = undefined;\n\n\t\t\t\tif (value === undefined) {\n\t\t\t\t\tif (regex.radio_checkbox.test(obj.type)) {\n\t\t\t\t\t\tif (string.isEmpty(obj.name)) {\n\t\t\t\t\t\t\tthrow new Error(label.expectedProperty);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tarray.each(utility.dom(\"input[name='\" + obj.name + \"']\"), function (i) {\n\t\t\t\t\t\t\tif (i.checked) {\n\t\t\t\t\t\t\t\toutput = i.value;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (regex.select.test(obj.type)) {\n\t\t\t\t\t\toutput = null;\n\t\t\t\t\t\tarray.each(element.find(obj, \"option\"), function (i) {\n\t\t\t\t\t\t\tif (i.selected === true) {\n\t\t\t\t\t\t\t\toutput = i.value;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (obj.value) {\n\t\t\t\t\t\toutput = obj.value;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toutput = element.text(obj);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (output !== undefined) {\n\t\t\t\t\t\toutput = utility.coerce(output);\n\n\t\t\t\t\t\tif (typeof output === \"string\") {\n\t\t\t\t\t\t\toutput = string.trim(output);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\toutput = \"\";\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tvalue = value.toString();\n\n\t\t\t\t\tif (regex.radio_checkbox.test(obj.type)) {\n\t\t\t\t\t\tev = \"click\";\n\n\t\t\t\t\t\tarray.each(utility.dom(\"input[name='\" + obj.name + \"']\"), function (i) {\n\t\t\t\t\t\t\tif (i.value === value) {\n\t\t\t\t\t\t\t\ti.checked = true;\n\t\t\t\t\t\t\t\toutput = i;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (regex.select.test(obj.type)) {\n\t\t\t\t\t\tev = \"change\";\n\n\t\t\t\t\t\tarray.each(element.find(obj, \" option\"), function (i) {\n\t\t\t\t\t\t\tif (i.value === value) {\n\t\t\t\t\t\t\t\ti.selected = true;\n\t\t\t\t\t\t\t\toutput = i;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobj.value !== undefined ? obj.value = value : element.text(obj, value);\n\t\t\t\t\t}\n\n\t\t\t\t\telement.dispatch(obj, ev);\n\n\t\t\t\t\toutput = obj;\n\t\t\t\t}\n\n\t\t\t\treturn output;\n\t\t\t}\n\t\t};\n\n\t\t/**\n   * @namespace json\n   */\n\t\tvar json = {\n\t\t\t/**\n    * Decodes the argument\n    *\n    * @method decode\n    * @memberOf json\n    * @param  {String}  arg    String to parse\n    * @param  {Boolean} silent [Optional] Silently fail\n    * @return {Mixed}          Entity resulting from parsing JSON, or undefined\n    * @example\n    * let x = keigai.util.json.decode( ..., true );\n    *\n    * if ( x ) {\n    *   ...\n    * } else {\n    *   ... // invalid JSON, with `Error` suppressed by `silent`\n    * }\n    */\n\t\t\tdecode: function (arg, silent) {\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(arg);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (silent !== true) {\n\t\t\t\t\t\tutility.error(e, [arg, silent], undefined);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n    * Encodes `arg` as JSON\n    *\n    * @method encode\n    * @memberOf json\n    * @param  {Mixed}   arg    Primative\n    * @param  {Boolean} silent [Optional] Silently fail\n    * @return {String}         JSON, or undefined\n    * @example\n    * let x = keigai.util.json.encode( ..., true );\n    *\n    * if ( x ) {\n    *   ...\n    * } else {\n    *   ... // invalid JSON, with `Error` suppressed by `silent`\n    * }\n    */\n\t\t\tencode: function (arg, silent) {\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.stringify(arg);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (silent !== true) {\n\t\t\t\t\t\tutility.error(e, [arg, silent], undefined);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n   * @namespace label\n   * @private\n   */\n\t\tvar label = {\n\t\t\t/**\n    * Expected a Number\n    *\n    * @type {String}\n    * @memberOf label\n    */\n\t\t\texpectedNumber: \"Expected a Number\",\n\n\t\t\t/**\n    * Expected a property, and it was not set\n    *\n    * @type {String}\n    * @memberOf label\n    */\n\t\t\texpectedProperty: \"Expected a property, and it was not set\",\n\n\t\t\t/**\n    * Expected an Object\n    *\n    * @type {String}\n    * @memberOf label\n    */\n\t\t\texpectedObject: \"Expected an Object\",\n\n\t\t\t/**\n    * One or more arguments is invalid\n    *\n    * @type {String}\n    * @memberOf label\n    */\n\t\t\tinvalidArguments: \"One or more arguments is invalid\",\n\n\t\t\t/**\n    * INVALID_STATE_ERR: Headers have not been received\n    *\n    * @type {String}\n    * @memberOf label\n    */\n\t\t\tinvalidStateNoHeaders: \"INVALID_STATE_ERR: Headers have not been received\",\n\n\t\t\t/**\n    * Synchronous XMLHttpRequest requests are not supported\n    *\n    * @type {String}\n    * @memberOf label\n    */\n\t\t\tinvalidStateNoSync: \"Synchronous XMLHttpRequest requests are not supported\",\n\n\t\t\t/**\n    * INVALID_STATE_ERR: Object is not open\n    *\n    * @type {String}\n    * @memberOf label\n    */\n\t\t\tinvalidStateNotOpen: \"INVALID_STATE_ERR: Object is not open\",\n\n\t\t\t/**\n    * INVALID_STATE_ERR: Object is sending\n    *\n    * @type {String}\n    * @memberOf label\n    */\n\t\t\tinvalidStateNotSending: \"INVALID_STATE_ERR: Object is sending\",\n\n\t\t\t/**\n    * INVALID_STATE_ERR: Object is not usable\n    *\n    * @type {String}\n    * @memberOf label\n    */\n\t\t\tinvalidStateNotUsable: \"INVALID_STATE_ERR: Object is not usable\",\n\n\t\t\t/**\n    * Error when deferred is rejected for invalid request\n    *\n    * @type {String}\n    * @memberOf label\n    */\n\t\t\tmethodNotAllowed: \"Method not allowed\",\n\n\t\t\t/**\n    * Default `emptyMsg` of DataLists\n    *\n    * @type {String}\n    * @memberOf label\n    */\n\t\t\tnoData: \"Nothing to display\",\n\n\t\t\t/**\n    * Requested method is not available\n    *\n    * @type {String}\n    * @memberOf label\n    */\n\t\t\tnotAvailable: \"Requested method is not available\",\n\n\t\t\t/**\n    * No previous version of a record\n    *\n    * @type {String}\n    * @memberOf label\n    */\n\t\t\tdatastoreNoPrevVersion: \"No previous version found\",\n\n\t\t\t/**\n    * HTTP request timed out\n    *\n    * @type {String}\n    * @memberOf label\n    */\n\t\t\trequestTimeout: \"Request timed out\",\n\n\t\t\t/**\n    * Server error has occurred\n    *\n    * @type {String}\n    * @memberOf label\n    */\n\t\t\tserverError: \"Server error has occurred\",\n\n\t\t\t/**\n    * Forbidden to access URI\n    *\n    * @type {String}\n    * @memberOf label\n    */\n\t\t\tserverForbidden: \"Forbidden to access URI\",\n\n\t\t\t/**\n    * Method not allowed\n    *\n    * @type {String}\n    * @memberOf label\n    */\n\t\t\tserverInvalidMethod: \"Method not allowed\",\n\n\t\t\t/**\n    * Authorization required to access URI\n    *\n    * @type {String}\n    * @memberOf label\n    */\n\t\t\tserverUnauthorized: \"Authorization required to access URI\",\n\n\t\t\t/**\n    * Your browser is too old to use keigai, please upgrade\n    *\n    * @type {String}\n    * @memberOf label\n    */\n\t\t\tupgrade: \"Your browser is too old to use keigai, please upgrade\"\n\t\t};\n\n\t\t/**\n   * @namespace math\n   */\n\t\tvar math = {\n\t\t\t/**\n    * Generates bezier curve coordinates for up to 4 points, last parameter is `t`\n    *\n    * Two point example: (0, 10, 0, 0, 1) means move straight up\n    *\n    * @method bezier\n    * @memberOf math\n    * @return {Array} Coordinates\n    * @example\n    * // Moving straight down\n    * let p1 = keigai.util.math.bezier( 0, 10, 2000, 10, 0 ),\n    *     p2 = keigai.util.math.bezier( 0, 10, 2000, 10, 0.5 ),\n    *     p3 = keigai.util.math.bezier( 0, 10, 2000, 10, 0.75 ),\n    *     p4 = keigai.util.math.bezier( 0, 10, 2000, 10, 0.9 ),\n    *     p5 = keigai.util.math.bezier( 0, 10, 2000, 10, 1 );\n    */\n\t\t\tbezier: function () {\n\t\t\t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\t\t\targs[_key] = arguments[_key];\n\t\t\t\t}\n\n\t\t\t\tvar a = array.cast(args);\n\t\t\t\tvar t = a.pop();\n\t\t\t\tvar P = array.chunk(a, 2);\n\t\t\t\tvar n = P.length;\n\t\t\t\tvar c = undefined,\n\t\t\t\t    S0 = undefined,\n\t\t\t\t    Q0 = undefined,\n\t\t\t\t    Q1 = undefined,\n\t\t\t\t    Q2 = undefined,\n\t\t\t\t    C0 = undefined,\n\t\t\t\t    C1 = undefined,\n\t\t\t\t    C2 = undefined,\n\t\t\t\t    C3 = undefined;\n\n\t\t\t\tif (n < 2 || n > 4) {\n\t\t\t\t\tthrow new Error(label.invalidArguments);\n\t\t\t\t}\n\n\t\t\t\t// Setting variables\n\t\t\t\tc = [];\n\t\t\t\tS0 = 1 - t;\n\t\t\t\tQ0 = math.sqr(S0);\n\t\t\t\tQ1 = 2 * S0 * t;\n\t\t\t\tQ2 = math.sqr(t);\n\t\t\t\tC0 = Math.pow(S0, 3);\n\t\t\t\tC1 = 3 * Q0 * t;\n\t\t\t\tC2 = 3 * S0 * Q2;\n\t\t\t\tC3 = Math.pow(t, 3);\n\n\t\t\t\t// Straight\n\t\t\t\tif (n === 2) {\n\t\t\t\t\tc.push(S0 * P[0][0] + t * P[1][0]);\n\t\t\t\t\tc.push(S0 * P[0][1] + t * P[1][1]);\n\t\t\t\t}\n\t\t\t\t// Quadratic\n\t\t\t\telse if (n === 3) {\n\t\t\t\t\tc.push(Q0 * P[0][0] + Q1 * P[1][0] + (Q2 + P[2][0]));\n\t\t\t\t\tc.push(Q0 * P[0][1] + Q1 * P[1][1] + (Q2 + P[2][1]));\n\t\t\t\t}\n\t\t\t\t// Cubic\n\t\t\t\telse if (n === 4) {\n\t\t\t\t\tc.push(C0 * P[0][0] + C1 * P[1][0] + C2 * P[2][0] + C3 * P[3][0]);\n\t\t\t\t\tc.push(C0 * P[0][1] + C1 * P[1][1] + C2 * P[2][1] + C3 * P[3][1]);\n\t\t\t\t}\n\n\t\t\t\treturn c;\n\t\t\t},\n\n\t\t\t/**\n    * Finds the distance between 2 Arrays of coordinates\n    *\n    * @method dist\n    * @memberOf math\n    * @param  {Array} a Coordinates [x, y]\n    * @param  {Array} b Coordinates [x, y]\n    * @return {Number}  Distance between `a` & `b`\n    * @example\n    * let dist = keigai.util.math.dist( [4, 40], [-10, 12] );\n    */\n\t\t\tdist: function (a, b) {\n\t\t\t\treturn Math.sqrt(math.sqr(b[0] - a[0]) + math.sqr(b[1] - a[1]));\n\t\t\t},\n\n\t\t\t/**\n    * Squares a Number\n    *\n    * @method sqr\n    * @memberOf math\n    * @param  {Number} n Number to square\n    * @return {Number}   Squared value\n    * @example\n    * let sqr = keigai.util.math.sqr( 23 );\n    */\n\t\t\tsqr: function (n) {\n\t\t\t\treturn n * n;\n\t\t\t}\n\t\t};\n\n\t\t/**\n   * @namespace number\n   */\n\t\tvar number = {\n\t\t\t/**\n    * Returns the difference of arg\n    *\n    * @method diff\n    * @memberOf number\n    * @param {Number} arg Number to compare\n    * @return {Number}    The absolute difference\n    * @example\n    * keigai.util.number.diff( -3, 8 ); // 11\n    */\n\t\t\tdiff: function (num1, num2) {\n\t\t\t\treturn Math.abs(num1 - num2);\n\t\t\t},\n\n\t\t\t/**\n    * Tests if an number is even\n    *\n    * @method even\n    * @memberOf number\n    * @param {Number} arg Number to test\n    * @return {Boolean}   True if even, or undefined\n    * @example\n    * let n = keigai.util.number.random( 10 );\n    *\n    * if ( keigai.util.number.even( n ) ) {\n    *   ...\n    * }\n    */\n\t\t\teven: function (arg) {\n\t\t\t\treturn arg % 2 === 0;\n\t\t\t},\n\n\t\t\t/**\n    * Formats a Number to a delimited String\n    *\n    * @method format\n    * @memberOf number\n    * @param  {Number} arg       Number to format\n    * @param  {String} delimiter [Optional] String to delimit the Number with\n    * @param  {String} every     [Optional] Position to insert the delimiter, default is 3\n    * @return {String}           Number represented as a comma delimited String\n    * @example\n    * keigai.util.number.format( 1000 ); // \"1,000\"\n    */\n\t\t\tformat: function (arg) {\n\t\t\t\tvar delimiter = arguments[1] === undefined ? \",\" : arguments[1];\n\t\t\t\tvar every = arguments[2] === undefined ? 3 : arguments[2];\n\t\t\t\targ = arg.toString();\n\n\t\t\t\tvar d = arg.indexOf(\".\") > -1 ? \".\" + arg.replace(regex.number_format_1, \"\") : \"\";\n\t\t\t\tvar a = arg.replace(regex.number_format_2, \"\").split(\"\").reverse();\n\t\t\t\tvar p = Math.floor(a.length / every);\n\t\t\t\tvar i = 1;\n\t\t\t\tvar n = undefined,\n\t\t\t\t    b = undefined;\n\n\t\t\t\tfor (b = 0; b < p; b++) {\n\t\t\t\t\tn = i === 1 ? every : every * i + (i === 2 ? 1 : i - 1);\n\t\t\t\t\ta.splice(n, 0, delimiter);\n\t\t\t\t\ti++;\n\t\t\t\t}\n\n\t\t\t\ta = a.reverse().join(\"\");\n\n\t\t\t\tif (a.charAt(0) === delimiter) {\n\t\t\t\t\ta = a.substring(1);\n\t\t\t\t}\n\n\t\t\t\treturn a + d;\n\t\t\t},\n\n\t\t\t/**\n    * Returns half of a, or true if a is half of b\n    *\n    * @method half\n    * @memberOf number\n    * @param  {Number} a Number to divide\n    * @param  {Number} b [Optional] Number to test a against\n    * @return {Mixed}    Boolean if b is passed, Number if b is undefined\n    * @example\n    * if ( keigai.util.number.half( 2, 4 ) ) {\n    *   ...\n    * } );\n    */\n\t\t\thalf: function (a, b) {\n\t\t\t\treturn b ? a / b === 0.5 : a / 2;\n\t\t\t},\n\n\t\t\t/**\n    * Tests if a number is odd\n    *\n    * @method odd\n    * @memberOf number\n    * @param  {Number} arg Number to test\n    * @return {Boolean}    True if odd, or undefined\n    * @example\n    * let n = keigai.util.number.random( 10 );\n    *\n    * if ( keigai.util.number.odd( n ) ) {\n    *   ...\n    * }\n    */\n\t\t\todd: function (arg) {\n\t\t\t\treturn !number.even(arg);\n\t\t\t},\n\n\t\t\t/**\n    * Parses the number\n    *\n    * @method parse\n    * @memberOf number\n    * @param  {Mixed}  arg  Number to parse\n    * @param  {Number} base Integer representing the base or radix\n    * @return {Number}      Integer or float\n    * @example\n    * // Unsure if `n` is an int or a float\n    * keigai.util.number.parse( n );\n    */\n\t\t\tparse: function (arg, base) {\n\t\t\t\treturn base === undefined ? parseFloat(arg) : parseInt(arg, base);\n\t\t\t},\n\n\t\t\t/**\n    * Generates a random number between 0 and `arg`\n    *\n    * @method random\n    * @memberOf number\n    * @param  {Number} arg Ceiling for random number, default is 100\n    * @return {Number}     Random number\n    * @example\n    * let n = keigai.util.math.random( 10 );\n    */\n\t\t\trandom: function () {\n\t\t\t\tvar arg = arguments[0] === undefined ? 100 : arguments[0];\n\t\t\t\treturn Math.floor(Math.random() * (arg + 1));\n\t\t\t},\n\n\t\t\t/**\n    * Rounds a number up or down\n    *\n    * @method round\n    * @memberOf number\n    * @param  {Number} arg       Number to round\n    * @param  {String} direction [Optional] \"up\" or \"down\"\n    * @return {Number}           Rounded interger\n    * @example\n    * keigai.util.math.round( n, \"down\" );\n    */\n\t\t\tround: function (arg, direction) {\n\t\t\t\targ = number.parse(arg);\n\n\t\t\t\tif (direction === undefined || string.isEmpty(direction)) {\n\t\t\t\t\treturn number.parse(arg.toFixed(0));\n\t\t\t\t} else if (regex.down.test(direction)) {\n\t\t\t\t\treturn ~ ~arg;\n\t\t\t\t} else {\n\t\t\t\t\treturn Math.ceil(arg);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n   * @namespace promise\n   */\n\t\tvar promise = {\n\t\t\t/**\n    * \"Unboxed\" Promise factory\n    *\n    * @method factory\n    * @memberOf promise\n    * @return {Object} {@link Promise}\n    */\n\t\t\tfactory: function () {\n\t\t\t\tvar promise = undefined,\n\t\t\t\t    pCatch = undefined,\n\t\t\t\t    pResolve = undefined,\n\t\t\t\t    pReject = undefined,\n\t\t\t\t    pThen = undefined;\n\n\t\t\t\tpromise = new Promise(function (resolve, reject) {\n\t\t\t\t\tpResolve = resolve;\n\t\t\t\t\tpReject = reject;\n\t\t\t\t});\n\n\t\t\t\tpCatch = function () {\n\t\t\t\t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\t\t\t\targs[_key] = arguments[_key];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn promise[\"catch\"].apply(promise, args);\n\t\t\t\t};\n\n\t\t\t\tpThen = function () {\n\t\t\t\t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\t\t\t\targs[_key] = arguments[_key];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn promise.then.apply(promise, args);\n\t\t\t\t};\n\n\t\t\t\treturn { \"catch\": pCatch, resolve: pResolve, reject: pReject, then: pThen };\n\t\t\t}\n\t\t};\n\n\t\tvar DataStore = (function (Base) {\n\t\t\t/**\n    * Creates a new DataStore\n    *\n    * @constructor\n    * @memberOf keigai\n    * @extends {keigai.Base}\n    * @example\n    * let store = keigai.store();\n    */\n\t\t\tfunction DataStore() {\n\t\t\t\t_classCallCheck(this, DataStore);\n\n\t\t\t\tthis.autosave = false;\n\t\t\t\tthis.callback = null;\n\t\t\t\tthis.credentials = null;\n\t\t\t\tthis.lists = [];\n\t\t\t\tthis.events = true;\n\t\t\t\tthis.expires = null;\n\t\t\t\tthis.headers = { Accept: \"application/json\" };\n\t\t\t\tthis.ignore = [];\n\t\t\t\tthis.index = [];\n\t\t\t\tthis.indexes = { key: {} };\n\t\t\t\tthis.key = null;\n\t\t\t\tthis.loaded = false;\n\t\t\t\tthis.mongodb = \"\";\n\t\t\t\tthis.observer = observable.factory();\n\t\t\t\tthis.records = [];\n\t\t\t\tthis.source = null;\n\t\t\t\tthis.total = 0;\n\t\t\t\tthis.versions = {};\n\t\t\t\tthis.versioning = true;\n\t\t\t\tthis.views = {};\n\t\t\t\tthis.uri = null;\n\t\t\t}\n\n\t\t\t_inherits(DataStore, Base);\n\n\t\t\t_prototypeProperties(DataStore, null, {\n\t\t\t\tbatch: {\n\n\t\t\t\t\t/**\n      * Batch sets or deletes data in the store\n      *\n      * @method batch\n      * @memberOf keigai.DataStore\n      * @param  {String}  type Type of action to perform ( set/del/delete )\n      * @param  {Array}   data Array of keys or indices to delete, or Object containing multiple records to set\n      * @param  {Boolean} sync [Optional] Syncs store with data, if true everything is erased\n      * @return {Object} {@link keigai.Deferred}\n      * @fires keigai.DataStore#beforeBatch Fires before the batch is queued\n      * @fires keigai.DataStore#afterBatch Fires after the batch is queued\n      * @fires keigai.DataStore#failedBatch Fires when an exception occurs\n      * @example\n      * store.batch( \"set\", [...] ).then( ( records ) => {\n      *   ...\n      * }, ( err ) => {\n      *   ...\n      * } );\n      */\n\t\t\t\t\tvalue: function batch(type, data) {\n\t\t\t\t\t\tvar sync = arguments[2] === undefined ? false : arguments[2];\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\tvar events = this.events;\n\t\t\t\t\t\tvar defer = deferred.factory();\n\t\t\t\t\t\tvar deferreds = [];\n\n\t\t\t\t\t\tif (!regex.set_del.test(type) || sync && regex.del.test(type) || typeof data != \"object\") {\n\t\t\t\t\t\t\tdefer.reject(new Error(label.invalidArguments));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (events) {\n\t\t\t\t\t\t\t\tthis.dispatch(\"beforeBatch\", data);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (sync) {\n\t\t\t\t\t\t\t\tthis.clear(sync);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (data.length === 0) {\n\t\t\t\t\t\t\t\tthis.loaded = true;\n\n\t\t\t\t\t\t\t\tif (events) {\n\t\t\t\t\t\t\t\t\tthis.dispatch(\"afterBatch\", this.records);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tdefer.resolve(this.records);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Batch deletion will create a sparse array, which will be compacted before re-indexing\n\t\t\t\t\t\t\t\tif (type === \"del\") {\n\t\t\t\t\t\t\t\t\tarray.each(data, function (i) {\n\t\t\t\t\t\t\t\t\t\tdeferreds.push(self.del(i, false, true));\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tarray.each(data, function (i) {\n\t\t\t\t\t\t\t\t\t\tdeferreds.push(self.set(null, i, true));\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis.loaded = false;\n\n\t\t\t\t\t\t\t\tutility.when(deferreds).then(function (args) {\n\t\t\t\t\t\t\t\t\tself.loaded = true;\n\n\t\t\t\t\t\t\t\t\tif (events) {\n\t\t\t\t\t\t\t\t\t\tself.dispatch(\"afterBatch\", args);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// Forcing a clear of views to deal with async nature of workers & staggered loading\n\t\t\t\t\t\t\t\t\tarray.each(self.lists, function (i) {\n\t\t\t\t\t\t\t\t\t\ti.refresh(true);\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tif (type === \"del\") {\n\t\t\t\t\t\t\t\t\t\tself.records = array.compact(self.records);\n\t\t\t\t\t\t\t\t\t\tself.reindex();\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (self.autosave) {\n\t\t\t\t\t\t\t\t\t\tself.save();\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tdefer.resolve(args);\n\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\tif (events) {\n\t\t\t\t\t\t\t\t\t\tself.dispatch(\"failedBatch\", e);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn defer;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tbuildUri: {\n\n\t\t\t\t\t/**\n      * Builds a URI\n      *\n      * @method buildUri\n      * @memberOf keigai.DataStore\n      * @param  {String} key Record key\n      * @return {String}     URI\n      * @example\n      * let uri = store.buildUri( \"key\" );\n      */\n\t\t\t\t\tvalue: function buildUri(key) {\n\t\t\t\t\t\tvar parsed = utility.parse(this.uri);\n\n\t\t\t\t\t\treturn parsed.protocol + \"//\" + parsed.host + parsed.pathname + (regex.endslash.test(parsed.pathname) ? \"\" : \"/\") + key;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tclear: {\n\n\t\t\t\t\t/**\n      * Clears the data object, unsets the uri property\n      *\n      * @method clear\n      * @memberOf keigai.DataStore\n      * @param  {Boolean} sync [Optional] Boolean to limit clearing of properties\n      * @return {Object} {@link keigai.DataStore}\n      * @fires keigai.DataStore#beforeClear Fires before the data is cleared\n      * @fires keigai.DataStore#afterClear Fires after the data is cleared\n      * @example\n      * // Resyncing the records, if wired to an API\n      * store.clear( true );\n      *\n      * // Resetting the store\n      * store.clear();\n      */\n\t\t\t\t\tvalue: function clear() {\n\t\t\t\t\t\tvar sync = arguments[0] === undefined ? true : arguments[0];\n\t\t\t\t\t\tvar events = this.events === true;\n\t\t\t\t\t\tvar resave = this.autosave === true;\n\n\t\t\t\t\t\tif (!sync) {\n\t\t\t\t\t\t\tif (events) {\n\t\t\t\t\t\t\t\tthis.dispatch(\"beforeClear\");\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tarray.each(this.lists, function (i) {\n\t\t\t\t\t\t\t\tif (i) {\n\t\t\t\t\t\t\t\t\ti.teardown(true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tthis.autosave = false;\n\t\t\t\t\t\t\tthis.callback = null;\n\t\t\t\t\t\t\tthis.credentials = null;\n\t\t\t\t\t\t\tthis.lists = [];\n\t\t\t\t\t\t\tthis.events = true;\n\t\t\t\t\t\t\tthis.expires = null;\n\t\t\t\t\t\t\tthis.headers = { Accept: \"application/json\" };\n\t\t\t\t\t\t\tthis.ignore = [];\n\t\t\t\t\t\t\tthis.index = [];\n\t\t\t\t\t\t\tthis.indexes = { key: {} };\n\t\t\t\t\t\t\tthis.key = null;\n\t\t\t\t\t\t\tthis.loaded = false;\n\t\t\t\t\t\t\tthis.records = [];\n\t\t\t\t\t\t\tthis.source = null;\n\t\t\t\t\t\t\tthis.total = 0;\n\t\t\t\t\t\t\tthis.versions = {};\n\t\t\t\t\t\t\tthis.versioning = true;\n\t\t\t\t\t\t\tthis.views = {};\n\t\t\t\t\t\t\tthis.uri = null;\n\n\t\t\t\t\t\t\tif (events) {\n\t\t\t\t\t\t\t\tthis.dispatch(\"afterClear\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.indexes = { key: {} };\n\t\t\t\t\t\t\tthis.loaded = false;\n\t\t\t\t\t\t\tthis.records = [];\n\t\t\t\t\t\t\tthis.total = 0;\n\t\t\t\t\t\t\tthis.views = {};\n\n\t\t\t\t\t\t\tarray.each(this.lists, function (i) {\n\t\t\t\t\t\t\t\tif (i) {\n\t\t\t\t\t\t\t\t\ti.refresh();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (resave) {\n\t\t\t\t\t\t\tthis.save();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tdel: {\n\n\t\t\t\t\t/**\n      * Deletes a record based on key or index\n      *\n      * @method del\n      * @memberOf keigai.DataStore\n      * @param  {Mixed}   record  Record, key or index\n      * @param  {Boolean} reindex [Optional] `true` if DataStore should be reindexed\n      * @param  {Boolean} batch   [Optional] `true` if part of a batch operation\n      * @return {Object} {@link keigai.Deferred}\n      * @fires keigai.DataStore#beforeDelete Fires before the record is deleted\n      * @fires keigai.DataStore#afterDelete Fires after the record is deleted\n      * @fires keigai.DataStore#failedDelete Fires if the store is RESTful and the action is denied\n      * @example\n      * store.del( \"key\" ).then( () => {\n      *   console.log( \"Successfully deleted \" + key );\n      * }, ( err ) => {\n      *   console.warn( \"Failed to delete \" + key + \": \" + err.message );\n      * } );\n      */\n\t\t\t\t\tvalue: function del(record) {\n\t\t\t\t\t\tvar reindex = arguments[1] === undefined ? true : arguments[1];\n\t\t\t\t\t\tvar batch = arguments[2] === undefined ? false : arguments[2];\n\t\t\t\t\t\trecord = record.key ? record : this.get(record);\n\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\tvar defer = deferred.factory();\n\n\t\t\t\t\t\tif (record === undefined) {\n\t\t\t\t\t\t\tdefer.reject(new Error(label.invalidArguments));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (this.events) {\n\t\t\t\t\t\t\t\tself.dispatch(\"beforeDelete\", record);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (this.uri === null || this.callback !== null) {\n\t\t\t\t\t\t\t\tthis.delComplete(record, reindex, batch, defer);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tclient.request(this.buildUri(record.key), \"DELETE\", null, utility.merge({ withCredentials: this.credentials }, this.headers)).then(function () {\n\t\t\t\t\t\t\t\t\tself.delComplete(record, reindex, batch, defer);\n\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\tself.dispatch(\"failedDelete\", e);\n\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn defer;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tdelComplete: {\n\n\t\t\t\t\t/**\n      * Delete completion\n      *\n      * @method delComplete\n      * @memberOf keigai.DataStore\n      * @param  {Object}  record  DataStore record\n      * @param  {Boolean} reindex `true` if DataStore should be reindexed\n      * @param  {Boolean} batch   `true` if part of a batch operation\n      * @param  {Object}  defer   Deferred instance\n      * @return {Object} {@link keigai.DataStore}\n      * @private\n      */\n\t\t\t\t\tvalue: function delComplete(record, reindex, batch, defer) {\n\t\t\t\t\t\tvar self = this;\n\n\t\t\t\t\t\tdelete this.indexes.key[record.key];\n\t\t\t\t\t\tdelete this.versions[record.key];\n\n\t\t\t\t\t\tthis.total--;\n\t\t\t\t\t\tthis.views = {};\n\n\t\t\t\t\t\tif (!batch) {\n\t\t\t\t\t\t\tarray.remove(this.records, record.index);\n\n\t\t\t\t\t\t\tif (reindex) {\n\t\t\t\t\t\t\t\tthis.reindex();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tarray.each(record.indexes, function (i) {\n\t\t\t\t\t\t\t\t\tarray.remove(self.indexes[i[0]][i[1]], record.index);\n\n\t\t\t\t\t\t\t\t\tif (self.indexes[i[0]][i[1]].length === 0) {\n\t\t\t\t\t\t\t\t\t\tdelete self.indexes[i[0]][i[1]];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (this.autosave) {\n\t\t\t\t\t\t\t\tthis.purge(record.key);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (this.events) {\n\t\t\t\t\t\t\t\tthis.dispatch(\"afterDelete\", record);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tarray.each(this.lists, function (i) {\n\t\t\t\t\t\t\t\ti.refresh();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.records[record.index] = null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn defer.resolve(record.key);\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tdump: {\n\n\t\t\t\t\t/**\n      * Exports a subset or complete record set of DataStore\n      *\n      * @method dump\n      * @memberOf keigai.DataStore\n      * @param  {Array} args   [Optional] Sub-data set of DataStore\n      * @param  {Array} fields [Optional] Fields to export, defaults to all\n      * @return {Array}        Records\n      * @example\n      * let data = store.dump();\n      */\n\t\t\t\t\tvalue: function dump(args, fields) {\n\t\t\t\t\t\targs = args || this.records;\n\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\tvar custom = fields instanceof Array && fields.length > 0;\n\t\t\t\t\t\tvar key = this.key !== null;\n\t\t\t\t\t\tvar fn = undefined;\n\n\t\t\t\t\t\tif (custom) {\n\t\t\t\t\t\t\tfn = function (i) {\n\t\t\t\t\t\t\t\tvar record = {};\n\n\t\t\t\t\t\t\t\tarray.each(fields, function (f) {\n\t\t\t\t\t\t\t\t\trecord[f] = f === self.key ? isNaN(i.key) ? i.key : Number(i.key) : utility.clone(i.data[f], true);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\treturn record;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfn = function (i) {\n\t\t\t\t\t\t\t\tvar record = {};\n\n\t\t\t\t\t\t\t\tif (key) {\n\t\t\t\t\t\t\t\t\trecord[self.key] = isNaN(i.key) ? i.key : Number(i.key);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tutility.iterate(i.data, function (v, k) {\n\t\t\t\t\t\t\t\t\trecord[k] = utility.clone(v, true);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\treturn record;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn args.map(fn);\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tget: {\n\n\t\t\t\t\t/**\n      * Retrieves the current version of a record(s) based on key or index\n      *\n      * If the key is an integer, cast to a string before sending as an argument!\n      *\n      * @method get\n      * @memberOf keigai.DataStore\n      * @param  {Mixed}  record Key, index or Array of pagination start & end; or comma delimited String of keys or indices\n      * @param  {Number} offset [Optional] Offset from `record` for pagination\n      * @return {Mixed}         Individual record, or Array of records\n      * @example\n      * let record = store.get( \"key\" );\n      */\n\t\t\t\t\tvalue: function get(record, offset) {\n\t\t\t\t\t\tvar type = typeof record;\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\tvar result = undefined;\n\n\t\t\t\t\t\tif (type === \"undefined\") {\n\t\t\t\t\t\t\tresult = this.records;\n\t\t\t\t\t\t} else if (type === \"string\") {\n\t\t\t\t\t\t\tif (record.indexOf(\",\") === -1) {\n\t\t\t\t\t\t\t\tresult = this.records[this.indexes.key[record]];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresult = string.explode(record).map(function (i) {\n\t\t\t\t\t\t\t\t\tif (!isNaN(i)) {\n\t\t\t\t\t\t\t\t\t\treturn self.records[parseInt(i, 10)];\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\treturn self.records[self.indexes.key[i]];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (type === \"number\") {\n\t\t\t\t\t\t\tif (isNaN(offset)) {\n\t\t\t\t\t\t\t\tresult = this.records[parseInt(record, 10)];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tresult = array.limit(this.records, parseInt(record, 10), parseInt(offset, 10));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn utility.clone(result, true);\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tjoin: {\n\n\t\t\t\t\t/**\n      * Performs an (INNER/LEFT/RIGHT) JOIN on two DataStores\n      *\n      * @method join\n      * @memberOf keigai.DataStore\n      * @param  {String} arg   DataStore to join\n      * @param  {String} field Field in both DataStores\n      * @param  {String} join  Type of JOIN to perform, defaults to `inner`\n      * @return {Object} {@link keigai.Deferred}\n      * let data = store.join( otherStore, \"commonField\" );\n      */\n\t\t\t\t\tvalue: function join(arg, field) {\n\t\t\t\t\t\tvar join = arguments[2] === undefined ? \"inner\" : arguments[2];\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\tvar defer = deferred.factory();\n\t\t\t\t\t\tvar results = [];\n\t\t\t\t\t\tvar deferreds = [];\n\t\t\t\t\t\tvar key = field === this.key;\n\t\t\t\t\t\tvar keys = array.merge(array.keys(this.records[0].data), array.keys(arg.records[0].data));\n\t\t\t\t\t\tvar fn = undefined;\n\n\t\t\t\t\t\tif (join === \"inner\") {\n\t\t\t\t\t\t\tfn = function (i) {\n\t\t\t\t\t\t\t\tvar where = {},\n\t\t\t\t\t\t\t\t    record = i.data,\n\t\t\t\t\t\t\t\t    defer = deferred.factory();\n\n\t\t\t\t\t\t\t\twhere[field] = key ? i.key : record[field];\n\n\t\t\t\t\t\t\t\targ.select(where).then(function (match) {\n\t\t\t\t\t\t\t\t\tif (match.length > 2) {\n\t\t\t\t\t\t\t\t\t\tdefer.reject(new Error(label.databaseMoreThanOne));\n\t\t\t\t\t\t\t\t\t} else if (match.length === 1) {\n\t\t\t\t\t\t\t\t\t\tresults.push(utility.merge(record, match[0].data));\n\t\t\t\t\t\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tdefer.resolve(false);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tdeferreds.push(defer);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} else if (join === \"left\") {\n\t\t\t\t\t\t\tfn = function (i) {\n\t\t\t\t\t\t\t\tvar where = {},\n\t\t\t\t\t\t\t\t    record = i.data,\n\t\t\t\t\t\t\t\t    defer = deferred.factory();\n\n\t\t\t\t\t\t\t\twhere[field] = key ? i.key : record[field];\n\n\t\t\t\t\t\t\t\targ.select(where).then(function (match) {\n\t\t\t\t\t\t\t\t\tif (match.length > 2) {\n\t\t\t\t\t\t\t\t\t\tdefer.reject(new Error(label.databaseMoreThanOne));\n\t\t\t\t\t\t\t\t\t} else if (match.length === 1) {\n\t\t\t\t\t\t\t\t\t\tresults.push(utility.merge(record, match[0].data));\n\t\t\t\t\t\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tarray.each(keys, function (i) {\n\t\t\t\t\t\t\t\t\t\t\tif (record[i] === undefined) {\n\t\t\t\t\t\t\t\t\t\t\t\trecord[i] = null;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\tresults.push(record);\n\t\t\t\t\t\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tdeferreds.push(defer);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} else if (join === \"right\") {\n\t\t\t\t\t\t\tfn = function (i) {\n\t\t\t\t\t\t\t\tvar where = {},\n\t\t\t\t\t\t\t\t    record = i.data,\n\t\t\t\t\t\t\t\t    defer = deferred.factory();\n\n\t\t\t\t\t\t\t\twhere[field] = key ? i.key : record[field];\n\n\t\t\t\t\t\t\t\tself.select(where).then(function (match) {\n\t\t\t\t\t\t\t\t\tif (match.length > 2) {\n\t\t\t\t\t\t\t\t\t\tdefer.reject(new Error(label.databaseMoreThanOne));\n\t\t\t\t\t\t\t\t\t} else if (match.length === 1) {\n\t\t\t\t\t\t\t\t\t\tresults.push(utility.merge(record, match[0].data));\n\t\t\t\t\t\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tarray.each(keys, function (i) {\n\t\t\t\t\t\t\t\t\t\t\tif (record[i] === undefined) {\n\t\t\t\t\t\t\t\t\t\t\t\trecord[i] = null;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\tresults.push(record);\n\t\t\t\t\t\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tdeferreds.push(defer);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tarray.each(utility.clone(join === \"right\" ? arg.records : this.records, true), fn);\n\n\t\t\t\t\t\tutility.when(deferreds).then(function () {\n\t\t\t\t\t\t\tdefer.resolve(results);\n\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn defer;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tonly: {\n\n\t\t\t\t\t/**\n      * Retrieves only 1 field/property\n      *\n      * @method only\n      * @memberOf keigai.DataStore\n      * @param  {String} arg Field/property to retrieve\n      * @return {Array}      Array of values\n      * @example\n      * let ages = store.only( \"age\" );\n      */\n\t\t\t\t\tvalue: function only(arg) {\n\t\t\t\t\t\tif (arg === this.key) {\n\t\t\t\t\t\t\treturn this.records.map(function (i) {\n\t\t\t\t\t\t\t\treturn i.key;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn this.records.map(function (i) {\n\t\t\t\t\t\t\t\treturn i.data[arg];\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tpurge: {\n\n\t\t\t\t\t/**\n      * Purges DataStore or record from persistant storage\n      *\n      * @method purge\n      * @memberOf keigai.DataStore\n      * @param  {Mixed} arg  [Optional] String or Number for record\n      * @return {Object}     Record or store\n      * @example\n      * store.purge();\n      */\n\t\t\t\t\tvalue: function purge(arg) {\n\t\t\t\t\t\treturn this.storage(arg || this, \"remove\");\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\treindex: {\n\n\t\t\t\t\t/**\n      * Reindexes the DataStore\n      *\n      * @method reindex\n      * @memberOf keigai.DataStore\n      * @return {Object} {@link keigai.DataStore}\n      * @example\n      * store.reindex();\n      */\n\t\t\t\t\tvalue: function reindex() {\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\tvar i = -1;\n\t\t\t\t\t\tvar tmp = [];\n\n\t\t\t\t\t\tthis.views = {};\n\t\t\t\t\t\tthis.indexes = { key: {} };\n\n\t\t\t\t\t\tif (this.total > 0) {\n\t\t\t\t\t\t\tarray.each(this.records, function (record) {\n\t\t\t\t\t\t\t\tif (record !== undefined) {\n\t\t\t\t\t\t\t\t\ttmp[++i] = record;\n\t\t\t\t\t\t\t\t\trecord.index = i;\n\t\t\t\t\t\t\t\t\tself.indexes.key[record.key] = i;\n\t\t\t\t\t\t\t\t\tself.setIndexes(record);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.records = tmp;\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\trestore: {\n\n\t\t\t\t\t/**\n      * Restores DataStore or record persistant storage\n      *\n      * @method restore\n      * @memberOf keigai.DataStore\n      * @param  {Mixed} arg  [Optional] String or Number for record\n      * @return {Object}     Record or store\n      * @example\n      * store.restore();\n      */\n\t\t\t\t\tvalue: function restore(arg) {\n\t\t\t\t\t\treturn this.storage(arg || this, \"get\");\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tsave: {\n\n\t\t\t\t\t/**\n      * Saves DataStore or record to persistant storage, or sessionStorage\n      *\n      * @method save\n      * @memberOf keigai.DataStore\n      * @param  {Mixed} arg  [Optional] String or Number for record\n      * @return {Object} {@link keigai.Deferred}\n      * @example\n      * store.save();\n      */\n\t\t\t\t\tvalue: function save(arg) {\n\t\t\t\t\t\treturn this.storage(arg || this, \"set\");\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tselect: {\n\n\t\t\t\t\t/**\n      * Selects records (not by reference) based on an explicit description\n      *\n      * @method select\n      * @memberOf keigai.DataStore\n      * @param  {Object} where Object describing the WHERE clause\n      * @return {Object} {@link keigai.Deferred}\n      * @example\n      * let adults;\n      *\n      * store.select( {age: ( i ) { return i >= 21; } } ).then( function ( records ) => {\n      *   adults = records;\n      * }, ( err ) => {\n      *   ...\n      * } );\n      */\n\t\t\t\t\tvalue: function select(where) {\n\t\t\t\t\t\tvar _this = this;\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\tvar defer = deferred.factory();\n\t\t\t\t\t\tvar functions = [];\n\t\t\t\t\t\tvar clauses = undefined,\n\t\t\t\t\t\t    cond = undefined,\n\t\t\t\t\t\t    index = undefined,\n\t\t\t\t\t\t    result = undefined,\n\t\t\t\t\t\t    sorted = undefined,\n\t\t\t\t\t\t    values = undefined,\n\t\t\t\t\t\t    worker = undefined;\n\n\t\t\t\t\t\tif (!(where instanceof Object)) {\n\t\t\t\t\t\t\tdefer.reject(new Error(label.invalidArguments));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tutility.iterate(where, function (v, k) {\n\t\t\t\t\t\t\t\tif (typeof v === \"function\") {\n\t\t\t\t\t\t\t\t\t_this[k] = v.toString();\n\t\t\t\t\t\t\t\t\tfunctions.push(k);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (webWorker) {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tworker = utility.worker(defer);\n\t\t\t\t\t\t\t\t\tworker.postMessage({\n\t\t\t\t\t\t\t\t\t\tcmd: \"select\",\n\t\t\t\t\t\t\t\t\t\tindexes: this.indexes,\n\t\t\t\t\t\t\t\t\t\trecords: this.records,\n\t\t\t\t\t\t\t\t\t\twhere: json.encode(where),\n\t\t\t\t\t\t\t\t\t\tfunctions: functions\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t\t// Probably IE10, which doesn't have the correct security flag for local loading\n\t\t\t\t\t\t\t\t\twebWorker = false;\n\n\t\t\t\t\t\t\t\t\tthis.select(where).then(function (arg) {\n\t\t\t\t\t\t\t\t\t\tdefer.resolve(arg);\n\t\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tclauses = array.fromObject(where);\n\t\t\t\t\t\t\t\tsorted = array.flat(clauses).filter(function (i, idx) {\n\t\t\t\t\t\t\t\t\treturn idx % 2 === 0;\n\t\t\t\t\t\t\t\t}).sort(array.sort);\n\t\t\t\t\t\t\t\tindex = sorted.join(\"|\");\n\t\t\t\t\t\t\t\tvalues = sorted.map(function (i) {\n\t\t\t\t\t\t\t\t\treturn where[i];\n\t\t\t\t\t\t\t\t}).join(\"|\");\n\t\t\t\t\t\t\t\tcond = \"return ( \";\n\n\t\t\t\t\t\t\t\tif (functions.length === 0 && this.indexes[index]) {\n\t\t\t\t\t\t\t\t\tresult = (this.indexes[index][values] || []).map(function (i) {\n\t\t\t\t\t\t\t\t\t\treturn self.records[i];\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (clauses.length > 1) {\n\t\t\t\t\t\t\t\t\t\tarray.each(clauses, function (i, idx) {\n\t\t\t\t\t\t\t\t\t\t\tvar b1 = \"( \";\n\n\t\t\t\t\t\t\t\t\t\t\tif (idx > 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tb1 = \" && ( \";\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tif (i[1] instanceof Function) {\n\t\t\t\t\t\t\t\t\t\t\t\tcond += b1 + i[1].toString() + \"( rec.data[\\\"\" + i[0] + \"\\\"] ) )\";\n\t\t\t\t\t\t\t\t\t\t\t} else if (!isNaN(i[1])) {\n\t\t\t\t\t\t\t\t\t\t\t\tcond += b1 + \"rec.data[\\\"\" + i[0] + \"\\\"] === \" + i[1] + \" )\";\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tcond += b1 + \"rec.data[\\\"\" + i[0] + \"\\\"] === \\\"\" + i[1] + \"\\\" )\";\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tif (clauses[0][1] instanceof Function) {\n\t\t\t\t\t\t\t\t\t\t\tcond += clauses[0][1].toString() + \"( rec.data[\\\"\" + clauses[0][0] + \"\\\"] )\";\n\t\t\t\t\t\t\t\t\t\t} else if (!isNaN(clauses[0][1])) {\n\t\t\t\t\t\t\t\t\t\t\tcond += \"rec.data[\\\"\" + clauses[0][0] + \"\\\"] === \" + clauses[0][1];\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tcond += \"rec.data[\\\"\" + clauses[0][0] + \"\\\"] === \\\"\" + clauses[0][1] + \"\\\"\";\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tcond += \" );\";\n\n\t\t\t\t\t\t\t\t\tresult = utility.clone(this.records, true).filter(new Function(\"rec\", cond));\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tdefer.resolve(result);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn defer;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tset: {\n\n\t\t\t\t\t/**\n      * Creates or updates an existing record\n      *\n      * @method set\n      * @memberOf keigai.DataStore\n      * @param  {Mixed}   key       [Optional] Integer or String to use as a Primary Key\n      * @param  {Object}  data      Key:Value pairs to set as field values\n      * @param  {Boolean} batch     [Optional] True if called by data.batch\n      * @param  {Boolean} overwrite [Optional] Overwrites the existing record, if found\n      * @return {Object} {@link keigai.Deferred}\n      * @fires keigai.DataStore#beforeSet Fires before the record is set\n      * @fires keigai.DataStore#afterSet Fires after the record is set, the record is the argument for listeners\n      * @fires keigai.DataStore#failedSet Fires if the store is RESTful and the action is denied\n      * @example\n      * // Creating a new record\n      * store.set( null, {...} );\n      *\n      * // Updating a record\n      * store.set( \"key\", {...} );\n      */\n\t\t\t\t\tvalue: function set(key, data) {\n\t\t\t\t\t\tvar batch = arguments[2] === undefined ? false : arguments[2];\n\t\t\t\t\t\tvar overwrite = arguments[3] === undefined ? false : arguments[3];\n\t\t\t\t\t\tdata = utility.clone(data, true);\n\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\tvar events = this.events;\n\t\t\t\t\t\tvar defer = deferred.factory();\n\t\t\t\t\t\tvar record = key !== null ? this.get(key) || null : data[this.key] ? this.get(data[this.key]) || null : null;\n\t\t\t\t\t\tvar method = \"POST\";\n\t\t\t\t\t\tvar parsed = utility.parse(self.uri || \"\");\n\t\t\t\t\t\tvar uri = undefined,\n\t\t\t\t\t\t    odata = undefined,\n\t\t\t\t\t\t    rdefer = undefined;\n\n\t\t\t\t\t\tvar patch = function (overwrite, data, ogdata) {\n\t\t\t\t\t\t\tvar ndata = [];\n\n\t\t\t\t\t\t\tif (overwrite) {\n\t\t\t\t\t\t\t\tarray.each(array.keys(ogdata), function (k) {\n\t\t\t\t\t\t\t\t\tif (k !== self.key && data[k] === undefined) {\n\t\t\t\t\t\t\t\t\t\tndata.push({ op: \"remove\", path: \"/\" + k });\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tutility.iterate(data, function (v, k) {\n\t\t\t\t\t\t\t\tif (k !== self.key && ogdata[k] === undefined) {\n\t\t\t\t\t\t\t\t\tndata.push({ op: \"add\", path: \"/\" + k, value: v });\n\t\t\t\t\t\t\t\t} else if (json.encode(ogdata[k]) !== json.encode(v)) {\n\t\t\t\t\t\t\t\t\tndata.push({ op: \"replace\", path: \"/\" + k, value: v });\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\treturn ndata;\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (typeof data === \"string\") {\n\t\t\t\t\t\t\tif (data.indexOf(\"//\") === -1) {\n\t\t\t\t\t\t\t\t// Relative path to store, i.e. a child\n\t\t\t\t\t\t\t\tif (data.charAt(0) !== \"/\") {\n\t\t\t\t\t\t\t\t\turi = this.buildUri(data);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// Root path, relative to store, i.e. a domain\n\t\t\t\t\t\t\t\telse if (self.uri !== null && regex.root.test(data)) {\n\t\t\t\t\t\t\t\t\turi = parsed.protocol + \"//\" + parsed.host + data;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\turi = data;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\turi = data;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tkey = uri.replace(regex.not_endpoint, \"\");\n\n\t\t\t\t\t\t\tif (string.isEmpty(key)) {\n\t\t\t\t\t\t\t\tdefer.reject(new Error(label.invalidArguments));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (!batch && events) {\n\t\t\t\t\t\t\t\t\tself.dispatch(\"beforeSet\", { key: key, data: data });\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tclient.request(uri, \"GET\", null, utility.merge({ withCredentials: self.credentials }, self.headers)).then(function (arg) {\n\t\t\t\t\t\t\t\t\tself.setComplete(record, key, self.source ? utility.walk(arg, self.source) : arg, batch, overwrite, defer);\n\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\tself.dispatch(\"failedSet\", e);\n\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (!batch && events) {\n\t\t\t\t\t\t\t\tself.dispatch(\"beforeSet\", { key: key, data: data });\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (batch || this.uri === null) {\n\t\t\t\t\t\t\t\tthis.setComplete(record, key, data, batch, overwrite, defer);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (key !== null) {\n\t\t\t\t\t\t\t\t\turi = this.buildUri(key);\n\t\t\t\t\t\t\t\t\tmethod = \"PATCH\";\n\t\t\t\t\t\t\t\t\todata = utility.clone(data, true);\n\t\t\t\t\t\t\t\t\tdata = patch(overwrite, data, this.dump([record])[0]);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t// Dropping query string\n\t\t\t\t\t\t\t\t\turi = parsed.protocol + \"//\" + parsed.host + parsed.pathname;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\trdefer = client.request(uri, method, data, utility.merge({ withCredentials: this.credentials }, this.headers));\n\t\t\t\t\t\t\t\trdefer.then(function (arg) {\n\t\t\t\t\t\t\t\t\tvar change = undefined;\n\n\t\t\t\t\t\t\t\t\tif (rdefer.xhr.status !== 204 && rdefer.xhr.status < 300) {\n\t\t\t\t\t\t\t\t\t\tchange = key === null ? self.source ? utility.walk(arg, self.source) : arg : odata;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tchange = odata;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tself.setComplete(record, key, change, batch, overwrite, defer);\n\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\tif (method === \"PATCH\") {\n\t\t\t\t\t\t\t\t\t\tmethod = \"PUT\";\n\t\t\t\t\t\t\t\t\t\tdata = utility.clone(odata, true);\n\n\t\t\t\t\t\t\t\t\t\tutility.iterate(record.data, function (v, k) {\n\t\t\t\t\t\t\t\t\t\t\tdata[k] = v;\n\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\tclient.request(uri, method, data, utility.merge({ withCredentials: self.credentials }, self.headers)).then(function () {\n\t\t\t\t\t\t\t\t\t\t\tself.setComplete(record, key, odata, batch, overwrite, defer);\n\t\t\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\t\t\tself.dispatch(\"failedSet\", e);\n\t\t\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tself.dispatch(\"failedSet\", e);\n\t\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn defer;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tsetComplete: {\n\n\t\t\t\t\t/**\n      * Set completion\n      *\n      * @method setComplete\n      * @memberOf keigai.DataStore\n      * @param  {Mixed}   record    DataStore record, or `null` if new\n      * @param  {String}  key       Record key\n      * @param  {Object}  data      Record data\n      * @param  {Boolean} batch     `true` if part of a batch operation\n      * @param  {Boolean} overwrite Overwrites the existing record, if found\n      * @param  {Object}  defer     Deferred instance\n      * @return {Object} {@link keigai.DataStore}\n      * @private\n      */\n\t\t\t\t\tvalue: function setComplete(record, key, data, batch, overwrite, defer) {\n\t\t\t\t\t\t// Clearing views\n\t\t\t\t\t\tthis.views = {};\n\n\t\t\t\t\t\t// Setting key\n\t\t\t\t\t\tif (key === null) {\n\t\t\t\t\t\t\tif (this.key !== null && data[this.key] !== undefined && data[this.key] !== null) {\n\t\t\t\t\t\t\t\tkey = data[this.key].toString();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tkey = utility.uuid();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Removing primary key from data\n\t\t\t\t\t\tif (this.key) {\n\t\t\t\t\t\t\tdelete data[this.key];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Create\n\t\t\t\t\t\tif (record === null) {\n\t\t\t\t\t\t\trecord = {\n\t\t\t\t\t\t\t\tindex: this.total++,\n\t\t\t\t\t\t\t\tkey: key,\n\t\t\t\t\t\t\t\tdata: data,\n\t\t\t\t\t\t\t\tindexes: []\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tthis.indexes.key[key] = record.index;\n\t\t\t\t\t\t\tthis.records[record.index] = record;\n\n\t\t\t\t\t\t\tif (this.versioning) {\n\t\t\t\t\t\t\t\tthis.versions[record.key] = lru.factory(VERSIONS);\n\t\t\t\t\t\t\t\tthis.versions[record.key].nth = 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Update\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tif (this.versioning) {\n\t\t\t\t\t\t\t\tif (this.versions[record.key] === undefined) {\n\t\t\t\t\t\t\t\t\tthis.versions[record.key] = lru.factory(VERSIONS);\n\t\t\t\t\t\t\t\t\tthis.versions[record.key].nth = 0;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis.versions[record.key].set(\"v\" + ++this.versions[record.key].nth, this.dump([record])[0]);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// By reference\n\t\t\t\t\t\t\trecord = this.records[record.index];\n\n\t\t\t\t\t\t\tif (overwrite) {\n\t\t\t\t\t\t\t\trecord.data = {};\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tutility.iterate(data, function (v, k) {\n\t\t\t\t\t\t\t\trecord.data[k] = v;\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// Snapshot that's safe to hand out\n\t\t\t\t\t\t\trecord = utility.clone(record, true);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.setIndexes(record);\n\n\t\t\t\t\t\tif (!batch) {\n\t\t\t\t\t\t\tif (this.autosave) {\n\t\t\t\t\t\t\t\tthis.save();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (this.events) {\n\t\t\t\t\t\t\t\tthis.dispatch(\"afterSet\", record);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tarray.each(this.lists, function (i) {\n\t\t\t\t\t\t\t\ti.refresh();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdefer.resolve(record);\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tsetExpires: {\n\n\t\t\t\t\t/**\n      * Gets or sets an explicit expiration of data\n      *\n      * @method setExpires\n      * @memberOf keigai.DataStore\n      * @param  {Number} arg Milliseconds until data is stale\n      * @return {Object} {@link keigai.DataStore}\n      * @example\n      * store.setExpires( 5 * 60 * 1000 ); // Resyncs every 5 minutes\n      */\n\t\t\t\t\tvalue: function setExpires(arg) {\n\t\t\t\t\t\tvar id = this.id + \"Expire\";\n\t\t\t\t\t\tvar expires = arg;\n\t\t\t\t\t\tvar self = this;\n\n\t\t\t\t\t\t// Expiry cannot be less than a second, and must be a valid scenario for consumption; null will disable repetitive expiration\n\t\t\t\t\t\tif (arg !== null && this.uri === null || arg !== null && (isNaN(arg) || arg < 1000)) {\n\t\t\t\t\t\t\tthrow new Error(label.invalidArguments);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.expires === arg) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.expires = arg;\n\n\t\t\t\t\t\tutility.clearTimers(id);\n\n\t\t\t\t\t\tif (arg === null) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tutility.repeat(function () {\n\t\t\t\t\t\t\tif (self.uri === null) {\n\t\t\t\t\t\t\t\tself.setExpires(null);\n\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tself.dispatch(\"beforeExpire\");\n\t\t\t\t\t\t\tcache.expire(self.uri);\n\t\t\t\t\t\t\tself.dispatch(\"expire\");\n\t\t\t\t\t\t\tself.dispatch(\"afterExpire\");\n\t\t\t\t\t\t}, expires, id, false);\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tsetIndexes: {\n\n\t\t\t\t\t/**\n      * Sets indexes for a record using `store.indexes`\n      *\n      * Composite indexes are supported, but require keys be in alphabetical order, e.g. \"age|name\"\n      *\n      * @method setIndexes\n      * @memberOf keigai.DataStore\n      * @param  {Object} arg DataStore Record\n      * @return {Object} {@link keigai.DataStore}\n      * @example\n      * store.setIndexes( record );\n      */\n\t\t\t\t\tvalue: function setIndexes(arg) {\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\tvar delimter = \"|\";\n\n\t\t\t\t\t\targ.indexes = [];\n\n\t\t\t\t\t\tarray.each(this.index, function (i) {\n\t\t\t\t\t\t\tvar keys = i.split(delimter);\n\t\t\t\t\t\t\tvar values = \"\";\n\n\t\t\t\t\t\t\tif (self.indexes[i] === undefined) {\n\t\t\t\t\t\t\t\tself.indexes[i] = {};\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tarray.each(keys, function (k, kdx) {\n\t\t\t\t\t\t\t\tvalues += (kdx > 0 ? delimter : \"\") + arg.data[k];\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (self.indexes[i][values] === undefined) {\n\t\t\t\t\t\t\t\tself.indexes[i][values] = [];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!array.contains(self.indexes[i][values], arg.index)) {\n\t\t\t\t\t\t\t\tself.indexes[i][values].push(arg.index);\n\t\t\t\t\t\t\t\targ.indexes.push([i, values]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tsetUri: {\n\n\t\t\t\t\t/**\n      * Sets the RESTful API end point\n      *\n      * @method setUri\n      * @memberOf keigai.DataStore\n      * @param  {String} arg API collection end point\n      * @return {Object}     Deferred\n      * @example\n      * store.setUri( \"...\" ).then( ( records ) => {\n      *   ...\n      * }, ( err ) => {\n      *   ...\n      * } );\n      */\n\t\t\t\t\tvalue: function setUri(arg) {\n\t\t\t\t\t\tvar defer = deferred.factory();\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\tvar parsed = undefined;\n\n\t\t\t\t\t\tif (arg !== null && string.isEmpty(arg)) {\n\t\t\t\t\t\t\tdefer.reject(new Error(label.invalidArguments));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (arg === null) {\n\t\t\t\t\t\t\tthis.uri = arg;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tparsed = utility.parse(arg);\n\t\t\t\t\t\t\tthis.uri = parsed.protocol + \"//\" + parsed.host + parsed.path;\n\n\t\t\t\t\t\t\tif (!string.isEmpty(parsed.auth) && !this.headers.authorization && !this.headers.Authorization) {\n\t\t\t\t\t\t\t\tthis.headers.Authorization = \"Basic \" + btoa(decodeURIComponent(parsed.auth));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.on(\"expire\", function () {\n\t\t\t\t\t\t\t\tself.sync();\n\t\t\t\t\t\t\t}, \"resync\");\n\n\t\t\t\t\t\t\tcache.expire(this.uri);\n\n\t\t\t\t\t\t\tthis.sync().then(function (arg) {\n\t\t\t\t\t\t\t\tdefer.resolve(arg);\n\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn defer;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tsort: {\n\n\t\t\t\t\t/**\n      * Creates, or returns a cached view of the records (not by reference)\n      *\n      * @method sort\n      * @memberOf keigai.DataStore\n      * @param  {String} query  SQL ( style ) order by\n      * @param  {String} create [Optional, default behavior is true, value is false] Boolean determines whether to recreate a view if it exists\n      * @param  {Object} where  [Optional] Object describing the WHERE clause\n      * @return {Object} {@link keigai.Deferred}\n      * @example\n      * store.sort( \"age desc, name\" ).then( ( records ) => {\n      *   ...\n      * }, ( err ) => {\n      *   ...\n      * } );\n      */\n\t\t\t\t\tvalue: function sort(query, create, where) {\n\t\t\t\t\t\tcreate = create === true || where instanceof Object;\n\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\tvar view = string.toCamelCase(string.explode(query).join(\" \"));\n\t\t\t\t\t\tvar defer = deferred.factory();\n\n\t\t\t\t\t\t// Next phase\n\t\t\t\t\t\tvar next = function (records) {\n\t\t\t\t\t\t\tvar worker = undefined;\n\n\t\t\t\t\t\t\tif (self.total === 0) {\n\t\t\t\t\t\t\t\tdefer.resolve([]);\n\t\t\t\t\t\t\t} else if (!create && self.views[view]) {\n\t\t\t\t\t\t\t\tdefer.resolve(self.views[view]);\n\t\t\t\t\t\t\t} else if (webWorker) {\n\t\t\t\t\t\t\t\tdefer.then(function (arg) {\n\t\t\t\t\t\t\t\t\tself.views[view] = arg;\n\n\t\t\t\t\t\t\t\t\treturn self.views[view];\n\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\tutility.error(e);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tworker = utility.worker(defer);\n\t\t\t\t\t\t\t\t\tworker.postMessage({ cmd: \"sort\", indexes: self.indexes, records: records, query: query });\n\t\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t\t// Probably IE10, which doesn't have the correct security flag for local loading\n\t\t\t\t\t\t\t\t\twebWorker = false;\n\n\t\t\t\t\t\t\t\t\tself.views[view] = array.keySort(records, query, \"data\");\n\t\t\t\t\t\t\t\t\tdefer.resolve(self.views[view]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tself.views[view] = array.keySort(records, query, \"data\");\n\t\t\t\t\t\t\t\tdefer.resolve(self.views[view]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (!where) {\n\t\t\t\t\t\t\tnext(utility.clone(this.records, true));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.select(where).then(next, function (e) {\n\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn defer;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tstorage: {\n\n\t\t\t\t\t/**\n      * Storage interface\n      *\n      * SQL/NoSQL backends will be used if configured in lieu of localStorage (node.js only)\n      *\n      * @method storage\n      * @memberOf keigai.DataStore\n      * @param  {Mixed}  obj  Record ( Object, key or index ) or store\n      * @param  {Object} op   Operation to perform ( get, remove or set )\n      * @param  {String} type [Optional] Type of Storage to use ( local, session [local] )\n      * @return {Object} {@link keigai.Deferred}\n      * @example\n      * store.storage( store, \"set\" );\n      */\n\t\t\t\t\tvalue: function storage(obj, op, type) {\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\tvar record = false;\n\t\t\t\t\t\tvar mongo = !string.isEmpty(this.mongodb);\n\t\t\t\t\t\tvar session = type === \"session\" && typeof sessionStorage != \"undefined\";\n\t\t\t\t\t\tvar defer = deferred.factory();\n\t\t\t\t\t\tvar data = undefined,\n\t\t\t\t\t\t    key = undefined,\n\t\t\t\t\t\t    result = undefined;\n\n\t\t\t\t\t\tif (!regex.number_string_object.test(typeof obj) || !regex.get_remove_set.test(op)) {\n\t\t\t\t\t\t\tdefer.reject(new Error(label.invalidArguments));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trecord = regex.number_string.test(typeof obj) || obj.hasOwnProperty(\"data\");\n\n\t\t\t\t\t\t\tif (op !== \"remove\") {\n\t\t\t\t\t\t\t\tif (record && !(obj instanceof Object)) {\n\t\t\t\t\t\t\t\t\tobj = this.get(obj);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tkey = record ? obj.key : obj.id;\n\t\t\t\t\t\t\t} else if (op === \"remove\" && record) {\n\t\t\t\t\t\t\t\tkey = obj.key || obj;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (mongo) {\n\t\t\t\t\t\t\t\tmongodb.connect(this.mongodb, function (e, db) {\n\t\t\t\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\t\t\t\tif (db) {\n\t\t\t\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\treturn defer.reject(e);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tdb.collection(self.id, function (e, collection) {\n\t\t\t\t\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\t\t\t\treturn defer.reject(e);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (op === \"get\") {\n\t\t\t\t\t\t\t\t\t\t\tif (record) {\n\t\t\t\t\t\t\t\t\t\t\t\tcollection.find({ _id: obj.key }).limit(1).toArray(function (e, recs) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdb.close();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (recs.length === 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefer.resolve(null);\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdelete recs[0]._id;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tself.set(key, recs[0], true).then(function (rec) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefer.resolve(rec);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tcollection.find({}).toArray(function (e, recs) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar i = undefined,\n\t\t\t\t\t\t\t\t\t\t\t\t\t    nth = undefined;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn defer.reject(e);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\ti = -1;\n\t\t\t\t\t\t\t\t\t\t\t\t\tnth = recs.length;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (nth > 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tself.records = recs.map(function (r) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar rec = { key: r._id, index: ++i, data: {} };\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tself.indexes.key[rec.key] = rec.index;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trec.data = r;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdelete rec.data._id;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tself.setIndexes(rec);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn rec;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tself.total = nth;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\t\t\t\t\t\tdefer.resolve(self.records);\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else if (op === \"remove\") {\n\t\t\t\t\t\t\t\t\t\t\tcollection.remove(record ? { _id: key } : {}, { safe: true }, function (e, arg) {\n\t\t\t\t\t\t\t\t\t\t\t\tdb.close();\n\n\t\t\t\t\t\t\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdefer.resolve(arg);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t} else if (op === \"set\") {\n\t\t\t\t\t\t\t\t\t\t\tif (record) {\n\t\t\t\t\t\t\t\t\t\t\t\tcollection.update({ _id: obj.key }, obj.data, {\n\t\t\t\t\t\t\t\t\t\t\t\t\tw: 1,\n\t\t\t\t\t\t\t\t\t\t\t\t\tsafe: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\tupsert: true\n\t\t\t\t\t\t\t\t\t\t\t\t}, function (e, arg) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdb.close();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefer.resolve(arg);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t// Removing all documents & re-inserting\n\t\t\t\t\t\t\t\t\t\t\t\tcollection.remove({}, { w: 1, safe: true }, function (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar deferreds = undefined;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn defer.reject(e);\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdeferreds = [];\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tarray.each(self.records, function (i) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar data = {};\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar defer2 = deferred.factory();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdeferreds.push(defer2);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tutility.iterate(i.data, function (v, k) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata[k] = v;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcollection.update({ _id: i.key }, data, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tw: 1,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsafe: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tupsert: true\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}, function (e, arg) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefer2.reject(e);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefer2.resolve(arg);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tutility.when(deferreds).then(function (result) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefer.resolve(result);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\t\t\t\tdefer.reject(null);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (op === \"get\") {\n\t\t\t\t\t\t\t\t\tresult = session ? sessionStorage.getItem(key) : localStorage.getItem(key);\n\n\t\t\t\t\t\t\t\t\tif (result !== null) {\n\t\t\t\t\t\t\t\t\t\tresult = json.decode(result);\n\n\t\t\t\t\t\t\t\t\t\tif (record) {\n\t\t\t\t\t\t\t\t\t\t\tself.set(key, result, true).then(function (rec) {\n\t\t\t\t\t\t\t\t\t\t\t\tdefer.resolve(rec);\n\t\t\t\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tutility.merge(self, result);\n\t\t\t\t\t\t\t\t\t\t\tdefer.resolve(self);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tdefer.resolve(self);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// Decorating loaded state for various code paths\n\t\t\t\t\t\t\t\t\tdefer.then(function () {\n\t\t\t\t\t\t\t\t\t\tself.loaded = true;\n\t\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\t\tthrow e;\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else if (op === \"remove\") {\n\t\t\t\t\t\t\t\t\tsession ? sessionStorage.removeItem(key) : localStorage.removeItem(key);\n\t\t\t\t\t\t\t\t\tdefer.resolve(this);\n\t\t\t\t\t\t\t\t} else if (op === \"set\") {\n\t\t\t\t\t\t\t\t\tdata = json.encode(record ? obj.data : {\n\t\t\t\t\t\t\t\t\t\ttotal: this.total,\n\t\t\t\t\t\t\t\t\t\tindex: this.index,\n\t\t\t\t\t\t\t\t\t\tindexes: this.indexes,\n\t\t\t\t\t\t\t\t\t\trecords: this.records\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tsession ? sessionStorage.setItem(key, data) : localStorage.setItem(key, data);\n\t\t\t\t\t\t\t\t\tdefer.resolve(this);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdefer.reject(null);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn defer;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tsync: {\n\n\t\t\t\t\t/**\n      * Syncs the DataStore with a URI representation\n      *\n      * @method sync\n      * @memberOf keigai.DataStore\n      * @return {Object} {@link keigai.Deferred}\n      * @fires keigai.DataStore#beforeSync Fires before syncing the DataStore\n      * @fires keigai.DataStore#afterSync Fires after syncing the DataStore\n      * @fires keigai.DataStore#failedSync Fires when an exception occurs\n      * @example\n      * store.sync().then( ( records ) => {\n      *   ...\n      * }, ( err ) => {\n      *   ...\n      * } );\n      */\n\t\t\t\t\tvalue: function sync() {\n\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\tvar events = this.events === true;\n\t\t\t\t\t\tvar defer = deferred.factory();\n\n\t\t\t\t\t\t/**\n       * Resolves public deferred\n       *\n       * @method success\n       * @memberOf keigai.DataStore.sync\n       * @private\n       * @param  {Object} arg API response\n       * @return {Undefined}  undefined\n       */\n\t\t\t\t\t\tvar success = function (arg) {\n\t\t\t\t\t\t\tvar data = undefined;\n\n\t\t\t\t\t\t\tif (typeof arg != \"object\") {\n\t\t\t\t\t\t\t\treturn failure(new Error(label.expectedObject));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (self.source !== null) {\n\t\t\t\t\t\t\t\targ = utility.walk(arg, self.source);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (arg instanceof Array) {\n\t\t\t\t\t\t\t\tdata = arg;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdata = [arg];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tself.batch(\"set\", data, true).then(function (arg) {\n\t\t\t\t\t\t\t\tif (events) {\n\t\t\t\t\t\t\t\t\tself.dispatch(\"afterSync\", arg);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tdefer.resolve(arg);\n\t\t\t\t\t\t\t}, failure);\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t/**\n       * Rejects public deferred\n       *\n       * @method failure\n       * @memberOf keigai.DataStore.sync\n       * @private\n       * @param  {Object} e Error instance\n       * @return {Undefined} undefined\n       */\n\t\t\t\t\t\tvar failure = function (e) {\n\t\t\t\t\t\t\tif (events) {\n\t\t\t\t\t\t\t\tself.dispatch(\"failedSync\", e);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (this.uri === null || string.isEmpty(this.uri)) {\n\t\t\t\t\t\t\tdefer.reject(new Error(label.invalidArguments));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (events) {\n\t\t\t\t\t\t\t\tthis.dispatch(\"beforeSync\", this.uri);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (this.callback !== null) {\n\t\t\t\t\t\t\t\tclient.jsonp(this.uri, { callback: this.callback }).then(success, failure);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tclient.request(this.uri, \"GET\", null, utility.merge({ withCredentials: this.credentials }, this.headers)).then(success, failure);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn defer;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tteardown: {\n\n\t\t\t\t\t/**\n      * Tears down a store & expires all records associated to an API\n      *\n      * @method teardown\n      * @memberOf keigai.DataStore\n      * @return {Object} {@link keigai.DataStore}\n      * @example\n      * store.teardown();\n      */\n\t\t\t\t\tvalue: function teardown() {\n\t\t\t\t\t\tvar uri = this.uri;\n\t\t\t\t\t\tvar id = undefined;\n\n\t\t\t\t\t\tif (uri !== null) {\n\t\t\t\t\t\t\tcache.expire(uri, true);\n\n\t\t\t\t\t\t\tid = this.id + \"DataExpire\";\n\t\t\t\t\t\t\tutility.clearTimers(id);\n\n\t\t\t\t\t\t\tarray.each(this.records, function (i) {\n\t\t\t\t\t\t\t\tvar recordUri = uri + \"/\" + i.key;\n\n\t\t\t\t\t\t\t\tcache.expire(recordUri, true);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tarray.each(this.lists, function (i) {\n\t\t\t\t\t\t\ti.teardown(true);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.clear(true);\n\t\t\t\t\t\tthis.dispatch(\"afterTeardown\");\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tundo: {\n\n\t\t\t\t\t/**\n      * Undoes the last modification to a record, if it exists\n      *\n      * @method undo\n      * @memberOf keigai.DataStore\n      * @param  {Mixed}  key     Key or index\n      * @param  {String} version [Optional] Version to restore\n      * @return {Object}         Deferred\n      * @example\n      * // Didn't like the new version, so undo the change\n      * store.undo( \"key\", \"v1\" );\n      */\n\t\t\t\t\tvalue: function undo(key, version) {\n\t\t\t\t\t\tvar record = this.get(key);\n\t\t\t\t\t\tvar defer = deferred.factory();\n\t\t\t\t\t\tvar versions = this.versions[record.key];\n\t\t\t\t\t\tvar previous = undefined;\n\n\t\t\t\t\t\tif (record === undefined) {\n\t\t\t\t\t\t\tdefer.reject(new Error(label.invalidArguments));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (versions) {\n\t\t\t\t\t\t\t\tprevious = versions.get(version || versions.first);\n\n\t\t\t\t\t\t\t\tif (previous === undefined) {\n\t\t\t\t\t\t\t\t\tdefer.reject(label.datastoreNoPrevVersion);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthis.set(key, previous).then(function (arg) {\n\t\t\t\t\t\t\t\t\t\tdefer.resolve(arg);\n\t\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdefer.reject(label.datastoreNoPrevVersion);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn defer;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tunique: {\n\n\t\t\t\t\t/**\n      * Returns Array of unique values of `key`\n      *\n      * @method unique\n      * @memberOf keigai.DataStore\n      * @param  {String} key Field to compare\n      * @return {Array}      Array of values\n      * @example\n      * let ages = store.unique( \"age\" );\n      */\n\t\t\t\t\tvalue: function unique(key) {\n\t\t\t\t\t\treturn array.unique(this.records.map(function (i) {\n\t\t\t\t\t\t\treturn i.data[key];\n\t\t\t\t\t\t}));\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tupdate: {\n\n\t\t\t\t\t/**\n      * Applies a difference to a record\n      *\n      * Use `data.set()` if `data` is the complete field set\n      *\n      * @method update\n      * @memberOf keigai.DataStore\n      * @param  {Mixed}  key  Key or index\n      * @param  {Object} data Key:Value pairs to set as field values\n      * @return {Object} {@link keigai.Deferred}\n      * @example\n      * store.update( \"key\", {age: 34} );\n      */\n\t\t\t\t\tvalue: function update(key, data) {\n\t\t\t\t\t\tvar record = this.get(key);\n\t\t\t\t\t\tvar defer = deferred.factory();\n\n\t\t\t\t\t\tif (record === undefined) {\n\t\t\t\t\t\t\tdefer.reject(new Error(label.invalidArguments));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.set(key, utility.merge(record.data, data)).then(function (arg) {\n\t\t\t\t\t\t\t\tdefer.resolve(arg);\n\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn defer;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn DataStore;\n\t\t})(Base);\n\n\t\t/**\n   * @namespace store\n   */\n\t\tvar store = {\n\t\t\t/**\n    * Decorates a DataStore on an Object\n    *\n    * @method factory\n    * @memberOf store\n    * @param  {Mixed}  recs [Optional] Data to set with this.batch\n    * @param  {Object} args [Optional] Arguments to set on the store\n    * @return {Object} {@link keigai.DataStore}\n    * @example\n    * let store = keigai.store(null, {key: \"guid\"});\n    *\n    * store.setUri( \"http://...\" ).then( ( records ) => {\n    *   // Do something with the records\n    * }, ( e ) => {\n    *   // Handle `e`\n    * } );\n    */\n\t\t\tfactory: function (recs, args) {\n\t\t\t\tvar obj = new DataStore();\n\n\t\t\t\tif (args instanceof Object) {\n\t\t\t\t\tutility.merge(obj, args);\n\t\t\t\t}\n\n\t\t\t\tif (recs !== null && typeof recs === \"object\") {\n\t\t\t\t\tobj.batch(\"set\", recs);\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * DataStore worker handler\n    *\n    * @method worker\n    * @memberOf store\n    * @param  {Object} ev Event\n    * @return {Undefined} undefined\n    * @private\n    */\n\t\t\tworker: function (ev) {\n\t\t\t\tvar cmd = ev.data.cmd;\n\t\t\t\tvar records = ev.data.records;\n\t\t\t\tvar clauses = undefined,\n\t\t\t\t    cond = undefined,\n\t\t\t\t    functions = undefined,\n\t\t\t\t    indexes = undefined,\n\t\t\t\t    index = undefined,\n\t\t\t\t    result = undefined,\n\t\t\t\t    sorted = undefined,\n\t\t\t\t    where = undefined,\n\t\t\t\t    values = undefined;\n\n\t\t\t\tif (cmd === \"select\") {\n\t\t\t\t\twhere = JSON.parse(ev.data.where);\n\t\t\t\t\tfunctions = ev.data.functions;\n\t\t\t\t\tclauses = array.fromObject(where);\n\t\t\t\t\tsorted = array.flat(clauses).filter(function (i, idx) {\n\t\t\t\t\t\treturn idx % 2 === 0;\n\t\t\t\t\t}).sort(array.sort);\n\t\t\t\t\tindex = sorted.join(\"|\");\n\t\t\t\t\tvalues = sorted.map(function (i) {\n\t\t\t\t\t\treturn where[i];\n\t\t\t\t\t}).join(\"|\");\n\t\t\t\t\tindexes = ev.data.indexes;\n\t\t\t\t\tcond = \"return ( \";\n\n\t\t\t\t\tif (functions.length === 0 && indexes[index]) {\n\t\t\t\t\t\tresult = (indexes[index][values] || []).map(function (i) {\n\t\t\t\t\t\t\treturn records[i];\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (clauses.length > 1) {\n\t\t\t\t\t\t\tarray.each(clauses, function (i, idx) {\n\t\t\t\t\t\t\t\tvar b1 = \"( \";\n\n\t\t\t\t\t\t\t\tif (idx > 0) {\n\t\t\t\t\t\t\t\t\tb1 = \" && ( \";\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (array.contains(functions, i[0])) {\n\t\t\t\t\t\t\t\t\tcond += b1 + i[1] + \"( rec.data[\\\"\" + i[0] + \"\\\"] ) )\";\n\t\t\t\t\t\t\t\t} else if (!isNaN(i[1])) {\n\t\t\t\t\t\t\t\t\tcond += b1 + \"rec.data[\\\"\" + i[0] + \"\\\"] === \" + i[1] + \" )\";\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tcond += b1 + \"rec.data[\\\"\" + i[0] + \"\\\"] === \\\"\" + i[1] + \"\\\" )\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (array.contains(functions, clauses[0][0])) {\n\t\t\t\t\t\t\t\tcond += clauses[0][1] + \"( rec.data[\\\"\" + clauses[0][0] + \"\\\"] )\";\n\t\t\t\t\t\t\t} else if (!isNaN(clauses[0][1])) {\n\t\t\t\t\t\t\t\tcond += \"rec.data[\\\"\" + clauses[0][0] + \"\\\"] === \" + clauses[0][1];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcond += \"rec.data[\\\"\" + clauses[0][0] + \"\\\"] === \\\"\" + clauses[0][1] + \"\\\"\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcond += \" );\";\n\n\t\t\t\t\t\tresult = records.filter(new Function(\"rec\", cond));\n\t\t\t\t\t}\n\t\t\t\t} else if (cmd === \"sort\") {\n\t\t\t\t\tresult = array.keySort(records, ev.data.query, \"data\");\n\t\t\t\t}\n\n\t\t\t\tpostMessage(result);\n\t\t\t}\n\t\t};\n\n\t\t/**\n   * @namespace string\n   */\n\t\tvar string = {\n\t\t\t/**\n    * Capitalizes the String\n    *\n    * @method capitalize\n    * @memberOf string\n    * @param  {String}  obj String to capitalize\n    * @param  {Boolean} all [Optional] Capitalize each word\n    * @return {String}      Capitalized String\n    * @example\n    * keigai.util.string.capitalize( \"hello\" ); // \"Hello\"\n    */\n\t\t\tcapitalize: function (obj) {\n\t\t\t\tvar all = arguments[1] === undefined ? false : arguments[1];\n\t\t\t\tvar result = undefined;\n\n\t\t\t\tif (all) {\n\t\t\t\t\tresult = string.explode(obj, \" \").map(function (i) {\n\t\t\t\t\t\treturn i.charAt(0).toUpperCase() + i.slice(1);\n\t\t\t\t\t}).join(\" \");\n\t\t\t\t} else {\n\t\t\t\t\tresult = obj.charAt(0).toUpperCase() + obj.slice(1);\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Escapes meta characters within a string\n    *\n    * @method escape\n    * @memberOf string\n    * @param  {String} obj String to escape\n    * @return {String}     Escaped string\n    * @example\n    * keigai.util.string.escape( \"{hello}\" ); // \"\\{hello\\}\"\n    */\n\t\t\tescape: function (obj) {\n\t\t\t\treturn obj.replace(/[\\-\\[\\]{}()*+?.,\\\\\\/\\^\\$|#\\s]/g, \"\\\\$&\");\n\t\t\t},\n\n\t\t\t/**\n    * Splits a string on comma, or a parameter, and trims each value in the resulting Array\n    *\n    * @method explode\n    * @memberOf string\n    * @param  {String} obj String to capitalize\n    * @param  {String} arg String to split on\n    * @return {Array}      Array of the exploded String\n    * @example\n    * keigai.util.array.each( keigai.util.string.explode( \"abc, def\" ), ( i ) => {\n    *   ...\n    * } );\n    */\n\t\t\texplode: function (obj) {\n\t\t\t\tvar arg = arguments[1] === undefined ? \",\" : arguments[1];\n\t\t\t\treturn string.trim(obj).split(new RegExp(\"\\\\s*\" + arg + \"\\\\s*\"));\n\t\t\t},\n\n\t\t\t/**\n    * Creates a String representation of an Object, preserving Functions\n    *\n    * Nested Objects are not supported\n    *\n    * @method fromObject\n    * @memberOf string\n    * @param  {Object} obj  Object to convert\n    * @param  {String} name [Optional] Name of Object\n    * @return {String}      String representation\n    * @example\n    * keigai.util.string.fromObject( {a: true, b: false}, \"stats\" ); // \"stats = {'a': true,'b':false}\"\n    */\n\t\t\tfromObject: function (obj, name) {\n\t\t\t\tvar result = (name ? name + \" = {\" : \"{\") + \"\\n\";\n\n\t\t\t\tutility.iterate(obj, function (v, k) {\n\t\t\t\t\tresult += \"\\\"\" + k + \"\\\":\" + v.toString() + \",\\n\";\n\t\t\t\t});\n\n\t\t\t\tresult = result.replace(/\\[object Object\\]/g, \"{}\").replace(/,\\n$/, \"\\n\") + \"}\";\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Replaces all spaces in a string with dashes\n    *\n    * @method hyphenate\n    * @memberOf string\n    * @param  {String} obj   String to hyphenate\n    * @param {Boolean} camel [Optional] Hyphenate camelCase\n    * @return {String}       String with dashes instead of spaces\n    * @example\n    * keigai.util.string.hyphenate( \"hello world\" ); // \"hello-world\"\n    */\n\t\t\thyphenate: function (obj) {\n\t\t\t\tvar camel = arguments[1] === undefined ? false : arguments[1];\n\t\t\t\tvar result = string.trim(obj).replace(/\\s+/g, \"-\");\n\n\t\t\t\tif (camel === true) {\n\t\t\t\t\tresult = result.replace(/([A-Z])/g, \"-$1\").toLowerCase();\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Tests if a string is a boolean\n    *\n    * @method isBoolean\n    * @memberOf string\n    * @param  {String}  obj String to test\n    * @return {Boolean}     Result of test\n    * @example\n    * if ( keigai.util.string.isBoolean( ... ) {\n    *   ...\n    * } );\n    */\n\t\t\tisBoolean: function (obj) {\n\t\t\t\treturn regex.bool.test(obj);\n\t\t\t},\n\n\t\t\t/**\n    * Tests if a string is empty\n    *\n    * @method isEmpty\n    * @memberOf string\n    * @param  {String}  obj String to test\n    * @return {Boolean}     Result of test\n    * @example\n    * if ( !keigai.util.string.isEmpty( ... ) {\n    *   ...\n    * } );\n    */\n\t\t\tisEmpty: function (obj) {\n\t\t\t\treturn string.trim(obj) === \"\";\n\t\t\t},\n\n\t\t\t/**\n    * Tests if a string is a number\n    *\n    * @method isNumber\n    * @memberOf string\n    * @param  {String}  obj String to test\n    * @return {Boolean}     Result of test\n    * @example\n    * if ( keigai.util.string.isNumber( ... ) {\n    *   ...\n    * } );\n    */\n\t\t\tisNumber: function (obj) {\n\t\t\t\treturn regex.number.test(obj);\n\t\t\t},\n\n\t\t\t/**\n    * Tests if a string is a URL\n    *\n    * @method isUrl\n    * @memberOf string\n    * @param  {String}  obj String to test\n    * @return {Boolean}     Result of test\n    * @example\n    * if ( keigai.util.string.isUrl( ... ) {\n    *   ...\n    * } );\n    */\n\t\t\tisUrl: function (obj) {\n\t\t\t\treturn regex.url.test(obj);\n\t\t\t},\n\n\t\t\t/**\n    * Transforms the case of a String into CamelCase\n    *\n    * @method toCamelCase\n    * @memberOf string\n    * @param  {String} obj String to capitalize\n    * @return {String}     Camel case String\n    * @example\n    * keigai.util.string.toCamelCase( \"hello world\" ); // \"helloWorld\"\n    */\n\t\t\ttoCamelCase: function (obj) {\n\t\t\t\tvar s = string.trim(obj).replace(/\\.|_|-|\\@|\\[|\\]|\\(|\\)|\\#|\\$|\\%|\\^|\\&|\\*|\\s+/g, \" \").toLowerCase().split(regex.space_hyphen);\n\t\t\t\tvar r = [];\n\n\t\t\t\tarray.each(s, function (i, idx) {\n\t\t\t\t\tr.push(idx === 0 ? i : string.capitalize(i));\n\t\t\t\t});\n\n\t\t\t\treturn r.join(\"\");\n\t\t\t},\n\n\t\t\t/**\n    * Returns singular form of the string\n    *\n    * @method singular\n    * @memberOf string\n    * @param  {String} obj String to transform\n    * @return {String}     Transformed string\n    * @example\n    * keigai.util.string.singular( \"cans\" ); // \"can\"\n    */\n\t\t\tsingular: function (obj) {\n\t\t\t\treturn obj.replace(/oe?s$/, \"o\").replace(/ies$/, \"y\").replace(/ses$/, \"se\").replace(/s$/, \"\");\n\t\t\t},\n\n\t\t\t/**\n    * Casts a String to a Function\n    *\n    * @method toFunction\n    * @memberOf string\n    * @param  {String} obj String to cast\n    * @return {Function}   Function\n    * @example\n    * let fn = someFunction.toString();\n    *\n    * ...\n    *\n    * let func = keigai.util.string.toFunction( fn );\n    */\n\t\t\ttoFunction: function (obj) {\n\t\t\t\tvar args = string.trim(obj.replace(/^.*\\(/, \"\").replace(/[\\t|\\r|\\n|\\\"|\\']+/g, \"\").replace(/\\).*/, \"\"));\n\t\t\t\tvar body = string.trim(obj.replace(/^.*\\{/, \"\").replace(/\\}$/, \"\"));\n\n\t\t\t\treturn Function.apply(Function, string.explode(args).concat([body]));\n\t\t\t},\n\n\t\t\t/**\n    * Trims the whitespace around a String\n    *\n    * @method trim\n    * @memberOf string\n    * @param  {String} obj String to capitalize\n    * @return {String}     Trimmed String\n    * @example\n    * keigai.util.string.trim( \"  hello world \" ); // \"hello world\"\n    */\n\t\t\ttrim: function (obj) {\n\t\t\t\treturn obj.replace(/^(\\s+|\\t+|\\n+)|(\\s+|\\t+|\\n+)$/g, \"\");\n\t\t\t},\n\n\t\t\t/**\n    * Uncamelcases the String\n    *\n    * @method unCamelCase\n    * @memberOf string\n    * @param  {String} obj String to uncamelcase\n    * @return {String}     Uncamelcased String\n    */\n\t\t\tunCamelCase: function (obj) {\n\t\t\t\treturn string.trim(obj.replace(/([A-Z])/g, \" $1\").toLowerCase());\n\t\t\t},\n\n\t\t\t/**\n    * Uncapitalizes the String\n    *\n    * @method uncapitalize\n    * @memberOf string\n    * @param  {String} obj String to uncapitalize\n    * @return {String}     Uncapitalized String\n    * @example\n    * keigai.util.string.uncapitalize( \"Hello\" ); // \"hello\"\n    */\n\t\t\tuncapitalize: function (obj) {\n\t\t\t\tvar result = string.trim(obj);\n\n\t\t\t\treturn result.charAt(0).toLowerCase() + result.slice(1);\n\t\t\t},\n\n\t\t\t/**\n    * Replaces all hyphens with spaces\n    *\n    * @method unhyphenate\n    * @memberOf string\n    * @param  {String}  obj  String to unhypenate\n    * @param  {Boolean} caps [Optional] True to capitalize each word\n    * @return {String}       Unhyphenated String\n    * @example\n    * keigai.util.string.unhyphenate( \"hello-world\" );       // \"hello world\"\n    * keigai.util.string.unhyphenate( \"hello-world\", true ); // \"Hello World\"\n    */\n\t\t\tunhyphenate: function (obj) {\n\t\t\t\tvar caps = arguments[1] === undefined ? false : arguments[1];\n\t\t\t\tif (caps !== true) {\n\t\t\t\t\treturn string.explode(obj, \"-\").join(\" \");\n\t\t\t\t} else {\n\t\t\t\t\treturn string.explode(obj, \"-\").map(function (i) {\n\t\t\t\t\t\treturn string.capitalize(i);\n\t\t\t\t\t}).join(\" \");\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\n   * @namespace utility\n   */\n\t\tvar utility = {\n\t\t\t/**\n    * Collection of timers\n    *\n    * @memberOf utility\n    * @type {Object}\n    * @private\n    */\n\t\t\ttimer: {},\n\n\t\t\t/**\n    * Collection of repeating functions\n    *\n    * @memberOf utility\n    * @type {Object}\n    * @private\n    */\n\t\t\trepeating: {},\n\n\t\t\t/**\n    * Creates Elements or Queries the DOM using CSS selectors\n    *\n    * @method $\n    * @memberOf utility\n    * @param  {Mixed} arg HTML, or Comma delimited string of CSS selectors\n    * @return {Array}     Array of matching Elements\n    * @example\n    * let $ = keigai.util.$;\n    *\n    * // Looking for Elements\n    * $( \".someClass\" ).forEach( ( i ) => {\n    *   ...\n    * } );\n    *\n    * // Creating an H1 Element\n    * $( \"&lt;h1&gt;\" ).forEach( ( i ) => {\n    *   ...\n    * } );\n    */\n\t\t\t$: function (arg) {\n\t\t\t\tvar result = undefined;\n\n\t\t\t\t// Nothing\n\t\t\t\tif (!arg) {}\n\t\t\t\t// HTML\n\t\t\t\telse if (regex.html.test(arg)) {\n\t\t\t\t\tresult = [element.create(arg)];\n\t\t\t\t}\n\t\t\t\t// CSS selector(s)\n\t\t\t\telse {\n\t\t\t\t\targ = string.trim(arg);\n\n\t\t\t\t\tif (arg.indexOf(\",\") === -1) {\n\t\t\t\t\t\tresult = utility.dom(arg);\n\n\t\t\t\t\t\tif (result) {\n\t\t\t\t\t\t\tif (isNaN(result.length)) {\n\t\t\t\t\t\t\t\tresult = [result];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult = [];\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult = [];\n\n\t\t\t\t\t\tarray.each(string.explode(arg), function (query) {\n\t\t\t\t\t\t\tvar obj = utility.dom(query);\n\n\t\t\t\t\t\t\tif (obj instanceof Array) {\n\t\t\t\t\t\t\t\tresult = result.concat(obj);\n\t\t\t\t\t\t\t} else if (obj) {\n\t\t\t\t\t\t\t\tresult.push(obj);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Creates an instance of Base\n    *\n    * @method base\n    * @memberOf utility\n    * @param  {Object} arg [Optional] Decorative Object\n    * @return {Object}     Instance of Base\n    */\n\t\t\tbase: function (arg) {\n\t\t\t\tvar obj = new Base();\n\n\t\t\t\tif (arg instanceof Object) {\n\t\t\t\t\tutility.merge(obj, arg);\n\t\t\t\t}\n\n\t\t\t\tobj.observer = observable.factory();\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Blob factory\n    *\n    * @method blob\n    * @memberOf utility\n    * @param  {String} arg String to convert to a Blob\n    * @return {Object}     Blob\n    * @private\n    */\n\t\t\tblob: function (arg) {\n\t\t\t\tvar obj = undefined;\n\n\t\t\t\ttry {\n\t\t\t\t\tobj = new Blob([arg], { type: \"application/javascript\" });\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (!global.BlobBuilder) {\n\t\t\t\t\t\tglobal.BlobBuilder = global.MSBlobBuilder || global.WebKitBlobBuilder || global.MozBlobBuilder;\n\t\t\t\t\t}\n\n\t\t\t\t\tobj = new global.BlobBuilder().append(arg).getBlob();\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Clears deferred & repeating functions\n    *\n    * @method clearTimers\n    * @memberOf utility\n    * @param  {String} id ID of timer( s )\n    * @return {Undefined} undefined\n    * @example\n    * keigai.util.clearTimers( 'helloWorld' );\n    */\n\t\t\tclearTimers: function (id) {\n\t\t\t\t// deferred\n\t\t\t\tif (utility.timer[id]) {\n\t\t\t\t\tclearTimeout(utility.timer[id]);\n\t\t\t\t\tdelete utility.timer[id];\n\t\t\t\t}\n\n\t\t\t\t// repeating\n\t\t\t\tif (utility.repeating[id]) {\n\t\t\t\t\tclearTimeout(utility.repeating[id]);\n\t\t\t\t\tdelete utility.repeating[id];\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n    * Clones an Object\n    *\n    * @method clone\n    * @memberOf utility\n    * @param  {Object}  obj     Object to clone\n    * @param  {Boolean} shallow [Optional] Create a shallow clone, which doesn't maintain prototypes, default is `false`\n    * @return {Object}          Clone of obj\n    * @example\n    * let x = {a: true, b: false},\n    *     y = keigai.util.clone( x, true );\n    *\n    * y.a; // true\n    */\n\t\t\tclone: function (obj) {\n\t\t\t\tvar shallow = arguments[1] === undefined ? false : arguments[1];\n\t\t\t\tvar clone = undefined,\n\t\t\t\t    result = undefined;\n\n\t\t\t\tif (shallow === true) {\n\t\t\t\t\treturn obj !== undefined && obj !== null ? JSON.parse(JSON.stringify(obj)) : obj;\n\t\t\t\t} else if (!obj || regex.primitive.test(typeof obj) || obj instanceof RegExp) {\n\t\t\t\t\treturn obj;\n\t\t\t\t} else if (obj instanceof Array) {\n\t\t\t\t\tresult = [];\n\n\t\t\t\t\tarray.each(obj, function (i, idx) {\n\t\t\t\t\t\tresult[idx] = utility.clone(i);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn result;\n\t\t\t\t} else if (!server && !client.ie && obj instanceof Document) {\n\t\t\t\t\treturn xml.decode(xml.encode(obj));\n\t\t\t\t} else if (typeof obj.__proto__ != \"undefined\") {\n\t\t\t\t\treturn utility.extend(obj.__proto__, obj);\n\t\t\t\t} else if (obj instanceof Object) {\n\t\t\t\t\t// If JSON encoding fails due to recursion, the original Object is returned because it's assumed this is for decoration\n\t\t\t\t\tclone = json.encode(obj, true);\n\n\t\t\t\t\tif (clone !== undefined) {\n\t\t\t\t\t\tclone = json.decode(clone);\n\n\t\t\t\t\t\t// Decorating Functions that would be lost with JSON encoding/decoding\n\t\t\t\t\t\tutility.iterate(obj, function (v, k) {\n\t\t\t\t\t\t\tif (typeof v === \"function\") {\n\t\t\t\t\t\t\t\tclone[k] = v;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tclone = obj;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn clone;\n\t\t\t\t} else {\n\t\t\t\t\treturn obj;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n    * Coerces a String to a Type\n    *\n    * @method coerce\n    * @memberOf utility\n    * @param  {String} value String to coerce\n    * @return {Mixed}        Primitive version of the String\n    * @example\n    * keigai.util.coerce( \"1\" ); // 1\n    */\n\t\t\tcoerce: function (value) {\n\t\t\t\tvar tmp = undefined;\n\n\t\t\t\tif (value === null || value === undefined) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t} else if (value === \"true\") {\n\t\t\t\t\treturn true;\n\t\t\t\t} else if (value === \"false\") {\n\t\t\t\t\treturn false;\n\t\t\t\t} else if (value === \"null\") {\n\t\t\t\t\treturn null;\n\t\t\t\t} else if (value === \"undefined\") {\n\t\t\t\t\treturn undefined;\n\t\t\t\t} else if (value === \"\") {\n\t\t\t\t\treturn value;\n\t\t\t\t} else if (!isNaN(tmp = Number(value))) {\n\t\t\t\t\treturn tmp;\n\t\t\t\t} else if (regex.json_wrap.test(value)) {\n\t\t\t\t\treturn json.decode(value, true) || value;\n\t\t\t\t} else {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n    * Recompiles a RegExp by reference\n    *\n    * This is ideal when you need to recompile a regex for use within a conditional statement\n    *\n    * @method compile\n    * @memberOf utility\n    * @param  {Object} regex     RegExp\n    * @param  {String} pattern   Regular expression pattern\n    * @param  {String} modifiers Modifiers to apply to the pattern\n    * @return {Boolean}          true\n    * @private\n    */\n\t\t\tcompile: function (reg, pattern, modifiers) {\n\t\t\t\treg.compile(pattern, modifiers);\n\n\t\t\t\treturn true;\n\t\t\t},\n\n\t\t\t/**\n    * Curries a Function\n    *\n    * Note: Function to curry must return a Function\n    *\n    * @method curry\n    * @memberOf utility\n    * @return {Function} Curried Function\n    * @example\n    * function f ( a, b ) {\n    *   return ( n ) => {\n    *     return ( a + b ) * n;\n    *   };\n    * }\n    *\n    * let g = keigai.util.curry( f, 2, 8 );\n    *\n    * g( 5 ); // 50\n    */\n\t\t\tcurry: function (fn) {\n\t\t\t\tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n\t\t\t\t\targs[_key - 1] = arguments[_key];\n\t\t\t\t}\n\n\t\t\t\tvar cfn = fn.apply(fn, args);\n\n\t\t\t\treturn function () {\n\t\t\t\t\tfor (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n\t\t\t\t\t\targs[_key2] = arguments[_key2];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn cfn.apply(cfn, args);\n\t\t\t\t};\n\t\t\t},\n\n\t\t\t/**\n    * Defers the execution of Function by at least the supplied milliseconds.\n    * Timing may vary under \"heavy load\" relative to the CPU & client JavaScript engine.\n    *\n    * @method defer\n    * @memberOf utility\n    * @param  {Function} fn     Function to defer execution of\n    * @param  {Number}   ms     Milliseconds to defer execution\n    * @param  {Number}   id     [Optional] ID of the deferred function\n    * @param  {Boolean}  repeat [Optional] Describes the execution, default is `false`\n    * @return {String}          ID of the timer\n    * @example\n    * keigai.util.defer( () => {\n    *   console.log( 'hello world' );\n    * }, 1000, 'helloWorld', true );\n    */\n\t\t\tdefer: function (fn, _x, id) {\n\t\t\t\tvar ms = arguments[1] === undefined ? 0 : arguments[1];\n\t\t\t\tvar repeat = arguments[3] === undefined ? false : arguments[3];\n\t\t\t\tvar op = undefined;\n\n\t\t\t\tif (id !== undefined) {\n\t\t\t\t\tutility.clearTimers(id);\n\t\t\t\t} else {\n\t\t\t\t\tid = utility.uuid(true);\n\t\t\t\t}\n\n\t\t\t\top = function () {\n\t\t\t\t\tutility.clearTimers(id);\n\t\t\t\t\tfn();\n\t\t\t\t};\n\n\t\t\t\tutility[repeat ? \"repeating\" : \"timer\"][id] = setTimeout(op, ms);\n\n\t\t\t\treturn id;\n\t\t\t},\n\n\t\t\t/**\n    * Async delay strategy\n    *\n    * @method delay\n    * @memberOf promise\n    * @return {Function} Delay method\n    * @private\n    */\n\t\t\tdelay: (function () {\n\t\t\t\tif (typeof setImmediate != \"undefined\") {\n\t\t\t\t\treturn function (arg) {\n\t\t\t\t\t\tsetImmediate(arg);\n\t\t\t\t\t};\n\t\t\t\t} else if (typeof process != \"undefined\") {\n\t\t\t\t\treturn process.nextTick;\n\t\t\t\t} else {\n\t\t\t\t\treturn function (arg) {\n\t\t\t\t\t\tsetTimeout(arg, 0);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t})(),\n\n\t\t\t/**\n    * Queries DOM with fastest method\n    *\n    * @method dom\n    * @memberOf utility\n    * @param  {String} arg DOM query\n    * @return {Mixed}      undefined, Element, or Array of Elements\n    * @private\n    */\n\t\t\tdom: function (arg) {\n\t\t\t\tvar result = undefined;\n\n\t\t\t\tif (!regex.selector_complex.test(arg)) {\n\t\t\t\t\tif (regex.hash.test(arg)) {\n\t\t\t\t\t\tresult = document.getElementById(arg.replace(regex.hash, \"\")) || undefined;\n\t\t\t\t\t} else if (regex.klass.test(arg)) {\n\t\t\t\t\t\tresult = array.cast(document.getElementsByClassName(arg.replace(regex.klass, \"\")));\n\t\t\t\t\t} else if (regex.word.test(arg)) {\n\t\t\t\t\t\tresult = array.cast(document.getElementsByTagName(arg));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult = array.cast(document.querySelectorAll(arg));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tresult = array.cast(document.querySelectorAll(arg));\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n    * Encodes a UUID to a DOM friendly ID\n    *\n    * @method domId\n    * @memberOf utility\n    * @param  {String} UUID\n    * @return {String} DOM friendly ID\n    * @private\n    */\n\t\t\tdomId: function (arg) {\n\t\t\t\treturn \"a\" + arg.replace(/-/g, \"\").slice(1);\n\t\t\t},\n\n\t\t\t/**\n    * Error handling, with history in `error.log`\n    *\n    * @method error\n    * @memberOf utility\n    * @param  {Mixed}   e       Error object or message to display\n    * @param  {Array}   args    Array of arguments from the callstack\n    * @param  {Mixed}   scope   Entity that was \"this\"\n    * @param  {Boolean} warning [Optional] Will display as console warning if true\n    * @return {Undefined}       undefined\n    * @private\n    */\n\t\t\terror: function (e, args, scope, warning) {\n\t\t\t\tvar o = {\n\t\t\t\t\targuments: args ? array.cast(args) : [],\n\t\t\t\t\tmessage: e.message || e,\n\t\t\t\t\tnumber: e.number ? e.number & 65535 : undefined,\n\t\t\t\t\tscope: scope,\n\t\t\t\t\tstack: e.stack || undefined,\n\t\t\t\t\ttimestamp: new Date().toUTCString(),\n\t\t\t\t\ttype: e.type || \"TypeError\"\n\t\t\t\t};\n\n\t\t\t\tutility.log(o.stack || o.message, warning !== true ? \"error\" : \"warn\");\n\n\t\t\t\treturn undefined;\n\t\t\t},\n\n\t\t\t/**\n    * Creates a \"class\" extending Object, with optional decoration. SuperClass can be called from `super` property.\n    *\n    * @method extend\n    * @memberOf utility\n    * @param  {Object} obj Object to extend\n    * @param  {Object} arg [Optional] Object for decoration\n    * @return {Object}     Decorated obj\n    * @example\n    * let extendObj = keigai.util.extend( someObj, {newProperty: value} );\n    */\n\t\t\textend: function (obj, arg) {\n\t\t\t\tvar o = Object.create(obj);\n\n\t\t\t\tif (arg instanceof Object) {\n\t\t\t\t\tutility.merge(o, arg);\n\t\t\t\t}\n\n\t\t\t\to[\"super\"] = obj;\n\n\t\t\t\treturn o;\n\t\t\t},\n\n\t\t\t/**\n    * Generates an ID value\n    *\n    * @method genId\n    * @memberOf utility\n    * @param  {Mixed}   obj [Optional] Object to receive id\n    * @param  {Boolean} dom [Optional] Verify the ID is unique in the DOM, default is false\n    * @return {Mixed}       Object or id\n    * @example\n    * let id = keigai.util.genId();\n    */\n\t\t\tgenId: function (obj) {\n\t\t\t\tvar dom = arguments[1] === undefined ? false : arguments[1];\n\t\t\t\tvar id = undefined;\n\n\t\t\t\tif (obj && (obj.id || obj instanceof Array || (typeof obj === \"string\" || obj instanceof String))) {\n\t\t\t\t\treturn obj;\n\t\t\t\t}\n\n\t\t\t\tif (dom) {\n\t\t\t\t\tdo {\n\t\t\t\t\t\tid = utility.domId(utility.uuid(true));\n\t\t\t\t\t} while (utility.dom(\"#\" + id));\n\t\t\t\t} else {\n\t\t\t\t\tid = utility.domId(utility.uuid(true));\n\t\t\t\t}\n\n\t\t\t\tif (obj && typeof obj === \"object\") {\n\t\t\t\t\tobj.id = id;\n\n\t\t\t\t\treturn obj;\n\t\t\t\t} else {\n\t\t\t\t\treturn id;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n    * Iterates an Object and executes a function against the properties.\n    * Returning `false` halts iteration.\n    *\n    * @method iterate\n    * @memberOf utility\n    * @param  {Object}   obj Object to iterate\n    * @param  {Function} fn  Function to execute against properties\n    * @return {Object}       Object\n    * @example\n    * keigai.util.iterate( {...}, ( value, key ) => {\n    *   ...\n    * } );\n    */\n\t\t\titerate: function (obj, fn) {\n\t\t\t\tarray.each(Object.keys(obj), function (i) {\n\t\t\t\t\treturn fn.call(obj, obj[i], i);\n\t\t\t\t});\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Writes argument to the console\n    *\n    * @method log\n    * @memberOf utility\n    * @param  {String} arg    String to write to the console\n    * @param  {String} target [Optional] Target console, default is \"log\"\n    * @return {Undefined}     undefined\n    * @example\n    * keigai.util.log( \"Something bad happened\", \"warn\" );\n    */\n\t\t\tlog: (function () {\n\t\t\t\tif (typeof console != \"undefined\") {\n\t\t\t\t\treturn function (arg) {\n\t\t\t\t\t\tvar target = arguments[1] === undefined ? \"log\" : arguments[1];\n\t\t\t\t\t\tvar ts = typeof arg != \"object\";\n\t\t\t\t\t\tvar msg = ts ? \"[\" + new Date().toLocaleTimeString() + \"] \" + arg : arg;\n\n\t\t\t\t\t\tconsole[target](msg);\n\t\t\t\t\t};\n\t\t\t\t} else {\n\t\t\t\t\treturn function () {};\n\t\t\t\t}\n\t\t\t})(),\n\n\t\t\t/**\n    * Merges obj with arg\n    *\n    * @method merge\n    * @memberOf utility\n    * @param  {Object} obj Object to decorate\n    * @param  {Object} arg Decoration\n    * @return {Object}     Decorated Object\n    * @example\n    * let obj = {a: true};\n    *\n    * keigai.util.merge( obj, {b: false} )\n    * console.log(obj); // {a: true, b: false}\n    */\n\t\t\tmerge: function (obj, arg) {\n\t\t\t\tvar keys = array.keys(obj);\n\n\t\t\t\tutility.iterate(arg, function (v, k) {\n\t\t\t\t\tif (!array.contains(keys, k) || v instanceof Function) {\n\t\t\t\t\t\tobj[k] = v;\n\t\t\t\t\t} else if (obj[k] instanceof Array && v instanceof Array) {\n\t\t\t\t\t\tarray.merge(obj[k], v);\n\t\t\t\t\t} else if (v instanceof Function) {\n\t\t\t\t\t\tobj[k] = v;\n\t\t\t\t\t} else if (obj[k] instanceof Object && v instanceof Object) {\n\t\t\t\t\t\tutility.iterate(v, function (x, y) {\n\t\t\t\t\t\t\tobj[k][y] = utility.clone(x);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobj[k] = utility.clone(v);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Parses a URI into an Object\n    *\n    * @method parse\n    * @memberOf utility\n    * @param  {String} uri URI to parse\n    * @return {Object}     Parsed URI\n    * @example\n    * let parsed = keigai.util.parse( location.href );\n    *\n    * parsed;\n    * {\n    *   auth     : \"\",\n    *   hash     : \"\",\n    *   host     : \"\",\n    *   hostname : \"\",\n    *   query    : {},\n    *   pathname : \"\",\n    *   port     : n,\n    *   protocol : \"\",\n    *   search   : \"\",\n    * }\n    */\n\t\t\tparse: function (uri) {\n\t\t\t\tvar obj = {};\n\t\t\t\tvar parsed = {};\n\t\t\t\tvar host = undefined,\n\t\t\t\t    protocol = undefined;\n\n\t\t\t\tif (uri === undefined) {\n\t\t\t\t\turi = !server ? location.href : \"\";\n\t\t\t\t}\n\n\t\t\t\tif (!server) {\n\t\t\t\t\tobj = document.createElement(\"a\");\n\t\t\t\t\tobj.href = uri;\n\t\t\t\t\thost = obj.href.match(regex.host)[1];\n\t\t\t\t\tprotocol = obj.href.match(regex.protocol)[1];\n\t\t\t\t} else {\n\t\t\t\t\tobj = url.parse(uri);\n\t\t\t\t}\n\n\t\t\t\tif (server) {\n\t\t\t\t\tutility.iterate(obj, function (v, k) {\n\t\t\t\t\t\tif (v === null) {\n\t\t\t\t\t\t\tobj[k] = undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tparsed = {\n\t\t\t\t\tauth: server ? null : regex.auth.exec(uri),\n\t\t\t\t\tprotocol: obj.protocol || protocol,\n\t\t\t\t\thostname: obj.hostname || host,\n\t\t\t\t\tport: obj.port ? number.parse(obj.port, 10) : \"\",\n\t\t\t\t\tpathname: obj.pathname,\n\t\t\t\t\tsearch: obj.search || \"\",\n\t\t\t\t\thash: obj.hash || \"\",\n\t\t\t\t\thost: obj.host || host\n\t\t\t\t};\n\n\t\t\t\t// 'cause IE is ... IE; required for data.batch()\n\t\t\t\tif (client.ie) {\n\t\t\t\t\tif (parsed.protocol === \":\") {\n\t\t\t\t\t\tparsed.protocol = location.protocol;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (string.isEmpty(parsed.hostname)) {\n\t\t\t\t\t\tparsed.hostname = location.hostname;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (string.isEmpty(parsed.host)) {\n\t\t\t\t\t\tparsed.host = location.host;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (parsed.pathname.charAt(0) !== \"/\") {\n\t\t\t\t\t\tparsed.pathname = \"/\" + parsed.pathname;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tparsed.auth = obj.auth || (parsed.auth === null ? \"\" : parsed.auth[1]);\n\t\t\t\tparsed.href = obj.href || parsed.protocol + \"//\" + (string.isEmpty(parsed.auth) ? \"\" : parsed.auth + \"@\") + parsed.host + parsed.pathname + parsed.search + parsed.hash;\n\t\t\t\tparsed.path = obj.path || parsed.pathname + parsed.search;\n\t\t\t\tparsed.query = utility.queryString(null, parsed.search);\n\n\t\t\t\treturn parsed;\n\t\t\t},\n\n\t\t\t/**\n    * Creates a partially applied Function\n    *\n    * @method partial\n    * @memberOf utility\n    * @return {Function} Partial Function\n    * @example\n    * function f ( a, b ) {\n    *   return a + b;\n    * }\n    *\n    * let g = keigai.util.partial( f, 2 );\n    *\n    * g( 2 ); // 4\n    */\n\t\t\tpartial: function (fn) {\n\t\t\t\tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n\t\t\t\t\targs[_key - 1] = arguments[_key];\n\t\t\t\t}\n\n\t\t\t\treturn function () {\n\t\t\t\t\tfor (var _len2 = arguments.length, args2 = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n\t\t\t\t\t\targs2[_key2] = arguments[_key2];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn fn.apply(fn, args.concat(args2));\n\t\t\t\t};\n\t\t\t},\n\n\t\t\t/**\n    * Prevents default behavior of an Event\n    *\n    * @method prevent\n    * @memberOf utility\n    * @param  {Object} ev Event\n    * @return {Object}    Event\n    * @example\n    * keigai.util.prevent( Event );\n    */\n\t\t\tprevent: function (ev) {\n\t\t\t\tif (typeof ev.preventDefault === \"function\") {\n\t\t\t\t\tev.preventDefault();\n\t\t\t\t}\n\n\t\t\t\treturn ev;\n\t\t\t},\n\n\t\t\t/**\n    * Parses a query string & coerces values\n    *\n    * @method queryString\n    * @memberOf utility\n    * @param  {String} arg     [Optional] Key to find in the querystring\n    * @param  {String} qstring [Optional] Query string to parse\n    * @return {Mixed}          Value or Object of key:value pairs\n    * @private\n    */\n\t\t\tqueryString: function (arg, qstring) {\n\t\t\t\tvar obj = {};\n\t\t\t\tvar result = qstring !== undefined ? qstring.indexOf(\"?\") > -1 ? qstring.replace(/.*\\?/, \"\") : null : server || string.isEmpty(location.search) ? null : location.search.replace(\"?\", \"\");\n\n\t\t\t\tif (result !== null && !string.isEmpty(result)) {\n\t\t\t\t\tresult = result.split(\"&\");\n\t\t\t\t\tarray.each(result, function (prop) {\n\t\t\t\t\t\tvar item = prop.split(\"=\");\n\n\t\t\t\t\t\tif (string.isEmpty(item[0])) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (item[1] === undefined) {\n\t\t\t\t\t\t\titem[1] = \"\";\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\titem[1] = utility.coerce(decodeURIComponent(item[1]));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (obj[item[0]] === undefined) {\n\t\t\t\t\t\t\tobj[item[0]] = item[1];\n\t\t\t\t\t\t} else if (!(obj[item[0]] instanceof Array)) {\n\t\t\t\t\t\t\tobj[item[0]] = [obj[item[0]]];\n\t\t\t\t\t\t\tobj[item[0]].push(item[1]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tobj[item[0]].push(item[1]);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (arg !== null && arg !== undefined) {\n\t\t\t\t\tobj = obj[arg];\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\n    * Accepts Deferreds or Promises as arguments, or an Array of either\n    *\n    * @method race\n    * @memberOf utility\n    * @return {Object} {@link keigai.Deferred}\n    * @example\n    * let deferreds = [],\n    *     defer1    = keigai.util.defer(),\n    *     defer2    = keigai.util.defer();\n    *\n    * deferreds.push( defer1 );\n    * deferreds.push( defer2 );\n    *\n    * // Executes when one deferred is resolved or rejected\n    * keigai.util.race( deferreds ).then( ( arg ) ) => {\n    *   ...\n    * }, ( err ) => {\n    *   ...\n    * } );\n    *\n    * ...\n    *\n    * defer1.resolve( true );\n    * defer2.resolve( true );\n    */\n\t\t\trace: function () {\n\t\t\t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\t\t\targs[_key] = arguments[_key];\n\t\t\t\t}\n\n\t\t\t\tvar defer = deferred.factory();\n\n\t\t\t\t// Did we receive an Array? if so it overrides any other arguments\n\t\t\t\tif (args[0] instanceof Array) {\n\t\t\t\t\targs = args[0];\n\t\t\t\t}\n\n\t\t\t\t// None, end on next tick\n\t\t\t\tif (args.length === 0) {\n\t\t\t\t\tdefer.resolve(null);\n\t\t\t\t}\n\t\t\t\t// Setup and wait\n\t\t\t\telse {\n\t\t\t\t\tPromise.race(args).then(function (results) {\n\t\t\t\t\t\tdefer.resolve(results);\n\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn defer;\n\t\t\t},\n\n\t\t\t/**\n    * Asynchronous DOM rendering (cannot be cancelled, suggested for reactive behavior)\n    *\n    * @method render\n    * @memberOf utility\n    * @param  {Function} fn Function to execute on next 'frame'\n    * @return {Object} {@link keigai.Deferred}\n    * @example\n    * keigai.util.render( () => {\n    *     return keitai.util.element.html( document.querySelector( \"#id\" ), \"Hello World\" )\n    * } ).then( ( arg ) => {\n    *     // arg is the return value of your function\n    * }, ( e ) => {\n    *     // Handle e\n    * } );\n    */\n\t\t\trender: function (fn) {\n\t\t\t\tvar defer = deferred.factory();\n\n\t\t\t\tRENDER(function (arg) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdefer.resolve(fn(arg));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn defer;\n\t\t\t},\n\n\t\t\t/**\n    * Creates a recursive function. Return false from the function to halt recursion.\n    *\n    * @method repeat\n    * @memberOf utility\n    * @param  {Function} fn  Function to execute repeatedly\n    * @param  {Number}   ms  Milliseconds to stagger the execution\n    * @param  {String}   id  [Optional] Timeout ID\n    * @param  {Boolean}  now Executes `fn` and then setup repetition, default is `true`\n    * @return {String}       Timeout ID\n    * @example\n    * keigai.util.repeat( () => {\n    *   ...\n    *\n    *   // Cancelling repetition at some point in the future\n    *   if ( someCondition ) {\n    *     return false;\n    *   }\n    * }, 1000, \"repeating\" );\n    */\n\t\t\trepeat: function (fn) {\n\t\t\t\tvar ms = arguments[1] === undefined ? 10 : arguments[1];\n\t\t\t\tvar id = arguments[2] === undefined ? utility.uuid(true) : arguments[2];\n\t\t\t\tvar now = arguments[3] === undefined ? true : arguments[3];\n\t\t\t\t// Could be valid to return false from initial execution\n\t\t\t\tif (now && fn() === false) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Creating repeating execution\n\t\t\t\tutility.defer(function () {\n\t\t\t\t\tvar recursive = function (fn, ms, id) {\n\t\t\t\t\t\tif (fn() !== false) {\n\t\t\t\t\t\t\tutility.repeating[id] = setTimeout(function () {\n\t\t\t\t\t\t\t\trecursive.call(recursive, fn, ms, id);\n\t\t\t\t\t\t\t}, ms);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdelete utility.repeating[id];\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\trecursive(fn, ms, id);\n\t\t\t\t}, ms, id, true);\n\n\t\t\t\treturn id;\n\t\t\t},\n\n\t\t\t/**\n    * Stops an Event from bubbling, & prevents default behavior\n    *\n    * @method stop\n    * @memberOf utility\n    * @param  {Object} ev Event\n    * @return {Object}    Event\n    * @example\n    * keigai.util.stop( Event );\n    */\n\t\t\tstop: function (ev) {\n\t\t\t\tif (typeof ev.stopPropagation === \"function\") {\n\t\t\t\t\tev.stopPropagation();\n\t\t\t\t}\n\n\t\t\t\tutility.prevent(ev);\n\n\t\t\t\treturn ev;\n\t\t\t},\n\n\t\t\t/**\n    * Returns the Event target\n    *\n    * @method target\n    * @memberOf utility\n    * @param  {Object} ev Event\n    * @return {Object}    Event target\n    * @example\n    * let target = keigai.util.target( Event );\n    */\n\t\t\ttarget: function (ev) {\n\t\t\t\treturn ev.target || ev.srcElement;\n\t\t\t},\n\n\t\t\t/**\n    * Generates a version 4 UUID\n    *\n    * @method uuid\n    * @memberOf utility\n    * @param  {Boolean} strip [Optional] Strips - from UUID\n    * @return {String}        UUID\n    * @example\n    * let uuid4 = keigai.util.uuid();\n    */\n\t\t\tuuid: function (strip) {\n\t\t\t\tvar r = [8, 9, \"a\", \"b\"];\n\t\t\t\tvar s = function () {\n\t\t\t\t\treturn ((1 + Math.random()) * 65536 | 0).toString(16).substring(1);\n\t\t\t\t};\n\t\t\t\tvar o = s() + s() + \"-\" + s() + \"-4\" + s().substr(0, 3) + \"-\" + r[Math.floor(Math.random() * 4)] + s().substr(0, 3) + \"-\" + s() + s() + s();\n\n\t\t\t\tif (strip === true) {\n\t\t\t\t\to = o.replace(/-/g, \"\");\n\t\t\t\t}\n\n\t\t\t\treturn o;\n\t\t\t},\n\n\t\t\t/**\n    * Walks `obj` and returns `arg`, for when you can't easily access `arg`\n    *\n    * @method  walk\n    * @memberOf utility\n    * @param  {Mixed}  obj  Object or Array\n    * @param  {String} arg  String describing the property to return\n    * @return {Mixed}       Target or undefined\n    * @example\n    * let obj = {a: [{b: true}]};\n    *\n    * keigai.util.walk( obj, \"a[0].b\" ); // true\n    */\n\t\t\twalk: function (obj, arg) {\n\t\t\t\tvar output = obj;\n\n\t\t\t\tarray.each(arg.replace(/\\]$/, \"\").replace(/\\]/g, \".\").replace(/\\.\\./g, \".\").split(/\\.|\\[/), function (i) {\n\t\t\t\t\tif (output[i] === undefined || output[i] === null) {\n\t\t\t\t\t\toutput = undefined;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\toutput = output[i];\n\t\t\t\t});\n\n\t\t\t\treturn output;\n\t\t\t},\n\n\t\t\t/**\n    * Accepts Deferreds or Promises as arguments, or an Array of either\n    *\n    * @method when\n    * @memberOf utility\n    * @return {Object} {@link keigai.Deferred}\n    * @example\n    * let deferreds = [],\n    *     defer1    = keigai.util.defer(),\n    *     defer2    = keigai.util.defer();\n    *\n    * deferreds.push( defer1 );\n    * deferreds.push( defer2 );\n    *\n    * // Executes when both deferreds have resolved or one has rejected\n    * keigai.util.when( deferreds ).then( ( args ) ) => {\n    *   ...\n    * }, ( err ) => {\n    *   ...\n    * } );\n    *\n    * ...\n    *\n    * defer1.resolve( true );\n    * defer2.resolve( true );\n    */\n\t\t\twhen: function () {\n\t\t\t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\t\t\targs[_key] = arguments[_key];\n\t\t\t\t}\n\n\t\t\t\tvar defer = deferred.factory();\n\n\t\t\t\t// Did we receive an Array? if so it overrides any other arguments\n\t\t\t\tif (args[0] instanceof Array) {\n\t\t\t\t\targs = args[0];\n\t\t\t\t}\n\n\t\t\t\t// None, end on next tick\n\t\t\t\tif (args.length === 0) {\n\t\t\t\t\tdefer.resolve(null);\n\t\t\t\t}\n\t\t\t\t// Setup and wait\n\t\t\t\telse {\n\t\t\t\t\tPromise.all(args).then(function (results) {\n\t\t\t\t\t\tdefer.resolve(results);\n\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn defer;\n\t\t\t},\n\n\t\t\t/**\n    * Worker factory\n    *\n    * @method worker\n    * @memberOf utility\n    * @param  {Object} defer Deferred to receive message from Worker\n    * @return {Object}       Worker\n    * @private\n    */\n\t\t\tworker: function (defer) {\n\t\t\t\tvar obj = new Worker(WORKER);\n\n\t\t\t\tobj.onerror = function (err) {\n\t\t\t\t\tdefer.reject(err);\n\t\t\t\t\tobj.terminate();\n\t\t\t\t};\n\n\t\t\t\tobj.onmessage = function (ev) {\n\t\t\t\t\tdefer.resolve(ev.data);\n\t\t\t\t\tobj.terminate();\n\t\t\t\t};\n\n\t\t\t\treturn obj;\n\t\t\t}\n\t\t};\n\n\t\t/**\n   * XMLHttpRequest shim for node.js\n   *\n   * @method xhr\n   * @private\n   * @return {Object} XMLHttpRequest instance\n   */\n\t\tvar xhr = function () {\n\t\t\tvar UNSENT = 0;\n\t\t\tvar OPENED = 1;\n\t\t\tvar HEADERS_RECEIVED = 2;\n\t\t\tvar LOADING = 3;\n\t\t\tvar DONE = 4;\n\t\t\tvar ERR_REFUSED = /ECONNREFUSED/;\n\t\t\tvar ready = new RegExp(HEADERS_RECEIVED + \"|\" + LOADING);\n\n\t\t\tvar headers = {\n\t\t\t\t\"user-agent\": \"keigai/1.1.5 node.js/\" + process.versions.node.replace(/^v/, \"\") + \" (\" + string.capitalize(process.platform) + \" V8/\" + process.versions.v8 + \" )\",\n\t\t\t\t\"content-type\": \"text/plain\",\n\t\t\t\taccept: \"*/*\"\n\t\t\t};\n\n\t\t\t/**\n    * Dispatches an event\n    *\n    * @method dispatch\n    * @memberOf xhr\n    * @param  {String} arg Event to dispatch\n    * @return {Object}     XMLHttpRequest instance\n    */\n\t\t\tvar dispatch = function (obj, arg) {\n\t\t\t\tvar fn = \"on\" + arg;\n\n\t\t\t\tif (typeof obj[fn] === \"function\") {\n\t\t\t\t\tobj[fn]();\n\t\t\t\t}\n\n\t\t\t\tobj.dispatchEvent(arg);\n\n\t\t\t\treturn obj;\n\t\t\t};\n\n\t\t\t/**\n    * Changes the readyState of an XMLHttpRequest\n    *\n    * @method state\n    * @memberOf xhr\n    * @param  {String} arg New readyState\n    * @return {Object}     XMLHttpRequest instance\n    */\n\t\t\tvar state = function (obj, arg) {\n\t\t\t\tif (obj.readyState !== arg) {\n\t\t\t\t\tobj.readyState = arg;\n\t\t\t\t\tdispatch(obj, \"readystatechange\");\n\n\t\t\t\t\tif (obj.readyState === DONE && !obj._error) {\n\t\t\t\t\t\tdispatch(obj, \"load\");\n\t\t\t\t\t\tdispatch(obj, \"loadend\");\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t};\n\n\t\t\t/**\n    * Response handler\n    *\n    * @method success\n    * @memberOf xhr\n    * @param  {Object} res HTTP(S) Response Object\n    * @return {Undefined}  undefined\n    */\n\t\t\tvar success = function (obj, res) {\n\t\t\t\tstate(obj, HEADERS_RECEIVED);\n\t\t\t\tobj.status = res.statusCode;\n\t\t\t\tobj._resheaders = res.headers;\n\n\t\t\t\tif (obj._resheaders[\"set-cookie\"] && obj._resheaders[\"set-cookie\"] instanceof Array) {\n\t\t\t\t\tobj._resheaders[\"set-cookie\"] = obj._resheaders[\"set-cookie\"].join(\";\");\n\t\t\t\t}\n\n\t\t\t\tres.on(\"data\", function (arg) {\n\t\t\t\t\tres.setEncoding(\"utf8\");\n\n\t\t\t\t\tif (obj._send) {\n\t\t\t\t\t\tif (arg) {\n\t\t\t\t\t\t\tobj.responseText += arg;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstate(obj, LOADING);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tres.on(\"end\", function () {\n\t\t\t\t\tif (obj._send) {\n\t\t\t\t\t\tstate(obj, DONE);\n\t\t\t\t\t\tobj._send = false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t/**\n    * Response error handler\n    *\n    * @method failure\n    * @memberOf xhr\n    * @param  {Object} e Error\n    * @return {Undefined} undefined\n    */\n\t\t\tvar failure = function (obj, e) {\n\t\t\t\tobj.status = ERR_REFUSED.test(e.message) ? 503 : 500;\n\t\t\t\tobj.statusText = \"\";\n\t\t\t\tobj.responseText = e.message;\n\t\t\t\tobj._error = true;\n\t\t\t\tobj._send = false;\n\t\t\t\tdispatch(obj, \"error\");\n\t\t\t\tstate(obj, DONE);\n\t\t\t};\n\n\t\t\tvar XMLHttpRequest = (function (Base) {\n\t\t\t\t/**\n     * Creates a new XMLHttpRequest\n     *\n     * @constructor\n     * @private\n     * @memberOf xhr\n     * @return {Object} XMLHttpRequest instance\n     */\n\t\t\t\tfunction XMLHttpRequest() {\n\t\t\t\t\t_classCallCheck(this, XMLHttpRequest);\n\n\t\t\t\t\tthis.onabort = null;\n\t\t\t\t\tthis.onerror = null;\n\t\t\t\t\tthis.onload = null;\n\t\t\t\t\tthis.onloadend = null;\n\t\t\t\t\tthis.onloadstart = null;\n\t\t\t\t\tthis.onreadystatechange = null;\n\t\t\t\t\tthis.readyState = UNSENT;\n\t\t\t\t\tthis.response = null;\n\t\t\t\t\tthis.responseText = \"\";\n\t\t\t\t\tthis.responseType = \"\";\n\t\t\t\t\tthis.responseXML = null;\n\t\t\t\t\tthis.status = UNSENT;\n\t\t\t\t\tthis.statusText = \"\";\n\t\t\t\t\tthis.observer = observable.factory();\n\n\t\t\t\t\t// Psuedo private for prototype chain\n\t\t\t\t\tthis._error = false;\n\t\t\t\t\tthis._headers = {};\n\t\t\t\t\tthis._params = {};\n\t\t\t\t\tthis._request = null;\n\t\t\t\t\tthis._resheaders = {};\n\t\t\t\t\tthis._send = false;\n\t\t\t\t}\n\n\t\t\t\t_inherits(XMLHttpRequest, Base);\n\n\t\t\t\t_prototypeProperties(XMLHttpRequest, null, {\n\t\t\t\t\tabort: {\n\n\t\t\t\t\t\t/**\n       * Aborts a request\n       *\n       * @method abort\n       * @memberOf XMLHttpRequest\n       * @return {Object} XMLHttpRequest instance\n       */\n\t\t\t\t\t\tvalue: function abort() {\n\t\t\t\t\t\t\tif (this._request !== null) {\n\t\t\t\t\t\t\t\tthis._request.abort();\n\t\t\t\t\t\t\t\tthis._request = null;\n\t\t\t\t\t\t\t\tthis.responseText = \"\";\n\t\t\t\t\t\t\t\tthis.responseXML = \"\";\n\t\t\t\t\t\t\t\tthis._error = true;\n\t\t\t\t\t\t\t\tthis._headers = {};\n\n\t\t\t\t\t\t\t\tif (this._send === true || ready.test(this.readyState)) {\n\t\t\t\t\t\t\t\t\tthis._send = false;\n\t\t\t\t\t\t\t\t\tstate(this, DONE);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tdispatch(this, \"abort\");\n\t\t\t\t\t\t\t\tthis.readyState = UNSENT;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn this;\n\t\t\t\t\t\t},\n\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\tconfigurable: true\n\t\t\t\t\t},\n\t\t\t\t\tgetAllResponseHeaders: {\n\n\t\t\t\t\t\t/**\n       * Gets all response headers\n       *\n       * @method getAllResponseHeaders\n       * @memberOf XMLHttpRequest\n       * @return {Object} Response headers\n       */\n\t\t\t\t\t\tvalue: function getAllResponseHeaders() {\n\t\t\t\t\t\t\tvar result = \"\";\n\n\t\t\t\t\t\t\tif (this.readyState < HEADERS_RECEIVED) {\n\t\t\t\t\t\t\t\tthrow new Error(label.invalidStateNoHeaders);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tutility.iterate(this._resheaders, function (v, k) {\n\t\t\t\t\t\t\t\tresult += k + \": \" + v + \"\\n\";\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\treturn result;\n\t\t\t\t\t\t},\n\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\tconfigurable: true\n\t\t\t\t\t},\n\t\t\t\t\tgetResponseHeader: {\n\n\t\t\t\t\t\t/**\n       * Gets a specific response header\n       *\n       * @method getResponseHeader\n       * @memberOf XMLHttpRequest\n       * @param  {String} header Header to get\n       * @return {String}        Response header value\n       */\n\t\t\t\t\t\tvalue: function getResponseHeader(header) {\n\t\t\t\t\t\t\tif (this.readyState < HEADERS_RECEIVED || this._error) {\n\t\t\t\t\t\t\t\tthrow new Error(label.invalidStateNoHeaders);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn this._resheaders[header] || this._resheaders[header.toLowerCase()];\n\t\t\t\t\t\t},\n\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\tconfigurable: true\n\t\t\t\t\t},\n\t\t\t\t\topen: {\n\n\t\t\t\t\t\t/**\n       * Prepares an XMLHttpRequest instance to make a request\n       *\n       * @method open\n       * @memberOf XMLHttpRequest\n       * @param  {String}  method   HTTP method\n       * @param  {String}  url      URL to receive request\n       * @param  {Boolean} async    [Optional] Asynchronous request\n       * @param  {String}  user     [Optional] Basic auth username\n       * @param  {String}  password [Optional] Basic auth password\n       * @return {Object}           XMLHttpRequest instance\n       */\n\t\t\t\t\t\tvalue: function open(method, url, async, user, password) {\n\t\t\t\t\t\t\tvar self = this;\n\n\t\t\t\t\t\t\tif (async !== true) {\n\t\t\t\t\t\t\t\tthrow new Error(label.invalidStateNoSync);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.abort();\n\t\t\t\t\t\t\tthis._error = false;\n\t\t\t\t\t\t\tthis._params = {\n\t\t\t\t\t\t\t\tmethod: method,\n\t\t\t\t\t\t\t\turl: url,\n\t\t\t\t\t\t\t\tasync: async || true,\n\t\t\t\t\t\t\t\tuser: user || null,\n\t\t\t\t\t\t\t\tpassword: password || null\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tutility.iterate(headers, function (v, k) {\n\t\t\t\t\t\t\t\tself._headers[k] = v;\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tthis.readyState = OPENED;\n\n\t\t\t\t\t\t\treturn this;\n\t\t\t\t\t\t},\n\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\tconfigurable: true\n\t\t\t\t\t},\n\t\t\t\t\toverrideMimeType: {\n\n\t\t\t\t\t\t/**\n       * Overrides the Content-Type of the request\n       *\n       * @method overrideMimeType\n       * @memberOf XMLHttpRequest\n       * @param  {String} mime Mime type of the request ( media type )\n       * @return {Object}      XMLHttpRequest instance\n       */\n\t\t\t\t\t\tvalue: function overrideMimeType(mime) {\n\t\t\t\t\t\t\tthis._headers[\"content-type\"] = mime;\n\n\t\t\t\t\t\t\treturn this;\n\t\t\t\t\t\t},\n\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\tconfigurable: true\n\t\t\t\t\t},\n\t\t\t\t\tsend: {\n\n\t\t\t\t\t\t/**\n       * Sends an XMLHttpRequest request\n       *\n       * @method send\n       * @memberOf XMLHttpRequest\n       * @param  {Mixed} data [Optional] Payload to send with the request\n       * @return {Object}     XMLHttpRequest instance\n       */\n\t\t\t\t\t\tvalue: function send() {\n\t\t\t\t\t\t\tvar data = arguments[0] === undefined ? null : arguments[0];\n\t\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\t\tvar options = undefined,\n\t\t\t\t\t\t\t    parsed = undefined,\n\t\t\t\t\t\t\t    request = undefined,\n\t\t\t\t\t\t\t    obj = undefined;\n\n\t\t\t\t\t\t\tif (this.readyState < OPENED) {\n\t\t\t\t\t\t\t\tthrow new Error(label.invalidStateNotOpen);\n\t\t\t\t\t\t\t} else if (this._send) {\n\t\t\t\t\t\t\t\tthrow new Error(label.invalidStateNotSending);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tparsed = utility.parse(this._params.url);\n\t\t\t\t\t\t\tparsed.port = parsed.port || (parsed.protocol === \"https:\" ? 443 : 80);\n\n\t\t\t\t\t\t\tif (this._params.user !== null && this._params.password !== null) {\n\t\t\t\t\t\t\t\tparsed.auth = this._params.user + \":\" + this._params.password;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Specifying Content-Length accordingly\n\t\t\t\t\t\t\tif (regex.put_post.test(this._params.method)) {\n\t\t\t\t\t\t\t\tif (data === null) {\n\t\t\t\t\t\t\t\t\tthis._headers[\"content-length\"] = 0;\n\t\t\t\t\t\t\t\t} else if (typeof data === \"string\") {\n\t\t\t\t\t\t\t\t\tthis._headers[\"content-length\"] = Buffer.byteLength(data);\n\t\t\t\t\t\t\t\t} else if (data instanceof Buffer || typeof data.toString === \"function\") {\n\t\t\t\t\t\t\t\t\tdata = data.toString();\n\t\t\t\t\t\t\t\t\tthis._headers[\"content-length\"] = Buffer.byteLength(data);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthrow new Error(label.invalidArguments);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis._headers.host = parsed.host;\n\n\t\t\t\t\t\t\tif (this._headers[\"x-requested-with\"] === \"XMLHttpRequest\") {\n\t\t\t\t\t\t\t\tdelete this._headers[\"x-requested-with\"];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\toptions = {\n\t\t\t\t\t\t\t\thostname: parsed.hostname,\n\t\t\t\t\t\t\t\tpath: parsed.path,\n\t\t\t\t\t\t\t\tport: parsed.port,\n\t\t\t\t\t\t\t\tmethod: this._params.method,\n\t\t\t\t\t\t\t\theaders: this._headers\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tif (parsed.protocol === \"https:\") {\n\t\t\t\t\t\t\t\toptions.rejectUnauthorized = false;\n\t\t\t\t\t\t\t\toptions.agent = false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (parsed.auth) {\n\t\t\t\t\t\t\t\toptions.auth = parsed.auth;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis._send = true;\n\t\t\t\t\t\t\tdispatch(this, \"readystatechange\");\n\n\t\t\t\t\t\t\tobj = parsed.protocol === \"http:\" ? http : https;\n\n\t\t\t\t\t\t\trequest = obj.request(options, function (arg) {\n\t\t\t\t\t\t\t\tsuccess(self, arg);\n\t\t\t\t\t\t\t}).on(\"error\", function (e) {\n\t\t\t\t\t\t\t\tfailure(self, e);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tdata === null ? request.setSocketKeepAlive(true) : request.write(data, \"utf8\");\n\t\t\t\t\t\t\tthis._request = request;\n\t\t\t\t\t\t\trequest.end();\n\n\t\t\t\t\t\t\tdispatch(this, \"loadstart\");\n\n\t\t\t\t\t\t\treturn this;\n\t\t\t\t\t\t},\n\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\tconfigurable: true\n\t\t\t\t\t},\n\t\t\t\t\tsetRequestHeader: {\n\n\t\t\t\t\t\t/**\n       * Sets a request header of an XMLHttpRequest instance\n       *\n       * @method setRequestHeader\n       * @memberOf XMLHttpRequest\n       * @param {String} header HTTP header\n       * @param {String} value  Header value\n       * @return {Object}       XMLHttpRequest instance\n       */\n\t\t\t\t\t\tvalue: function setRequestHeader(header, value) {\n\t\t\t\t\t\t\tif (this.readyState !== OPENED) {\n\t\t\t\t\t\t\t\tthrow new Error(label.invalidStateNotUsable);\n\t\t\t\t\t\t\t} else if (this._send) {\n\t\t\t\t\t\t\t\tthrow new Error(label.invalidStateNotSending);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis._headers[header.toLowerCase()] = value;\n\n\t\t\t\t\t\t\treturn this;\n\t\t\t\t\t\t},\n\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\tconfigurable: true\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn XMLHttpRequest;\n\t\t\t})(Base);\n\n\t\t\treturn XMLHttpRequest;\n\t\t};\n\n\t\t/**\n   * WeakMap shim\n   *\n   * @class\n   * @private\n   */\n\t\tvar WeakMapShim = (function () {\n\t\t\tfunction WeakMapShim() {\n\t\t\t\t_classCallCheck(this, WeakMapShim);\n\n\t\t\t\tthis.elements = {};\n\t\t\t}\n\n\t\t\t_prototypeProperties(WeakMapShim, null, {\n\t\t\t\tclear: {\n\t\t\t\t\tvalue: function clear() {\n\t\t\t\t\t\tthis.elements = {};\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\t\"delete\": {\n\t\t\t\t\tvalue: function _delete(arg) {\n\t\t\t\t\t\tdelete this.elements[arg];\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\thas: {\n\t\t\t\t\tvalue: function has(arg) {\n\t\t\t\t\t\treturn this.elements[arg] !== undefined;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tget: {\n\t\t\t\t\tvalue: function get(arg) {\n\t\t\t\t\t\treturn this.has(arg) ? this.elements[arg].value : undefined;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t},\n\t\t\t\tset: {\n\t\t\t\t\tvalue: function set(arg, value) {\n\t\t\t\t\t\tthis.elements[arg] = { value: value };\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t},\n\t\t\t\t\twritable: true,\n\t\t\t\t\tconfigurable: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn WeakMapShim;\n\t\t})();\n\n\t\t/**\n   * @namespace xml\n   * @private\n   */\n\t\tvar xml = {\n\t\t\t/**\n    * Returns XML (Document) Object from a String\n    *\n    * @method decode\n    * @memberOf xml\n    * @param  {String} arg XML String\n    * @return {Object}     XML Object or undefined\n    */\n\t\t\tdecode: function (arg) {\n\t\t\t\treturn new DOMParser().parseFromString(arg, \"text/xml\");\n\t\t\t},\n\n\t\t\t/**\n    * Returns XML String from an Object or Array\n    *\n    * @method encode\n    * @memberOf xml\n    * @param  {Mixed} arg Object or Array to cast to XML String\n    * @return {String}    XML String or undefined\n    */\n\t\t\tencode: function (arg) {\n\t\t\t\tvar wrap = arguments[1] === undefined ? true : arguments[1];\n\t\t\t\tvar top = arguments[2] === undefined ? true : arguments[2];\n\t\t\t\ttry {\n\t\t\t\t\tvar _ret = (function () {\n\t\t\t\t\t\tvar x = wrap ? \"<xml>\" : \"\";\n\n\t\t\t\t\t\t/**\n       * Encodes a value as a node\n       *\n       * @method node\n       * @memberOf xml.encode\n       * @private\n       * @param  {String} name  Node name\n       * @param  {String} value Node value\n       * @return {String}       Node\n       */\n\t\t\t\t\t\tvar node = function (name, value) {\n\t\t\t\t\t\t\tvar output = \"<n>v</n>\";\n\n\t\t\t\t\t\t\toutput = output.replace(\"v\", regex.cdata.test(value) ? \"<![CDATA[\" + value + \"]]>\" : value);\n\t\t\t\t\t\t\treturn output.replace(/<(\\/)?n>/g, \"<$1\" + name + \">\");\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (arg !== null && arg.xml) {\n\t\t\t\t\t\t\targ = arg.xml;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (arg instanceof Document) {\n\t\t\t\t\t\t\targ = new XMLSerializer().serializeToString(arg);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (regex.boolean_number_string.test(typeof arg)) {\n\t\t\t\t\t\t\tx += node(\"item\", arg);\n\t\t\t\t\t\t} else if (typeof arg === \"object\") {\n\t\t\t\t\t\t\tutility.iterate(arg, function (v, k) {\n\t\t\t\t\t\t\t\tx += xml.encode(v, typeof v === \"object\", false).replace(/item|xml/g, isNaN(k) ? k : \"item\");\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tx += wrap ? \"</xml>\" : \"\";\n\n\t\t\t\t\t\tif (top) {\n\t\t\t\t\t\t\tx = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF8\\\"?>\" + x;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tv: x\n\t\t\t\t\t\t};\n\t\t\t\t\t})();\n\n\t\t\t\t\tif (typeof _ret === \"object\") return _ret.v;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tutility.error(e, [arg, wrap, top], undefined);\n\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n    * Validates `arg` is XML\n    *\n    * @method valid\n    * @memberOf xml\n    * @param  {String} arg String to validate\n    * @return {Boolean}    `true` if valid XML\n    */\n\t\t\tvalid: function (arg) {\n\t\t\t\treturn xml.decode(arg).getElementsByTagName(\"parsererror\").length === 0;\n\t\t\t}\n\t\t};\n\n\t\t/**\n   * Bootstraps environment\n   *\n   * @method bootstrap\n   * @private\n   * @return {Undefined} undefined\n   */\n\t\tvar bootstrap = function () {\n\t\t\tvar defineProperty = Object.defineProperty !== undefined;\n\t\t\tvar target = undefined;\n\n\t\t\t// ES6 Array shims\n\t\t\tArray.from = Array.from || function (arg) {\n\t\t\t\treturn [].slice.call(arg);\n\t\t\t};\n\t\t\tArray.keys = Array.keys || function (arg) {\n\t\t\t\treturn Object.keys(arg);\n\t\t\t};\n\n\t\t\t// Describing the Client\n\t\t\tif (!server) {\n\t\t\t\tclient.version = client.version();\n\n\t\t\t\tif (client.ie) {\n\t\t\t\t\t(function () {\n\t\t\t\t\t\t// IE8 and older is not supported\n\t\t\t\t\t\tif (client.version < 9) {\n\t\t\t\t\t\t\tthrow new Error(label.upgrade);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttarget = (global.HTMLElement || global.Element).prototype;\n\n\t\t\t\t\t\tvar ClassList = (function (Array) {\n\t\t\t\t\t\t\tfunction ClassList(obj) {\n\t\t\t\t\t\t\t\t_classCallCheck(this, ClassList);\n\n\t\t\t\t\t\t\t\tvar classes = string.explode(obj.className || \"\", \" \");\n\t\t\t\t\t\t\t\tvar self = this;\n\n\t\t\t\t\t\t\t\tarray.each(classes, function (i) {\n\t\t\t\t\t\t\t\t\tself.push(i);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t_inherits(ClassList, Array);\n\n\t\t\t\t\t\t\t_prototypeProperties(ClassList, null, {\n\t\t\t\t\t\t\t\tadd: {\n\t\t\t\t\t\t\t\t\tvalue: function add(arg) {\n\t\t\t\t\t\t\t\t\t\tif (!array.contains(this, arg)) {\n\t\t\t\t\t\t\t\t\t\t\tthis.push(arg);\n\t\t\t\t\t\t\t\t\t\t\tthis.updateClassName();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\t\t\t\tconfigurable: true\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcontains: {\n\t\t\t\t\t\t\t\t\tvalue: function contains(arg) {\n\t\t\t\t\t\t\t\t\t\treturn array.contains(this, arg);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\t\t\t\tconfigurable: true\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tremove: {\n\t\t\t\t\t\t\t\t\tvalue: function remove(arg) {\n\t\t\t\t\t\t\t\t\t\tif (array.contains(this, arg)) {\n\t\t\t\t\t\t\t\t\t\t\tarray.remove(this, arg);\n\t\t\t\t\t\t\t\t\t\t\tthis.updateClassName();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\t\t\t\tconfigurable: true\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\ttoggle: {\n\t\t\t\t\t\t\t\t\tvalue: function toggle(arg) {\n\t\t\t\t\t\t\t\t\t\tarray[array.contains(this, arg) ? \"remove\" : \"add\"](this, arg);\n\t\t\t\t\t\t\t\t\t\tthis.updateClassName();\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\t\t\t\tconfigurable: true\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tupdateClassName: {\n\t\t\t\t\t\t\t\t\tvalue: function updateClassName() {\n\t\t\t\t\t\t\t\t\t\tthis.className = this.join(\" \");\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\twritable: true,\n\t\t\t\t\t\t\t\t\tconfigurable: true\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\treturn ClassList;\n\t\t\t\t\t\t})(Array);\n\n\t\t\t\t\t\tif (!\"classList\" in target) {\n\t\t\t\t\t\t\tif (defineProperty) {\n\t\t\t\t\t\t\t\tObject.defineProperty(target, \"classList\", {\n\t\t\t\t\t\t\t\t\tget: function () {\n\t\t\t\t\t\t\t\t\t\treturn new ClassList(undefined);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tenumerable: true,\n\t\t\t\t\t\t\t\t\tconfigurable: true\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else if (Object.prototype.__defineGetter__) {\n\t\t\t\t\t\t\t\ttarget.__defineGetter__(\"classList\", function () {\n\t\t\t\t\t\t\t\t\treturn new ClassList(undefined);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthrow new Error(\"Could not create classList shim\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!\"getElementsByClassName\" in Element) {\n\t\t\t\t\t\t\tif (defineProperty) {\n\t\t\t\t\t\t\t\tObject.defineProperty(Element, \"getElementsByClassName\", {\n\t\t\t\t\t\t\t\t\tget: function (arg) {\n\t\t\t\t\t\t\t\t\t\treturn undefined.querySelectorAll(\".\" + arg);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tenumerable: true,\n\t\t\t\t\t\t\t\t\tconfigurable: true\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else if (Object.prototype.__defineGetter__) {\n\t\t\t\t\t\t\t\ttarget.__defineGetter__(\"getElementsByClassName\", function (arg) {\n\t\t\t\t\t\t\t\t\treturn undefined.querySelectorAll(\".\" + arg);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthrow new Error(\"Could not create getElementsByClassName shim\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// XHR shim\n\t\t\t\tXMLHttpRequest = xhr();\n\t\t\t}\n\n\t\t\t// WeakMap shim for client & server\n\t\t\tif (WeakMap === null) {\n\t\t\t\tWeakMap = WeakMapShim;\n\t\t\t}\n\n\t\t\t// DataStore Worker \"script\"\n\t\t\tif (webWorker) {\n\t\t\t\tWORKER = global.URL.createObjectURL(utility.blob(\"var \" + string.fromObject(array, \"array\") + \", \" + string.fromObject(regex, \"regex\") + \", \" + string.fromObject(string, \"string\") + \", \" + string.fromObject(utility, \"utility\") + \"; onmessage = \" + store.worker.toString() + \";\"));\n\t\t\t}\n\n\t\t\tTIME = new Date().getTime();\n\n\t\t\t// Setting up `utility.render()`\n\t\t\tRENDER = global.requestAnimationFrame || function (fn) {\n\t\t\t\tvar offset = new Date().getTime() - TIME;\n\n\t\t\t\tutility.defer(function () {\n\t\t\t\t\tfn(offset);\n\t\t\t\t}, 16, offset);\n\t\t\t};\n\t\t};\n\n\t\t// Bootstrapping\n\t\tbootstrap();\n\n\t\t// Interface\n\t\treturn {\n\t\t\tfilter: filter.factory,\n\t\t\tlist: list.factory,\n\t\t\tgrid: grid.factory,\n\t\t\tstore: store.factory,\n\t\t\tutil: {\n\t\t\t\t$: utility.$,\n\t\t\t\tarray: array,\n\t\t\t\tbase: utility.base,\n\t\t\t\tclearTimers: utility.clearTimers,\n\t\t\t\tclone: utility.clone,\n\t\t\t\tcoerce: utility.coerce,\n\t\t\t\tcurry: utility.curry,\n\t\t\t\tcsv: csv,\n\t\t\t\tdefer: deferred.factory,\n\t\t\t\tdelay: utility.defer,\n\t\t\t\telement: element,\n\t\t\t\textend: utility.extend,\n\t\t\t\tgenId: utility.genId,\n\t\t\t\titerate: utility.iterate,\n\t\t\t\tjson: json,\n\t\t\t\tjsonp: client.jsonp,\n\t\t\t\tlog: utility.log,\n\t\t\t\tlru: lru.factory,\n\t\t\t\tmath: math,\n\t\t\t\tmerge: utility.merge,\n\t\t\t\tnumber: number,\n\t\t\t\tobserver: observable.factory,\n\t\t\t\tparse: utility.parse,\n\t\t\t\tpartial: utility.partial,\n\t\t\t\tprevent: utility.prevent,\n\t\t\t\trace: utility.race,\n\t\t\t\trender: utility.render,\n\t\t\t\trepeat: utility.repeat,\n\t\t\t\trequest: client.request,\n\t\t\t\tstop: utility.stop,\n\t\t\t\tstring: string,\n\t\t\t\ttarget: utility.target,\n\t\t\t\tuuid: utility.uuid,\n\t\t\t\twalk: utility.walk,\n\t\t\t\twhen: utility.when\n\t\t\t},\n\t\t\tversion: \"1.1.5\"\n\t\t};\n\t})();\n\n\t// Node, AMD & window supported\n\tif (typeof exports != \"undefined\") {\n\t\tmodule.exports = lib;\n\t} else if (typeof define === \"function\") {\n\t\tdefine(function () {\n\t\t\treturn lib;\n\t\t});\n\t} else {\n\t\tglobal.keigai = lib;\n\t}\n})(typeof global != \"undefined\" ? global : window);"]}