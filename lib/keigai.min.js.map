{"version":3,"file":"keigai.min.js","sources":["keigai.js"],"names":["_get","get","object","property","receiver","desc","Object","getOwnPropertyDescriptor","undefined","parent","getPrototypeOf","value","getter","call","_inherits","subClass","superClass","TypeError","prototype","create","constructor","enumerable","writable","configurable","__proto__","_classCallCheck","instance","Constructor","_createClass","defineProperties","target","props","i","length","descriptor","defineProperty","key","protoProps","staticProps","global","document","location","navigator","server","process","mutation","MutationObserver","MAX","VERSIONS","CACHE","EVENTS","Buffer","Promise","localStorage","XMLHttpRequest","WeakMap","btoa","webWorker","Blob","Worker","external","http","https","mongodb","url","RENDER","TIME","WORKER","require","MongoClient","lib","regex","after_space","allow","allow_cors","and","args","auth","bool","boolean_number_string","caps","cdata","checked_disabled","complete_loaded","csv_quote","del","domain","down","endslash","eol_nl","element_update","get_headers","get_remove_set","hash","header_replace","header_value_replace","html","http_body","http_ports","host","ie","ip","is_xml","json_maybe","json_wrap","klass","no","not_dotnotation","not_endpoint","null_undefined","number","number_format_1","number_format_2","number_present","number_string","number_string_object","object_type","patch","primitive","priv","protocol","put_post","radio_checkbox","root","select","selector_is","selector_complex","set_del","space_hyphen","string_object","svg","top_bottom","word","xdomainrequest","xml","LRU","max","arguments","this","cache","first","last","remove","item","set","previous","next","LRUItem","evict","lru","factory","Observable","arg","limit","listeners","hooks","ev","_len","Array","_key","utility","iterate","handler","apply","scope","_this2","addEventListener","Error","label","invalidArguments","obj","dispatch","id","uuid","array","keys","_this3","on","_len2","_key2","off","removeEventListener","observable","Base","observer","listener","_len3","_key3","_len4","_key4","_len5","_key5","_len6","_key6","hook","once","add","contains","push","binIndex","min","idx","val","Math","floor","cast","o","isNaN","from","chunk","size","result","nth","round","start","clear","clone","shallow","indexOf","collect","fn","map","compact","diff","filter","test","count","obj1","obj2","concat","each","async","offset","repeat","eachReverse","empty","equal","JSON","stringify","fill","l","flat","reduce","a","b","forEach","fromObject","mingle","index","indexed","v","intersect","itr","iterator","done","n","keepIf","keySort","query","sub","replace","queries","string","explode","split","sorts","braceS","braceE","s","e","sort","Function","join","sorted","mean","sum","median","dupe","mid","odd","merge","mode","values","k","parse","range","rassoc","reject","end","remaining","slice","removeIf","removeWhile","rest","rindex","rotate","series","ceil","types","c","d","toString","divisor","total","low","lower","lowered","stddev","sqrt","variance","prev","cur","take","toObject","ar","unique","math","sqr","zip","x","expire","uri","expired","expires","Date","getTime","headers","href","request_headers","permission","KXMLHttpRequest","_Base","xhr","_this4","defer","deferred","always","fail","resolve","success","failure","then","client","ab","ArrayBuffer","blob","doc","Document","userAgent","version","trim","allows","verb","toLowerCase","bit","Boolean","permissions","cors","type","getAllResponseHeaders","items","cachable","header","setSeconds","getSeconds","exec","timestamp","isEmpty","responseText","json","decode","csv","overrideMimeType","responseXML","valid","cached","partial","read","write","delete","unknown","jsonp","callback","cbid","keigai","genId","clearTimers","element","destroy","src","dom","requestTimeout","kxhr","request","XDomainRequest","payload","contentType","notAvailable","state","readyState","status","methodNotAllowed","delay","_resheaders","response","open","toUpperCase","hasOwnProperty","encode","etag","setRequestHeader","withCredentials","xdr","shared","r","t","redirect","serverError","isUrl","Location","serverUnauthorized","serverForbidden","serverInvalidMethod","send","scroll","dest","ms","scrollPos","pos","bezier","window","scrollTo","scrollX","scrollY","delimiter","RegExp","rows","shift","row","coerce","prepare","input","output","DataListFilter","_Base2","list","debounce","filters","fields","_this5","unhook","_this6","escape","pageIndex","refresh","ref","attr","update","DataGrid","_Base3","store","sortable","options","filtered","sortOrder","order","class","record","_this7","error","dump","records","_this8","find","data","where","_this9","field","stop","hasClass","splice","teardown","_this10","grid","template","width","css","trimmed","el","innerHTML","capitalize","unCamelCase","unhyphenate","style","data-field","addClass","parentNode","listFiltered","listFilter","currentTarget","_len7","_key7","_len8","_key8","_len9","_key9","DataList","_Base4","current","emptyMsg","noData","pageSize","pageRange","pagination","placeholder","_this11","_this12","page","pages","more","data-page","removeClass","_this13","reg","registry","ceiling","match","walk","compile","li","render","callbacks","childNodes","reverse","$","_this14","_this15","lists","_this16","nodeName","observe","childList","subtree","loaded","Deferred","_this17","promise","onDone","onAlways","onFail","appendTo","child","appendChild","namespaceURI","getAttributeNS","setAttributeNS","selected","removeAttribute","setAttribute","getAttribute","reset","frag","fragment","body","createElementNS","createElement","prependChild","after","insertBefore","nextSibling","before","toCamelCase","removeChild","disable","disabled","bubbles","cancelable","CustomEvent","createEvent","initCustomEvent","dispatchEvent","enable","querySelectorAll","createDocumentFragment","has","classList","hidden","display","is","position","left","top","right","bottom","height","offsetWidth","offsetHeight","offsetParent","offsetTop","offsetLeft","removeAttr","removeAttributeNS","serialize","children","elements","name","encodeURIComponent","paddingLeft","paddingRight","borderLeft","borderRight","paddingTop","paddingBottom","borderTop","borderBottom","text","textContent","toggleClass","toggle","expectedProperty","checked","innerText","silent","expectedNumber","expectedObject","invalidStateNoHeaders","invalidStateNoSync","invalidStateNotOpen","invalidStateNotSending","invalidStateNotUsable","datastoreNoPrevVersion","upgrade","_len10","_key10","pop","P","S0","Q0","Q1","Q2","C0","C1","C2","C3","pow","dist","num1","num2","abs","even","format","every","p","charAt","substring","half","base","parseFloat","parseInt","random","direction","toFixed","pCatch","pResolve","pReject","pThen","_len11","_key11","_len12","_key12","catch","DataStore","_Base5","autosave","credentials","events","Accept","ignore","indexes","source","versions","versioning","views","_this18","sync","deferreds","when","reindex","save","parsed","pathname","resave","_this19","batch","delComplete","buildUri","_this20","purge","_this21","custom","f","Number","_this22","_join","_x","_x2","_this23","results","databaseMoreThanOne","storage","_this24","tmp","setIndexes","_this25","functions","clauses","cond","worker","postMessage","cmd","b1","_this26","overwrite","method","odata","rdefer","ogdata","ndata","op","path","setComplete","change","_this27","setExpires","_this28","delimter","kdx","_this29","authorization","Authorization","decodeURIComponent","_this30","view","_this31","self","mongo","session","sessionStorage","connect","db","close","collection","_id","toArray","recs","rec","safe","w","upsert","defer2","getItem","removeItem","setItem","_this32","recordUri","all","hyphenate","camel","isBoolean","isNumber","singular","toFunction","uncapitalize","timer","banner","console","log","BlobBuilder","MSBlobBuilder","WebKitBlobBuilder","MozBlobBuilder","append","getBlob","clearTimeout","extend","pattern","modifiers","curry","_len13","_key13","cfn","_len14","y","_key14","setTimeout","setImmediate","nextTick","getElementById","getElementsByClassName","getElementsByTagName","domId","warning","message","stack","toUTCString","String","msg","toLocaleTimeString","hostname","port","search","queryString","_len15","_key15","_len16","args2","_key16","prevent","preventDefault","qstring","aresult","prop","aitem","race","_len17","_key17","now","recursive","stopPropagation","srcElement","strip","substr","_len18","_key18","onerror","err","terminate","onmessage","UNSENT","OPENED","HEADERS_RECEIVED","LOADING","DONE","ERR_REFUSED","ready","user-agent","node","platform","v8","content-type","accept","_error","res","statusCode","setEncoding","_send","statusText","_Base6","onabort","onload","onloadend","onloadstart","onreadystatechange","responseType","_headers","_params","_request","abort","user","password","_this33","mime","_this34","byteLength","rejectUnauthorized","agent","setSocketKeepAlive","WeakMapShim","DOMParser","parseFromString","wrap","XMLSerializer","serializeToString","bootstrap","URL","createObjectURL","requestAnimationFrame","util","exports","module","define"],"mappings":";;;;;;;;;;;AAAA,YAEA,IAAIA,MAAO,QAASC,GAAIC,EAAQC,EAAUC,GAAY,GAAIC,GAAOC,OAAOC,yBAAyBL,EAAQC,EAAW,IAAaK,SAATH,EAAoB,CAAE,GAAII,GAASH,OAAOI,eAAeR,EAAS,OAAe,QAAXO,EAA0BD,OAA2BP,EAAIQ,EAAQN,EAAUC,GAAoB,GAAI,SAAWC,GAAQ,MAAOA,GAAKM,KAAgB,IAAIC,GAASP,EAAKJ,GAAK,OAAeO,UAAXI,EAA+BJ,OAAoBI,EAAOC,KAAKT,IAEtaU,UAAY,SAAUC,EAAUC,GAAc,GAA0B,kBAAfA,IAA4C,OAAfA,EAAuB,KAAM,IAAIC,WAAU,iEAAoED,GAAeD,GAASG,UAAYZ,OAAOa,OAAOH,GAAcA,EAAWE,WAAaE,aAAeT,MAAOI,EAAUM,YAAY,EAAOC,UAAU,EAAMC,cAAc,KAAeP,IAAYD,EAASS,UAAYR,IAE9ZS,gBAAkB,SAAUC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIV,WAAU,sCAEnHW,aAAe,WAAe,QAASC,GAAiBC,EAAQC,GAAS,IAAK,GAAIC,GAAI,EAAGA,EAAID,EAAME,OAAQD,IAAK,CAAE,GAAIE,GAAaH,EAAMC,EAAIE,GAAWb,WAAaa,EAAWb,aAAc,EAAOa,EAAWX,cAAe,EAAU,SAAWW,KAAYA,EAAWZ,UAAW,GAAMhB,OAAO6B,eAAeL,EAAQI,EAAWE,IAAKF,IAAiB,MAAO,UAAUP,EAAaU,EAAYC,GAAiJ,MAA9HD,IAAYR,EAAiBF,EAAYT,UAAWmB,GAAiBC,GAAaT,EAAiBF,EAAaW,GAAqBX,OAYjiB,SAAWY,GACV,GAAIC,GAAWD,EAAOC,SAClBC,EAAWF,EAAOE,aAClBC,EAAYH,EAAOG,UACnBC,EAA4B,mBAAZC,SAChBC,EAAuC,kBAArBC,kBAClBC,EAAM,GACNC,EAAW,IACXC,EAAQ,IACRC,GAAU,mBAAoB,QAAS,OAAQ,YAAa,UAAW,QAAS,WAAY,WAE5FC,EAAS,aACTC,EAAUb,EAAOa,SAAW5C,OAC5B6C,EAAed,EAAOc,cAAgB7C,OACtC8C,EAAiBf,EAAOe,gBAAkB,KAC1CC,EAAUhB,EAAOgB,SAAW,KAC5BC,EAAOjB,EAAOiB,MAAQhD,OACtBiD,EAA4B,mBAATC,OAA0C,mBAAXC,QAClDC,EAAWpD,OACXqD,EAAOrD,OACPsD,EAAQtD,OACRuD,EAAUvD,OACVwD,EAAMxD,OACNyD,EAASzD,OACT0D,EAAO1D,OACP2D,EAAS3D,MAETmC,KACHqB,EAAMI,QAAQ,OACdP,EAAOO,QAAQ,QACfN,EAAQM,QAAQ,SAChBL,EAAUK,QAAQ,WAAWC,YAC7BlB,EAASiB,QAAQ,UAAUjB,OAEJ,mBAAZC,KACVA,EAAUgB,QAAQ,eAAehB,SAGN,mBAAjBC,KACVA,EAAee,QAAQ,iBAGJ,mBAATZ,KACVA,EAAOY,QAAQ,SAIjB,IAAIE,GAAM,WAWT,GAAIC,QACHC,YAAa,QACbC,MAAO,WACPC,WAAY,kCACZC,IAAK,KACLC,KAAM,WACNC,KAAM,aACNC,KAAM,kBACNC,sBAAuB,wBACvBC,KAAM,QACNC,MAAO,8BACPC,iBAAkB,oBAClBC,gBAAiB,uBACjBC,UAAW,kBACXC,IAAK,OACLC,OAAQ,2BACRC,KAAM,OACNC,SAAU,MACVC,OAAQ,MACRC,eAAgB,8CAChBC,YAAa,uBACbC,eAAgB,iBAChBC,KAAM,MACNC,eAAgB,MAChBC,qBAAsB,SACtBC,KAAM,SACNC,UAAW,sBACXC,WAAY,SACZC,KAAM,aACNC,GAAI,6BACJC,GAAI,8FACJC,OAAQ,eACRC,WAAY,wBACZC,UAAW,UACXC,MAAO,MACPC,GAAI,qBACJC,gBAAiB,OACjBC,aAAc,OACdC,eAAgB,iBAChBC,OAAQ,oDACRC,gBAAiB,OACjBC,gBAAiB,OACjBC,eAAgB,SAChBC,cAAe,iBACfC,qBAAsB,wBACtBC,YAAa,oBACbC,MAAO,UACPC,UAAW,qCACXC,KAAM,UACNC,SAAU,YACVC,SAAU,gBACVC,eAAgB,sBAChBC,KAAM,WACNC,OAAQ,UACRC,YAAa,KACbC,iBAAkB,qBAClBC,QAAS,qBACTC,aAAc,OACdC,cAAe,iBACfC,IAAK,MACLC,WAAY,cACZnE,IAAK,oeACLoE,KAAM,QACNC,eAAgB,gBAChBC,IAAK,QAGFC,EAAM,WAWT,QAASA,KACR,GAAIC,GAAuBhI,SAAjBiI,UAAU,GAAmB,IAAOA,UAAU,EAExDhH,iBAAgBiH,KAAMH,GAEtBG,KAAKC,SACLD,KAAKF,IAAMA,EACXE,KAAKE,MAAQ,KACbF,KAAKG,KAAO,KACZH,KAAKzG,OAAS,EAmIf,MAhIAL,cAAa2G,IACZnG,IAAK,QAWLzB,MAAO,WAKN,MAJkB,QAAd+H,KAAKG,MACRH,KAAKI,OAAOJ,KAAKG,MAGXH,QAGRtG,IAAK,MAYLzB,MAAO,SAAayB,GACnB,GAAI2G,GAAOL,KAAKC,MAAMvG,EAEtB,IAAa5B,SAATuI,EAMJ,MAFAL,MAAKM,IAAI5G,EAAK2G,EAAKpI,OAEZoI,EAAKpI,SAGbyB,IAAK,SAYLzB,MAAO,SAAgByB,GACtB,GAAI2G,GAAOL,KAAKC,MAAMvG,EAwBtB,OAtBI2G,WACIL,MAAKC,MAAMvG,GAElBsG,KAAKzG,SAEiB,OAAlB8G,EAAKE,WACRP,KAAKC,MAAMI,EAAKE,UAAUC,KAAOH,EAAKG,MAGrB,OAAdH,EAAKG,OACRR,KAAKC,MAAMI,EAAKG,MAAMD,SAAWF,EAAKE,UAGnCP,KAAKE,QAAUxG,IAClBsG,KAAKE,MAAQG,EAAKE,UAGfP,KAAKG,OAASzG,IACjBsG,KAAKG,KAAOE,EAAKG,OAIZH,KAGR3G,IAAK,MAaLzB,MAAO,SAAayB,EAAKzB,GACxB,GAAIoI,GAAOL,KAAKI,OAAO1G,EA0BvB,OAxBa5B,UAATuI,EACHA,EAAO,GAAII,GAAQxI,GAEnBoI,EAAKpI,MAAQA,EAGdoI,EAAKG,KAAO,KACZH,EAAKE,SAAWP,KAAKE,MACrBF,KAAKC,MAAMvG,GAAO2G,EAEC,OAAfL,KAAKE,QACRF,KAAKC,MAAMD,KAAKE,OAAOM,KAAO9G,GAG/BsG,KAAKE,MAAQxG,EAEK,OAAdsG,KAAKG,OACRH,KAAKG,KAAOzG,KAGPsG,KAAKzG,OAASyG,KAAKF,KACxBE,KAAKU,QAGCV,SAIFH,KAYJY,EAAU,QAASA,IAAQxI,GAC9Bc,gBAAgBiH,KAAMS,IAEtBT,KAAKQ,KAAO,KACZR,KAAKO,SAAW,KAChBP,KAAK/H,MAAQA,GAMV0I,GAUHC,QAAS,SAAiBd,GACzB,MAAO,IAAID,GAAIC,KAIbe,EAAa,WAWhB,QAASA,KACR,GAAIC,GAAuBhJ,SAAjBiI,UAAU,GAAmB1F,EAAM0F,UAAU,EAEvDhH,iBAAgBiH,KAAMa,GAEtBb,KAAKe,MAAQD,EACbd,KAAKgB,aACLhB,KAAKiB,MAAQ,GAAIpG,GA0LlB,MAvLA3B,cAAa2H,IACZnH,IAAK,WAWLzB,MAAO,SAAkBiJ,GACxB,IAAK,GAAIC,GAAOpB,UAAUxG,OAAQ2C,EAAOkF,MAAMD,EAAO,EAAIA,EAAO,EAAI,GAAIE,EAAO,EAAUF,EAAPE,EAAaA,IAC/FnF,EAAKmF,EAAO,GAAKtB,UAAUsB,EAS5B,OANIH,IAAMlB,KAAKgB,UAAUE,IACxBI,QAAQC,QAAQvB,KAAKgB,UAAUE,GAAK,SAAU5H,GAC7CA,EAAEkI,QAAQC,MAAMnI,EAAEoI,MAAOxF,KAIpB8D,QAGRtG,IAAK,OAaLzB,MAAO,SAAcmB,EAAQ8H,GAC5B,GAAIS,GAAS3B,IAEb,IAAuC,kBAA5B5G,GAAOwI,iBACjB,KAAM,IAAIC,OAAMC,EAAMC,iBAGvB,IAAIC,GAAMhC,KAAKiB,MAAM1J,IAAI6B,MASzB,OAPA4I,GAAId,GAAM,SAAUJ,GACnBa,EAAOM,SAASf,EAAIJ,IAGrBd,KAAKiB,MAAMX,IAAIlH,EAAQ4I,GACvB5I,EAAOwI,iBAAiBV,EAAIlB,KAAKiB,MAAM1J,IAAI6B,GAAQ8H,IAAK,GAEjD9H,KAGRM,IAAK,MAaLzB,MAAO,SAAaiJ,EAAIgB,GASvB,MARIlC,MAAKgB,UAAUE,KACdgB,QACIlC,MAAKgB,UAAUE,GAAIgB,SAEnBlC,MAAKgB,UAAUE,IAIjBlB,QAGRtG,IAAK,KAiBLzB,MAAO,SAAYiJ,EAAIM,GACtB,GAAIU,GAAsBpK,SAAjBiI,UAAU,GAAmBuB,QAAQa,OAASpC,UAAU,GAC7D2B,EAAyB5J,SAAjBiI,UAAU,GAAmBjI,OAAYiI,UAAU,EAM/D,IAJKC,KAAKgB,UAAUE,KACnBlB,KAAKgB,UAAUE,OAGZkB,MAAMC,KAAKrC,KAAKgB,UAAUE,IAAK3H,QAAUyG,KAAKe,MACjD,KAAM,IAAIc,OAAM,mCAAqC7B,KAAKe,MAAQ,yBAA2BG,EAK9F,OAFAlB,MAAKgB,UAAUE,GAAIgB,IAAQR,MAAOA,GAAS1B,KAAMwB,QAASA,GAEnDxB,QAGRtG,IAAK,OAiBLzB,MAAO,SAAciJ,EAAIM,GACxB,GAAIc,GAAStC,KAETkC,EAAsBpK,SAAjBiI,UAAU,GAAmBuB,QAAQa,OAASpC,UAAU,GAC7D2B,EAAyB5J,SAAjBiI,UAAU,GAAmBjI,OAAYiI,UAAU,EAI/D,OAFA2B,GAAQA,GAAS1B,KAEVA,KAAKuC,GAAGrB,EAAI,WAClB,IAAK,GAAIsB,GAAQzC,UAAUxG,OAAQ2C,EAAOkF,MAAMoB,GAAQC,EAAQ,EAAWD,EAARC,EAAeA,IACjFvG,EAAKuG,GAAS1C,UAAU0C,EAGzBjB,GAAQC,MAAMC,EAAOxF,GACrBoG,EAAOI,IAAIxB,EAAIgB,IACbA,EAAIR,MAGRhI,IAAK,SAaLzB,MAAO,SAAgBmB,EAAQ8H,GAC9B,GAAIc,GAAMhC,KAAKiB,MAAM1J,IAAI6B,EAazB,OAXI4I,KACH5I,EAAOuJ,oBAAoBzB,EAAIc,EAAId,IAAK,SACjCc,GAAId,GAEoB,IAA3BkB,MAAMC,KAAKL,GAAKzI,OACnByG,KAAKiB,MAAM,UAAU7H,GAErB4G,KAAKiB,MAAMX,IAAIlH,EAAQ4I,IAIlB5I,MAIFyH,KAYJ+B,EAAa,SAAoB9B,GACpC,MAAO,IAAID,GAAWC,IAGnB+B,EAAO,WAQV,QAASA,KACR9J,gBAAgBiH,KAAM6C,GAQtB7C,KAAK8C,SAAW,KAgQjB,MA7PA5J,cAAa2J,IACZnJ,IAAK,mBAiBLzB,MAAO,SAA0BiJ,EAAI6B,EAAUb,EAAIR,GAGlD,MAFA1B,MAAK8C,SAASP,GAAGrB,EAAI6B,EAAUb,EAAIR,GAAS1B,MAErCA,QAGRtG,IAAK,cAiBLzB,MAAO,SAAqBiJ,EAAI6B,EAAUb,EAAIR,GAG7C,MAFA1B,MAAK8C,SAASP,GAAGrB,EAAI6B,EAAUb,EAAIR,GAAS1B,MAErCA,QAGRtG,IAAK,WAWLzB,MAAO,WACN,IAAK,GAAI+K,GAAQjD,UAAUxG,OAAQ2C,EAAOkF,MAAM4B,GAAQC,EAAQ,EAAWD,EAARC,EAAeA,IACjF/G,EAAK+G,GAASlD,UAAUkD,EAKzB,OAFAjD,MAAK8C,SAASb,SAASR,MAAMzB,KAAK8C,SAAU5G,GAErC8D,QAGRtG,IAAK,gBAWLzB,MAAO,WACN,IAAK,GAAIiL,GAAQnD,UAAUxG,OAAQ2C,EAAOkF,MAAM8B,GAAQC,EAAQ,EAAWD,EAARC,EAAeA,IACjFjH,EAAKiH,GAASpD,UAAUoD,EAKzB,OAFAnD,MAAK8C,SAASb,SAASR,MAAMzB,KAAK8C,SAAU5G,GAErC8D,QAGRtG,IAAK,OAWLzB,MAAO,WACN,IAAK,GAAImL,GAAQrD,UAAUxG,OAAQ2C,EAAOkF,MAAMgC,GAAQC,EAAQ,EAAWD,EAARC,EAAeA,IACjFnH,EAAKmH,GAAStD,UAAUsD,EAKzB,OAFArD,MAAK8C,SAASb,SAASR,MAAMzB,KAAK8C,SAAU5G,GAErC8D,QAGRtG,IAAK,OAWLzB,MAAO,WACN,IAAK,GAAIqL,GAAQvD,UAAUxG,OAAQ2C,EAAOkF,MAAMkC,GAAQC,EAAQ,EAAWD,EAARC,EAAeA,IACjFrH,EAAKqH,GAASxD,UAAUwD,EAKzB,OAFAvD,MAAK8C,SAASU,KAAK/B,MAAMzB,KAAK8C,SAAU5G,GAEjC8D,QAGRtG,IAAK,YAcLzB,MAAO,SAAmBiJ,GACzB,MAAOA,GAAKlB,KAAK8C,SAAS9B,UAAUE,GAAMlB,KAAK8C,SAAS9B,aAGzDtH,IAAK,MAaLzB,MAAO,SAAaiJ,EAAIgB,GAGvB,MAFAlC,MAAK8C,SAASJ,IAAIxB,EAAIgB,GAEflC,QAGRtG,IAAK,KAiBLzB,MAAO,SAAYiJ,EAAI6B,EAAUb,EAAIR,GAGpC,MAFA1B,MAAK8C,SAASP,GAAGrB,EAAI6B,EAAUb,EAAIR,GAAS1B,MAErCA,QAGRtG,IAAK,OAiBLzB,MAAO,SAAciJ,EAAI6B,EAAUb,EAAIR,GAGtC,MAFA1B,MAAK8C,SAASW,KAAKvC,EAAI6B,EAAUb,EAAIR,GAAS1B,MAEvCA,QAGRtG,IAAK,sBAaLzB,MAAO,SAA6BiJ,EAAIgB,GAGvC,MAFAlC,MAAK8C,SAASJ,IAAIxB,EAAIgB,GAEflC,QAGRtG,IAAK,iBAaLzB,MAAO,SAAwBiJ,EAAIgB,GAGlC,MAFAlC,MAAK8C,SAASJ,IAAIxB,EAAIgB,GAEflC,SAIF6C,KAMJT,OAeHsB,IAAK,SAAa1B,EAAKlB,GAKtB,MAJKsB,OAAMuB,SAAS3B,EAAKlB,IACxBkB,EAAI4B,KAAK9C,GAGHkB,GAgBR6B,SAAU,SAAkB7B,EAAKlB,GAMhC,IALA,GAAIhB,GAAMkC,EAAIzI,OAAS,EACnBuK,EAAM,EACNC,EAAM,EACNC,EAAM,EAEIlE,GAAPgE,GAIN,GAHAC,EAAME,KAAKC,OAAOJ,EAAMhE,GAAO,GAC/BkE,EAAMhC,EAAI+B,GAEAjD,EAANkD,EACHF,EAAMC,EAAM,MACN,CAAA,KAAIC,EAAMlD,GAGhB,MAAOiD,EAFPjE,GAAMiE,EAAM,EAMd,MAAO,IAcRI,KAAM,SAAcnC,EAAKtI,GACxB,GAAI0K,KAYJ,OAVKC,OAAMrC,EAAIzI,QAEJG,KAAQ,EAClB0K,EAAIhC,MAAMC,KAAKL,GAEfV,QAAQC,QAAQS,EAAK,SAAU1I,GAC9B8K,EAAER,KAAKtK,KALR8K,EAAIhD,MAAMkD,KAAKtC,GASToC,GAcRG,MAAO,SAAevC,EAAKwC,GAM1B,IALA,GAAIC,MACAC,EAAMtG,EAAOuG,MAAM3C,EAAIzI,OAASiL,EAAM,MACtCI,EAAQ,EACRtL,EAAI,KAECA,EAAIoL,GACZE,EAAQtL,EAAIkL,EACZC,EAAOb,KAAKxB,MAAMrB,MAAMiB,EAAK4C,EAAOJ,GAGrC,OAAOC,IAgBRI,MAAO,SAAe7C,GACrB,MAAOA,GAAIzI,OAAS,EAAI6I,MAAMhC,OAAO4B,EAAK,EAAGA,EAAIzI,QAAUyI,GAoB5D8C,MAAO,SAAe9C,GACrB,GAAI+C,GAA2BjN,SAAjBiI,UAAU,IAAmB,EAAOA,UAAU,EAE5D,OAAOuB,SAAQwD,MAAM9C,EAAK+C,IAc3BpB,SAAU,SAAkB3B,EAAKlB,GAChC,MAAOkB,GAAIgD,QAAQlE,GAAO,IAc3BmE,QAAS,SAAiBjD,EAAKkD,GAC9B,MAAOlD,GAAImD,IAAID,IAehBE,QAAS,SAAiBpD,EAAKqD,GAC9B,GAAIZ,GAASzC,EAAIsD,OAAO,SAAUhM,GACjC,OAAQuC,MAAMsC,eAAeoH,KAAKjM,IAGnC,OAAO+L,MAAS,EAAOZ,EAASA,EAAOlL,OAASyI,EAAIzI,OAASkL,EAAS,MAcvEe,MAAO,SAAexD,EAAK/J,GAC1B,MAAO+J,GAAIsD,OAAO,SAAUhM,GAC3B,MAAOA,KAAMrB,IACXsB,QAcJ8L,KAAM,SAAcI,EAAMC,GACzB,GAAIjB,GAAS3M,MAUb,OARA2M,GAASgB,EAAKH,OAAO,SAAUhM,GAC9B,OAAQ8I,MAAMuB,SAAS+B,EAAMpM,KAG9BmL,EAASA,EAAOkB,OAAOD,EAAKJ,OAAO,SAAUhM,GAC5C,OAAQ8I,MAAMuB,SAAS8B,EAAMnM,OAqB/BsM,KAAM,SAAc5D,EAAKkD,EAAIW,GAC5B,GAAIrB,GAAwB1M,SAAjBiI,UAAU,GAAmB,GAAKA,UAAU,GAEnD2E,EAAM1C,EAAIzI,OACVD,EAAIxB,OACJgO,EAAShO,MAEb,IAAI+N,KAAU,EAEb,IADAvM,EAAI,KACKA,EAAIoL,GACRQ,EAAG/M,KAAK6J,EAAKA,EAAI1I,GAAIA,MAAO,QAKjCwM,GAAS,EAELtB,EAAOE,IACVF,EAAOE,GAGRpD,QAAQyE,OAAO,WAId,IAHA,GAAIzM,GAAI,GACJyK,EAAMjM,SAEDwB,EAAIkL,GAGZ,GAFAT,EAAMzK,EAAIwM,EAEN/B,IAAQW,GAAOQ,EAAG/M,KAAK6J,EAAKA,EAAI+B,GAAMA,MAAS,EAClD,OAAO,CAMT,OAFA+B,IAAUtB,EAENsB,GAAUpB,GACN,EADR,QAGE5M,OAAWA,QAAW,EAG1B,OAAOkK,IAkBRgE,YAAa,SAAqBhE,EAAKkD,EAAIW,EAAOrB,GACjD,GAAIE,GAAM1C,EAAIzI,OACVD,EAAIxB,OACJgO,EAAShO,MAEb,IAAI+N,KAAU,EAEb,IADAvM,EAAIoL,IACKpL,EAAI,IACR4L,EAAG/M,KAAK6J,EAAKA,EAAI1I,GAAIA,MAAO,QAKjCkL,GAAOA,GAAQ,GACfsB,EAASpB,EAAM,EAEXF,EAAOE,IACVF,EAAOE,GAGRpD,QAAQyE,OAAO,WAId,IAHA,GAAIzM,GAAI,GACJyK,EAAMjM,SAEDwB,EAAIkL,GAGZ,GAFAT,EAAM+B,EAASxM,EAEL,EAANyK,GAAWmB,EAAG/M,KAAK6J,EAAKA,EAAI+B,GAAMA,MAAS,EAC9C,OAAO,CAMT,OAFA+B,IAAUtB,EAEG,EAATsB,GACI,EADR,QAGEhO,OAAWA,QAAW,EAG1B,OAAOkK,IAcRiE,MAAO,SAAejE,GACrB,MAAsB,KAAfA,EAAIzI,QAeZ2M,MAAO,SAAeT,EAAMC,GAC3B,MAAOS,MAAKC,UAAUX,KAAUU,KAAKC,UAAUV,IAmBhDW,KAAM,SAAcrE,EAAKlB,EAAK8D,EAAOkB,GACpC,GAAIZ,GAAoB,kBAARpE,GACZwF,EAAItE,EAAIzI,OACRD,EAAK+K,MAAMO,GAAiB,EAARA,EACpBF,EAAOL,MAAMyB,GAAuBQ,EAAI,EAAjBhN,EAAIwM,CAM/B,IAJIpB,EAAM4B,EAAI,IACb5B,EAAM4B,EAAI,GAGPpB,EACH,KAAYR,GAALpL,GACN0I,EAAI1I,GAAKwH,EAAIkB,EAAI1I,IACjBA,QAGD,MAAYoL,GAALpL,GACN0I,EAAI1I,GAAKwH,EACTxH,GAIF,OAAO0I,IAaR9B,MAAO,SAAe8B,GACrB,MAAOA,GAAI,IAaZuE,KAAM,SAAcvE,GACnB,GAAIyC,KAMJ,OAJAA,GAASzC,EAAIwE,OAAO,SAAUC,EAAGC,GAChC,MAAOD,GAAEd,OAAOe,IACdjC,IAqBJkC,QAAS,SAAiB3E,EAAKkD,EAAIW,EAAOrB,GACzC,MAAOpC,OAAMwD,KAAK5D,EAAKkD,EAAIW,EAAOrB,IAanCoC,WAAY,SAAoB5E,GAC/B,MAAOI,OAAMyE,OAAOzE,MAAMC,KAAKL,GAAMI,MAAM+B,KAAKnC,KAcjD8E,MAAO,SAAe9E,EAAKlB,GAC1B,MAAOkB,GAAIgD,QAAQlE,IAgBpBiG,QAAS,SAAiB/E,GACzB,GAAIyC,KAMJ,OAJAnD,SAAQC,QAAQS,EAAK,SAAUgF,GAC9BvC,EAAOb,KAAKoD,KAGNvC,GAcRwC,UAAW,SAAmBxB,EAAMC,GACnC,GAAIe,GAAIhB,EAAKlM,OAASmM,EAAKnM,OAASkM,EAAOC,EACvCgB,EAAID,IAAMhB,EAAOC,EAAOD,CAE5B,OAAOgB,GAAEnB,OAAO,SAAU5L,GACzB,MAAO0I,OAAMuB,SAAS+C,EAAGhN,MAY3B6H,QAAS,SAAiBS,EAAKkD,GAC9B,GAAIgC,GAAM9E,MAAM+E,SAASnF,GACrB1I,EAAI,GACJ+G,EAAOvI,OACP0I,EAAO1I,MAEX,GACCuI,GAAO6G,EAAI1G,OAKVA,EAHIH,EAAK+G,MAGF,EAFAlC,EAAG7E,EAAKpI,QAASqB,SAIjBkH,KAAS,EAElB,OAAOwB,IAWRmF,SAAU,SAAkBnF,GAC3B,GAAI1I,GAAI,GACJ+N,EAAIrF,EAAIzI,MAEZ,QACCiH,KAAM,WACL,QAAMlH,EAAI+N,GACAD,MAAM,EAAOnP,MAAO+J,EAAI1I,KAExB8N,MAAM,MAoBnBE,OAAQ,SAAgBtF,EAAKkD,GAC5B,GAAIT,GAAS3M,OACTsI,EAAStI,MASb,OAPA2M,GAASzC,EAAIsD,OAAOJ,GACpB9E,EAASgC,MAAMiD,KAAKrD,EAAKyC,GAEzBrC,MAAMwD,KAAKxF,EAAQ,SAAU9G,GAC5B8I,MAAMhC,OAAO4B,EAAKI,MAAM0E,MAAM9E,EAAK1I,MAG7B0I,GAaRK,KAAM,SAAcL,GACnB,MAAOpK,QAAOyK,KAAKL,IAkBpBuF,QAAS,SAAiBvF,EAAKwF,EAAOC,GACrCD,EAAQA,EAAME,QAAQ,WAAY,IAAIA,QAAQ,YAAa,QAE3D,IAAIC,GAAUC,OAAOC,QAAQL,GAAOrC,IAAI,SAAU7L,GACjD,MAAOA,GAAEwO,MAAM,OAEZC,KACAC,EAAS,KACTC,EAAS,IAuCb,OApCCR,GADGA,GAAe,KAARA,EACJ,IAAMA,EAEN,GAGPrF,MAAMwD,KAAK+B,EAAS,SAAUrO,GAC7B,GAAI4O,GAAI,IACJC,EAAI,EAEJtM,OAAMoC,gBAAgBsH,KAAKjM,EAAE,MAChC4O,EAAIF,EACJG,EAAIF,GAGLF,EAAMnE,KAAK,SAEE,SAATtK,EAAE,IACLyO,EAAMnE,KAAK,SAAW6D,EAAMS,EAAI5O,EAAE,GAAK6O,EAAI,OAASV,EAAMS,EAAI5O,EAAE,GAAK6O,EAAI,gBACzEJ,EAAMnE,KAAK,SAAW6D,EAAMS,EAAI5O,EAAE,GAAK6O,EAAI,OAASV,EAAMS,EAAI5O,EAAE,GAAK6O,EAAI,mBAEzEJ,EAAMnE,KAAK,SAAW6D,EAAMS,EAAI5O,EAAE,GAAK6O,EAAI,OAASV,EAAMS,EAAI5O,EAAE,GAAK6O,EAAI,iBACzEJ,EAAMnE,KAAK,SAAW6D,EAAMS,EAAI5O,EAAE,GAAK6O,EAAI,OAASV,EAAMS,EAAI5O,EAAE,GAAK6O,EAAI,iBAG1EJ,EAAMnE,KAAK,iBACXmE,EAAMnE,KAAK,SACXmE,EAAMnE,KAAK,SAAW6D,EAAMS,EAAI5O,EAAE,GAAK6O,EAAI,4BAAuC,SAAT7O,EAAE,GAAgB,KAAO,KAAO,KACzGyO,EAAMnE,KAAK,kBACXmE,EAAMnE,KAAK,SACXmE,EAAMnE,KAAK,SAAW6D,EAAMS,EAAI5O,EAAE,GAAK6O,EAAI,4BAAuC,SAAT7O,EAAE,GAAgB,IAAM,MAAQ,KACzGyO,EAAMnE,KAAK,kBACXmE,EAAMnE,KAAK,OAGZmE,EAAMnE,KAAK,aAEJ5B,EAAIoG,KAAK,GAAIC,UAAS,IAAK,IAAKN,EAAMO,KAAK,SAiBnDnI,KAAM,SAAc6B,EAAKlB,GACxB,GAAIuG,GAAIrF,EAAIzI,OAAS,CAErB,OAAIuH,IAAOuG,EAAI,EACPrF,EACGqC,MAAMvD,IAAgB,IAARA,EACjBkB,EAAIqF,GAEJjF,MAAMrB,MAAMiB,EAAKqF,KAAMvG,EAAKuG,IAmBrCtG,MAAO,SAAeiB,EAAK4C,EAAOkB,GACjC,GAAIrB,MACAnL,EAAIsL,EAAQ,EACZF,EAAME,EAAQkB,EACdhG,EAAMkC,EAAIzI,MAEd,IAAIuG,EAAM,EACT,OAASxG,EAAIoL,GAAW5E,EAAJxG,GACnBmL,EAAOb,KAAK5B,EAAI1I,GAIlB,OAAOmL,IAaR3E,IAAK,SAAakC,GACjB,MAAOI,OAAMjC,KAAKiC,MAAMmG,OAAOnG,MAAM0C,MAAM9C,MAa5CwG,KAAM,SAAcxG,GACnB,MAAOA,GAAIzI,OAAS,EAAI6I,MAAMqG,IAAIzG,GAAOA,EAAIzI,OAASzB,QAcvD4Q,OAAQ,SAAgB1G,GACvB,GAAI2G,GAAOvG,MAAMmG,OAAOnG,MAAM0C,MAAM9C,IAChC0C,EAAMiE,EAAKpP,OACXqP,EAAMxK,EAAOuG,MAAMD,EAAM,EAAG,OAEhC,OAAOtG,GAAOyK,IAAInE,GAAOiE,EAAKC,IAAQD,EAAKC,EAAM,GAAKD,EAAKC,IAAQ,GAkBpEE,MAAO,SAAerD,EAAMC,GAK3B,MAJAtD,OAAMwD,KAAKF,EAAM,SAAUpM,GAC1B8I,MAAMsB,IAAI+B,EAAMnM,KAGVmM,GAaR3B,IAAK,SAAa9B,GACjB,MAAOI,OAAMmG,OAAOnG,MAAM0C,MAAM9C,IAAM,IAiBvC6E,OAAQ,SAAgBpB,EAAMC,GAC7B,GAAIjB,GAASgB,EAAKN,IAAI,SAAU7L,EAAGyK,GAClC,OAAQzK,EAAGoM,EAAK3B,KAGjB,OAAOU,IAcRsE,KAAM,QAASA,IAAK/G,GACnB,GAAIgH,MACAxD,EAAQ,EACRuD,MACArE,EAAM5M,OACN2M,EAAS3M,MA4Bb,OAzBAsK,OAAMwD,KAAK5D,EAAK,SAAU1I,GACpB+K,MAAM2E,EAAO1P,IAGjB0P,EAAO1P,GAAK,EAFZ0P,EAAO1P,OAOTkM,EAAQpD,MAAMtC,IAAIsC,MAAM+B,KAAK6E,IAG7B1H,QAAQC,QAAQyH,EAAQ,SAAUhC,EAAGiC,GAChCjC,IAAMxB,GACTuD,GAAKnF,KAAKxF,EAAO8K,MAAMD,MAKzBvE,EAAMqE,GAAKxP,OAEPmL,EAAM,IACTD,EAAiB,IAARC,EAAYqE,GAAK,GAAKA,IAGzBtE,GAaR0E,MAAO,SAAenH,GACrB,MAAOI,OAAMtC,IAAIkC,GAAOI,MAAM0B,IAAI9B,IAcnCoH,OAAQ,SAAgBpH,EAAKlB,GAC5B,GAAI2D,GAAS3M,MAUb,OARAsK,OAAMwD,KAAK5D,EAAK,SAAU1I,EAAGyK,GAC5B,MAAIzK,GAAE,KAAOwH,GACZ2D,EAASnD,QAAQwD,MAAM9C,EAAI+B,IAAM,IAE1B,GAHR,SAOMU,GAcR4E,OAAQ,SAAgBrH,EAAKkD,GAC5B,MAAO9C,OAAMiD,KAAKrD,EAAKA,EAAIsD,OAAOJ,KAkBnC9E,OAAQ,SAAgB4B,EAAK4C,EAAO0E,GACnC,GAAIjF,MAAMO,IAGT,GAFAA,EAAQxC,MAAM0E,MAAM9E,EAAK4C,GAEX,KAAVA,EACH,MAAO5C,OAGR4C,GAAQA,GAAS,CAGlB,IAAIrL,GAASyI,EAAIzI,OACbgQ,EAAYvH,EAAIwH,OAAOF,GAAO1E,GAAS,GAAKrL,EAKhD,OAHAyI,GAAIzI,OAAiB,EAARqL,EAAYrL,EAASqL,EAAQA,EAC1C5C,EAAI4B,KAAKnC,MAAMO,EAAKuH,GAEbvH,GAiBRyH,SAAU,SAAkBzH,EAAKkD,GAChC,GAAI9E,GAAS4B,EAAIsD,OAAOJ,EAMxB,OAJA9C,OAAMwD,KAAKxF,EAAQ,SAAU9G,GAC5B8I,MAAMhC,OAAO4B,EAAKI,MAAM0E,MAAM9E,EAAK1I,MAG7B0I,GAkBR0H,YAAa,SAAqB1H,EAAKkD,GACtC,GAAI9E,KAcJ,OAZAgC,OAAMwD,KAAK5D,EAAK,SAAU1I,GACzB,MAAI4L,GAAG5L,MAAO,GAGN,MAFP8G,GAAOwD,KAAKtK,KAMd8I,MAAMwD,KAAKxF,EAAQ,SAAU9G,GAC5B8I,MAAMhC,OAAO4B,EAAKI,MAAM0E,MAAM9E,EAAK1I,MAG7B0I,GAkBR0F,QAAS,SAAiBjC,EAAMC,GAM/B,MALAtD,OAAMhC,OAAOqF,EAAM,EAAGA,EAAKlM,QAC3B6I,MAAMwD,KAAKF,EAAM,SAAUpM,GAC1BmM,EAAK7B,KAAKtK,KAGJmM,GAeRkE,KAAM,SAAc3H,GACnB,GAAIlB,GAAuBhJ,SAAjBiI,UAAU,GAAmB,EAAIA,UAAU,EAMrD,OAJU,GAANe,IACHA,EAAM,GAGAsB,MAAMrB,MAAMiB,EAAKlB,EAAKkB,EAAIzI,SAclCqQ,OAAQ,SAAgB5H,EAAKlB,GAC5B,GAAI2D,GAAS,EAQb,OANArC,OAAMwD,KAAK5D,EAAK,SAAU1I,EAAGyK,GACxBzK,IAAMwH,IACT2D,EAASV,KAIJU,GAeRoF,OAAQ,SAAgB7H,EAAKlB,GAC5B,GAAI4D,GAAM1C,EAAIzI,OACVkL,EAAS3M,MAeb,OAbY,KAARgJ,EACH2D,EAASzC,GAEC,EAANlB,EACHA,GAAO4D,EAEP5D,IAGD2D,EAASrC,MAAMrB,MAAMiB,EAAKlB,EAAK4D,GAC/BD,EAASA,EAAOkB,OAAOvD,MAAMrB,MAAMiB,EAAK,EAAGlB,KAGrC2D,GAgBRqF,OAAQ,WACP,GAAIlF,GAAyB9M,SAAjBiI,UAAU,GAAmB,EAAIA,UAAU,GACnDuJ,EAAuBxR,SAAjBiI,UAAU,GAAmBjI,OAAYiI,UAAU,GACzD+F,EAA0BhO,SAAjBiI,UAAU,GAAmB,EAAIA,UAAU,EAExDuJ,GAAMA,GAAO1E,CAMb,KAJA,GAAIH,MACA4C,EAAI,GACJ3C,EAAMT,KAAKnE,IAAI,EAAGmE,KAAK8F,MAAMT,EAAM1E,GAASkB,MAEvCuB,EAAI3C,GACZD,EAAO4C,GAAKzC,EACZA,GAASkB,CAGV,OAAOrB,IAcR2D,KAAM,SAAc3B,EAAGC,GACtB,GAAIsD,IAAUvD,QAAUA,GAAGC,QAAUA,IACjCuD,EAAInS,OACJoS,EAAIpS,OACJ2M,EAAS3M,MAqBb,OAnBgB,WAAZkS,EAAMvD,GAA8B,WAAZuD,EAAMtD,EACjCjC,EAASgC,EAAIC,GAEbuD,EAAIxD,EAAE0D,WACND,EAAIxD,EAAEyD,WAGL1F,EADOyF,EAAJD,EACM,GACCA,EAAIC,EACL,EACCF,EAAMvD,IAAMuD,EAAMtD,EACnB,EACa,YAAZsD,EAAMvD,EACP,GAEA,GAIJhC,GAgBR8D,OAAQ,SAAgBvG,GACvB,MAAOA,GAAIoG,KAAKhG,MAAMgG,OA4BvBN,MAAO,SAAe9F,EAAKoI,GAC1B,GAAI3F,MACA4F,EAAQrI,EAAIzI,OACZmL,EAAMT,KAAK8F,KAAKM,EAAQD,GACxBE,EAAMrG,KAAKC,MAAMmG,EAAQD,GACzBG,EAAQtG,KAAK8F,KAAKM,EAAQ3F,GAC1B8F,GAAU,EACV5F,EAAQ,EACRtL,EAAI,EASR,KANI8E,EAAOiH,KAAKgF,EAAOD,EAAU1F,GAAOA,EACvC6F,EAAQF,EAAQC,EAAMF,EAAUE,EAAM,EAC5BD,EAAQD,EAAU,GAAKG,EAAQ7F,GAAO2F,GAChDE,MAGQjR,EAAI8Q,GACR9Q,EAAI,IACPsL,GAAgBF,IAGZ8F,GAAmBJ,EAARG,GAAmBjR,IAAMiR,MACtC7F,EACF8F,GAAU,GAGX/F,EAAOb,KAAKxB,MAAMrB,MAAMiB,EAAK4C,EAAOF,GAGrC,OAAOD,IAaRgG,OAAQ,SAAgBzI,GACvB,MAAOiC,MAAKyG,KAAKtI,MAAMuI,SAAS3I,KAajCyG,IAAK,SAAazG,GACjB,GAAIyC,GAAS,CAQb,OANIzC,GAAIzI,OAAS,IAChBkL,EAASzC,EAAIwE,OAAO,SAAUoE,EAAMC,GACnC,MAAOD,GAAOC,KAITpG,GAcRqG,KAAM,SAAc9I,EAAKqF,GACxB,MAAOjF,OAAMrB,MAAMiB,EAAK,EAAGqF,IAa5B0D,SAAU,SAAkBC,GAI3B,IAHA,GAAIhJ,MACA1I,EAAI0R,EAAGzR,OAEJD,KACN0I,EAAI1I,EAAE6Q,YAAca,EAAG1R,EAGxB,OAAO0I,IAgBRqI,MAAO,SAAerI,GACrB,MAAOI,OAAM2E,QAAQ/E,GAAKzI,QAa3B0R,OAAQ,SAAgBjJ,GACvB,GAAIyC,KAMJ,OAJArC,OAAMwD,KAAK5D,EAAK,SAAU1I,GACzB8I,MAAMsB,IAAIe,EAAQnL,KAGZmL,GAaRkG,SAAU,SAAkB3I,GAC3B,GAAI0C,GAAM1C,EAAIzI,OACV8N,EAAI,EACJmB,EAAO1Q,MAEX,OAAI4M,GAAM,GACT8D,EAAOpG,MAAMoG,KAAKxG,GAElBI,MAAMwD,KAAK5D,EAAK,SAAU1I,GACzB+N,GAAK6D,EAAKC,IAAI7R,EAAIkP,KAGZnB,EAAI3C,GAEJ2C,GAeT+D,IAAK,SAAapJ,EAAK9F,GACtB,GAAIuI,KAqBJ,OAlBMvI,aAAgBkF,SACrBlF,EAAuB,gBAATA,GAAoBkG,MAAM+B,KAAKjI,IAASA,IAGvDkG,MAAMwD,KAAK1J,EAAM,SAAU5C,EAAGyK,GACvBzK,YAAa8H,SAClBlF,EAAK6H,IAAQzK,MAKf8I,MAAMwD,KAAK5D,EAAK,SAAU1I,EAAGyK,GAC5BU,EAAOV,IAAQzK,GACf8I,MAAMwD,KAAK1J,EAAM,SAAUmP,GAC1B5G,EAAOV,GAAKH,KAAKyH,EAAEtH,IAAQ,UAItBU,IAQLxE,GAOHU,IAAKA,EAAIC,QAAQrG,GAUjB+Q,OAAQ,SAAgBC,GACvB,MAAItL,GAAMU,IAAIV,MAAMsL,IACnBtL,EAAMU,IAAIP,OAAOmL,IAEV,IAGD,GAWRC,QAAS,SAAiBD,GACzB,GAAIlL,GAAOJ,EAAMU,IAAIV,MAAMsL,EAE3B,OAAOlL,IAAQA,EAAKpI,MAAMwT,SAAU,GAAIC,OAAOC,WAahDpU,IAAK,SAAagU,EAAKD,EAAQM,GAC9BL,EAAMjK,QAAQ4H,MAAMqC,GAAKM,IACzB,IAAIxL,GAAOJ,EAAMU,IAAIpJ,IAAIgU,EAEzB,OAAKlL,GAIDiL,KAAW,GAASrL,EAAMuL,QAAQD,KAASjK,QAAQ4E,MAAM7F,EAAKyL,gBAAiBF,IAClF3L,EAAMqL,OAAOC,IAEN,GAGDjK,QAAQwD,MAAMzE,GAAM,IATnB,GAsBTC,IAAK,SAAaiL,EAAK9T,EAAUQ,GAChCsT,EAAMjK,QAAQ4H,MAAMqC,GAAKM,IACzB,IAAIxL,GAAOJ,EAAMU,IAAIpJ,IAAIgU,EAkBzB,OAhBKlL,KACJA,GACC0L,WAAY,IAIG,eAAbtU,EACH4I,EAAK0L,YAAc9T,EACI,gBAAbR,EACV4I,EAAK0L,aAAe9T,EAEpBoI,EAAK5I,GAAYQ,EAGlBgI,EAAMU,IAAIL,IAAIiL,EAAKlL,GAEZA,IAaL2L,EAAkB,SAAWC,GAChC,QAASD,GAAgBE,GACxB,GAAIC,GAASnM,IAEbjH,iBAAgBiH,KAAMgM,GAEtB1U,KAAKM,OAAOI,eAAegU,EAAgBxT,WAAY,cAAewH,MAAM7H,KAAK6H,MAEjFA,KAAK8C,SAAWF,IAChB5C,KAAKoM,MAAQC,IACbrM,KAAKkM,IAAMA,EAGX9J,MAAMwD,KAAKpL,EAAQ,SAAUlB,GAC5B6S,EAAO3I,KAAK2I,EAAOD,IAAK5S,KAsC1B,MAlCAlB,WAAU4T,EAAiBC,GAE3B/S,aAAa8S,IACZtS,IAAK,SACLzB,MAAO,SAAgB6I,GACtB,MAAOd,MAAKoM,MAAME,OAAOnU,KAAK6H,KAAKoM,MAAOtL,MAG3CpH,IAAK,OACLzB,MAAO,SAAc6I,GACpB,MAAOd,MAAKoM,MAAMhF,KAAKjP,KAAK6H,KAAKoM,MAAOtL,MAGzCpH,IAAK,OACLzB,MAAO,SAAc6I,GACpB,MAAOd,MAAKoM,MAAMG,KAAKpU,KAAK6H,KAAKoM,MAAOtL,MAGzCpH,IAAK,SACLzB,MAAO,SAAgB6I,GACtB,MAAOd,MAAKoM,MAAM/C,OAAOlR,KAAK6H,KAAKoM,MAAOtL,MAG3CpH,IAAK,UACLzB,MAAO,SAAiB6I,GACvB,MAAOd,MAAKoM,MAAMI,QAAQrU,KAAK6H,KAAKoM,MAAOtL,MAG5CpH,IAAK,OACLzB,MAAO,SAAcwU,EAASC,GAC7B,MAAO1M,MAAKoM,MAAMO,KAAKxU,KAAK6H,KAAKoM,MAAOK,EAASC,OAI5CV,GACLnJ,GAKC+J,GAQHC,GAA2B,mBAAhBC,aASXC,KAAsB,mBAAT/R,MASbgS,IAAyB,mBAAbC,UASZvP,IAAKzD,GAAU4B,MAAM6B,GAAG6H,KAAKvL,EAAUkT,WASvCC,QAAS,WACR,GAAI1I,GAAS,CAMb,OAJImI,GAAOlP,KACV+G,EAASrG,EAAO8K,MAAMtB,OAAOwF,KAAKpT,EAAUkT,UAAUxF,QAAQ,kBAAmB,MAAQ,EAAG,KAGtFjD,GAcR4I,OAAQ,SAAgB9B,EAAK+B,EAAM1B,GAClCL,EAAMjK,QAAQ4H,MAAMqC,GAAKM,KACzByB,EAAOA,EAAKC,aAEZ,IAAI9I,IAAS,EACT+I,EAAM,CAkBV,OAhBKvN,GAAM1I,IAAIgU,GAAK,EAAOK,IAGtB/P,MAAMc,IAAI4I,KAAK+H,GAClBE,EAAM,EACI3R,MAAMoB,YAAYsI,KAAK+H,GACjCE,EAAM,EACI3R,MAAMkD,SAASwG,KAAK+H,GAC9BE,EAAM,EACI3R,MAAM8C,MAAM4G,KAAK+H,KAC3BE,EAAM,GAGP/I,EAASgJ,QAAQb,EAAOc,YAAYnC,EAAKK,GAAS4B,IAAMA,IAZxD/I,EAAS3M,OAeH2M,GAYR+I,IAAK,SAAatR,GACjB,GAAIuI,GAAS,CAgBb,OAdArC,OAAMwD,KAAK1J,EAAM,SAAUoR,GAC1BA,EAAOA,EAAKC,cAER1R,MAAMoB,YAAYsI,KAAK+H,GAC1B7I,GAAU,EACA5I,MAAMkD,SAASwG,KAAK+H,GAC9B7I,GAAU,EACA5I,MAAM8C,MAAM4G,KAAK+H,GAC3B7I,GAAU,EACA5I,MAAMc,IAAI4I,KAAK+H,KACzB7I,GAAU,KAILA,GAYRkJ,KAAM,SAAcpC,GACnB,OAAQtR,GAAUsR,EAAIvG,QAAQ,MAAQ,IAA4C,KAAtCuG,EAAIvG,QAAQ,KAAOjL,EAAS0D,OAezEmO,QAAS,QAASA,IAAQM,EAAKX,EAAKqC,EAAM9B,GACzC,GAAIF,IAAUhE,OAAOwF,KAAKlB,EAAI2B,yBAAyB/F,MAAM,MACzDgG,KACA1J,KACArI,EAAQ,KACR0P,EAAU,GAAIC,MACdiC,EAAOf,EAAOe,KAAKpC,GACnBwC,GAAW,CAyCf,OAvCA3L,OAAMwD,KAAKgG,GAAS,SAAUtS,GAC7B,GAAI0U,GAAS1U,EAAEwO,MAAM,KAIrB,OAFAgG,GAAME,EAAO,GAAGT,eAAiB3F,OAAOwF,KAAKY,EAAO,IAEtC,OAAVjS,KACE4R,GAAQ9R,MAAME,MAAMwJ,KAAKyI,EAAO,KAAOL,GAAQ9R,MAAMG,WAAWuJ,KAAKyI,EAAO,MAChFjS,EAAQiS,EAAO,IAER,GAJT,SASGnS,MAAMmC,GAAGuH,KAAKuI,EAAM,kBACvBrC,EAAUA,EAAQE,UACRmC,EAAM,kBAAoBjS,MAAM0C,eAAegH,KAAKuI,EAAM,kBACpErC,EAAUA,EAAQwC,WAAWxC,EAAQyC,aAAe9P,EAAO8K,MAAMrN,MAAM0C,eAAe4P,KAAKL,EAAM,kBAAkB,GAAI,KAC7GA,EAAMrC,QAChBA,EAAU,GAAIC,MAAKoC,EAAMrC,SAASE,WAElCoC,GAAW,EACXtC,EAAUA,EAAQE,WAGnBvH,EAAE2J,SAAWA,EACb3J,EAAEqH,QAAUA,EACZrH,EAAEwH,QAAUkC,EACZ1J,EAAEgK,UAAY,GAAI1C,MAClBtH,EAAE2H,WAAaa,EAAOY,IAAc,OAAVzR,EAAiB6L,OAAOC,QAAQ9L,IAAU6R,IAEvD,QAATA,GAAkBG,IACrB9N,EAAMK,IAAIiL,EAAK,UAAWnH,EAAEqH,SAC5BxL,EAAMK,IAAIiL,EAAK,UAAWnH,EAAEwH,SAC5B3L,EAAMK,IAAIiL,EAAK,YAAanH,EAAEgK,WAC9BnO,EAAMK,IAAIiL,EAAK,aAAcnH,EAAE2H,YAC/B9L,EAAMK,IAAIiL,EAAK,kBAAmBO,IAG5B1H,GAaR8E,MAAO,SAAegD,GACrB,GAAI0B,GAAwB9V,SAAjBiI,UAAU,GAAmB,GAAKA,UAAU,GAEnD0E,EAAS3M,OACTkK,EAAMlK,MAoBV,QAlBK+D,MAAMgC,WAAW0H,KAAKqI,IAAShG,OAAOyG,QAAQT,KAAW/R,MAAMiC,UAAUyH,KAAK2G,EAAIoC,eAAiBb,QAAQzL,EAAMuM,EAAKC,OAAOtC,EAAIoC,cAAc,IACnJ7J,EAASzC,EACU,aAAT4L,EACVnJ,EAASgK,EAAID,OAAOtC,EAAIoC,cACL,aAATV,EACVnJ,EAASgK,EAAID,OAAOtC,EAAIoC,aAAc,KAC5BzS,MAAM+D,IAAI2F,KAAKqI,IACZ,aAATA,GACH1B,EAAIwC,iBAAiB,YAGtBjK,EAASyH,EAAIyC,aAEblK,EADmB,eAATmJ,GAAyB/R,MAAM+B,OAAO2H,KAAK2G,EAAIoC,eAAiB1O,EAAIgP,MAAM1C,EAAIoC,cAC/E1O,EAAI4O,OAAOtC,EAAIoC,cAEfpC,EAAIoC,aAGP7J,GAaRiJ,YAAa,SAAqBnC,EAAKK,GACtC,GAAIiD,GAAS5O,EAAM1I,IAAIgU,GAAK,EAAOK,GAC/B4B,EAAOqB,EAAaA,EAAO9C,WAAX,EAChBtH,GAAW4I,UAAYG,IAAKA,EAAKrI,KAAO2J,QAAS,EAAGC,KAAM,EAAGC,MAAO,EAAGC,SAAU,EAAGC,QAAS,GAmBjG,OAjBU,GAAN1B,GACH/I,EAAO4I,OAAOzJ,KAAK,UAGV,EAAN4J,IACH/I,EAAO4I,OAAOzJ,KAAK,QACnBa,EAAO4I,OAAOzJ,KAAK,QAGV,EAAN4J,GACH/I,EAAO4I,OAAOzJ,KAAK,OAGV,EAAN4J,GACH/I,EAAO4I,OAAOzJ,KAAK,SAGba,GAkBR0K,MAAO,SAAe5D,EAAKrP,GAC1B,GAAIkQ,GAAQC,IACR+C,EAAW,WACXC,EAAOvX,OACPoQ,EAAIpQ,MAESA,UAAboD,IACErB,EAAOyV,SACXzV,EAAOyV,QAAWF,cAGnBlU,EAAW,UAGRgB,YAAgBtE,UAAWsE,EAAKkT,WACnCA,EAAWlT,EAAKkT,SAGjB,GACCC,GAAO/N,QAAQiO,QAAQ/F,MAAM,EAAG,UACxB3P,EAAOuV,SAASC,GAmBzB,OAjBA9D,GAAMA,EAAI7D,QAAQ0H,EAAW,KAAMA,EAAW,IAAMlU,EAAW,aAAemU,GAE9ExV,EAAOuV,SAASC,GAAQ,SAAUvO,GACjCQ,QAAQkO,YAAYH,SACbxV,GAAOuV,SAASC,GACvBjD,EAAMI,QAAQ1L,GACd2O,EAAQC,QAAQxH,IAGjBA,EAAIuH,EAAQhX,OAAO,UAAYkX,IAAKpE,EAAKqC,KAAM,mBAAqBtM,QAAQsO,IAAI,QAAQ,IAExFtO,QAAQ8K,MAAM,WACb9K,QAAQkO,YAAYH,SACbxV,GAAOuV,SAASC,GACvBjD,EAAM/C,OAAO,GAAIxH,OAAMC,EAAM+N,kBAC3B,IAAOR,GAEHjD,GAYR0D,KAAM,SAAc5D,GACnB,MAAO,IAAIF,GAAgBE,IAsB5B6D,QAAS,SAAiBxE,GACzB,GAAIqC,GAAwB9V,SAAjBiI,UAAU,GAAmB,MAAQA,UAAU,GACtD7D,EAAwBpE,SAAjBiI,UAAU,GAAmBjI,OAAYiI,UAAU,GAC1D6L,EAA2B9T,SAAjBiI,UAAU,GAAmBjI,OAAYiI,UAAU,EAEjEwL,GAAMjK,QAAQ4H,MAAMqC,GAAKM,KACzB+B,EAAOA,EAAKL,cACZ3B,EAAUA,YAAmBhU,QAASgU,EAAU,IAEhD,IAAI+B,GAAOf,EAAOe,KAAKpC,GACnBuE,EAAOlD,EAAOkD,MAAMlD,EAAOlP,KAAQiQ,GAAQf,EAAOO,QAAU,EAAK,GAAIvS,GAAmB,GAAIoV,iBAC5FC,GAAWpU,MAAMkD,SAASwG,KAAKqI,IAAS/R,MAAM8C,MAAM4G,KAAKqI,KAAU1R,EAAOA,EAAO,KACjF2S,EAAkB,QAATjB,EAAiB3N,EAAM1I,IAAIgU,GAAK,EAAOK,IAAW,EAC3DsE,EAAc,KACdlD,EAAMJ,EAAOI,IACbH,EAAKD,EAAOC,GACZE,EAAOH,EAAOG,IAGlB,IAAIH,EAAOlP,IAAyB,IAAnBkP,EAAOO,SAAiBQ,IAAS9R,MAAM8D,eAAe4F,KAAKqI,GAC3E,KAAM,IAAI/L,OAAMC,EAAMqO,aAwNvB,OApNAL,GAAKvN,GAAG,mBAAoB,SAAUrB,GACrC,GAAIkP,GAAQN,EAAK5D,IAAImE,UAEP,KAAVD,EACHN,EAAK7N,SAAS,YAAa6N,EAAK5D,IAAKhL,GACjB,IAAVkP,GACVN,EAAK7N,SAAS,WAAY6N,EAAK5D,IAAKhL,KAIlC0L,EAAOS,OAAO9B,EAAKqC,EAAMhC,MAAa,GACzCkE,EAAK7N,SAAS,YAAa6N,EAAK5D,IAAK,MACrC4D,EAAK5D,IAAIoE,OAAS,IAClBR,EAAKzG,OAAO,GAAIxH,OAAMC,EAAMyO,mBAC5BjP,QAAQkP,MAAM,WACbV,EAAK7N,SAAS,WAAY6N,EAAK5D,IAAK,SAElB,QAAT0B,GAAkBH,QAAQoB,IAEhC5U,IACH6V,EAAK5D,IAAImE,WAAa,EACtBP,EAAK5D,IAAIoE,OAAS,IAClBR,EAAK5D,IAAIuE,YAAc5B,EAAOjD,SAG/BkE,EAAK7N,SAAS,YAAa6N,EAAK5D,IAAK,MACrC4D,EAAKtD,QAAQqC,EAAO6B,UACpBpP,QAAQkP,MAAM,WACbV,EAAK7N,SAAS,WAAY6N,EAAK5D,IAAK,SAGrC5K,QAAQkP,MAAM,WACbV,EAAK5D,IAAIyE,KAAK/C,EAAKgD,cAAerF,GAAK,GAGvB,OAAZK,GAAoBA,EAAQiF,eAAe,kBAC9CX,EAActE,EAAQ,iBAGnB+B,GAAwB,OAAhBuC,IACXA,EAAc,cAIC,OAAZD,IACCA,EAAQY,eAAe,SAC1BZ,EAAUA,EAAQrQ,KAGfoN,GAAOiD,YAAmBhD,YAC7BgD,EAAUrQ,EAAI4O,OAAOyB,IAGC,gBAAZA,IAAwBpU,MAAM+B,OAAO2H,KAAK0K,KACpDC,EAAc,mBAGTrD,GAAMoD,YAAmBnD,cAAkBC,GAAQkD,YAAmBjV,OAAWiV,YAAmBxV,MAAWwV,YAAmBrY,WACvIsY,EAAc,mBACdD,EAAU1B,EAAKuC,OAAOb,IAGH,OAAhBC,IAAyBrD,GAAMoD,YAAmBnD,cAAeC,GAAQkD,YAAmBjV,SAC/FkV,EAAc,4BAGK,OAAhBA,IACHA,EAAc,uDAKXtD,EAAOlP,KAAQiQ,GAAQf,EAAOO,QAAU,KAC5B,OAAZvB,IACHA,MAGqB,gBAAXiD,IAAuBA,EAAOjD,QAAQiF,eAAe,UAC/DjF,EAAQmF,KAAOlC,EAAOjD,QAAQmF,MAGX,OAAhBb,IACHtE,EAAQ,gBAAkBsE,GAGvBtE,EAAQiF,eAAe,mBACnBjF,GAAQwD,SAGhBxD,EAAQ,oBAAsB,iBAE9BtK,QAAQC,QAAQqK,EAAS,SAAU5E,EAAGiC,GAC3B,OAANjC,GAAoB,oBAANiC,GACjB6G,EAAK5D,IAAI8E,iBAAiB/H,EAAGjC,KAKS,iBAA7B8I,GAAK5D,IAAI+E,iBAA6C,OAAZrF,GAAuD,iBAA5BA,GAAQqF,kBACvFnB,EAAK5D,IAAI+E,gBAAkBrF,EAAQqF,kBAIrCnB,EAAKvN,GAAG,OAAQ,WACf,GAAI2O,GAAMtE,EAAOlP,IAA8B5F,SAAxBgY,EAAK5D,IAAImE,WAC5Bc,GAAS,EACT/M,EAAItM,OACJsZ,EAAItZ,OACJuZ,EAAIvZ,OACJwZ,EAAWxZ,MAEf,IAAKoZ,GAA+B,IAAxBpB,EAAK5D,IAAImE,WAoFVa,IACVE,EAAIxE,EAAO1D,MAAM4G,EAAK5D,IAAK,cAC3BjM,EAAMK,IAAIiL,EAAK,aAAcqB,EAAOY,KAAK,SACzCvN,EAAMK,IAAIiL,EAAK,WAAY6F,GAC3BtB,EAAKtD,QAAQ4E,QAvFb,QAAQtB,EAAK5D,IAAIoE,QAChB,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,KAGJ,GAFAlM,EAAIwI,EAAOhB,QAAQkE,EAAK5D,IAAKX,EAAKqC,EAAMhC,GAE3B,SAATgC,EACH,MAAOkC,GAAKtD,QAAQpI,EAAEwH,QAChB,IAAa,YAATgC,EACV,MAAOkC,GAAKtD,QAAQpI,EAAEwH,QAwBvB,QAvBoB,WAATgC,GACN3T,GAAU4B,MAAMgD,KAAK0G,KAAKnB,EAAEwH,QAAQ,oBACvCuF,GAAS,GAGNtV,MAAM0B,UAAUgI,KAAKuK,EAAK5D,IAAIoE,UACjCe,EAAIjN,EAAEwH,QAAQ,iBAAmB,GACjCwF,EAAIxE,EAAO1D,MAAM4G,EAAK5D,IAAKmF,GAEjBvZ,SAANsZ,GACHtB,EAAKzG,OAAO,GAAIxH,OAAMC,EAAMyP,eAIjB,QAAT3D,GAAkBuD,GAAU/M,EAAE2J,SACjC9N,EAAMK,IAAIiL,EAAK,WAAYnH,EAAEsM,SAAWpP,QAAQwD,MAAMsM,GAAG,IAEzDnR,EAAMqL,OAAOC,GAAK,IAEA,WAATqC,GACV3N,EAAMqL,OAAOC,GAAK,GAGXuE,EAAK5D,IAAIoE,QAChB,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,KACJR,EAAKtD,QAAQ4E,EACb,MACD,KAAK,KACwBtZ,SAAvBsM,EAAEwH,QAAQ7R,WAA0B6N,OAAOyG,QAAQjK,EAAEwH,QAAQ7R,WAAe6N,OAAO4J,MAAMJ,IAG7FE,EAAW1J,OAAOwF,KAAKhJ,EAAEwH,QAAQ6F,UAAYL,GAC7CxE,EAAOmD,QAAQuB,GAAU3E,KAAK,SAAU7L,GAC1B,QAAT8M,GAAkBuD,GAAU/M,EAAE2J,UACjC9N,EAAMK,IAAIiL,EAAK,WAAYzK,GAG5BgP,EAAKtD,QAAQ1L,IACX,SAAUqH,GACZ2H,EAAKzG,OAAOlB,MAVb2H,EAAKtD,QAAQ4E,EAad,MACD,KAAK,KACL,IAAK,KACJtB,EAAKtD,QAAQ,MAGf,KACD,KAAK,KACJsD,EAAKtD,QAAQ4E,EACb,MACD,KAAK,KACJtB,EAAKzG,OAAO,GAAIxH,OAAMiO,EAAK5D,IAAIoC,cAAgBxM,EAAM4P,oBACrD,MACD,KAAK,KACJzR,EAAMK,IAAIiL,EAAK,cAAeqB,EAAOY,KAAKI,KAC1CkC,EAAKzG,OAAO,GAAIxH,OAAMiO,EAAK5D,IAAIoC,cAAgBxM,EAAM6P,iBACrD,MACD,KAAK,KACJ1R,EAAMK,IAAIiL,EAAK,cAAeqB,EAAOY,KAAKI,KAC1CkC,EAAKzG,OAAO,GAAIxH,OAAMiO,EAAK5D,IAAIoC,cAAgBxM,EAAM8P,qBACrD,MACD,SACC9B,EAAKzG,OAAO,GAAIxH,OAAMiO,EAAK5D,IAAIoC,cAAgBxM,EAAMyP,iBAUzDzB,EAAKvN,GAAG,QAAS,SAAU4F,GAC1B2H,EAAKzG,OAAOlB,KAIb2H,EAAK5D,IAAI2F,KAAiB,OAAZ5B,EAAmBA,EAAUnY,UAItCgY,GAaRgC,OAAQ,SAAgBC,EAAMC,GAC7B,GAAI5F,GAAQC,IACRzH,EAAQgI,EAAOqF,YACfZ,EAAI,CAeR,OAbAW,IAAO3N,MAAM2N,GAAW,IAALA,GAAY,IAE/B1Q,QAAQyE,OAAO,WACd,GAAImM,GAAMhH,EAAKiH,OAAOvN,EAAM,GAAIA,EAAM,GAAImN,EAAK,GAAIA,EAAK,KAAMV,EAAI,IAIlE,OAFAe,QAAOC,SAASH,EAAI,GAAIA,EAAI,IAElB,MAANb,GACHjF,EAAMI,SAAQ,IACP,GAFR,QAIEwF,EAAI,aAEA5F,GAWR6F,UAAW,WACV,OAAQG,OAAOE,SAAW,EAAGF,OAAOG,SAAW,KAO7C9D,GAUHD,OAAQ,SAAgB1N,GACvB,GAAI0R,GAA6B1a,SAAjBiI,UAAU,GAAmB,IAAMA,UAAU,GAEzDlE,MAAQ,GAAI4W,QAAOD,EAAY,kCAC/BE,EAAO9K,OAAOwF,KAAKtM,GAAKgH,MAAM,MAC9BzF,EAAOqQ,EAAKC,QAAQ7K,MAAM0K,GAC1B/N,EAAS3M,MAab,OAXA2M,GAASiO,EAAKvN,IAAI,SAAUiM,GAC3B,GAAIpP,MACA4Q,EAAMxB,EAAEtJ,MAAMjM,MAMlB,OAJAuG,OAAMwD,KAAKvD,EAAM,SAAU/I,EAAGyK,GAC7B/B,EAAI1I,GAAKgI,QAAQuR,QAAQD,EAAI7O,IAAQ,IAAI2D,QAAQ,SAAU,OAGrD1F,KAuBT8O,OAAQ,SAAgBhQ,GACvB,GAAI0R,GAA6B1a,SAAjBiI,UAAU,GAAmB,IAAMA,UAAU,GACzDiO,EAA0BlW,SAAjBiI,UAAU,IAAmB,EAAOA,UAAU,GAEvDiC,EAAMuM,EAAKC,OAAO1N,GAAK,IAASA,EAChC2D,EAAS,GAGTqO,EAAU,SAAiBC,GAC9B,GAAIC,GAASlb,MAgBb,OAdIib,aAAiB3R,QACpB4R,EAAS,IAAOD,EAAM5I,WAAa,IAE/BtO,MAAM6C,YAAY6G,KAAKyN,KAC1BA,EAAS,IAAOvE,EAAIqC,OAAOiC,EAAOP,GAAa,MAGhDQ,EADUD,YAAiBnb,QAClB,IAAO6W,EAAIqC,OAAOiC,EAAOP,GAAa,IACrC3W,MAAMa,UAAU6I,KAAKwN,GACtB,IAAOA,EAAMrL,QAAQ,KAAM,MAAU,IAErCqL,EAGHC,EAuBR,OApBIhR,aAAeZ,OACdY,EAAI,YAAcpK,SACjBoW,IACHvJ,EAASrC,MAAMC,KAAKL,EAAI,IAAIsG,KAAKkK,GAAa,MAG/C/N,GAAUzC,EAAImD,IAAI,SAAU7L,GAC3B,MAAOmV,GAAIqC,OAAOxX,EAAGkZ,GAAW,KAC9BlK,KAAK,OAER7D,GAAUqO,EAAQ9Q,EAAKwQ,GAAa,MAGjCxE,IACHvJ,EAASrC,MAAMC,KAAKL,GAAKsG,KAAKkK,GAAa,MAG5C/N,GAAUrC,MAAM+B,KAAKnC,GAAKmD,IAAI2N,GAASxK,KAAKkK,GAAa,MAGnD/N,EAAOiD,QAAQ7L,MAAMkB,OAAQ,MAIlCkW,EAAiB,SAAWC,GAgB/B,QAASD,GAAexD,EAAS0D,EAAMC,GACtCra,gBAAgBiH,KAAMiT,GAEtB3b,KAAKM,OAAOI,eAAeib,EAAeza,WAAY,cAAewH,MAAM7H,KAAK6H,MAEhFA,KAAKoT,SAAWA,EAChBpT,KAAKyP,QAAUA,EACfzP,KAAKqT,WACLrT,KAAKmT,KAAOA,EACZnT,KAAK8C,SAAWF,IAsGjB,MAnGAxK,WAAU6a,EAAgBC,GAE1Bha,aAAa+Z,IACZvZ,IAAK,MAcLzB,MAAO,SAAaqb,GACnB,GAAIC,GAASvT,IAOb,OALAA,MAAKqT,WACLjR,MAAMwD,KAAKgC,OAAOC,QAAQyL,GAAS,SAAUtM,GAC5CuM,EAAOF,QAAQrM,GAAK,KAGdhH,QAGRtG,IAAK,WAWLzB,MAAO,WAKN,MAJA+H,MAAK8C,SAAS0Q,OAAOxT,KAAKyP,QAAS,SACnCzP,KAAK8C,SAAS0Q,OAAOxT,KAAKyP,QAAS,SACnCzP,KAAKyP,QAAU,KAERzP,QAGRtG,IAAK,SAaLzB,MAAO,WACN,GAAIwb,GAASzT,IAkCb,OAhCAsB,SAAQ8K,MAAM,WACb,GAAIpI,GAAMyL,EAAQzL,IAAIyP,EAAOhE,SAAStF,UAEtCsJ,GAAON,KAAKlR,SAAS,eAAgBwR,EAAOhE,QAASzL,GAEhD4D,OAAOyG,QAAQrK,GAmBnByP,EAAON,KAAK7N,OAAS,MAlBrBhE,QAAQC,QAAQkS,EAAOJ,QAAS,SAAUrM,EAAGiC,GAC5C,GAAItB,GAAUC,OAAOC,QAAQ7D,EAG7B2D,GAAUA,EAAQrC,OAAO,SAAUhM,GAClC,OAAQsO,OAAOyG,QAAQ/U,KAIxB8I,MAAMwD,KAAK+B,EAAS,SAAUrO,EAAGyK,GAChC4D,EAAQ5D,GAAO,MAAQ6D,OAAO8L,OAAOpa,GAAGoO,QAAQ,aAAc,IAAIA,QAAQ,MAAO,MAAQ,OAG1F+L,EAAOJ,QAAQpK,GAAKtB,EAAQW,KAAK,OAGlCmL,EAAON,KAAK7N,OAASmO,EAAOJ,SAK7BI,EAAON,KAAKQ,UAAY,EACxBF,EAAON,KAAKS,UACZH,EAAON,KAAKlR,SAAS,cAAewR,EAAOhE,UACzCzP,KAAKoT,SAAUpT,KAAKyP,QAAQvN,GAAK,YAE7BlC,SAIFiT,GACLpQ,GAiBCyC,EAAS,SAAgBlM,EAAQ+Z,EAAME,GAC1C,GAAID,GAA4Btb,SAAjBiI,UAAU,GAAmB,IAAMA,UAAU,GAExD8T,GAAOV,GACPnR,EAAM,GAAIiR,GAAe7Z,EAAQya,EAAI,GAAIT,GAAU9S,IAAI+S,EAW3D,OARA5D,GAAQqE,KAAK1a,EAAQ,OAAQ,QAG7B4I,EAAIc,SAASU,KAAKxB,EAAIyN,QAAS,SAC/BzN,EAAIc,SAASU,KAAKxB,EAAIyN,QAAS,SAC/BzN,EAAIO,GAAG,QAASP,EAAI+R,OAAQ,SAC5B/R,EAAIO,GAAG,QAASP,EAAI+R,OAAQ,SAErB/R,GAGJgS,EAAW,SAAWC,GAoBzB,QAASD,GAAS5a,EAAQ8a,MAAOZ,GAChC,GAAIa,GAA4Brc,SAAjBiI,UAAU,MAAwBA,UAAU,GACvDqU,EAA2Btc,SAAjBiI,UAAU,MAAwBA,UAAU,GACtDsU,EAA4Bvc,SAAjBiI,UAAU,IAAmB,EAAQA,UAAU,EAE9DhH,iBAAgBiH,KAAMgU,GAEtB1c,KAAKM,OAAOI,eAAegc,EAASxb,WAAY,cAAewH,MAAM7H,KAAK6H,KAE1E,IAAIsU,GAAYxc,MAEZsc,GAAQG,QAAU3M,OAAOyG,QAAQ+F,EAAQG,SAC5CD,EAAY1M,OAAOC,QAAQuM,EAAQG,OAAOpP,IAAI,SAAU7L,GACvD,MAAOA,GAAEoO,QAAQ7L,MAAMC,YAAa,OAItCkE,KAAKyP,QAAUA,EAAQhX,OAAO,WAAa+b,QAAS,QAAUpb,GAC9D4G,KAAKsT,OAASA,EACdtT,KAAKqU,SAAWA,EAChBrU,KAAKmT,KAAO,KACZnT,KAAK8C,SAAWF,IAChB5C,KAAKoU,QAAUA,EACfpU,KAAKkU,MAAQA,MACblU,KAAKmU,SAAWA,EAChBnU,KAAKsU,UAAYA,GAAaH,EAkL/B,MA/KA/b,WAAU4b,EAAUC,GAEpB/a,aAAa8a,IACZta,IAAK,MAYLzB,MAAO,SAAawc,GACnB,GAAIC,GAAS1U,IAOb,OALAA,MAAKkU,MAAM5T,IAAI,KAAMmU,GAAQ9H,KAAK,KAAM,SAAUxE,GACjD7G,QAAQqT,MAAMxM,GACduM,EAAOzS,SAAS,QAASkG,KAGnBnI,QAGRtG,IAAK,OAWLzB,MAAO,WACN,MAAO+H,MAAKkU,MAAMU,KAAK5U,KAAKmT,KAAK0B,QAAS7U,KAAKsT,WAGhD5Z,IAAK,UAaLzB,MAAO,WACN,GAAI6c,GAAS9U,KAEToI,IAkBJ,OAjBApI,MAAKiC,SAAS,gBAAiBjC,KAAKyP,SAEhCzP,KAAKsU,UAAU/a,OAAS,IAC3B6I,MAAMwD,KAAK5F,KAAKsU,UAAW,SAAUhb,GACpC,GAAI0I,GAAMyN,EAAQsF,KAAKD,EAAOrF,QAAS,4BAA8BnW,EAAI,MAAM,EAE/E8O,GAAKxE,KAAKgE,OAAOwF,KAAK9T,EAAI,KAAOmW,EAAQuF,KAAKhT,EAAK,SAAW,QAG/DhC,KAAKoU,QAAQG,MAAQvU,KAAKmT,KAAKoB,MAAQnM,EAAKE,KAAK,OAGlDtI,KAAKmT,KAAK8B,MAAQ,KAClB3T,QAAQwH,MAAM9I,KAAKmT,KAAMnT,KAAKoU,SAC9BpU,KAAKmT,KAAKS,UACV5T,KAAKiC,SAAS,eAAgBjC,KAAKyP,SAE5BzP,QAGRtG,IAAK,SAYLzB,MAAO,SAAgBwc,GACtB,GAAIS,GAASlV,IAOb,OALAA,MAAKkU,MAAMvX,IAAI8X,GAAQ9H,KAAK,KAAM,SAAUxE,GAC3C7G,QAAQqT,MAAMxM,GACd+M,EAAOjT,SAAS,QAASkG,KAGnBnI,QAGRtG,IAAK,OAULzB,MAAO,SAAciJ,GACpB,GAAI9H,GAASkI,QAAQlI,OAAO8H,GACxBiU,EAAQrd,MAcZ,OAXAwJ,SAAQ8T,KAAKlU,GAGTuO,EAAQ4F,SAASjc,EAAQ,cAC5B+b,EAAQ1F,EAAQuF,KAAK5b,EAAQ,SAC7BqW,EAAQuF,KAAK5b,EAAQ,OAAyC,QAAjCqW,EAAQuF,KAAK5b,EAAQ,QAAoB,OAAS,OAC/EgJ,MAAMhC,OAAOJ,KAAKsU,UAAWa,GAC7BnV,KAAKsU,UAAUgB,OAAO,EAAG,EAAGH,GAC5BnV,KAAK4T,WAGC5T,QAGRtG,IAAK,WAWLzB,MAAO,WAMN,MALA+H,MAAK8C,SAAS0Q,OAAO/D,EAAQsF,KAAK/U,KAAKyP,QAAS,aAAa,GAAI,SACjEzP,KAAKmT,KAAKoC,WACV9F,EAAQC,QAAQ1P,KAAKyP,SACrBzP,KAAKyP,QAAU,KAERzP,QAGRtG,IAAK,SAaLzB,MAAO,SAAgByB,EAAKsb,GAC3B,GAAIQ,GAAUxV,IAOd,OALAA,MAAKkU,MAAMH,OAAOra,EAAKsb,GAAMrI,KAAK,KAAM,SAAUxE,GACjD7G,QAAQqT,MAAMxM,GACdqN,EAAQvT,SAAS,QAASkG,KAGpBnI,SAIFgU,GACLnR,GA0BC4S,EAAO,SAAcrc,EAAQ8a,MAAOZ,EAAQa,EAAUC,EAASC,GAClE,GAAIjB,GAA4Btb,SAAjBiI,UAAU,GAAmB,IAAMA,UAAU,GAExD8T,GAAOK,OACPlS,EAAM,GAAIgS,GAAS5a,EAAQya,EAAI,GAAIP,EAAQa,EAAUC,EAASC,GAC9DqB,EAAW,GACX1H,EAASyB,EAAQhX,OAAO,QAAUgX,EAAQhX,OAAO,MAAQ+b,QAAS,UAAYxS,EAAIyN,UAClFkG,EAAQ,IAAM3T,EAAIsR,OAAO/Z,OAAS,IAClCqc,EAAM,8BAAgCD,EACtCvN,EAAOpG,EAAIoS,QAAQG,MAAQ3M,OAAOC,QAAQ7F,EAAIoS,QAAQG,SAmF1D,OAhFAnS,OAAMwD,KAAK5D,EAAIsR,OAAQ,SAAUha,GAChC,GAAIuc,GAAUvc,EAAEoO,QAAQ,QAAS,IAC7BoO,EAAKrG,EAAQhX,OAAO,QACvBsd,UAAWnO,OAAOoO,WAAWpO,OAAOqO,YAAYrO,OAAOsO,YAAYL,GAAS,IAAOnO,QAAQ,OAAQ,MAAM,GACzGyO,MAAOP,EACPQ,aAAc9c,GACZ0U,EAGC5L,OAAMuB,SAAS3B,EAAImS,SAAU7a,KAChCmW,EAAQ4G,SAASP,EAAI,YAGjB1N,EAAK9C,OAAO,SAAU+F,GACzB,MAAwB,KAAjBA,EAAErG,QAAQ1L,KACfC,OAAS,GACXkW,EAAQuF,KAAKc,EAAI,OAAQ1T,MAAMuB,SAASyE,EAAM9O,EAAI,SAAW,OAAS,QAIxEoc,GAAY,gBAAmBpc,EAAI,iBAAqBA,EAAI,YAAgBsc,EAAM,OAAUtc,EAAI,cAI7F0I,EAAImS,SAAS5a,OAAS,GACzByI,EAAIc,SAASU,KAAKwK,EAAOsI,WAAY,QAAStU,EAAIoG,KAAM,OAAQpG,GAG7DA,EAAIqS,YAAa,IACpBrS,EAAIoS,QAAQmC,cAAe,EAC3BvU,EAAIoS,QAAQoC,WAAaxU,EAAIsR,OAAOhL,KAAK,MAG1CtG,EAAIoS,QAAQhB,SAAWA,EAGvBS,EAAIjQ,KAAKuP,EAAKvS,QAAQoB,EAAIyN,QAASoE,EAAI,GAAI6B,EAAU1T,EAAIoS,UAGzDpS,EAAImR,KAAOU,EAAI,GAGf7R,EAAIO,GAAG,gBAAiB,SAAUzB,GACjC2O,EAAQxN,SAASnB,EAAK,kBACpB,UAEHkB,EAAIO,GAAG,eAAgB,SAAUzB,GAChC2O,EAAQxN,SAASnB,EAAK,iBACpB,UAEHkB,EAAIO,GAAG,QAAS,SAAU4F,GACrBsH,EAAQ4F,SAASlN,EAAEsO,cAAe,WACrCzU,EAAIoG,KAAKD,IAER,UAEHnG,EAAImR,KAAK5Q,GAAG,SAAU,WACrB,IAAK,GAAImU,GAAQ3W,UAAUxG,OAAQ2C,EAAOkF,MAAMsV,GAAQC,EAAQ,EAAWD,EAARC,EAAeA,IACjFza,EAAKya,GAAS5W,UAAU4W,EAGzB3U,GAAIC,SAASR,MAAMO,GAAM,UAAU2D,OAAOzJ,KACxC,UAEH8F,EAAImR,KAAK5Q,GAAG,eAAgB,WAC3B,IAAK,GAAIqU,GAAQ7W,UAAUxG,OAAQ2C,EAAOkF,MAAMwV,GAAQC,EAAQ,EAAWD,EAARC,EAAeA,IACjF3a,EAAK2a,GAAS9W,UAAU8W,EAGzB7U,GAAIC,SAASR,MAAMO,GAAM,gBAAgB2D,OAAOzJ,KAC9C,gBAEH8F,EAAImR,KAAK5Q,GAAG,cAAe,WAC1B,IAAK,GAAIuU,GAAQ/W,UAAUxG,OAAQ2C,EAAOkF,MAAM0V,GAAQC,EAAQ,EAAWD,EAARC,EAAeA,IACjF7a,EAAK6a,GAAShX,UAAUgX,EAGzB/U,GAAIC,SAASR,MAAMO,GAAM,eAAe2D,OAAOzJ,KAC7C,eAEI8F,GAGJgV,EAAW,SAAWC,GAYzB,QAASD,GAASvH,EAASyE,MAAOwB,GACjC3c,gBAAgBiH,KAAMgX,GAEtB1f,KAAKM,OAAOI,eAAegf,EAASxe,WAAY,cAAewH,MAAM7H,KAAK6H,MAE1EA,KAAKoP,SAAW,KAChBpP,KAAKkX,WACLlX,KAAKyP,QAAUA,EACfzP,KAAKmX,SAAWrV,EAAMsV,OACtBpX,KAAKsF,OAAS,KACdtF,KAAKqU,YACLrU,KAAKkC,GAAKZ,QAAQiO,QAClBvP,KAAK8N,SACL9N,KAAKwW,WAAa,KAClBxW,KAAK7F,SAAW,KAChB6F,KAAK8C,SAAWF,IAChB5C,KAAK2T,UAAY,EACjB3T,KAAKqX,SAAW,KAChBrX,KAAKsX,UAAY,EACjBtX,KAAKuX,WAAa,SAClBvX,KAAKwX,YAAc,GACnBxX,KAAKuU,MAAQ,GACbvU,KAAK6U,WACL7U,KAAK0V,SAAWA,EAChB1V,KAAKqK,MAAQ,EACbrK,KAAKkU,MAAQA,MACblU,KAAKiV,MAAQ,KAiiBd,MA9hBA7c,WAAU4e,EAAUC,GAEpB/d,aAAa8d,IACZtd,IAAK,MAYLzB,MAAO,SAAawc,GACnB,GAAIgD,GAAUzX,IAOd,OALAA,MAAKkU,MAAM5T,IAAI,KAAMmU,GAAQ9H,KAAK,KAAM,SAAUxE,GACjD7G,QAAQqT,MAAMxM,GACdsP,EAAQxV,SAAS,QAASkG,KAGpBnI,QAGRtG,IAAK,OAWLzB,MAAO,WACN,MAAO+H,MAAKkU,MAAMU,KAAK5U,KAAK6U,YAG7Bnb,IAAK,OAYLzB,MAAO,SAAcoP,GAGpB,MAFArH,MAAK2T,UAAYtM,EAEVrH,KAAK4T,aAGbla,IAAK,QAWLzB,MAAO,WACN,GAAIyf,GAAU1X,KAEVgC,EAAMhC,KAAKyP,QACXkI,EAAO3X,KAAK2T,UACZzB,EAAMlS,KAAKuX,WACXpO,EAAQnJ,KAAKsX,UACb1O,EAAM3E,KAAKC,MAAMiF,EAAQ,GACzBvE,EAAQ+S,EAAO/O,EACfU,EAAMqO,EAAO/O,EACbyB,EAAQ8I,EAAKyE,MAAM5X,MACnBqF,EAAOvN,MAWX,OARAsK,OAAMwD,KAAKtE,QAAQsO,IAAI,IAAM5N,EAAIE,GAAK,gBAAkBF,EAAIE,GAAK,iBAAkB,SAAU5I,GACxFA,IACHoe,EAAQ5U,SAAS0Q,OAAOla,EAAG,SAC3BmW,EAAQC,QAAQpW,MAKd0G,KAAKsF,QAAmC,IAAzBtF,KAAKqU,SAAS9a,QAA+B,IAAfyG,KAAKqK,OAAyB,IAAVA,EAC7DrK,MAII,EAAR4E,IACHS,EAAOjH,EAAOiH,KAAKT,EAAO,GAC1BA,GAAgBS,EAChBiE,GAAYjE,GAGTiE,EAAMe,IACTf,EAAMe,EACNzF,EAAQ0E,EAAMH,EAAQ,EAEV,EAARvE,IACHA,EAAQ,IAINxG,EAAOiH,KAAKT,EAAO0E,IAAQH,KAC5BG,EAGHlH,MAAMwD,KAAKgC,OAAOC,QAAQqK,GAAM,SAAU5Y,GACzC,GAAI4d,IAAU,EACVW,EAAOF,EAAO,EACdnX,EAAmB6J,GAAZsN,EAAO,EACdxX,EAAOwX,GAAQtN,EACfyL,EAAKhe,OACLuP,EAAIvP,MAwBR,KArBAge,EAAKrG,EAAQhX,OAAO,MACnB+b,QAAS,qBAAuBlb,EAChC4I,GAAIF,EAAIE,GAAK,UAAY5I,GACvB0I,EAAW,WAAN1I,EAAiB,QAAU,UAGnCmW,EAAQhX,OAAOof,EAAO,IAAM,QAC3BrD,QAAS,aACTsD,YAAa,EACb/B,UAAW,YACTtG,EAAQhX,OAAO,QAAUqd,IAG5BrG,EAAQhX,OAAOof,EAAO,IAAM,QAC3BrD,QAAS,YACTsD,YAAaH,EAAO,EACpB5B,UAAW,QACTtG,EAAQhX,OAAO,QAAUqd,IAG5BzO,EAAIzC,EAAQ,IACHyC,GAAKiC,GACb4N,EAAU7P,IAAMsQ,EAChBlI,EAAQhX,OAAOye,EAAU,OAAS,KACjC1C,QAAS0C,EAAU,eAAiB,OACpCY,YAAazQ,EACb0O,UAAW1O,GACToI,EAAQhX,OAAO,QAAUqd,GAI7BrG,GAAQhX,OAAO+H,EAAO,IAAM,QAC3BgU,QAAS,YACTsD,YAAatX,EAAOmX,EAAO,EAAI,KAC/B5B,UAAW,QACTtG,EAAQhX,OAAO,QAAUqd,IAG5BrG,EAAQhX,OAAO0H,EAAO,OAAS,KAC9BqU,QAAS,YACTsD,YAAa3X,EAAO,KAAOkK,EAC3B0L,UAAW,YACTtG,EAAQhX,OAAO,QAAUqd,IAG5BrG,EAAQsI,YAAYjC,EAAI,UAGxB4B,EAAQ5U,SAASU,KAAKsS,EAAI,WAGpB9V,SAGRtG,IAAK,UAgBLzB,MAAO,WACN,GAAI+f,GAAUhY,KAEVvH,EAA0BX,SAAjBiI,UAAU,IAAmB,EAAQA,UAAU,GAExD+V,EAAK9V,KAAKyP,QACViG,EAAoC,gBAAlB1V,MAAK0V,SACvBpQ,EAAyB,OAAhBtF,KAAKsF,OACdwI,KACAsB,EAAoC,kBAAlBpP,MAAKoP,SACvB6I,EAAM,GAAIxF,QACVyF,KACA/O,KACAjE,EAAKpN,OACLqgB,EAAUrgB,OACV0I,EAAO1I,MA6MX,OA3MAkI,MAAKiC,SAAS,gBAAiB6T,GA8B9B5Q,EA3BIwQ,EA2BC,SAAUpc,GACd,GAAI0I,GAAMuM,EAAKuC,OAAOkH,EAAQtC,UAC1B5H,EAAQ1L,MAAM6I,OAAOjJ,EAAIoW,MAAM;;AAmBnC,MAhBApW,GAAMA,EAAI0F,QAAQ,KAAOsQ,EAAQ9D,MAAMxa,IAAM,KAAMJ,EAAEI,KAGrD0I,MAAMwD,KAAKkI,EAAO,SAAUgG,GAC3B,GAAIpa,GAAMoa,EAAKpM,QAAQ,aAAc,IACjCzP,EAAQqJ,QAAQ+W,KAAK/e,EAAE0b,KAAMtb,IAAQ,EAEzCue,GAAIK,QAAQ1Q,OAAO8L,OAAOI,GAAO,KAGjC9R,EAAMA,EAAI0F,QAAQuQ,EAAK1J,EAAKuC,OAAO7Y,GAAOyP,QAAQ,aAAc,OAIjE1F,EAAMuM,EAAKC,OAAOxM,EAAI0F,QAAQ,cAAesQ,EAAQR,eAE5Ce,GAAIvW,IA/CT,SAAU1I,GACd,GAAIgE,GAAO0a,EAAQtC,SACf5H,EAAQ1L,MAAM6I,OAAO3N,EAAK8a,MAAM,0BAqBpC,OAlBA9a,GAAOA,EAAKoK,QAAQ,KAAOsQ,EAAQ9D,MAAMxa,IAAM,KAAMJ,EAAEI,KAGvD0I,MAAMwD,KAAKkI,EAAO,SAAUgG,GAC3B,GAAIpa,GAAMoa,EAAKpM,QAAQ,aAAc,IACjCzP,EAAQqJ,QAAQ+W,KAAK/e,EAAE0b,KAAMtb,EAEnB5B,UAAVG,IACHA,EAAQ,IAGTggB,EAAIK,QAAQ1Q,OAAO8L,OAAOI,GAAO,KACjCxW,EAAOA,EAAKoK,QAAQuQ,EAAKhgB,KAI1BqF,EAAOA,EAAKoK,QAAQ,cAAesQ,EAAQR,aAEpC,iBAAoBle,EAAEI,IAAM,KAAQ4D,EAAO,SA6BpDkD,EAAO,SAAUtE,GAqChB,GAnCA8b,EAAQnD,QAAU3Y,EAClB8b,EAAQ3N,MAAQ2N,EAAQnD,QAAQtb,OAChCye,EAAQ3D,YAGR2D,EAAQd,WAGJ5R,GACHlD,MAAMwD,KAAKoS,EAAQnD,QAAS,SAAUvb,GACrCgI,QAAQC,QAAQyW,EAAQ1S,OAAQ,SAAU0B,EAAGiC,GAC5C,GAAIvP,GAAM5B,MAEV,OAAIsK,OAAMuB,SAASuU,EAAU5e,EAAEI,MACvB,GAGRA,EAAMuP,IAAM+O,EAAQ9D,MAAMxa,QAE1B0I,OAAMwD,KAAKgC,OAAOC,QAAQb,GAAI,SAAUQ,GACvC,GAAIyQ,GAAM,GAAIxF,QAAOjL,EAAO,KACxBvP,EAASyB,EAAgC,GAA1B4H,QAAQ+W,KAAK/e,EAAE0b,KAAM/L,EAExC,OAAIvP,IAAOue,EAAI1S,KAAKjM,EAAEI,MAAQue,EAAI1S,KAAKtN,IACtCigB,EAAStU,KAAKtK,EAAEI,KAChBse,EAAQ3D,SAASzQ,KAAKtK,IAEf,GAJR,cAYqB,OAArB0e,EAAQX,UAAsBhT,MAAM2T,EAAQrE,YAAetP,MAAM2T,EAAQX,UAa5EW,EAAQd,QAAW5R,EAA2B0S,EAAQ3D,SAA1B2D,EAAQnD,YAbmD,CAIvF,GAHAsD,EAAUhF,EAAKyE,MAAMI,GAGjBG,EAAU,GAAKH,EAAQrE,UAAYwE,EACtC,MAAOH,GAAQL,KAAKQ,EAGZH,GAAQ3N,MAAQ,IACxBlB,EAAQgK,EAAKhK,MAAM6O,GACnBA,EAAQd,QAAU9U,MAAMrB,MAAOuE,EAA2B0S,EAAQ3D,SAA1B2D,EAAQnD,QAA4B1L,EAAM,GAAIA,EAAM,KAO9F/G,MAAMwD,KAAKoS,EAAQd,QAAS,SAAU5d,GACrC,GAAIgE,GAAO4H,EAAG5L,GACV6D,EAAOrC,EAAKwC,EAEhBwQ,GAAMlK,MAAOlK,IAAKJ,EAAEI,IAAKgc,SAAUpY,EAAMH,KAAMA,MAIhDmE,QAAQkX,OAAO,WACd,GAAI9I,MACA+I,KACAnf,EAAIxB,OACJ4M,EAAM5M,MAEV,IAAqB,IAAjBgW,EAAMvU,OACTkW,EAAQnS,KAAKwY,EAAI,qBAAyBkC,EAAQb,SAAW,aAE7D,IAA6B,IAAzBa,EAAQlK,MAAMvU,OACjBkW,EAAQnS,KAAKwY,EAAIhI,EAAM3I,IAAI,SAAU7L,GACpC,MAAOA,GAAEoc,WACPpN,KAAK,KAEJ8G,GACHhN,MAAMwD,KAAKxD,MAAM+B,KAAK2R,EAAG4C,YAAa,SAAUpf,GAC/C0e,EAAQ5I,SAAS9V,SAGb,CAWN,GAVA8I,MAAMwD,KAAKkI,EAAO,SAAUxU,EAAGyK,GACHjM,SAAvBkgB,EAAQlK,MAAM/J,IAAsBiU,EAAQlK,MAAM/J,GAAK5G,OAAS7D,EAAE6D,MACrEsS,EAAQuF,KAAKvF,EAAQnS,KAAKwY,EAAG4C,WAAW3U,GAAMzK,EAAEoc,SAAShO,QAAQ,gCAAiC,KAAM,MAAOpO,EAAEI,KACjH+e,EAAU7U,KAAKG,IACkBjM,SAAvBkgB,EAAQlK,MAAM/J,KACxB0L,EAAQhX,OAAOa,EAAEoc,SAAU,KAAMI,GACjC2C,EAAU7U,KAAKG,MAIb+J,EAAMvU,OAASye,EAAQlK,MAAMvU,OAAQ,CAIxC,IAHAD,EAAIwU,EAAMvU,OAAS,EACnBmL,EAAMsT,EAAQlK,MAAMvU,SAEXD,EAAIoL,GACZgL,EAAQ9L,KAAKtK,EAGd8I,OAAMwD,KAAK8J,EAAQiJ,UAAW,SAAUrf,GACvCmW,EAAQC,QAAQoG,EAAG4C,WAAWpf,MAI5B8V,GACHhN,MAAMwD,KAAK6S,EAAW,SAAUnf,GAC/B0e,EAAQ5I,SAAS0G,EAAG4C,WAAWpf,MAOnC0e,EAAQlK,MAAQA,EAGS,OAArBkK,EAAQX,WAAqBxb,MAAM4D,WAAW8F,KAAKyS,EAAQT,aAAgBlT,MAAM2T,EAAQrE,YAAetP,MAAM2T,EAAQX,UAGzHjV,MAAMwD,KAAKtE,QAAQsX,EAAE,IAAM9C,EAAG5T,GAAK,gBAAkB4T,EAAG5T,GAAK,iBAAkB,SAAU5I,GACxFmW,EAAQC,QAAQpW,KAHjB0e,EAAQJ,QAOTI,EAAQ/V,SAAS,eAAgB6T,MAKhB,OAAf9V,KAAKiV,MACRrN,OAAOyG,QAAQrO,KAAKuU,OAAS/T,EAAKR,KAAKkU,MAAM3c,OAASyI,KAAKkU,MAAM9L,KAAKpI,KAAKuU,MAAO9b,GAAQkU,KAAKnM,EAAM,SAAU2H,GAC9G7G,QAAQqT,MAAMxM,GACd6P,EAAQ/V,SAAS,QAASkG,KAEjBP,OAAOyG,QAAQrO,KAAKuU,OAC9BvU,KAAKkU,MAAMhV,OAAOc,KAAKiV,OAAOtI,KAAKnM,EAAM,SAAU2H,GAClD7G,QAAQqT,MAAMxM,GACd6P,EAAQ/V,SAAS,QAASkG,KAG3BnI,KAAKkU,MAAM9L,KAAKpI,KAAKuU,MAAO9b,EAAQuH,KAAKiV,OAAOtI,KAAKnM,EAAM,SAAU2H,GACpE7G,QAAQqT,MAAMxM,GACd6P,EAAQ/V,SAAS,QAASkG,KAIrBnI,QAGRtG,IAAK,SAmBLzB,MAAO,SAAgBwc,GACtB,GAAIoE,GAAU7Y,IAOd,OALAA,MAAKkU,MAAMvX,IAAI8X,GAAQ9H,KAAK,KAAM,SAAUxE,GAC3C7G,QAAQqT,MAAMxM,GACd0Q,EAAQ5W,SAAS,QAASkG,KAGpBnI,QAGRtG,IAAK,OAYLzB,MAAO,SAAcsc,GAGpB,MAFAvU,MAAKuU,MAAQA,EAENvU,KAAK4T,aAGbla,IAAK,WAYLzB,MAAO,WACN,GAAI6gB,GAAU9Y,KAEV0P,EAA2B5X,SAAjBiI,UAAU,IAAmB,EAAQA,UAAU,GAEzD+V,EAAK9V,KAAKyP,QACVvN,EAAK4T,EAAG5T,EA8BZ,OA5BAE,OAAMwD,KAAK5F,KAAKkU,MAAM6E,MAAO,SAAUzf,EAAGyK,GACzC,MAAIzK,GAAE4I,KAAO4W,EAAQ5W,IACpBE,MAAMhC,OAAO0Y,EAAQ5E,MAAM6E,MAAOhV,IAE3B,GAHR,SAOG/D,KAAKwW,YACRxW,KAAKwW,WAAWjB,WAGjBnT,MAAMwD,KAAKtE,QAAQsX,EAAE,IAAM1W,EAAK,gBAAkBA,EAAK,iBAAkB,SAAU5I,GAClFwf,EAAQhW,SAAS0Q,OAAOla,EAAG,SAEvBoW,GACHD,EAAQC,QAAQpW,KAIlB0G,KAAK8C,SAAS0Q,OAAOsC,EAAI,SAErBpG,GACHD,EAAQC,QAAQoG,GAGjB9V,KAAKyP,QAAU,KAERzP,QAGRtG,IAAK,SAaLzB,MAAO,SAAgByB,EAAKsb,GAC3B,GAAIgE,GAAUhZ,IAOd,OALAA,MAAKkU,MAAMH,OAAOra,EAAKsb,GAAMrI,KAAK,KAAM,SAAUxE,GACjD7G,QAAQqT,MAAMxM,GACd6Q,EAAQ/W,SAAS,QAASkG,KAGpBnI,SAIFgX,GACLnU,GAKCsQ,GAgBHvS,QAAS,SAAiBxH,EAAQ8a,MAAOwB,EAAUtB,GAClD,GAAIP,IAAOK,OACPlS,EAAM,GAAIgV,GAASvH,EAAQhX,OAAO,MAAQ+b,QAAS,OAAQtS,GAAIZ,QAAQiO,MAAM,MAAM,IAASnW,GAASya,EAAI,GAAI6B,EA4DjH,OA1DItB,aAAmBxc,UAClBwc,EAAQmC,cAAgBnC,EAAQoC,aACnCxU,EAAIwU,WAAalR,EAAOmK,EAAQhX,OAAO,SACtCyJ,GAAIF,EAAIyN,QAAQvN,GAAK,UACrBsS,QAAS,SACTgD,YAAa,UACXpe,EAAQ,SAAU4I,EAAKoS,EAAQoC,WAAYpC,EAAQhB,gBAC/CgB,GAAQoC,iBACRpC,GAAQmC,mBACRnC,GAAQhB,UAGhB9R,QAAQwH,MAAM9G,EAAKoS,IAGpBpS,EAAIkS,MAAM6E,MAAMnV,KAAK5B,GAGrBA,EAAIO,GAAG,gBAAiB,SAAUzB,GACjC2O,EAAQxN,SAASnB,EAAK,kBACpB,UAEHkB,EAAIO,GAAG,eAAgB,SAAUzB,GAChC2O,EAAQxN,SAASnB,EAAK,iBACpB,UAEHkB,EAAIO,GAAG,SAAU,SAAUzB,GAC1B2O,EAAQxN,SAASD,EAAIyN,QAAS,SAAU3O,IACtC,UAEHkB,EAAIO,GAAG,QAAS,SAAU4F,GACzB,GAAI/O,GAASkI,QAAQlI,OAAO+O,GACxBwP,EAAO7f,MAEXwJ,SAAQ8T,KAAKjN,GAEW,MAApB/O,EAAO6f,WACVtB,EAAOlI,EAAQuF,KAAK5b,EAAQ,QAEvBiL,MAAMsT,IACV3V,EAAI2V,KAAKA,KAGT,cAECxd,IACH6H,EAAI7H,SAAW,GAAIC,kBAAiB,SAAU0G,GAC7CkB,EAAIC,SAAS,SAAUnB,KAGxBkB,EAAI7H,SAAS+e,QAAQlX,EAAIyN,SAAW0J,WAAW,EAAMC,SAAS,MAIzC,OAAlBpX,EAAIkS,MAAM3I,KAAgBvJ,EAAIkS,MAAMmF,SACvCrX,EAAI4R,UAGE5R,GAWR4V,MAAO,SAAe5V,GACrB,GAAIqC,MAAMrC,EAAIqV,UACb,KAAM,IAAIxV,OAAMC,EAAMC,iBAGvB,OAAOkC,MAAK8F,MAAO/H,EAAIsD,OAAqBtD,EAAIqS,SAAS9a,OAAzByI,EAAIqI,OAA+BrI,EAAIqV,WAWxElO,MAAO,SAAenH,GACrB,GAAI4C,GAAQ5C,EAAI2R,UAAY3R,EAAIqV,SAAWrV,EAAIqV,SAC3C/N,EAAMtH,EAAIqV,QAEd,QAAQzS,EAAO0E,KAIbgQ,EAAW,WAQd,QAASA,KACR,GAAIC,GAAUvZ,IAEdjH,iBAAgBiH,KAAMsZ,GAEtBtZ,KAAKwZ,QAAUA,EAAQ5Y,UACvBZ,KAAKyZ,UACLzZ,KAAK0Z,YACL1Z,KAAK2Z,UAGL3Z,KAAKwZ,QAAQ7M,KAAK,SAAU7L,GAC3BsB,MAAMwD,KAAK2T,EAAQE,OAAQ,SAAUngB,GACpCA,EAAEwH,KAGHsB,MAAMwD,KAAK2T,EAAQG,SAAU,SAAUpgB,GACtCA,EAAEwH,KAGHyY,EAAQG,YACRH,EAAQE,UACRF,EAAQI,WACN,SAAU7Y,GACZsB,MAAMwD,KAAK2T,EAAQI,OAAQ,SAAUrgB,GACpCA,EAAEwH,KAGHsB,MAAMwD,KAAK2T,EAAQG,SAAU,SAAUpgB,GACtCA,EAAEwH,KAGHyY,EAAQG,YACRH,EAAQE,UACRF,EAAQI,YAkKV,MA9JAzgB,cAAaogB,IACZ5f,IAAK,SAsBLzB,MAAO,SAAgB6I,GAGtB,MAFAd,MAAK0Z,SAAS9V,KAAK9C,GAEZd,QAGRtG,IAAK,QAgBLzB,MAAO,SAAgB6I,GACtB,MAAOd,MAAKwZ,QAAQ,SAAS1Y,MAG9BpH,IAAK,OAgBLzB,MAAO,SAAc6I,GAGpB,MAFAd,MAAKyZ,OAAO7V,KAAK9C,GAEVd,QAGRtG,IAAK,OAgBLzB,MAAO,SAAc6I,GAGpB,MAFAd,MAAK2Z,OAAO/V,KAAK9C,GAEVd,QAGRtG,IAAK,SAcLzB,MAAO,SAAgB6I,GAGtB,MAFAd,MAAKwZ,QAAQnQ,OAAOlR,KAAK6H,KAAKwZ,QAAS1Y,GAEhCd,QAGRtG,IAAK,UAcLzB,MAAO,SAAiB6I,GAGvB,MAFAd,MAAKwZ,QAAQhN,QAAQrU,KAAK6H,KAAKwZ,QAAS1Y,GAEjCd,QAGRtG,IAAK,OAoBLzB,MAAO,SAAcwU,EAASC,GAC7B,MAAO1M,MAAKwZ,QAAQ7M,KAAKF,EAASC,OAI7B4M,KAmBJjN,EAAW,WACd,MAAO,IAAIiN,IAMR7J,GAYH4G,SAAU,SAAkBrU,EAAKlB,GAChC2O,EAAQ1R,MAAMiE,EAAKlB,GAAK,IAczB8Y,SAAU,SAAkB5X,EAAK6X,GAGhC,MAFA7X,GAAI8X,YAAYD,GAET7X,GAeR8R,KAAM,SAAc9R,EAAKtI,EAAKzB,GAC7B,GAAImB,GAAStB,OACT2M,EAAS3M,MAEb,IAAI+D,MAAM2D,IAAI+F,KAAKvD,EAAI+X,cAAe,CACrC,GAAcjiB,SAAVG,EASH,MARAwM,GAASzC,EAAIgY,eAAehY,EAAI+X,aAAcrgB,GAG7C+K,EADc,OAAXA,GAAmBmD,OAAOyG,QAAQ5J,GAC5B3M,OAEAwJ,QAAQuR,OAAOpO,EAKzBzC,GAAIiY,eAAejY,EAAI+X,aAAcrgB,EAAKzB,OAErC,CAKN,GAJqB,gBAAVA,KACVA,EAAQ2P,OAAOwF,KAAKnV,IAGjB4D,MAAMW,iBAAiB+I,KAAK7L,IAAkB5B,SAAVG,EACvC,MAAOqJ,SAAQuR,OAAO7Q,EAAItI,GACpB,IAAImC,MAAMW,iBAAiB+I,KAAK7L,IAAkB5B,SAAVG,EAC9C+J,EAAItI,GAAOzB,MACL,CAAA,GAAqB,WAAjB+J,EAAIiX,UAAiC,aAARvf,GAAgC5B,SAAVG,EAC7D,MAAOqJ,SAAQsO,IAAI,IAAM5N,EAAIE,GAAK,gCAAkC,IAAMZ,QAAQsO,IAAI,IAAM5N,EAAIE,GAAK,WAAW,EAC1G,IAAqB,WAAjBF,EAAIiX,UAAiC,aAARvf,GAAgC5B,SAAVG,EAC7DmB,EAASkI,QAAQsO,IAAI,IAAM5N,EAAIE,GAAK,gCAAkC,GAEvDpK,SAAXsB,IACHA,EAAO8gB,UAAW,EAClB9gB,EAAO+gB,gBAAgB,aAGxB/gB,EAASkI,QAAQsO,IAAI,IAAM5N,EAAIE,GAAK,kBAAqBjK,EAAQ,MAAO,GACxEmB,EAAO8gB,UAAW,EAClB9gB,EAAOghB,aAAa,WAAY,gBAC1B,CAAA,GAActiB,SAAVG,EASV,MARAwM,GAASzC,EAAIqY,aAAa3gB,GAGzB+K,EADc,OAAXA,GAAmBmD,OAAOyG,QAAQ5J,GAC5B3M,OAEAwJ,QAAQuR,OAAOpO,EAKzBzC,GAAIoY,aAAa1gB,EAAKzB,KAIxB,MAAO+J,IAaR6C,MAAO,SAAe7C,GASrB,MARyB,kBAAdA,GAAIsY,MACdtY,EAAIsY,QACoBxiB,SAAdkK,EAAI/J,MACdwX,EAAQsE,OAAO/R,GAAO+T,UAAW,GAAI9d,MAAO,KAE5CwX,EAAQsE,OAAO/R,GAAO+T,UAAW,KAG3B/T,GAkBRvJ,OAAQ,SAAgBmV,EAAM1R,EAAM8F,EAAKkQ,GACxC,GAAI1S,IAAM,EACN+a,GAAO,EACPC,EAAW1iB,OACX2M,EAAS3M,MAkDb,OA/CA8V,GAAOA,EAAKlG,QAAQ,YAAa,IAE7B1F,EACHxC,EAAMwC,EAAI+X,cAAgBle,MAAM2D,IAAI+F,KAAKvD,EAAI+X,cAE7C/X,EAAMlI,EAAS2gB,KAIZ5e,MAAMyB,KAAKiI,KAAKqI,IACnB2M,GAAO,EACPC,EAAW/K,EAAQ8K,KAAK3M,GACxBnJ,EAAwC,IAA/B+V,EAAS9B,WAAWnf,OAAeihB,EAAS9B,WAAW,GAAKtW,MAAM+B,KAAKqW,EAAS9B,cAOxF8B,EAHIhb,GAAQ3D,MAAM2D,IAAI+F,KAAKqI,GAGhB9T,EAAS4gB,gBAAgB,6BAA8B9M,GAFvD9T,EAAS6gB,cAAc/M,GAK/B1R,YAAgBtE,SACnB6X,EAAQsE,OAAOyG,EAAUte,IAItBgW,GAAe,SAARA,EAEO,UAARA,EACVzC,EAAQmL,aAAa5Y,EAAKwY,GACR,UAARtI,GACVA,GAAQ2I,MAAO7Y,GACfA,EAAMA,EAAIsU,WACVtU,EAAI8Y,aAAaN,EAAUtI,EAAI2I,MAAME,cAC3B7I,EAAI2I,MACd7Y,EAAI8Y,aAAaN,EAAUtI,EAAI2I,MAAME,aACnB,WAAR7I,GACVA,GAAQ8I,OAAQhZ,GAChBA,EAAMA,EAAIsU,WACVtU,EAAI8Y,aAAaN,EAAUtI,EAAI8I,SACrB9I,EAAI8I,OACdhZ,EAAI8Y,aAAaN,EAAUtI,EAAI8I,QAE/BhZ,EAAI8X,YAAYU,GAhBhBxY,EAAI8X,YAAYU,GAmBTD,EAAkB9V,EAAX+V,GAgBhB5E,IAAK,SAAa5T,EAAKtI,EAAKzB,GAK3B,MAJK4D,OAAMS,KAAKiJ,KAAK7L,KACpBA,EAAMkO,OAAOqT,YAAYvhB,IAGZ5B,SAAVG,GACH+J,EAAImU,MAAMzc,GAAOzB,EACV+J,GAEAA,EAAImU,MAAMzc,IA0BnBsb,KAAM,SAAchT,EAAKtI,EAAKzB,GAC7B,MAAcH,UAAVG,GACH+J,EAAIoY,aAAa,QAAU1gB,EAAKmC,MAAMiC,UAAUyH,KAAKtN,GAASsW,EAAKuC,OAAO7Y,GAASA,GAE5E+J,GAEAV,QAAQuR,OAAO7Q,EAAIqY,aAAa,QAAU3gB,KAcnDgW,QAAS,SAAiB1N,GAKzB,YAJuB,OAAnBA,EAAIsU,YACPtU,EAAIsU,WAAW4E,YAAYlZ,KAgB7BmZ,QAAS,SAAiBnZ,GAKzB,MAJ4B,iBAAjBA,GAAIoZ,UAA2BpZ,EAAIoZ,WAC7CpZ,EAAIoZ,UAAW,GAGTpZ,GAmBRC,SAAU,SAAkBD,EAAK4L,GAChC,GAAIoH,GAAwBld,SAAjBiI,UAAU,MAAwBA,UAAU,GACnDsb,EAA2BvjB,SAAjBiI,UAAU,IAAmB,EAAOA,UAAU,GACxDub,EAA8BxjB,SAAjBiI,UAAU,IAAmB,EAAOA,UAAU,GAE3DmB,EAAKpJ,MAET,IAAKkK,EAAL,CAIA,IACCd,EAAK,GAAIqa,aAAY3N,GACpB,MAAOzF,GACRjH,EAAKpH,EAAS0hB,YAAY,eAM3B,MAHAta,GAAGua,gBAAgB7N,EAAMyN,EAASC,EAAYtG,GAC9ChT,EAAI0Z,cAAcxa,GAEXc,IAaR2Z,OAAQ,SAAgB3Z,GAKvB,MAJ4B,iBAAjBA,GAAIoZ,UAA0BpZ,EAAIoZ,WAC5CpZ,EAAIoZ,UAAW,GAGTpZ,GAcR+S,KAAM,SAAc/S,EAAKlB,GACxB,GAAI2D,KAMJ,OAJArC,OAAMwD,KAAKgC,OAAOC,QAAQ/G,GAAM,SAAUxH,GACzCmL,EAASA,EAAOkB,OAAOvD,MAAM+B,KAAKnC,EAAI4Z,iBAAiBtiB,OAGjDmL,GAaR8V,KAAM,SAAczZ,GACnB,GAAIkB,GAAMlI,EAAS+hB,wBAUnB,OARI/a,KACHsB,MAAMwD,KAAKxD,MAAM+B,KAAKsL,EAAQhX,OAAO,OAASsd,UAAWjV,GAAOkB,GAAK0W,YAAa,SAAUpf,GAC3F0I,EAAI8X,YAAYxgB,KAGjB0I,EAAIkZ,YAAYlZ,EAAI0W,WAAW,KAGzB1W,GAgBR8Z,IAAK,SAAa9Z,EAAKlB,GACtB,GAAI2D,GAASgL,EAAQsF,KAAK/S,EAAKlB,EAE/B,QAAQuD,MAAMI,EAAOlL,SAAWkL,EAAOlL,OAAS,GAgBjD8b,SAAU,SAAkBrT,EAAKlB,GAChC,MAAOkB,GAAI+Z,UAAUpY,SAAS7C,IAe/Bkb,OAAQ,SAAgBha,GACvB,MAA6B,SAAtBA,EAAImU,MAAM8F,SAAsBja,EAAIga,UAAW,GAevD1e,KAAM,SAAc0E,EAAKlB,GACxB,MAAYhJ,UAARgJ,EACIkB,EAAI+T,WAEX/T,EAAI+T,UAAYjV,EACTkB,IAqBTka,GAAI,SAAYla,EAAKlB,GACpB,MAAIjF,OAAMsD,YAAYoG,KAAKzE,GAGZ,IAFP2O,EAAQsF,KAAK/S,EAAIsU,WAAYtU,EAAIiX,SAAS1L,cAAgBzM,GAAKwE,OAAO,SAAUhM,GACtF,MAAOA,GAAE4I,KAAOF,EAAIE,KAClB3I,OAEI,GAAIkZ,QAAO3R,EAAK,KAAKyE,KAAKvD,EAAIiX,WAoBvClb,MAAO,SAAeiE,EAAKlB,GAC1B,GAAI4C,GAAuB5L,SAAjBiI,UAAU,IAAmB,EAAOA,UAAU,EAsBxD,OApBAe,GAAM8G,OAAOC,QAAQ/G,EAAK,KAEtB4C,EACHtB,MAAMwD,KAAK9E,EAAK,SAAUxH,GACzB0I,EAAI+Z,UAAUrY,IAAIpK,KAGnB8I,MAAMwD,KAAK9E,EAAK,SAAUxH,GACzB,MAAU,MAANA,GAGH8I,MAAMwD,KAAK5D,EAAI+Z,UAAW,SAAU1Q,GACnCrJ,EAAI+Z,UAAU3b,OAAOiL,MAGf,OANPrJ,GAAI+Z,UAAU3b,OAAO9G,KAWjB0I,GAaRma,SAAU,WACT,GAAIna,GAAuBlK,SAAjBiI,UAAU,GAAmBjG,EAAS2gB,KAAO1a,UAAU,GAE7Dqc,EAAOtkB,OACPukB,EAAMvkB,OACNwkB,EAAQxkB,OACRykB,EAASzkB,OACT0kB,EAAS1kB,OACT6d,EAAQ7d,MAMZ,IAJAskB,EAAOC,EAAM,EACb1G,EAAQ3T,EAAIya,YACZD,EAASxa,EAAI0a,aAET1a,EAAI2a,aAAc,CAIrB,IAHAN,EAAMra,EAAI4a,UACVR,EAAOpa,EAAI6a,WAEJ7a,EAAMA,EAAI2a,cAChBP,GAAQpa,EAAI6a,WACZR,GAAOra,EAAI4a,SAGZN,GAAQxiB,EAAS2gB,KAAKgC,aAAeL,EAAOzG,GAC5C4G,EAASziB,EAAS2gB,KAAKiC,cAAgBL,EAAMG,OAE7CF,GAAQ3G,EACR4G,EAASC,CAGV,QAAQJ,EAAMC,EAAKC,EAAOC,IAc3B3B,aAAc,SAAsB5Y,EAAK6X,GACxC,MAAiC,KAA1B7X,EAAI0W,WAAWnf,OAAeyI,EAAI8X,YAAYD,GAAS7X,EAAI8Y,aAAajB,EAAO7X,EAAI0W,WAAW,KActGoE,WAAY,SAAoB9a,EAAKtI,GAgBpC,MAfImC,OAAM2D,IAAI+F,KAAKvD,EAAI+X,cACtB/X,EAAI+a,kBAAkB/a,EAAI+X,aAAcrgB,GACb,WAAjBsI,EAAIiX,UAAiC,aAARvf,EACvC0I,MAAMwD,KAAK6J,EAAQsF,KAAK/S,EAAK,UAAW,SAAU1I,GACjD,MAAIA,GAAE4gB,YAAa,GAClB5gB,EAAE4gB,UAAW,EACb5gB,EAAE6gB,gBAAgB,aAEX,GAJR,SAQDnY,EAAImY,gBAAgBzgB,GAGdsI,GAcR+V,YAAa,SAAqB/V,EAAKlB,GACtC2O,EAAQ1R,MAAMiE,EAAKlB,GAAK,IAkBzBuR,SAAU,SAAkBrQ,EAAKgQ,EAAI4K,EAAWC,GAC/C,GAAI3K,GAAM9P,MAAMhC,OAAOqP,EAAQ0M,SAASna,GAAM,EAAG,EAUjD,OARKqC,OAAMuY,KACV1K,EAAI,IAAM0K,GAGNvY,MAAMwY,KACV3K,EAAI,IAAM2K,GAGJjQ,EAAOkF,OAAOI,EAAKF,IAe3BgL,UAAW,SAAmBhb,GAC7B,GAAI4F,QAA0B9P,SAAjBiI,UAAU,IAAmB,EAAOA,UAAU,GACvD+Q,EAA0BhZ,SAAjBiI,UAAU,IAAmB,EAAOA,UAAU,GAEvDmY,KACA+E,EAAWnlB,OACX2M,EAAS3M,MA0Bb,OAxBAmlB,GAA4B,SAAjBjb,EAAIiX,SAAsBjX,EAAIkb,SAAW9a,MAAM+B,KAAKnC,EAAIkb,UAAYlb,EAAI+S,KAAK,oCAAsC/S,GAE9HI,MAAMwD,KAAKqX,EAAU,SAAU3jB,GAC9B,GAAI4I,GAAK5I,EAAE4I,IAAM5I,EAAE6jB,MAAQ7jB,EAAEsU,IAEV,UAAftU,EAAE2f,SACL3X,QAAQwH,MAAMoP,EAAU3J,EAAKC,OAAOiB,EAAQuN,UAAU1jB,KAC3C4e,EAAShW,KACpBgW,EAAShW,GAAMuN,EAAQzL,IAAI1K,MAIxBsO,QAGJnD,EAAS,GAETnD,QAAQC,QAAQ2W,EAAU,SAAUlR,EAAGiC,GAC7BxE,GAATqM,EAAmB,IAAMsM,mBAAmBnU,GAAK,IAAMmU,mBAAmBpW,GAAe,IAAMiC,EAAI,IAAMjC,IAG1GvC,EAASA,EAAOiD,QAAQ7L,MAAMI,IAAK,MARnCwI,EAASyT,EAWHzT,GAaRD,KAAM,SAAcxC,GACnB,OAAQA,EAAIya,YAAcre,EAAO8K,MAAMlH,EAAImU,MAAMkH,aAAe,GAAKjf,EAAO8K,MAAMlH,EAAImU,MAAMmH,cAAgB,GAAKlf,EAAO8K,MAAMlH,EAAImU,MAAMoH,YAAc,GAAKnf,EAAO8K,MAAMlH,EAAImU,MAAMqH,aAAe,GAAIxb,EAAI0a,aAAete,EAAO8K,MAAMlH,EAAImU,MAAMsH,YAAc,GAAKrf,EAAO8K,MAAMlH,EAAImU,MAAMuH,eAAiB,GAAKtf,EAAO8K,MAAMlH,EAAImU,MAAMwH,WAAa,GAAKvf,EAAO8K,MAAMlH,EAAImU,MAAMyH,cAAgB,KAiBhYC,KAAM,SAAc7b,EAAKlB,GACxB,GAAIpH,GAAMsI,EAAI8b,YAAc,cAAgB,YACxC7N,KACA3P,GAAM,CAOV,OALmB,mBAARQ,KACVR,GAAM,EACN2P,EAAQvW,GAAOoH,GAGTR,EAAMmP,EAAQsE,OAAO/R,EAAKiO,GAAWjO,EAAItI,IAgBjDqkB,YAAa,SAAqB/b,EAAKlB,GAGtC,MAFAkB,GAAI+Z,UAAUiC,OAAOld,GAEdkB,GAcR+R,OAAQ,SAAgB/R,EAAK9F,GAa5B,MAZAoF,SAAQC,QAAQrF,EAAM,SAAU8K,EAAGiC,GAC9BpN,MAAMmB,eAAeuI,KAAK0D,GAC7BjH,EAAIiH,GAAKjC,EACO,UAANiC,EACTrB,OAAOyG,QAAQrH,GAAgCyI,EAAQsI,YAAY/V,EAAK,KAApDyN,EAAQ4G,SAASrU,EAAKgF,GACV,IAAvBiC,EAAEjE,QAAQ,SACpByK,EAAQuF,KAAKhT,EAAKiH,EAAEvB,QAAQ,QAAS,IAAKV,GAE1CyI,EAAQqE,KAAK9R,EAAKiH,EAAGjC,KAIhBhF,GAcRgC,IAAK,SAAahC,EAAK/J,GACtB,GAAIiJ,GAAK,QACL8R,EAASlb,MAEb,IAAcA,SAAVG,EAAqB,CACxB,GAAI4D,MAAMmD,eAAeuG,KAAKvD,EAAI4L,MAAO,CACxC,GAAIhG,OAAOyG,QAAQrM,EAAImb,MACtB,KAAM,IAAItb,OAAMC,EAAMmc,iBAGvB7b,OAAMwD,KAAKtE,QAAQsO,IAAI,eAAiB5N,EAAImb,KAAO,MAAO,SAAU7jB,GACnE,MAAIA,GAAE4kB,SACLlL,EAAS1Z,EAAErB,OACJ,GAFR,aAKS4D,OAAMqD,OAAOqG,KAAKvD,EAAI4L,OAChCoF,EAAS,KACT5Q,MAAMwD,KAAK6J,EAAQsF,KAAK/S,EAAK,UAAW,SAAU1I,GACjD,MAAIA,GAAE4gB,YAAa,GAClBlH,EAAS1Z,EAAErB,OACJ,GAFR,UAMD+a,EADUhR,EAAI/J,MACL+J,EAAI/J,MACH+J,EAAIwV,YACLxV,EAAIwV,cAAgBxV,EAAImc,UAAYrmB,OAAYkK,EAAImc,UAEpD1O,EAAQoO,KAAK7b,EAGRlK,UAAXkb,GACHA,EAAS1R,QAAQuR,OAAOG,GAEF,gBAAXA,KACVA,EAASpL,OAAOwF,KAAK4F,KAGtBA,EAAS,OAGV/a,GAAQA,EAAMkS,WAEVtO,MAAMmD,eAAeuG,KAAKvD,EAAI4L,OACjC1M,EAAK,QAELkB,MAAMwD,KAAKtE,QAAQsO,IAAI,eAAiB5N,EAAImb,KAAO,MAAO,SAAU7jB,GACnE,MAAIA,GAAErB,QAAUA,GACfqB,EAAE4kB,SAAU,EACZlL,EAAS1Z,GACF,GAHR,UAMSuC,MAAMqD,OAAOqG,KAAKvD,EAAI4L,OAChC1M,EAAK,SAELkB,MAAMwD,KAAK6J,EAAQsF,KAAK/S,EAAK,WAAY,SAAU1I,GAClD,MAAIA,GAAErB,QAAUA,GACfqB,EAAE4gB,UAAW,EACblH,EAAS1Z,GACF,GAHR,UAOaxB,SAAdkK,EAAI/J,MAAsB+J,EAAI/J,MAAQA,EAAQwX,EAAQoO,KAAK7b,EAAK/J,GAGjEwX,EAAQxN,SAASD,EAAKd,GAEtB8R,EAAShR,CAGV,OAAOgR,KAOLzE,GAkBHC,OAAQ,SAAgB1N,EAAKsd,GAC5B,IACC,MAAOjY,MAAK+C,MAAMpI,GACjB,MAAOqH,GAKR,YAJIiW,KAAW,GACd9c,QAAQqT,MAAMxM,GAAIrH,EAAKsd,OAwB1BtN,OAAQ,SAAgBhQ,EAAKsd,GAC5B,IACC,MAAOjY,MAAKC,UAAUtF,GACrB,MAAOqH,GAKR,YAJIiW,KAAW,GACd9c,QAAQqT,MAAMxM,GAAIrH,EAAKsd,QAYvBtc,GAOHuc,eAAgB,oBAQhBJ,iBAAkB,0CAQlBK,eAAgB,qBAQhBvc,iBAAkB,mCAQlBwc,sBAAuB,oDAQvBC,mBAAoB,wDAQpBC,oBAAqB,wCAQrBC,uBAAwB,uCAQxBC,sBAAuB,0CAQvBpO,iBAAkB,qBAQlB6G,OAAQ,qBAQRjH,aAAc,oCAQdyO,uBAAwB,4BAQxB/O,eAAgB,oBAQhB0B,YAAa,4BAQbI,gBAAiB,0BAQjBC,oBAAqB,qBAQrBF,mBAAoB,uCAQpBmN,QAAS,yDAMN3T,GAiBHiH,OAAQ,WACP,IAAK,GAAI2M,GAAS/e,UAAUxG,OAAQ2C,EAAOkF,MAAM0d,GAASC,EAAS,EAAYD,EAATC,EAAiBA,IACtF7iB,EAAK6iB,GAAUhf,UAAUgf,EAG1B,IAAItY,GAAIrE,MAAM+B,KAAKjI,GACfmV,EAAI5K,EAAEuY,MACNC,EAAI7c,MAAMmC,MAAMkC,EAAG,GACnBY,EAAI4X,EAAE1lB,OACN0Q,EAAInS,OACJonB,EAAKpnB,OACLqnB,EAAKrnB,OACLsnB,EAAKtnB,OACLunB,EAAKvnB,OACLwnB,EAAKxnB,OACLynB,EAAKznB,OACL0nB,EAAK1nB,OACL2nB,EAAK3nB,MAET,IAAQ,EAAJuP,GAASA,EAAI,EAChB,KAAM,IAAIxF,OAAMC,EAAMC,iBA8BvB,OA1BAkI,MACAiV,EAAK,EAAI7N,EACT8N,EAAKjU,EAAKC,IAAI+T,GACdE,EAAK,EAAIF,EAAK7N,EACdgO,EAAKnU,EAAKC,IAAIkG,GACdiO,EAAKrb,KAAKyb,IAAIR,EAAI,GAClBK,EAAK,EAAIJ,EAAK9N,EACdmO,EAAK,EAAIN,EAAKG,EACdI,EAAKxb,KAAKyb,IAAIrO,EAAG,GAGP,IAANhK,GACH4C,EAAErG,KAAKsb,EAAKD,EAAE,GAAG,GAAK5N,EAAI4N,EAAE,GAAG,IAC/BhV,EAAErG,KAAKsb,EAAKD,EAAE,GAAG,GAAK5N,EAAI4N,EAAE,GAAG,KAGjB,IAAN5X,GACR4C,EAAErG,KAAKub,EAAKF,EAAE,GAAG,GAAKG,EAAKH,EAAE,GAAG,IAAMI,EAAKJ,EAAE,GAAG,KAChDhV,EAAErG,KAAKub,EAAKF,EAAE,GAAG,GAAKG,EAAKH,EAAE,GAAG,IAAMI,EAAKJ,EAAE,GAAG,MAGlC,IAAN5X,IACR4C,EAAErG,KAAK0b,EAAKL,EAAE,GAAG,GAAKM,EAAKN,EAAE,GAAG,GAAKO,EAAKP,EAAE,GAAG,GAAKQ,EAAKR,EAAE,GAAG,IAC9DhV,EAAErG,KAAK0b,EAAKL,EAAE,GAAG,GAAKM,EAAKN,EAAE,GAAG,GAAKO,EAAKP,EAAE,GAAG,GAAKQ,EAAKR,EAAE,GAAG,KAGxDhV,GAcR0V,KAAM,SAAclZ,EAAGC,GACtB,MAAOzC,MAAKyG,KAAKQ,EAAKC,IAAIzE,EAAE,GAAKD,EAAE,IAAMyE,EAAKC,IAAIzE,EAAE,GAAKD,EAAE,MAa5D0E,IAAK,SAAa9D,GACjB,MAAOA,GAAIA,IAOTjJ,GAWHiH,KAAM,SAAcua,EAAMC,GACzB,MAAO5b,MAAK6b,IAAIF,EAAOC,IAiBxBE,KAAM,SAAcjf,GACnB,MAAOA,GAAM,IAAM,GAepBkf,OAAQ,SAAgBlf,GACvB,GAAI0R,GAA6B1a,SAAjBiI,UAAU,GAAmB,IAAMA,UAAU,GACzDkgB,EAAyBnoB,SAAjBiI,UAAU,GAAmB,EAAIA,UAAU,EAEvDe,GAAMA,EAAIqJ,UASV,KAPA,GAAID,GAAIpJ,EAAIkE,QAAQ,KAAO,GAAK,IAAMlE,EAAI4G,QAAQ7L,MAAMwC,gBAAiB,IAAM,GAC3EoI,EAAI3F,EAAI4G,QAAQ7L,MAAMyC,gBAAiB,IAAIwJ,MAAM,IAAI6Q,UACrDuH,EAAIjc,KAAKC,MAAMuC,EAAElN,OAAS0mB,GAC1B3mB,EAAI,EACJoN,EAAI,GACJW,EAAIvP,SAEC4O,EAAIwZ,GACZ7Y,EAAU,IAAN/N,EAAU2mB,EAAQA,EAAQ3mB,GAAW,IAANA,EAAU,EAAIA,EAAI,GACrDmN,EAAE6O,OAAOjO,EAAG,EAAGmL,GACflZ,GASD,OANAmN,GAAIA,EAAEkS,UAAUrQ,KAAK,IAEjB7B,EAAE0Z,OAAO,KAAO3N,IACnB/L,EAAIA,EAAE2Z,UAAU,IAGV3Z,EAAIyD,GAgBZmW,KAAM,SAAc5Z,EAAGC,GACtB,MAAOA,GAAID,EAAIC,IAAM,GAAMD,EAAI,GAiBhCoC,IAAK,SAAa/H,GACjB,OAAQ1C,EAAO2hB,KAAKjf,IAerBoI,MAAO,SAAepI,EAAKwf,GAC1B,MAAgBxoB,UAATwoB,EAAqBC,WAAWzf,GAAO0f,SAAS1f,EAAKwf,IAa7DG,OAAQ,WACP,GAAI3f,GAAuBhJ,SAAjBiI,UAAU,GAAmB,IAAMA,UAAU,EAEvD,OAAOkE,MAAKC,MAAMD,KAAKwc,UAAY3f,EAAM,KAc1C6D,MAAO,SAAe7D,EAAK4f,GAG1B,MAFA5f,GAAM1C,EAAO8K,MAAMpI,GAEDhJ,SAAd4oB,GAA2B9Y,OAAOyG,QAAQqS,GACtCtiB,EAAO8K,MAAMpI,EAAI6f,QAAQ,IACtB9kB,MAAMgB,KAAK0I,KAAKmb,KAChB5f,EAEHmD,KAAK8F,KAAKjJ,KAQhB0Y,GAQH5Y,QAAS,WACR,GAAI4Y,GAAU1hB,OACV8oB,EAAS9oB,OACT+oB,EAAW/oB,OACXgpB,EAAUhpB,OACVipB,EAAQjpB,MAuBZ,OArBA0hB,GAAU,GAAI9e,GAAQ,SAAU8R,EAASnD,GACxCwX,EAAWrU,EACXsU,EAAUzX,IAGXuX,EAAS,WACR,IAAK,GAAII,GAASjhB,UAAUxG,OAAQ2C,EAAOkF,MAAM4f,GAASC,EAAS,EAAYD,EAATC,EAAiBA,IACtF/kB,EAAK+kB,GAAUlhB,UAAUkhB,EAG1B,OAAOzH,GAAQ,SAAS/X,MAAM+X,EAAStd,IAGxC6kB,EAAQ,WACP,IAAK,GAAIG,GAASnhB,UAAUxG,OAAQ2C,EAAOkF,MAAM8f,GAASC,EAAS,EAAYD,EAATC,EAAiBA,IACtFjlB,EAAKilB,GAAUphB,UAAUohB,EAG1B,OAAO3H,GAAQ7M,KAAKlL,MAAM+X,EAAStd,KAG3BklB,QAASR,EAAQpU,QAASqU,EAAUxX,OAAQyX,EAASnU,KAAMoU,KAIlEM,EAAY,SAAWC,GAW1B,QAASD,KACRtoB,gBAAgBiH,KAAMqhB,GAEtB/pB,KAAKM,OAAOI,eAAeqpB,EAAU7oB,WAAY,cAAewH,MAAM7H,KAAK6H,MAE3EA,KAAKuhB,UAAW,EAChBvhB,KAAKoP,SAAW,KAChBpP,KAAKwhB,YAAc,KACnBxhB,KAAK+Y,SACL/Y,KAAKyhB,QAAS,EACdzhB,KAAKyL,QAAU,KACfzL,KAAK4L,SAAY8V,OAAQ,oBACzB1hB,KAAK2hB,UACL3hB,KAAK8G,SACL9G,KAAK4hB,SAAYloB,QACjBsG,KAAKtG,IAAM,KACXsG,KAAKqZ,QAAS,EACdrZ,KAAK3E,QAAU,GACf2E,KAAK8C,SAAWF,IAChB5C,KAAK6U,WACL7U,KAAK6hB,OAAS,KACd7hB,KAAKqK,MAAQ,EACbrK,KAAK8hB,YACL9hB,KAAK+hB,YAAa,EAClB/hB,KAAKgiB,SACLhiB,KAAKuL,IAAM,KAkpDZ,MA/oDAnT,WAAUipB,EAAWC,GAErBpoB,aAAamoB,IACZ3nB,IAAK,QAqBLzB,MAAO,SAAe2V,EAAMoH,GAC3B,GAAIiN,GAAUjiB,KAEVkiB,EAAwBpqB,SAAjBiI,UAAU,IAAmB,EAAQA,UAAU,GAGtD0hB,EAASzhB,KAAKyhB,OACdrV,EAAQC,IACR8V,IAoEJ,QAjEKtmB,MAAMwD,QAAQkG,KAAKqI,IAASsU,GAAQrmB,MAAMc,IAAI4I,KAAKqI,IAAyB,gBAAToH,GACvE5I,EAAM/C,OAAO,GAAIxH,OAAMC,EAAMC,oBAEzB0f,GACHzhB,KAAKiC,SAAS,cAAe+S,GAG1BkN,GACHliB,KAAK6E,MAAMqd,GAGQ,IAAhBlN,EAAKzb,QACRyG,KAAKqZ,QAAS,EAEVoI,GACHzhB,KAAKiC,SAAS,aAAcjC,KAAK6U,SAGlCzI,EAAMI,QAAQxM,KAAK6U,WAGN,QAATjH,EACHxL,MAAMwD,KAAKoP,EAAM,SAAU1b,GAC1B6oB,EAAUve,KAAKqe,EAAQtlB,IAAIrD,GAAG,GAAO,MAGtC8I,MAAMwD,KAAKoP,EAAM,SAAU1b,GAC1B6oB,EAAUve,KAAKqe,EAAQ3hB,IAAIhH,EAAE2oB,EAAQvoB,MAAQ,KAAMJ,GAAG,MAIxD0G,KAAKqZ,QAAS,EAEd/X,QAAQ8gB,KAAKD,GAAWxV,KAAK,SAAUzQ,GACtC+lB,EAAQ5I,QAAS,EAEboI,GACHQ,EAAQhgB,SAAS,aAAc/F,GAIhCkG,MAAMwD,KAAKqc,EAAQlJ,MAAO,SAAUzf,GACnCA,EAAEsa,SAAQ,KAGE,QAAThG,IACHqU,EAAQpN,QAAUzS,MAAMgD,QAAQ6c,EAAQpN,SACxCoN,EAAQI,WAGLJ,EAAQV,UACXU,EAAQK,OAGTlW,EAAMI,QAAQtQ,IACZ,SAAUiM,GACRsZ,GACHQ,EAAQhgB,SAAS,cAAekG,GAGjCiE,EAAM/C,OAAOlB,OAKTiE,KAGR1S,IAAK,WAYLzB,MAAO,SAAkByB,GACxB,GAAI6oB,GAASjhB,QAAQ4H,MAAMlJ,KAAKuL,IAEhC,OAAOgX,GAAOzjB,SAAW,KAAOyjB,EAAO9kB,KAAO8kB,EAAOC,SAAS9a,QAAQ7L,MAAMiB,SAAU,IAAM,IAAMpD,KAGnGA,IAAK,QAkBLzB,MAAO,WACN,GAAIiqB,GAAwBpqB,SAAjBiI,UAAU,IAAmB,EAAOA,UAAU,GAErD0hB,EAASzhB,KAAKyhB,UAAW,EACzBgB,EAASziB,KAAKuhB,YAAa,CAsD/B,OApDKW,IAmCJliB,KAAK4hB,SAAYloB,QACjBsG,KAAKqZ,QAAS,EACdrZ,KAAK6U,WACL7U,KAAKqK,MAAQ,EACbrK,KAAKgiB,SAEL5f,MAAMwD,KAAK5F,KAAK+Y,MAAO,SAAUzf,GAC5BA,GACHA,EAAEsa,cA1CA6N,GACHzhB,KAAKiC,SAAS,eAGfG,MAAMwD,KAAK5F,KAAK+Y,MAAO,SAAUzf,GAC5BA,GACHA,EAAEic,UAAS,KAIbvV,KAAKuhB,UAAW,EAChBvhB,KAAKoP,SAAW,KAChBpP,KAAKwhB,YAAc,KACnBxhB,KAAK+Y,SACL/Y,KAAKyhB,QAAS,EACdzhB,KAAKyL,QAAU,KACfzL,KAAK4L,SAAY8V,OAAQ,oBACzB1hB,KAAK2hB,UACL3hB,KAAK8G,SACL9G,KAAK4hB,SAAYloB,QACjBsG,KAAKtG,IAAM,KACXsG,KAAKqZ,QAAS,EACdrZ,KAAK6U,WACL7U,KAAK6hB,OAAS,KACd7hB,KAAKqK,MAAQ,EACbrK,KAAK8hB,YACL9hB,KAAK+hB,YAAa,EAClB/hB,KAAKgiB,SACLhiB,KAAKuL,IAAM,KAEPkW,GACHzhB,KAAKiC,SAAS,eAgBZwgB,GACHziB,KAAKsiB,OAGCtiB,QAGRtG,IAAK,MAqBLzB,MAAO,SAAawc,GACnB,GAAIiO,GAAU1iB,KAEVqiB,EAA2BvqB,SAAjBiI,UAAU,IAAmB,EAAOA,UAAU,GACxD4iB,EAAyB7qB,SAAjBiI,UAAU,IAAmB,EAAQA,UAAU,EAE3D0U,GAASA,EAAO/a,IAAM+a,EAASzU,KAAKzI,IAAIkd,EAExC,IAAIrI,GAAQC,GAqBZ,OAnBevU,UAAX2c,EACHrI,EAAM/C,OAAO,GAAIxH,OAAMC,EAAMC,oBAEzB/B,KAAKyhB,QACRzhB,KAAKiC,SAAS,eAAgBwS,GAGd,OAAbzU,KAAKuL,KAAkC,OAAlBvL,KAAKoP,SAC7BpP,KAAK4iB,YAAYnO,EAAQ4N,EAASM,EAAOvW,GAEzCQ,EAAOmD,QAAQ/P,KAAK6iB,SAASpO,EAAO/a,KAAM,SAAU,KAAM4H,QAAQwH,OAAQmI,gBAAiBjR,KAAKwhB,aAAexhB,KAAK4L,UAAUe,KAAK,WAClI+V,EAAQE,YAAYnO,EAAQ4N,EAASM,EAAOvW,IAC1C,SAAUjE,GACZua,EAAQzgB,SAAS,eAAgBkG,GACjCiE,EAAM/C,OAAOlB,MAKTiE,KAGR1S,IAAK,cAcLzB,MAAO,SAAqBwc,EAAQ4N,EAASM,EAAOvW,GACnD,GAAI0W,GAAU9iB,IAqCd,cAnCOA,MAAK4hB,QAAQloB,IAAI+a,EAAO/a,WACxBsG,MAAK8hB,SAASrN,EAAO/a,KAC5BsG,KAAKqK,QACLrK,KAAKgiB,SAEAW,EA2BJ3iB,KAAK6U,QAAQJ,EAAO3N,OAAS,MA1B7B1E,MAAMhC,OAAOJ,KAAK6U,QAASJ,EAAO3N,OAE9Bub,EACHriB,KAAKqiB,UAELjgB,MAAMwD,KAAK6O,EAAOmN,QAAS,SAAUtoB,GACpC8I,MAAMhC,OAAO0iB,EAAQlB,QAAQtoB,EAAE,IAAIA,EAAE,IAAKmb,EAAO3N,OAEN,IAAvCgc,EAAQlB,QAAQtoB,EAAE,IAAIA,EAAE,IAAIC,cACxBupB,GAAQlB,QAAQtoB,EAAE,IAAIA,EAAE,MAK9B0G,KAAKuhB,UACRvhB,KAAK+iB,MAAMtO,EAAO/a,KAGfsG,KAAKyhB,QACRzhB,KAAKiC,SAAS,cAAewS,GAG9BrS,MAAMwD,KAAK5F,KAAK+Y,MAAO,SAAUzf,GAChCA,EAAEsa,aAMa9b,SAAVsU,EAAsBA,EAAMI,QAAQiI,EAAO/a,KAAO+a,EAAO/a,OAGjEA,IAAK,OAaLzB,MAAO,SAAciE,EAAMoX,GAC1B,GAAI0P,GAAUhjB,IAEd9D,GAAOA,GAAQ8D,KAAK6U,OAEpB,IAAIoO,GAAS3P,YAAkBlS,QAASkS,EAAO/Z,OAAS,EACpDG,EAAmB,OAAbsG,KAAKtG,IACXwL,EAAKpN,MA4BT,OAzBCoN,GADG+d,EACE,SAAU3pB,GACd,GAAImb,KAMJ,OAJArS,OAAMwD,KAAK0N,EAAQ,SAAU4P,GAC5BzO,EAAOyO,GAAKA,IAAMF,EAAQtpB,IAAM2K,MAAM/K,EAAEI,KAAOJ,EAAEI,IAAMypB,OAAO7pB,EAAEI,KAAO4H,QAAQwD,MAAMxL,EAAE0b,KAAKkO,IAAI,KAG1FzO,GAGH,SAAUnb,GACd,GAAImb,KAUJ,OARI/a,KACH+a,EAAOuO,EAAQtpB,KAAO2K,MAAM/K,EAAEI,KAAOJ,EAAEI,IAAMypB,OAAO7pB,EAAEI,MAGvD4H,QAAQC,QAAQjI,EAAE0b,KAAM,SAAUhO,EAAGiC,GACpCwL,EAAOxL,GAAK3H,QAAQwD,MAAMkC,GAAG,KAGvByN,GAIFvY,EAAKiJ,IAAID,MAGjBxL,IAAK,MAeLzB,MAAO,SAAawc,EAAQ3O,GAC3B,GAAIsd,GAAUpjB,KAEV4N,QAAc6G,GACdhQ,EAAS3M,MAwBb,OAtBa,cAAT8V,EACHnJ,EAASzE,KAAK6U,QACK,WAATjH,EAETnJ,EAD2B,KAAxBgQ,EAAOzP,QAAQ,KACThF,KAAK6U,QAAQ7U,KAAK4hB,QAAQloB,IAAI+a,IAE9B7M,OAAOC,QAAQ4M,GAAQtP,IAAI,SAAU7L,GAC7C,MAAK+K,OAAM/K,GAGH8pB,EAAQvO,QAAQuO,EAAQxB,QAAQloB,IAAIJ,IAFpC8pB,EAAQvO,QAAQ2L,SAASlnB,EAAG,OAMnB,WAATsU,IAETnJ,EADGJ,MAAMyB,GACA9F,KAAK6U,QAAQ2L,SAAS/L,EAAQ,KAE9BrS,MAAMrB,MAAMf,KAAK6U,QAAS2L,SAAS/L,EAAQ,IAAK+L,SAAS1a,EAAQ,MAIrExE,QAAQwD,MAAML,GAAQ,MAG9B/K,IAAK,OAaLzB,MAAO,SAAWorB,GACjB,QAAS/a,GAAKgb,EAAIC,GACjB,MAAOF,GAAM5hB,MAAMzB,KAAMD,WAO1B,MAJAuI,GAAK6B,SAAW,WACf,MAAOkZ,GAAMlZ,YAGP7B,GACL,SAAUxH,EAAKqU,GACjB,GAAIqO,GAAUxjB,KAEVsI,EAAwBxQ,SAAjBiI,UAAU,GAAmB,QAAUA,UAAU,GAExDqM,EAAQC,IACRoX,KACAtB,KACAzoB,EAAMyb,IAAUnV,KAAKtG,IACrB2I,EAAOD,MAAM0G,MAAM1G,MAAMC,KAAKrC,KAAK6U,QAAQ,GAAGG,MAAO5S,MAAMC,KAAKvB,EAAI+T,QAAQ,GAAGG,OAC/E9P,EAAKpN,MAyFT,OAvFa,UAATwQ,EACHpD,EAAK,SAAU5L,GACd,GAAI2b,MACAR,EAASnb,EAAE0b,KACX5I,EAAQC,GAEZ4I,GAAME,GAASzb,EAAMJ,EAAEI,IAAM+a,EAAOU,GAEpCrU,EAAI5B,OAAO+V,GAAOtI,KAAK,SAAUyL,GAC5BA,EAAM7e,OAAS,EAClB6S,EAAM/C,OAAO,GAAIxH,OAAMC,EAAM4hB,sBACF,IAAjBtL,EAAM7e,QAChBkqB,EAAQ7f,KAAKtC,QAAQwH,MAAM2L,EAAQ2D,EAAM,GAAGpD,OAC5C5I,EAAMI,SAAQ,IAEdJ,EAAMI,SAAQ,KAIhB2V,EAAUve,KAAKwI,IAEG,SAAT9D,EACVpD,EAAK,SAAU5L,GACd,GAAI2b,MACAR,EAASnb,EAAE0b,KACX5I,EAAQC,GAEZ4I,GAAME,GAASzb,EAAMJ,EAAEI,IAAM+a,EAAOU,GAEpCrU,EAAI5B,OAAO+V,GAAOtI,KAAK,SAAUyL,GAC5BA,EAAM7e,OAAS,EAClB6S,EAAM/C,OAAO,GAAIxH,OAAMC,EAAM4hB,sBACF,IAAjBtL,EAAM7e,QAChBkqB,EAAQ7f,KAAKtC,QAAQwH,MAAM2L,EAAQ2D,EAAM,GAAGpD,OAC5C5I,EAAMI,SAAQ,KAEdpK,MAAMwD,KAAKvD,EAAM,SAAU/I,GACRxB,SAAd2c,EAAOnb,KACVmb,EAAOnb,GAAK,QAIdmqB,EAAQ7f,KAAK6Q,GACbrI,EAAMI,SAAQ,MAIhB2V,EAAUve,KAAKwI,IAEG,UAAT9D,IACVpD,EAAK,SAAU5L,GACd,GAAI2b,MACAR,EAASnb,EAAE0b,KACX5I,EAAQC,GAEZ4I,GAAME,GAASzb,EAAMJ,EAAEI,IAAM+a,EAAOU,GAEpCqO,EAAQtkB,OAAO+V,GAAOtI,KAAK,SAAUyL,GAChCA,EAAM7e,OAAS,EAClB6S,EAAM/C,OAAO,GAAIxH,OAAMC,EAAM4hB,sBACF,IAAjBtL,EAAM7e,QAChBkqB,EAAQ7f,KAAKtC,QAAQwH,MAAM2L,EAAQ2D,EAAM,GAAGpD,OAC5C5I,EAAMI,SAAQ,KAEdpK,MAAMwD,KAAKvD,EAAM,SAAU/I,GACRxB,SAAd2c,EAAOnb,KACVmb,EAAOnb,GAAK,QAIdmqB,EAAQ7f,KAAK6Q,GACbrI,EAAMI,SAAQ,MAIhB2V,EAAUve,KAAKwI,KAIjBhK,MAAMwD,KAAKtE,QAAQwD,MAAe,UAATwD,EAAmBxH,EAAI+T,QAAU7U,KAAK6U,SAAS,GAAO3P,GAE/E5D,QAAQ8gB,KAAKD,GAAWxV,KAAK,WAC5BP,EAAMI,QAAQiX,IACZ,SAAUtb,GACZiE,EAAM/C,OAAOlB,KAGPiE,MAGR1S,IAAK,OAYLzB,MAAO,SAAc6I,GACpB,MACQd,MAAK6U,QAAQ1P,IADjBrE,IAAQd,KAAKtG,IACQ,SAAUJ,GACjC,MAAOA,GAAEI,KAGc,SAAUJ,GACjC,MAAOA,GAAE0b,KAAKlU,QAKjBpH,IAAK,QAYLzB,MAAO,SAAe6I,GACrB,MAAOd,MAAK2jB,QAAQ7iB,GAAOd,KAAM,aAGlCtG,IAAK,UAWLzB,MAAO,WACN,GAAI2rB,GAAU5jB,KAEV1G,EAAI,GACJuqB,IAkBJ,OAhBA7jB,MAAKgiB,SACLhiB,KAAK4hB,SAAYloB,QAEbsG,KAAKqK,MAAQ,GAChBjI,MAAMwD,KAAK5F,KAAK6U,QAAS,SAAUJ,GACnB3c,SAAX2c,IACHoP,IAAMvqB,GAAKmb,EACXA,EAAO3N,MAAQxN,EACfsqB,EAAQhC,QAAQloB,IAAI+a,EAAO/a,KAAOJ,EAClCsqB,EAAQE,WAAWrP,MAKtBzU,KAAK6U,QAAUgP,EAER7jB,QAGRtG,IAAK,UAYLzB,MAAO,SAAiB6I,GACvB,MAAOd,MAAK2jB,QAAQ7iB,GAAOd,KAAM,UAGlCtG,IAAK,OAYLzB,MAAO,SAAc6I,GACpB,MAAOd,MAAK2jB,QAAQ7iB,GAAOd,KAAM,UAGlCtG,IAAK,SAmBLzB,MAAO,SAAgBgd,GACtB,GAAI8O,GAAU/jB,KAEVoM,EAAQC,IACR2X,KACAC,EAAUnsB,OACVosB,EAAOpsB,OACPgP,EAAQhP,OACR2M,EAAS3M,OACTyQ,EAASzQ,OACTkR,EAASlR,OACTqsB,EAASrsB,MAEb,IAAMmd,YAAiBrd,QAUtB,GAPA0J,QAAQC,QAAQ0T,EAAO,SAAUjO,EAAGiC,GAClB,kBAANjC,KACV+c,EAAQ9a,GAAKjC,EAAEmD,WACf6Z,EAAUpgB,KAAKqF,MAIblO,EACH,IACCopB,EAAS7iB,QAAQ6iB,OAAO/X,GACxB+X,EAAOC,aACNC,IAAK,SACLzC,QAAS5hB,KAAK4hB,QACd/M,QAAS7U,KAAK6U,QACdI,MAAO1G,EAAKuC,OAAOmE,GACnB+O,UAAWA,IAEX,MAAO7b,GAERpN,GAAY,EAEZiF,KAAKd,OAAO+V,GAAOtI,KAAK,SAAU7L,GACjCsL,EAAMI,QAAQ1L,IACZ,SAAUqH,GACZiE,EAAM/C,OAAOlB,SAIf8b,GAAU7hB,MAAMwE,WAAWqO,GAC3B1M,EAASnG,MAAMmE,KAAK0d,GAAS3e,OAAO,SAAUhM,EAAGyK,GAChD,MAAOA,GAAM,IAAM,IACjBoB,IAAI,SAAU7L,GAChB,MAAOA,GAAE6Q,aACP/B,KAAKhG,MAAMgG,MACdtB,EAAQyB,EAAOD,KAAK,KACpBU,EAAST,EAAOpD,IAAI,SAAU7L,GAC7B,MAAO2b,GAAM3b,KACXgP,KAAK,KACR4b,EAAO,YAEkB,IAArBF,EAAUzqB,QAAgByG,KAAK4hB,QAAQ9a,GAC1CrC,GAAUzE,KAAK4hB,QAAQ9a,GAAOkC,QAAe7D,IAAI,SAAU7L,GAC1D,MAAOyqB,GAAQlP,QAAQvb,MAGpB2qB,EAAQ1qB,OAAS,EACpB6I,MAAMwD,KAAKqe,EAAS,SAAU3qB,EAAGyK,GAChC,GAAIugB,GAAK,IAELvgB,GAAM,IACTugB,EAAK,UAILJ,GADG5qB,EAAE,YAAc+O,UACXic,EAAKhrB,EAAE,GAAG6Q,WAAa,eAAkB7Q,EAAE,GAAK,SAC7C+K,MAAM/K,EAAE,IAGXgrB,EAAK,aAAgBhrB,EAAE,GAAK,WAAeA,EAAE,GAAK,MAFlDgrB,EAAK,aAAgBhrB,EAAE,GAAK,UAAaA,EAAE,GAAK,OAOzD4qB,GADGD,EAAQ,GAAG,YAAc5b,UACpB4b,EAAQ,GAAG,GAAG9Z,WAAa,eAAkB8Z,EAAQ,GAAG,GAAK,OAC1D5f,MAAM4f,EAAQ,GAAG,IAGpB,aAAgBA,EAAQ,GAAG,GAAK,WAAeA,EAAQ,GAAG,GAAK,IAF/D,aAAgBA,EAAQ,GAAG,GAAK,UAAaA,EAAQ,GAAG,GAMlEC,GAAQ,MAERzf,EAASnD,QAAQwD,MAAM9E,KAAK6U,SAAS,GAAMvP,OAAO,GAAI+C,UAAS,MAAO6b,KAGvE9X,EAAMI,QAAQ/H,OA9Ef2H,GAAM/C,OAAO,GAAIxH,OAAMC,EAAMC,kBAkF9B,OAAOqK,MAGR1S,IAAK,MAsBLzB,MAAO,SAAayB,EAAKsb,GACxB,GAAIuP,GAAUvkB,KAEV2iB,EAAyB7qB,SAAjBiI,UAAU,IAAmB,EAAQA,UAAU,GACvDykB,EAA6B1sB,SAAjBiI,UAAU,IAAmB,EAAQA,UAAU,EAE/DiV,GAAO1T,QAAQwD,MAAMkQ,GAAM,EAE3B,IAAIyM,GAASzhB,KAAKyhB,OACdrV,EAAQC,IACRoI,EAAiB,OAAR/a,EAAesG,KAAKzI,IAAImC,IAAQ,KAAOsb,EAAKhV,KAAKtG,KAAOsG,KAAKzI,IAAIyd,EAAKhV,KAAKtG,OAAS,KAAO,KACpG+qB,EAAS,OACTlC,EAASjhB,QAAQ4H,MAAMlJ,KAAKuL,KAAO,IACnCA,EAAMzT,OACN4sB,EAAQ5sB,OACR6sB,EAAS7sB,OAET6G,EAAQ,SAAe6lB,EAAWxP,EAAM4P,GAC3C,GAAIC,KAkBJ,OAhBIL,IACHpiB,MAAMwD,KAAKxD,MAAMC,KAAKuiB,GAAS,SAAU3b,GACpCA,IAAMsb,EAAQ7qB,KAAmB5B,SAAZkd,EAAK/L,IAC7B4b,EAAMjhB,MAAOkhB,GAAI,SAAUC,KAAM,IAAM9b,MAK1C3H,QAAQC,QAAQyT,EAAM,SAAUhO,EAAGiC,GAC9BA,IAAMsb,EAAQ7qB,KAAqB5B,SAAd8sB,EAAO3b,GAC/B4b,EAAMjhB,MAAOkhB,GAAI,MAAOC,KAAM,IAAM9b,EAAGhR,MAAO+O,IACpCuH,EAAKuC,OAAO8T,EAAO3b,MAAQsF,EAAKuC,OAAO9J,IACjD6d,EAAMjhB,MAAOkhB,GAAI,UAAWC,KAAM,IAAM9b,EAAGhR,MAAO+O,MAI7C6d,EAuFR,OApFoB,gBAAT7P,IAIRzJ,EAHyB,KAAvByJ,EAAKhQ,QAAQ,MAEO,MAAnBgQ,EAAKmL,OAAO,GACTngB,KAAK6iB,SAAS7N,GAGC,OAAbhV,KAAKuL,KAAgB1P,MAAMoD,KAAKsG,KAAKyP,GACvCuN,EAAOzjB,SAAW,KAAOyjB,EAAO9kB,KAAOuX,EAEvCA,EAGDA,EAGPtb,EAAM6R,EAAI7D,QAAQ7L,MAAMqC,aAAc,IAElC0J,OAAOyG,QAAQ3U,GAClB0S,EAAM/C,OAAO,GAAIxH,OAAMC,EAAMC,qBAExB4gB,GAASlB,GACbzhB,KAAKiC,SAAS,aAAevI,IAAKA,EAAKsb,KAAMA,IAG9CpI,EAAOmD,QAAQxE,EAAK,MAAO,KAAMjK,QAAQwH,OAAQmI,gBAAiBjR,KAAKwhB,aAAexhB,KAAK4L,UAAUe,KAAK,SAAU7L,GACnHyjB,EAAQS,YAAYvQ,EAAQ/a,EAAK6qB,EAAQ1C,OAASvgB,QAAQ+W,KAAKvX,EAAKyjB,EAAQ1C,QAAU/gB,EAAK6hB,EAAO6B,EAAWpY,IAC3G,SAAUjE,GACZoc,EAAQtiB,SAAS,YAAakG,GAC9BiE,EAAM/C,OAAOlB,SAIVwa,GAASlB,GACbzhB,KAAKiC,SAAS,aAAevI,IAAKA,EAAKsb,KAAMA,IAG1C2N,GAAsB,OAAb3iB,KAAKuL,IACjBvL,KAAKglB,YAAYvQ,EAAQ/a,EAAKsb,EAAM2N,EAAO6B,EAAWpY,IAE1C,OAAR1S,GACH6R,EAAMvL,KAAK6iB,SAASnpB,GACpB+qB,EAAS,QACTC,EAAQpjB,QAAQwD,MAAMkQ,GAAM,GAC5BA,EAAOrW,EAAM6lB,EAAWxP,EAAMhV,KAAK4U,MAAMH,IAAS,KAGlDlJ,EAAMgX,EAAOzjB,SAAW,KAAOyjB,EAAO9kB,KAAO8kB,EAAOC,SAGrDmC,EAAS/X,EAAOmD,QAAQxE,EAAKkZ,EAAQzP,EAAM1T,QAAQwH,OAAQmI,gBAAiBjR,KAAKwhB,aAAexhB,KAAK4L,UACrG+Y,EAAOhY,KAAK,SAAU7L,GACrB,GAAImkB,GAASntB,MAGZmtB,GADyB,MAAtBN,EAAOzY,IAAIoE,QAAkBqU,EAAOzY,IAAIoE,OAAS,KACnC,OAAR5W,EAAe6qB,EAAQ1C,OAASvgB,QAAQ+W,KAAKvX,EAAKyjB,EAAQ1C,QAAU/gB,EAEpE4jB,EAGVH,EAAQS,YAAYvQ,EAAQ/a,EAAKurB,EAAQtC,EAAO6B,EAAWpY,IACzD,SAAUjE,GACG,UAAXsc,GACHA,EAAS,MACTzP,EAAO1T,QAAQwD,MAAM4f,GAAO,GAE5BpjB,QAAQC,QAAQkT,EAAOO,KAAM,SAAUhO,EAAGiC,GACzC+L,EAAK/L,GAAKjC,IAGX4F,EAAOmD,QAAQxE,EAAKkZ,EAAQzP,EAAM1T,QAAQwH,OAAQmI,gBAAiBsT,EAAQ/C,aAAe+C,EAAQ3Y,UAAUe,KAAK,WAChH4X,EAAQS,YAAYvQ,EAAQ/a,EAAKgrB,EAAO/B,EAAO6B,EAAWpY,IACxD,SAAUjE,GACZoc,EAAQtiB,SAAS,YAAakG,GAC9BiE,EAAM/C,OAAOlB,OAGdoc,EAAQtiB,SAAS,YAAakG,GAC9BiE,EAAM/C,OAAOlB,QAMViE,KAGR1S,IAAK,cAgBLzB,MAAO,SAAqBwc,EAAQ/a,EAAKsb,EAAM2N,EAAO6B,EAAWpY,GAiFhE,MA/EApM,MAAKgiB,SAGO,OAARtoB,IAEFA,EADgB,OAAbsG,KAAKtG,KAAmC5B,SAAnBkd,EAAKhV,KAAKtG,MAAyC,OAAnBsb,EAAKhV,KAAKtG,KAC5Dsb,EAAKhV,KAAKtG,KAAKyQ,WAEf7I,QAAQa,QAKZnC,KAAKtG,WACDsb,GAAKhV,KAAKtG,KAIH,OAAX+a,GACHA,GACC3N,MAAO9G,KAAKqK,QACZ3Q,IAAKA,EACLsb,KAAMA,EACN4M,YAGD5hB,KAAK4hB,QAAQloB,IAAIA,GAAO+a,EAAO3N,MAC/B9G,KAAK6U,QAAQJ,EAAO3N,OAAS2N,EAEzBzU,KAAK+hB,aACR/hB,KAAK8hB,SAASrN,EAAO/a,KAAOiH,EAAIC,QAAQtG,GACxC0F,KAAK8hB,SAASrN,EAAO/a,KAAKgL,IAAM,KAK7B1E,KAAK+hB,aAC0BjqB,SAA9BkI,KAAK8hB,SAASrN,EAAO/a,OACxBsG,KAAK8hB,SAASrN,EAAO/a,KAAOiH,EAAIC,QAAQtG,GACxC0F,KAAK8hB,SAASrN,EAAO/a,KAAKgL,IAAM,GAGjC1E,KAAK8hB,SAASrN,EAAO/a,KAAK4G,IAAI,OAAQN,KAAK8hB,SAASrN,EAAO/a,KAAKgL,IAAK1E,KAAK4U,MAAMH,IAAS,KAI1FA,EAASzU,KAAK6U,QAAQJ,EAAO3N,OAEzB0d,IACH/P,EAAOO,SAGR1T,QAAQC,QAAQyT,EAAM,SAAUhO,EAAGiC,GAClCwL,EAAOO,KAAK/L,GAAKjC,IAIlByN,EAASnT,QAAQwD,MAAM2P,GAAQ,IAGhCzU,KAAK8jB,WAAWrP,GAEXkO,IACA3iB,KAAKuhB,UACRvhB,KAAKsiB,OAGFtiB,KAAKyhB,QACRzhB,KAAKiC,SAAS,WAAYwS,GAG3BrS,MAAMwD,KAAK5F,KAAK+Y,MAAO,SAAUzf,GAChCA,EAAEsa,aAIU9b,SAAVsU,GACHA,EAAMI,QAAQiI,GAGRzU,QAGRtG,IAAK,aAYLzB,MAAO,SAAoB6I,GAC1B,GAAIokB,GAAUllB,KAEVkC,EAAKlC,KAAKkC,GAAK,SACfuJ,EAAU3K,CAGd,IAAY,OAARA,GAA6B,OAAbd,KAAKuL,KAAwB,OAARzK,IAAiBuD,MAAMvD,IAAc,IAANA,GACvE,KAAM,IAAIe,OAAMC,EAAMC,iBAGnB/B,MAAKyL,UAAY3K,IAIrBd,KAAKyL,QAAU3K,EAEfQ,QAAQkO,YAAYtN,GAER,OAARpB,GAIJQ,QAAQyE,OAAO,WACd,MAAoB,QAAhBmf,EAAQ3Z,KACX2Z,EAAQC,WAAW,OAEZ,IAGRD,EAAQjjB,SAAS,gBACjBhC,EAAMqL,OAAO4Z,EAAQ3Z,KACrB2Z,EAAQjjB,SAAS,cACjBijB,GAAQjjB,SAAS,iBACfwJ,EAASvJ,GAAI,OAGjBxI,IAAK,aAcLzB,MAAO,SAAoB6I,GAC1B,GAAIskB,GAAUplB,KAEVqlB,EAAW,GA0Bf,OAxBAvkB,GAAI8gB,WAEJxf,MAAMwD,KAAK5F,KAAK8G,MAAO,SAAUxN,GAChC,GAAI+I,GAAO/I,EAAEwO,MAAMud,GACfrc,EAAS,EAEclR,UAAvBstB,EAAQxD,QAAQtoB,KACnB8rB,EAAQxD,QAAQtoB,OAGjB8I,MAAMwD,KAAKvD,EAAM,SAAU4G,EAAGqc,GAC7Btc,IAAWsc,EAAM,EAAID,EAAW,IAAMvkB,EAAIkU,KAAK/L,KAGbnR,SAA/BstB,EAAQxD,QAAQtoB,GAAG0P,KACtBoc,EAAQxD,QAAQtoB,GAAG0P,OAGf5G,MAAMuB,SAASyhB,EAAQxD,QAAQtoB,GAAG0P,GAASlI,EAAIgG,SACnDse,EAAQxD,QAAQtoB,GAAG0P,GAAQpF,KAAK9C,EAAIgG,OACpChG,EAAI8gB,QAAQhe,MAAMtK,EAAG0P,OAIhBhJ,QAGRtG,IAAK,SAgBLzB,MAAO,SAAgB6I,GACtB,GAAIykB,GAAUvlB,KAEVoM,EAAQC,IACRkW,EAASzqB,MA6Bb,OA3BY,QAARgJ,GAAgB8G,OAAOyG,QAAQvN,IAClCsL,EAAM/C,OAAO,GAAIxH,OAAMC,EAAMC,mBAGlB,OAARjB,EACHd,KAAKuL,IAAMzK,GAEXyhB,EAASjhB,QAAQ4H,MAAMpI,GACvBd,KAAKuL,IAAMgX,EAAOzjB,SAAW,KAAOyjB,EAAO9kB,KAAO8kB,EAAOwC,KAEpDnd,OAAOyG,QAAQkU,EAAOpmB,OAAU6D,KAAK4L,QAAQ4Z,eAAkBxlB,KAAK4L,QAAQ6Z,gBAChFzlB,KAAK4L,QAAQ6Z,cAAgB,SAAW3qB,EAAK4qB,mBAAmBnD,EAAOpmB,QAGxE6D,KAAKuC,GAAG,SAAU,WACjBgjB,EAAQrD,QACN,UAEHjiB,EAAMqL,OAAOtL,KAAKuL,KAElBvL,KAAKkiB,OAAOvV,KAAK,SAAU7L,GAC1BsL,EAAMI,QAAQ1L,IACZ,SAAUqH,GACZiE,EAAM/C,OAAOlB,MAIRiE,KAGR1S,IAAK,OAkBLzB,MAAO,SAAcuP,EAAO/O,EAAQwc,GACnC,GAAI0Q,GAAU3lB,IAEdvH,GAASA,KAAW,GAAQwc,YAAiBrd,OAE7C,IAAIguB,GAAOhe,OAAOqT,YAAYrT,OAAOC,QAAQL,GAAOc,KAAK,MACrD8D,EAAQC,IAGR7L,EAAO,SAAcqU,GACxB,GAAIsP,GAASrsB,MAEb,IAAsB,IAAlB6tB,EAAQtb,MACX+B,EAAMI,gBACA,KAAK/T,GAAUktB,EAAQ3D,MAAM4D,GACnCxZ,EAAMI,QAAQmZ,EAAQ3D,MAAM4D,QACtB,IAAI7qB,EAAW,CACrBqR,EAAMO,KAAK,SAAU7L,GAGpB,MAFA6kB,GAAQ3D,MAAM4D,GAAQ9kB,EAEf6kB,EAAQ3D,MAAM4D,IACnB,SAAUzd,GACZ7G,QAAQqT,MAAMxM,IAGf,KACCgc,EAAS7iB,QAAQ6iB,OAAO/X,GACxB+X,EAAOC,aAAcC,IAAK,OAAQzC,QAAS+D,EAAQ/D,QAAS/M,QAASA,EAASrN,MAAOA,IACpF,MAAOW,GAERpN,GAAY,EAEZ4qB,EAAQ3D,MAAM4D,GAAQxjB,MAAMmF,QAAQsN,EAASrN,EAAO,QACpD4E,EAAMI,QAAQmZ,EAAQ3D,MAAM4D,SAG7BD,GAAQ3D,MAAM4D,GAAQxjB,MAAMmF,QAAQsN,EAASrN,EAAO,QACpD4E,EAAMI,QAAQmZ,EAAQ3D,MAAM4D,IAY9B,OARK3Q,GAGJjV,KAAKd,OAAO+V,GAAOtI,KAAKnM,EAAM,SAAU2H,GACvCiE,EAAM/C,OAAOlB,KAHd3H,EAAKc,QAAQwD,MAAM9E,KAAK6U,SAAS,IAO3BzI,KAGR1S,IAAK,UAgBLzB,MAAO,SAAiB+J,EAAK8iB,EAAIlX,GAChC,GAAIiY,GAAU7lB,KAEV8lB,EAAO9lB,KACPyU,GAAS,EACTsR,GAASne,OAAOyG,QAAQrO,KAAK3E,SAC7B2qB,EAAmB,YAATpY,GAAgD,mBAAnBqY,gBACvC7Z,EAAQC,IACR2I,EAAOld,OACP4B,EAAM5B,OACN2M,EAAS3M,MA4Mb,OA1MK+D,OAAM4C,qBAAqB8G,WAAYvD,KAASnG,MAAMqB,eAAeqI,KAAKuf,IAG9ErQ,EAAS5Y,MAAM2C,cAAc+G,WAAYvD,KAAQA,EAAI6O,eAAe,QAEzD,WAAPiU,IACCrQ,GAAYzS,YAAepK,UAC9BoK,EAAMhC,KAAKzI,IAAIyK,IAGhBtI,EAAM+a,EAASzS,EAAItI,IAAMsI,EAAIE,IACZ,WAAP4iB,GAAmBrQ,IAC7B/a,EAAMsI,EAAItI,KAAOsI,GAGd+jB,EACH1qB,EAAQ6qB,QAAQlmB,KAAK3E,QAAS,SAAU8M,EAAGge,GAC1C,MAAIhe,IACCge,GACHA,EAAGC,QAGGha,EAAM/C,OAAOlB,QAGrBge,GAAGE,WAAWR,EAAQ3jB,GAAI,SAAUiG,EAAGke,GACtC,MAAIle,IACHge,EAAGC,QACIha,EAAM/C,OAAOlB,SAGV,QAAP2c,EACCrQ,EACH4R,EAAWtR,MAAOuR,IAAKtkB,EAAItI,MAAOqH,MAAM,GAAGwlB,QAAQ,SAAUpe,EAAGqe,GAC/DL,EAAGC,QAECje,EACHiE,EAAM/C,OAAOlB,GACa,IAAhBqe,EAAKjtB,OACf6S,EAAMI,QAAQ,aAEPga,GAAK,GAAGF,IAEfT,EAAQvlB,IAAI5G,EAAK8sB,EAAK,IAAI,GAAM7Z,KAAK,SAAU8Z,GAC9Cra,EAAMI,QAAQia,IACZ,SAAUte,GACZiE,EAAM/C,OAAOlB,QAKhBke,EAAWtR,SAASwR,QAAQ,SAAUpe,EAAGqe,GACxC,GAAIltB,GAAIxB,OACJ4M,EAAM5M,MAEV,OAAIqQ,IACHge,EAAGC,QACIha,EAAM/C,OAAOlB,KAGrB7O,EAAI,GACJoL,EAAM8hB,EAAKjtB,OAEPmL,EAAM,IACTmhB,EAAQhR,QAAU2R,EAAKrhB,IAAI,SAAUiM,GACpC,GAAIqV,IAAQ/sB,IAAK0X,EAAEkV,IAAKxf,QAASxN,EAAG0b,QAOpC,OALA6Q,GAAQjE,QAAQloB,IAAI+sB,EAAI/sB,KAAO+sB,EAAI3f,MACnC2f,EAAIzR,KAAO5D,QACJqV,GAAIzR,KAAKsR,IAChBT,EAAQ/B,WAAW2C,GAEZA,IAGRZ,EAAQxb,MAAQ3F,GAGjByhB,EAAGC,YACHha,GAAMI,QAAQqZ,EAAQhR,YAGP,WAAPiQ,EACVuB,EAAWjmB,OAAOqU,GAAW6R,IAAK5sB,OAAcgtB,MAAM,GAAQ,SAAUve,EAAGrH,GAC1EqlB,EAAGC,QAECje,EACHiE,EAAM/C,OAAOlB,GAEbiE,EAAMI,QAAQ1L,KAGC,QAAPgkB,EACNrQ,EACH4R,EAAWtS,QAASuS,IAAKtkB,EAAItI,KAAOsI,EAAIgT,MACvC2R,EAAG,EACHD,MAAM,EACNE,QAAQ,GACN,SAAUze,EAAGrH,GACfqlB,EAAGC,QAECje,EACHiE,EAAM/C,OAAOlB,GAEbiE,EAAMI,QAAQ1L,KAKhBulB,EAAWjmB,WAAaumB,EAAG,EAAGD,MAAM,GAAQ,SAAUve,GACrD,GAAIga,GAAYrqB,MAEhB,OAAIqQ,IACHge,EAAGC,QACIha,EAAM/C,OAAOlB,KAEpBga,KAEA/f,MAAMwD,KAAKigB,EAAQhR,QAAS,SAAUvb,GACrC,GAAI0b,MACA6R,EAASxa,GAEb8V,GAAUve,KAAKijB,GAEfvlB,QAAQC,QAAQjI,EAAE0b,KAAM,SAAUhO,EAAGiC,GACpC+L,EAAK/L,GAAKjC,IAGXqf,EAAWtS,QAASuS,IAAKhtB,EAAEI,KAAOsb,GACjC2R,EAAG,EACHD,MAAM,EACNE,QAAQ,GACN,SAAUze,EAAGrH,GACXqH,EACH0e,EAAOxd,OAAOlB,GAEd0e,EAAOra,QAAQ1L,OAKlBQ,QAAQ8gB,KAAKD,GAAWxV,KAAK,SAAUlI,GACtC0hB,EAAGC,QACHha,EAAMI,QAAQ/H,IACZ,SAAU0D,GACZge,EAAGC,QACHha,EAAM/C,OAAOlB,KA9Bdga,WAoCHgE,EAAGC,QACHha,EAAM/C,OAAO,YAKL,QAAPyb,GACHrgB,EAASuhB,EAAUC,eAAea,QAAQptB,GAAOiB,EAAamsB,QAAQptB,GAEvD,OAAX+K,GACHA,EAAS8J,EAAKC,OAAO/J,GAEjBgQ,EACHzU,KAAKM,IAAI5G,EAAK+K,GAAQ,GAAMkI,KAAK,SAAU8Z,GAC1Cra,EAAMI,QAAQia,IACZ,SAAUte,GACZiE,EAAM/C,OAAOlB,MAGd7G,QAAQwH,MAAMgd,EAAMrhB,GACpB2H,EAAMI,QAAQsZ,KAGf1Z,EAAMI,QAAQsZ,GAIf1Z,EAAMO,KAAK,WACVkZ,EAAQxM,QAAS,GACf,SAAUlR,GACZ,KAAMA,MAEU,WAAP2c,GACVkB,EAAUC,eAAec,WAAWrtB,GAAOiB,EAAaosB,WAAWrtB,GACnE0S,EAAMI,QAAQxM,OACG,QAAP8kB,GACV9P,EAAOzG,EAAKuC,OAAO2D,EAASzS,EAAIgT,MAC/B3K,MAAOrK,KAAKqK,MACZvD,MAAO9G,KAAK8G,MACZ8a,QAAS5hB,KAAK4hB,QACd/M,QAAS7U,KAAK6U,UAEfmR,EAAUC,eAAee,QAAQttB,EAAKsb,GAAQra,EAAaqsB,QAAQttB,EAAKsb,GACxE5I,EAAMI,QAAQxM,OAEdoM,EAAM/C,OAAO,OApMf+C,EAAM/C,OAAO,GAAIxH,OAAMC,EAAMC,mBAyMvBqK,KAGR1S,IAAK,OAkBLzB,MAAO,WACN,GAAIgvB,GAAUjnB,KAEVyhB,EAASzhB,KAAKyhB,UAAW,EACzBrV,EAAQC,IAWRI,EAAU,SAAiB3L,GAC9B,GAAIkU,GAAOld,MAEX,OAAmB,gBAARgJ,GACH4L,EAAQ,GAAI7K,OAAMC,EAAMwc,kBAGT,OAAnB2I,EAAQpF,SACX/gB,EAAMQ,QAAQ+W,KAAKvX,EAAKmmB,EAAQpF,SAIhC7M,EADGlU,YAAeM,OACXN,GAECA,OAGTmmB,GAAQtE,MAAM,MAAO3N,GAAM,GAAMrI,KAAK,SAAU7L,GAC3C2gB,GACHwF,EAAQhlB,SAAS,YAAanB,GAG/BsL,EAAMI,QAAQ1L,IACZ4L,KAYAA,EAAU,SAAiBvE,GAC1BsZ,GACHwF,EAAQhlB,SAAS,aAAckG,GAGhCiE,EAAM/C,OAAOlB,GAiBd,OAdiB,QAAbnI,KAAKuL,KAAgB3D,OAAOyG,QAAQrO,KAAKuL,KAC5Ca,EAAM/C,OAAO,GAAIxH,OAAMC,EAAMC,oBAEzB0f,GACHzhB,KAAKiC,SAAS,aAAcjC,KAAKuL,KAGZ,OAAlBvL,KAAKoP,SACRxC,EAAOuC,MAAMnP,KAAKuL,KAAO6D,SAAUpP,KAAKoP,WAAYzC,KAAKF,EAASC,GAElEE,EAAOmD,QAAQ/P,KAAKuL,IAAK,MAAO,KAAMjK,QAAQwH,OAAQmI,gBAAiBjR,KAAKwhB,aAAexhB,KAAK4L,UAAUe,KAAKF,EAASC,IAInHN,KAGR1S,IAAK,WAWLzB,MAAO,WACN,GAAIsT,GAAMvL,KAAKuL,IACXrJ,EAAKpK,MAsBT,OApBY,QAARyT,IACHtL,EAAMqL,OAAOC,GAAK,GAElBrJ,EAAKlC,KAAKkC,GAAK,aACfZ,QAAQkO,YAAYtN,GAEpBE,MAAMwD,KAAK5F,KAAK6U,QAAS,SAAUvb,GAClC,GAAI4tB,GAAY3b,EAAM,IAAMjS,EAAEI,GAE9BuG,GAAMqL,OAAO4b,GAAW,MAI1B9kB,MAAMwD,KAAK5F,KAAK+Y,MAAO,SAAUzf,GAChCA,EAAEic,UAAS,KAGZvV,KAAK6E,OAAM,GACX7E,KAAKiC,SAAS,iBAEPjC,QAGRtG,IAAK,OAcLzB,MAAO,SAAcyB,EAAKyT,GACzB,GAAIsH,GAASzU,KAAKzI,IAAImC,GAClB0S,EAAQC,IACRyV,EAAW9hB,KAAK8hB,SAASrN,EAAO/a,KAChC6G,EAAWzI,MAsBf,OApBeA,UAAX2c,EACHrI,EAAM/C,OAAO,GAAIxH,OAAMC,EAAMC,mBAEzB+f,GACHvhB,EAAWuhB,EAASvqB,IAAI4V,GAAW2U,EAAS5hB,OAE3BpI,SAAbyI,EACH6L,EAAM/C,OAAOvH,EAAM8c,wBAEnB5e,KAAKM,IAAI5G,EAAK6G,GAAUoM,KAAK,SAAU7L,GACtCsL,EAAMI,QAAQ1L,IACZ,SAAUqH,GACZiE,EAAM/C,OAAOlB,MAIfiE,EAAM/C,OAAOvH,EAAM8c,wBAIdxS,KAGR1S,IAAK,SAYLzB,MAAO,SAAgByB,GACtB,MAAO0I,OAAM6I,OAAOjL,KAAK6U,QAAQ1P,IAAI,SAAU7L,GAC9C,MAAOA,GAAE0b,KAAKtb,SAIhBA,IAAK,SAeLzB,MAAO,SAAgByB,EAAKsb,GAC3B,GAAIP,GAASzU,KAAKzI,IAAImC,GAClB0S,EAAQC,GAYZ,OAVevU,UAAX2c,EACHrI,EAAM/C,OAAO,GAAIxH,OAAMC,EAAMC,mBAE7B/B,KAAKM,IAAI5G,EAAK4H,QAAQwH,MAAM2L,EAAOO,KAAMA,IAAOrI,KAAK,SAAU7L,GAC9DsL,EAAMI,QAAQ1L,IACZ,SAAUqH,GACZiE,EAAM/C,OAAOlB,KAIRiE,MAIFiV,GACLxe,GAKCqR,OAkBHtT,QAAS,SAAiB4lB,EAAMtqB,GAC/B,GAAI8F,GAAM,GAAIqf,EAUd,OARInlB,aAAgBtE,SACnB0J,QAAQwH,MAAM9G,EAAK9F,GAGP,OAATsqB,GAAiC,gBAATA,IAC3BxkB,EAAI2gB,MAAM,MAAO6D,GAGXxkB,GAYRmiB,OAAQ,SAAgBjjB,GACvB,GAAImjB,GAAMnjB,EAAG8T,KAAKqP,IACdxP,EAAU3T,EAAG8T,KAAKH,QAClBoP,EAAUnsB,OACVosB,EAAOpsB,OACPksB,EAAYlsB,OACZ8pB,EAAU9pB,OACVgP,EAAQhP,OACR2M,EAAS3M,OACTyQ,EAASzQ,OACTmd,EAAQnd,OACRkR,EAASlR,MAED,YAARusB,GACHpP,EAAQ9O,KAAK+C,MAAMhI,EAAG8T,KAAKC,OAC3B+O,EAAY9iB,EAAG8T,KAAKgP,UACpBC,EAAU7hB,MAAMwE,WAAWqO;AAC3B1M,EAASnG,MAAMmE,KAAK0d,GAAS3e,OAAO,SAAUhM,EAAGyK,GAChD,MAAOA,GAAM,IAAM,IACjBqE,KAAKhG,MAAMgG,MACdtB,EAAQyB,EAAOD,KAAK,KACpBU,EAAST,EAAOpD,IAAI,SAAU7L,GAC7B,MAAO2b,GAAM3b,KACXgP,KAAK,KACRsZ,EAAU1gB,EAAG8T,KAAK4M,QAClBsC,EAAO,YAEkB,IAArBF,EAAUzqB,QAAgBqoB,EAAQ9a,GACrCrC,GAAUmd,EAAQ9a,GAAOkC,QAAe7D,IAAI,SAAU7L,GACrD,MAAOub,GAAQvb,MAGZ2qB,EAAQ1qB,OAAS,EACpB6I,MAAMwD,KAAKqe,EAAS,SAAU3qB,EAAGyK,GAChC,GAAIugB,GAAK,IAELvgB,GAAM,IACTugB,EAAK,UAILJ,GADG9hB,MAAMuB,SAASqgB,EAAW1qB,EAAE,IACvBgrB,EAAKhrB,EAAE,GAAK,eAAkBA,EAAE,GAAK,SAClC+K,MAAM/K,EAAE,IAGXgrB,EAAK,aAAgBhrB,EAAE,GAAK,WAAeA,EAAE,GAAK,MAFlDgrB,EAAK,aAAgBhrB,EAAE,GAAK,UAAaA,EAAE,GAAK,OAOzD4qB,GADG9hB,MAAMuB,SAASqgB,EAAWC,EAAQ,GAAG,IAChCA,EAAQ,GAAG,GAAK,eAAkBA,EAAQ,GAAG,GAAK,OAC/C5f,MAAM4f,EAAQ,GAAG,IAGpB,aAAgBA,EAAQ,GAAG,GAAK,WAAeA,EAAQ,GAAG,GAAK,IAF/D,aAAgBA,EAAQ,GAAG,GAAK,UAAaA,EAAQ,GAAG,GAMlEC,GAAQ,MAERzf,EAASoQ,EAAQvP,OAAO,GAAI+C,UAAS,MAAO6b,MAE3B,SAARG,IACV5f,EAASrC,MAAMmF,QAAQsN,EAAS3T,EAAG8T,KAAKxN,MAAO,SAGhD4c,YAAY3f,KAOVmD,QAYHoO,WAAY,SAAoBhU,GAC/B,GAAImlB,GAAuBrvB,SAAjBiI,UAAU,IAAmB,EAAQA,UAAU,GAErD0E,EAAS3M,MAUb,OAPC2M,GADG0iB,EACMvf,OAAOC,QAAQ7F,EAAK,KAAKmD,IAAI,SAAU7L,GAC/C,MAAOA,GAAE6mB,OAAO,GAAGvP,cAAgBtX,EAAEkQ,MAAM,KACzClB,KAAK,KAECtG,EAAIme,OAAO,GAAGvP,cAAgB5O,EAAIwH,MAAM,IAgBnDkK,OAAQ,SAAgB1R,GACvB,MAAOA,GAAI0F,QAAQ,iCAAkC,SAgBtDG,QAAS,SAAiB7F,GACzB,GAAIlB,GAAuBhJ,SAAjBiI,UAAU,GAAmB,IAAMA,UAAU,EAEvD,OAAO6H,QAAOwF,KAAKpL,GAAK8F,MAAM,GAAI2K,QAAO,OAAS3R,EAAM,UAgBzD8F,WAAY,SAAoB5E,EAAKmb,GACpC,GAAI1Y,IAAU0Y,EAAOA,EAAO,OAAS,KAAO,IAQ5C,OANA7b,SAAQC,QAAQS,EAAK,SAAUgF,EAAGiC,GACjCxE,GAAU,IAAOwE,EAAI,KAAQjC,EAAEmD,WAAa,QAG7C1F,EAASA,EAAOiD,QAAQ,qBAAsB,MAAMA,QAAQ,OAAQ,MAAQ,KAgB7E0f,UAAW,SAAmBplB,GAC7B,GAAIqlB,GAAyBvvB,SAAjBiI,UAAU,IAAmB,EAAQA,UAAU,GAEvD0E,EAASmD,OAAOwF,KAAKpL,GAAK0F,QAAQ,OAAQ,IAM9C,OAJI2f,MAAU,IACb5iB,EAASA,EAAOiD,QAAQ,WAAY,OAAO6F,eAGrC9I,GAeR6iB,UAAW,SAAmBtlB,GAC7B,MAAOnG,OAAMO,KAAKmJ,KAAKvD,IAexBqM,QAAS,SAAiBrM,GACzB,MAA4B,KAArB4F,OAAOwF,KAAKpL,IAepBulB,SAAU,SAAkBvlB,GAC3B,MAAOnG,OAAMuC,OAAOmH,KAAKvD,IAe1BwP,MAAO,SAAexP,GACrB,MAAOnG,OAAMP,IAAIiK,KAAKvD,IAavBiZ,YAAa,SAAqBjZ,GACjC,GAAIkG,GAAIN,OAAOwF,KAAKpL,GAAK0F,QAAQ,+CAAgD,KAAK6F,cAAczF,MAAMjM,MAAMyD,cAC5G8R,IAMJ,OAJAhP,OAAMwD,KAAKsC,EAAG,SAAU5O,EAAGyK,GAC1BqN,EAAExN,KAAa,IAARG,EAAYzK,EAAIsO,OAAOoO,WAAW1c,MAGnC8X,EAAE9I,KAAK,KAafkf,SAAU,SAAkBxlB,GAC3B,MAAOA,GAAI0F,QAAQ,QAAS,KAAKA,QAAQ,OAAQ,KAAKA,QAAQ,OAAQ,MAAMA,QAAQ,KAAM,KAiB3F+f,WAAY,SAAoBzlB,GAC/B,GAAI9F,GAAO0L,OAAOwF,KAAKpL,EAAI0F,QAAQ,QAAS,IAAIA,QAAQ,qBAAsB,IAAIA,QAAQ,OAAQ,KAC9F+S,EAAO7S,OAAOwF,KAAKpL,EAAI0F,QAAQ,QAAS,IAAIA,QAAQ,MAAO,IAE/D,OAAOW,UAAS5G,MAAM4G,SAAUT,OAAOC,QAAQ3L,GAAMyJ,QAAQ8U,MAa9DrN,KAAM,SAAcpL,GACnB,MAAOA,GAAI0F,QAAQ,iCAAkC,KAWtDuO,YAAa,SAAqBjU,GACjC,MAAO4F,QAAOwF,KAAKpL,EAAI0F,QAAQ,WAAY,OAAO6F,gBAanDma,aAAc,SAAsB1lB,GACnC,GAAIyC,GAASmD,OAAOwF,KAAKpL,EAEzB,OAAOyC,GAAO0b,OAAO,GAAG5S,cAAgB9I,EAAO+E,MAAM,IAetD0M,YAAa,SAAqBlU,GACjC,GAAI1F,GAAwBxE,SAAjBiI,UAAU,IAAmB,EAAQA,UAAU,EAE1D,OAAIzD,MAAS,EACLsL,OAAOC,QAAQ7F,EAAK,KAAKsG,KAAK,KAE9BV,OAAOC,QAAQ7F,EAAK,KAAKmD,IAAI,SAAU7L,GAC7C,MAAOsO,QAAOoO,WAAW1c,KACvBgP,KAAK,OAQPhH,SAQHqmB,SAsBA/O,EAAG,SAAW9X,GACb,GAAI2D,GAAS3M,MAqCb,OAlCKgJ,KAEIjF,MAAMyB,KAAKiI,KAAKzE,GACxB2D,GAAUgL,EAAQhX,OAAOqI,KAIzBA,EAAM8G,OAAOwF,KAAKtM,GAEO,KAArBA,EAAIkE,QAAQ,MACfP,EAASnD,QAAQsO,IAAI9O,GAEjB2D,EACCJ,MAAMI,EAAOlL,UAChBkL,GAAUA,IAGXA,OAGDA,KAEArC,MAAMwD,KAAKgC,OAAOC,QAAQ/G,GAAM,SAAU0G,GACzC,GAAIxF,GAAMV,QAAQsO,IAAIpI,EAElBxF,aAAeZ,OAClBqD,EAASA,EAAOkB,OAAO3D,GACbA,GACVyC,EAAOb,KAAK5B,QAMTyC,GAYRmjB,OAAQ,WACPC,QAAQC,KAAK,2EAA4E,8EAA+E,8EAA+E,+EAAgF,iFAAkF,mFAAmFxf,KAAK,QAWlfgY,KAAM,SAAcxf,GACnB,GAAIkB,GAAM,GAAIa,EAQd,OANI/B,aAAelJ,SAClB0J,QAAQwH,MAAM9G,EAAKlB,GAGpBkB,EAAIc,SAAWF,IAERZ,GAYR+K,KAAM,SAAcjM,GACnB,GAAIkB,GAAMlK,MAEV,KACCkK,EAAM,GAAIhH,OAAM8F,IAAQ8M,KAAM,2BAC7B,MAAOzF,GACHtO,EAAOkuB,cACXluB,EAAOkuB,YAAcluB,EAAOmuB,eAAiBnuB,EAAOouB,mBAAqBpuB,EAAOquB,gBAGjFlmB,GAAM,GAAInI,GAAOkuB,aAAcI,OAAOrnB,GAAKsnB,UAG5C,MAAOpmB,IAaRwN,YAAa,SAAqBtN,GAC7BZ,QAAQqmB,MAAMzlB,KACjBmmB,aAAa/mB,QAAQqmB,MAAMzlB,UACpBZ,SAAQqmB,MAAMzlB,KAkBvB4C,MAAO,QAASA,IAAM9C,GACrB,GAAI+C,GAA2BjN,SAAjBiI,UAAU,IAAmB,EAAQA,UAAU,GAEzD+E,GAAQhN,OACR2M,EAAS3M,MAEb,OAAIiN,MAAY,EACAjN,SAARkK,GAA6B,OAARA,EAAemE,KAAK+C,MAAM/C,KAAKC,UAAUpE,IAAQA,GAClEA,GAAOnG,MAAM+C,UAAU2G,WAAYvD,KAAQA,YAAeyQ,QAC9DzQ,EACGA,YAAeZ,QACzBqD,KAEArC,MAAMwD,KAAK5D,EAAK,SAAU1I,EAAGyK,GAC5BU,EAAOV,GAAOzC,QAAQwD,MAAMxL,KAGtBmL,IACIxK,IAAW2S,EAAOlP,IAAMsE,YAAeiL,UAC3CrN,EAAI4O,OAAO5O,EAAIkR,OAAO9O,IACM,mBAAlBA,GAAIlJ,UACdwI,QAAQgnB,OAAOtmB,EAAIlJ,UAAWkJ,GAC3BA,YAAepK,SAEzBkN,GAAQyJ,EAAKuC,OAAO9O,GAAK,GAEXlK,SAAVgN,IACHA,GAAQyJ,EAAKC,OAAO1J,IAGpBxD,QAAQC,QAAQS,EAAK,SAAUgF,EAAGiC,GAChB,kBAANjC,KACVlC,GAAMmE,GAAKjC,MAIblC,GAAQ9C,EAGF8C,IAEA9C,GAcT6Q,OAAQ,SAAgB5a,GACvB,GAAI4rB,GAAM/rB,MAEV,OAAc,QAAVG,GAA4BH,SAAVG,EACdH,OACa,SAAVG,GACH,EACa,UAAVA,GACH,EACa,SAAVA,EACH,KACa,cAAVA,EACHH,OACa,KAAVG,EACHA,EACIoM,MAAMwf,EAAMV,OAAOlrB,IAEpB4D,MAAMiC,UAAUyH,KAAKtN,GACxBsW,EAAKC,OAAOvW,GAAO,IAASA,EAE5BA,EAJA4rB,GAqBTvL,QAAS,SAAiBL,EAAKsQ,EAASC,GAGvC,MAFAvQ,GAAIK,QAAQiQ,EAASC,IAEd,GAsBRC,MAAO,SAAevjB,GACrB,IAAK,GAAIwjB,GAAS3oB,UAAUxG,OAAQ8R,EAAIjK,MAAMsnB,EAAS,EAAIA,EAAS,EAAI,GAAIC,EAAS,EAAYD,EAATC,EAAiBA,IACxGtd,EAAEsd,EAAS,GAAK5oB,UAAU4oB,EAG3B,IAAIC,GAAM1jB,EAAGzD,MAAMyD,EAAImG,EAEvB,OAAO,YACN,IAAK,GAAIwd,GAAS9oB,UAAUxG,OAAQuvB,EAAI1nB,MAAMynB,GAASE,EAAS,EAAYF,EAATE,EAAiBA,IACnFD,EAAEC,GAAUhpB,UAAUgpB,EAGvB,OAAOH,GAAInnB,MAAMmnB,EAAKE,KAmBxB1c,MAAO,SAAelH,GACrB,GAAI8M,GAAsBla,SAAjBiI,UAAU,GAAmB,EAAIA,UAAU,GAChDmC,EAAsBpK,SAAjBiI,UAAU,GAAmBjI,OAAYiI,UAAU,EAa5D,OAXkB,gBAAPmC,GACVZ,QAAQkO,YAAYtN,GAEpBA,EAAKZ,QAAQa,MAAK,GAGnBb,QAAQqmB,MAAMzlB,GAAM8mB,WAAW,WAC9B1nB,QAAQkO,YAAYtN,GACpBgD,KACE8M,GAEI9P,GAcRsO,MAAO,WACN,MAA4B,mBAAjByY,cACH,SAAUnoB,GAChBmoB,aAAanoB,IAEe,mBAAZ5G,SACVA,QAAQgvB,SAER,SAAUpoB,GAChBkoB,WAAWloB,EAAK,OAcnB8O,IAAK,SAAa9O,GACjB,GAAI2D,GAAS3M,MAgBb,OAHC2M,GAXI5I,MAAMuD,iBAAiBmG,KAAKzE,GAWvBsB,MAAM+B,KAAKrK,EAAS8hB,iBAAiB9a,IAV1CjF,MAAMsB,KAAKoI,KAAKzE,GACVhH,EAASqvB,eAAeroB,EAAI4G,QAAQ7L,MAAMsB,KAAM,MAAQrF,OAExDsK,MAAM+B,KADLtI,MAAMkC,MAAMwH,KAAKzE,GACPhH,EAASsvB,uBAAuBtoB,EAAI4G,QAAQ7L,MAAMkC,MAAO,KACnElC,MAAM6D,KAAK6F,KAAKzE,GACNhH,EAASuvB,qBAAqBvoB,GAE9BhH,EAAS8hB,iBAAiB9a,KAkBjDwoB,MAAO,SAAexoB,GACrB,MAAO,IAAMA,EAAI4G,QAAQ,KAAM,IAAI8B,MAAM,IAa1CtD,MAAO,SAAeO,EAAGC,GACxB,MAAO6H,GAAKuC,OAAOrK,GAAG,KAAU8H,EAAKuC,OAAOpK,GAAG,IAehDiO,MAAO,SAAexM,EAAGjM,EAAMwF,EAAO6nB,GACrC,GAAInlB,IACHrE,UAAW7D,EAAOkG,MAAM+B,KAAKjI,MAC7BstB,QAASrhB,EAAEqhB,SAAWrhB,EACtB/J,OAAQ+J,EAAE/J,OAAoB,MAAX+J,EAAE/J,OAAiBtG,OACtC4J,MAAOA,EACP+nB,MAAOthB,EAAEshB,OAAS3xB,OAClBsW,WAAW,GAAI1C,OAAOge,cACtB9b,KAAMzF,EAAEyF,MAAQ,YAKjB,OAFAtM,SAAQwmB,IAAI1jB,EAAEqlB,OAASrlB,EAAEolB,QAASD,KAAY,EAAO,QAAU,QAExDnlB,GAcRkkB,OAAQ,SAAgBtmB,EAAKlB,GAC5B,GAAIsD,GAAIxM,OAAOa,OAAOuJ,EAQtB,OANIlB,aAAelJ,SAClB0J,QAAQwH,MAAM1E,EAAGtD,GAGlBsD,EAAE,SAAWpC,EAENoC,GAcRmL,MAAO,SAAevN,GACrB,GAAI4N,GAAuB9X,SAAjBiI,UAAU,IAAmB,EAAQA,UAAU,GAErDmC,EAAKpK,MAET,IAAIkK,IAAQA,EAAIE,IAAMF,YAAeZ,QAAyB,gBAARY,IAAoBA,YAAe2nB,SACxF,MAAO3nB,EAGR,IAAI4N,GACH,EACC1N,GAAKZ,QAAQgoB,MAAMhoB,QAAQa,MAAK,UACxBb,QAAQsO,IAAI,IAAM1N,QAE3BA,GAAKZ,QAAQgoB,MAAMhoB,QAAQa,MAAK,GAGjC,OAAIH,IAAsB,gBAARA,IACjBA,EAAIE,GAAKA,EAEFF,GAEAE,GAkBTX,QAAS,SAAiBS,EAAKkD,GAK9B,MAJA9C,OAAMwD,KAAKhO,OAAOyK,KAAKL,GAAM,SAAU1I,GACtC,MAAO4L,GAAG/M,KAAK6J,EAAKA,EAAI1I,GAAIA,KAGtB0I,GAcR8lB,IAAK,SAAahnB,GACjB,GAAI1H,GAA0BtB,SAAjBiI,UAAU,GAAmB,MAAQA,UAAU,GAExD6pB,EAAqB,gBAAR9oB,GAAmB,KAAM,GAAI4K,OAAOme,qBAAuB,KAAO/oB,EAAMA,CAEzF+mB,SAAQzuB,GAAQwwB,IAiBjB9gB,MAAO,SAAe9G,EAAKlB,GAiB1B,MAhBIkB,aAAepK,SAAUkJ,YAAelJ,QAC3CA,OAAOyK,KAAKvB,GAAK6F,QAAQ,SAAUrN,GAC9B0I,EAAI1I,YAAc1B,SAAUkJ,EAAIxH,YAAc1B,QACjDoK,EAAI1I,GAAKgI,QAAQwH,MAAM9G,EAAI1I,GAAIwH,EAAIxH,IACzB0I,EAAI1I,YAAc8H,QAASN,EAAIxH,YAAc8H,OACvDY,EAAI1I,GAAK0I,EAAI1I,GAAGqM,OAAOuE,EAAE5Q,IAEzB0I,EAAI1I,GAAKwH,EAAIxH,KAIf0I,EADUA,YAAeZ,QAASN,YAAeM,OAC3CY,EAAI2D,OAAO7E,GAEXA,EAGAkB,GA0BRkH,MAAO,SAAeqC,GACrB,GAAIvJ,MACAvE,EAAO3F,OACPyqB,EAASzqB,OACTgH,EAAWhH,MA0Df,OAxDYA,UAARyT,IACHA,EAAOtR,EAAyB,GAAhBF,EAAS8R,MAGrB5R,EAMJ+H,EAAM1G,EAAI4N,MAAMqC,IALhBvJ,EAAMlI,EAAS6gB,cAAc,KAC7B3Y,EAAI6J,KAAON,EACX9N,EAAOuE,EAAI6J,KAAKuM,MAAMvc,MAAM4B,MAAM,GAClCqB,EAAWkD,EAAI6J,KAAKuM,MAAMvc,MAAMiD,UAAU,IAKvC7E,GACHqH,QAAQC,QAAQS,EAAK,SAAUgF,EAAGiC,GACvB,OAANjC,IACHhF,EAAIiH,GAAKnR,UAKZyqB,GACCpmB,KAAMlC,EAAS,KAAO4B,MAAMM,KAAKgS,KAAK5C,GACtCzM,SAAUkD,EAAIlD,UAAYA,EAC1BgrB,SAAU9nB,EAAI8nB,UAAYrsB,EAC1BssB,KAAM/nB,EAAI+nB,KAAO3rB,EAAO8K,MAAMlH,EAAI+nB,KAAM,IAAM,GAC9CvH,SAAUxgB,EAAIwgB,SACdwH,OAAQhoB,EAAIgoB,QAAU,GACtB7sB,KAAM6E,EAAI7E,MAAQ,GAClBM,KAAMuE,EAAIvE,MAAQA,GAIfmP,EAAOlP,KACc,MAApB6kB,EAAOzjB,WACVyjB,EAAOzjB,SAAW/E,EAAS+E,UAGxB8I,OAAOyG,QAAQkU,EAAOuH,YACzBvH,EAAOuH,SAAW/vB,EAAS+vB,UAGxBliB,OAAOyG,QAAQkU,EAAO9kB,QACzB8kB,EAAO9kB,KAAO1D,EAAS0D,MAGU,MAA9B8kB,EAAOC,SAASrC,OAAO,KAC1BoC,EAAOC,SAAW,IAAMD,EAAOC,WAIjCD,EAAOpmB,KAAO6F,EAAI7F,OAAyB,OAAhBomB,EAAOpmB,KAAgB,GAAKomB,EAAOpmB,KAAK,IACnEomB,EAAO1W,KAAO7J,EAAI6J,MAAQ0W,EAAOzjB,SAAW,MAAQ8I,OAAOyG,QAAQkU,EAAOpmB,MAAQ,GAAKomB,EAAOpmB,KAAO,KAAOomB,EAAO9kB,KAAO8kB,EAAOC,SAAWD,EAAOyH,OAASzH,EAAOplB,KACnKolB,EAAOwC,KAAO/iB,EAAI+iB,MAAQxC,EAAOC,SAAWD,EAAOyH,OACnDzH,EAAO/a,MAAQlG,QAAQ2oB,YAAY,KAAM1H,EAAOyH,QAEzCzH,GAkBRzT,QAAS,SAAiB5J,GACzB,IAAK,GAAIglB,GAASnqB,UAAUxG,OAAQ2C,EAAOkF,MAAM8oB,EAAS,EAAIA,EAAS,EAAI,GAAIC,EAAS,EAAYD,EAATC,EAAiBA,IAC3GjuB,EAAKiuB,EAAS,GAAKpqB,UAAUoqB,EAG9B,OAAO,YACN,IAAK,GAAIC,GAASrqB,UAAUxG,OAAQ8wB,EAAQjpB,MAAMgpB,GAASE,EAAS,EAAYF,EAATE,EAAiBA,IACvFD,EAAMC,GAAUvqB,UAAUuqB,EAG3B,OAAOplB,GAAGzD,MAAMyD,EAAIhJ,EAAKyJ,OAAO0kB,MAclCE,QAAS,SAAiBrpB,GAKzB,MAJiC,kBAAtBA,GAAGspB,gBACbtpB,EAAGspB,iBAGGtpB,GAYR+oB,YAAa,SAAqBnpB,GACjC,GAAI2pB,GAA2B3yB,SAAjBiI,UAAU,GAAmB,GAAKA,UAAU,GAEtDiC,KACA0oB,GAAWD,GAAW1wB,EAASiwB,QAAU,IAAIliB,MAAM,KACnDrD,EAAS3M,MAsCb,OApCI4yB,GAAQnxB,OAAS,GACpBmxB,EAAQ/X,QAGTlO,EAASimB,EAAQpiB,KAAK,KAEtBlG,MAAMwD,KAAKnB,EAAOqD,MAAM,KAAM,SAAU6iB,GACvC,GAAIC,GAAQD,EAAK7iB,MAAM,KACnBzH,EAAOvI,MAGVuI,GADGuqB,EAAMrxB,OAAS,GACVqxB,EAAMjY,QAASiY,EAAMtiB,KAAK,MAE3BsiB,EAGJhjB,OAAOyG,QAAQhO,EAAK,MAIRvI,SAAZuI,EAAK,GACRA,EAAK,GAAK,GAEVA,EAAK,GAAKiB,QAAQuR,OAAO6S,mBAAmBrlB,EAAK,KAG7BvI,SAAjBkK,EAAI3B,EAAK,IACZ2B,EAAI3B,EAAK,IAAMA,EAAK,GACR2B,EAAI3B,EAAK,aAAee,OAIpCY,EAAI3B,EAAK,IAAIuD,KAAKvD,EAAK,KAHvB2B,EAAI3B,EAAK,KAAO2B,EAAI3B,EAAK,KACzB2B,EAAI3B,EAAK,IAAIuD,KAAKvD,EAAK,QAMH,gBAARS,GAAmBQ,QAAQ+W,KAAKrW,EAAKlB,GAAOkB,GA6B3D6oB,KAAM,WACL,IAAK,GAAIC,GAAS/qB,UAAUxG,OAAQ2C,EAAOkF,MAAM0pB,GAASC,EAAS,EAAYD,EAATC,EAAiBA,IACtF7uB,EAAK6uB,GAAUhrB,UAAUgrB,EAG1B,IAAI3e,GAAQC,GAoBZ,OAjBInQ,GAAK,YAAckF,SACtBlF,EAAOA,EAAK,IAIO,IAAhBA,EAAK3C,OACR6S,EAAMI,QAAQ,MAId9R,EAAQmwB,KAAK3uB,GAAMyQ,KAAK,SAAU8W,GACjCrX,EAAMI,QAAQiX,IACZ,SAAUtb,GACZiE,EAAM/C,OAAOlB,KAIRiE,GAmBRoM,OAAQ,SAAgBtT,GACvB,GAAIkH,GAAQC,GAUZ,OARA9Q,GAAO,SAAUuF,GAChB,IACCsL,EAAMI,QAAQtH,EAAGpE,IAChB,MAAOqH,GACRiE,EAAM/C,OAAOlB,MAIRiE,GAuBRrG,OAAQ,SAAgBb,GACvB,GAAI8M,GAAsBla,SAAjBiI,UAAU,GAAmB,GAAKA,UAAU,GACjDmC,EAAsBpK,SAAjBiI,UAAU,GAAmBuB,QAAQa,MAAK,GAAQpC,UAAU,GACjEirB,EAAuBlzB,SAAjBiI,UAAU,IAAmB,EAAOA,UAAU,GAEpDkrB,EAAYnzB,MAGhB,OAAIkzB,IAAO9lB,OAAS,EAApB,QAIA+lB,EAAY,WACP/lB,OAAS,GACZ5D,QAAQ8K,MAAM6e,EAAWjZ,EAAI9P,IAI/BZ,QAAQ8K,MAAM6e,EAAWjZ,EAAI9P,GAEtBA,IAaRkT,KAAM,SAAclU,GAOnB,MANkC,kBAAvBA,GAAGgqB,iBACbhqB,EAAGgqB,kBAGJ5pB,QAAQipB,QAAQrpB,GAETA,GAaR9H,OAAQ,SAAgB8H,GACvB,MAAOA,GAAG9H,QAAU8H,EAAGiqB,YAaxBhpB,KAAM,SAAcipB,GACnB,QAASljB,KACR,OAA8B,OAArB,EAAIjE,KAAKwc,UAAoB,GAAGtW,SAAS,IAAIiW,UAAU,GAGjE,GAAIhP,IAAK,EAAG,EAAG,IAAK,KAChBhN,EAAI8D,IAAMA,IAAM,IAAMA,IAAM,KAAOA,IAAImjB,OAAO,EAAG,GAAK,IAAMja,EAAEnN,KAAKC,MAAsB,EAAhBD,KAAKwc,WAAiBvY,IAAImjB,OAAO,EAAG,GAAK,IAAMnjB,IAAMA,IAAMA,GAMxI,OAJIkjB,MAAU,IACbhnB,EAAIA,EAAEsD,QAAQ,KAAM,KAGdtD,GAgBRiU,KAAM,SAAcrW,EAAKlB,GACxB,GAAIkS,GAAShR,CAWb,OATAI,OAAMwD,KAAK9E,EAAI4G,QAAQ,MAAO,IAAIA,QAAQ,MAAO,KAAKA,QAAQ,QAAS,KAAKI,MAAM,SAAU,SAAUxO,GACrG,MAAkBxB,UAAdkb,EAAO1Z,IAAkC,OAAd0Z,EAAO1Z,IACrC0Z,EAASlb,QACF,QAGRkb,EAASA,EAAO1Z,MAGV0Z,GA6BRoP,KAAM,WACL,IAAK,GAAIkJ,GAASvrB,UAAUxG,OAAQ2C,EAAOkF,MAAMkqB,GAASC,EAAS,EAAYD,EAATC,EAAiBA,IACtFrvB,EAAKqvB,GAAUxrB,UAAUwrB,EAG1B,IAAInf,GAAQC,GAoBZ,OAjBInQ,GAAK,YAAckF,SACtBlF,EAAOA,EAAK,IAIO,IAAhBA,EAAK3C,OACR6S,EAAMI,QAAQ,MAId9R,EAAQysB,IAAIjrB,GAAMyQ,KAAK,SAAU8W,GAChCrX,EAAMI,QAAQiX,IACZ,SAAUtb,GACZiE,EAAM/C,OAAOlB,KAIRiE,GAYR+X,OAAQ,SAAgB/X,GACvB,GAAIpK,GAAM,GAAI/G,QAAOQ,EAYrB,OAVAuG,GAAIwpB,QAAU,SAAUC,GACvBrf,EAAM/C,OAAOoiB,GACbzpB,EAAI0pB,aAGL1pB,EAAI2pB,UAAY,SAAUzqB,GACzBkL,EAAMI,QAAQtL,EAAG8T,MACjBhT,EAAI0pB,aAGE1pB,IAWLkK,EAAM,WACT,GAAI0f,GAAS,EACTC,EAAS,EACTC,EAAmB,EACnBC,EAAU,EACVC,EAAO,EACPC,EAAc,eACdC,EAAQ,GAAIzZ,QAAOqZ,EAAmB,IAAMC,GAE5CngB,GACHugB,aAAc,yBAA2BjyB,QAAQ4nB,SAASsK,KAAK1kB,QAAQ,KAAM,IAAM,KAAOE,OAAOoO,WAAW9b,QAAQmyB,UAAY,OAASnyB,QAAQ4nB,SAASwK,GAAK,KAC/JC,eAAgB,aAChBC,OAAQ,OAYLvqB,EAAW,SAAkBD,EAAKlB,GACrC,GAAIoE,GAAK,KAAOpE,CAQhB,OANuB,kBAAZkB,GAAIkD,IACdlD,EAAIkD,KAGLlD,EAAI0Z,cAAc5a,GAEXkB,GAWJoO,EAAQ,SAAepO,EAAKlB,GAW/B,MAVIkB,GAAIqO,aAAevP,IACtBkB,EAAIqO,WAAavP,EACjBmB,EAASD,EAAK,oBAEVA,EAAIqO,aAAe2b,GAAShqB,EAAIyqB,SACnCxqB,EAASD,EAAK,QACdC,EAASD,EAAK,aAITA,GAYJyK,EAAU,SAAiBzK,EAAK0qB,GACnCtc,EAAMpO,EAAK8pB,GACX9pB,EAAIsO,OAASoc,EAAIC,WACjB3qB,EAAIyO,YAAcic,EAAI9gB,QAElB5J,EAAIyO,YAAY,eAAiBzO,EAAIyO,YAAY,uBAAyBrP,SAC7EY,EAAIyO,YAAY,cAAgBzO,EAAIyO,YAAY,cAAcnI,KAAK,MAGpEokB,EAAInqB,GAAG,OAAQ,SAAUzB,GACxB4rB,EAAIE,YAAY,QAEZ5qB,EAAI6qB,QACH/rB,IACHkB,EAAIsM,cAAgBxN,GAGrBsP,EAAMpO,EAAK+pB,MAIbW,EAAInqB,GAAG,MAAO,WACTP,EAAI6qB,QACPzc,EAAMpO,EAAKgqB,GACXhqB,EAAI6qB,OAAQ,MAcXngB,EAAU,SAAiB1K,EAAKmG,GACnCnG,EAAIsO,OAAS2b,EAAY1mB,KAAK4C,EAAEqhB,SAAW,IAAM,IACjDxnB,EAAI8qB,WAAa,GACjB9qB,EAAIsM,aAAenG,EAAEqhB,QACrBxnB,EAAIyqB,QAAS,EACbzqB,EAAI6qB,OAAQ,EACZ5qB,EAASD,EAAK,SACdoO,EAAMpO,EAAKgqB,IAGRpxB,EAAiB,SAAWmyB,GAU/B,QAASnyB,KACR7B,gBAAgBiH,KAAMpF,GAEtBtD,KAAKM,OAAOI,eAAe4C,EAAepC,WAAY,cAAewH,MAAM7H,KAAK6H,MAEhFA,KAAKgtB,QAAU,KACfhtB,KAAKwrB,QAAU,KACfxrB,KAAKitB,OAAS,KACdjtB,KAAKktB,UAAY,KACjBltB,KAAKmtB,YAAc,KACnBntB,KAAKotB,mBAAqB,KAC1BptB,KAAKqQ,WAAaub,EAClB5rB,KAAK0Q,SAAW,KAChB1Q,KAAKsO,aAAe,GACpBtO,KAAKqtB,aAAe,GACpBrtB,KAAK2O,YAAc,KACnB3O,KAAKsQ,OAASsb,EACd5rB,KAAK8sB,WAAa,GAClB9sB,KAAK8C,SAAWF,IAGhB5C,KAAKysB,QAAS,EACdzsB,KAAKstB,YACLttB,KAAKutB,WACLvtB,KAAKwtB,SAAW,KAChBxtB,KAAKyQ,eACLzQ,KAAK6sB,OAAQ,EAuPd,MApPAz0B,WAAUwC,EAAgBmyB,GAE1B7zB,aAAa0B,IACZlB,IAAK,QASLzB,MAAO,WAkBN,MAjBsB,QAAlB+H,KAAKwtB,WACRxtB,KAAKwtB,SAASC,QACdztB,KAAKwtB,SAAW,KAChBxtB,KAAKsO,aAAe,GACpBtO,KAAK2O,YAAc,GACnB3O,KAAKysB,QAAS,EACdzsB,KAAKstB,aAEDttB,KAAK6sB,SAAU,GAAQX,EAAM3mB,KAAKvF,KAAKqQ,eAC1CrQ,KAAK6sB,OAAQ,EACbzc,EAAMpQ,KAAMgsB,IAGb/pB,EAASjC,KAAM,SACfA,KAAKqQ,WAAaub,GAGZ5rB,QAGRtG,IAAK,wBASLzB,MAAO,WACN,GAAIwM,GAAS,EAEb,IAAIzE,KAAKqQ,WAAayb,EACrB,KAAM,IAAIjqB,OAAMC,EAAMyc,sBAOvB,OAJAjd,SAAQC,QAAQvB,KAAKyQ,YAAa,SAAUzJ,EAAGiC,GAC9CxE,GAAUwE,EAAI,KAAOjC,EAAI,OAGnBvC,KAGR/K,IAAK,oBAULzB,MAAO,SAA2B+V,GACjC,GAAIhO,KAAKqQ,WAAayb,GAAoB9rB,KAAKysB,OAC9C,KAAM,IAAI5qB,OAAMC,EAAMyc,sBAGvB,OAAOve,MAAKyQ,YAAYzC,IAAWhO,KAAKyQ,YAAYzC,EAAOT,kBAG5D7T,IAAK,OAcLzB,MAAO,SAAcwsB,EAAQnpB,EAAKuK,EAAO6nB,EAAMC,GAC9C,GAAIC,GAAU5tB,IAEd,IAAI6F,KAAU,EACb,KAAM,IAAIhE,OAAMC,EAAM0c,mBAmBvB,OAhBAxe,MAAKytB,QACLztB,KAAKysB,QAAS,EACdzsB,KAAKutB,SACJ9I,OAAQA,EACRnpB,IAAKA,EACLuK,MAAOA,IAAS,EAChB6nB,KAAMA,GAAQ,KACdC,SAAUA,GAAY,MAGvBrsB,QAAQC,QAAQqK,EAAS,SAAU5E,EAAGiC,GACrC2kB,EAAQN,SAASrkB,GAAKjC,IAGvBhH,KAAKqQ,WAAawb,EAEX7rB,QAGRtG,IAAK,mBAULzB,MAAO,SAA0B41B,GAGhC,MAFA7tB,MAAKstB,SAAS,gBAAkBO,EAEzB7tB,QAGRtG,IAAK,OAULzB,MAAO,WACN,GAAI61B,GAAU9tB,KAEVgV,EAAwBld,SAAjBiI,UAAU,GAAmB,KAAOA,UAAU,GAErDqU,EAAUtc,OACVyqB,EAASzqB,OACTiY,EAAUjY,OACVkK,EAAMlK,MAEV,IAAIkI,KAAKqQ,WAAawb,EACrB,KAAM,IAAIhqB,OAAMC,EAAM2c,oBAChB,IAAIze,KAAK6sB,MACf,KAAM,IAAIhrB,OAAMC,EAAM4c,uBAWvB,IARA6D,EAASjhB,QAAQ4H,MAAMlJ,KAAKutB,QAAQjyB,KACpCinB,EAAOwH,KAAOxH,EAAOwH,OAA6B,WAApBxH,EAAOzjB,SAAwB,IAAM,IAEzC,OAAtBkB,KAAKutB,QAAQG,MAA2C,OAA1B1tB,KAAKutB,QAAQI,WAC9CpL,EAAOpmB,KAAO6D,KAAKutB,QAAQG,KAAO,IAAM1tB,KAAKutB,QAAQI,UAIlD9xB,MAAMkD,SAASwG,KAAKvF,KAAKutB,QAAQ9I,QACpC,GAAa,OAATzP,EACHhV,KAAKstB,SAAS,kBAAoB,MAC5B,IAAoB,gBAATtY,GACjBhV,KAAKstB,SAAS,kBAAoB7yB,EAAOszB,WAAW/Y,OAC9C,CAAA,KAAIA,YAAgBva,IAAmC,kBAAlBua,GAAK7K,UAIhD,KAAM,IAAItI,OAAMC,EAAMC,iBAHtBiT,GAAOA,EAAK7K,WACZnK,KAAKstB,SAAS,kBAAoB7yB,EAAOszB,WAAW/Y,GA8CtD,MAxCAhV,MAAKstB,SAAS7vB,KAAO8kB,EAAO9kB,KAEc,mBAAtCuC,KAAKstB,SAAS,2BACVttB,MAAKstB,SAAS,oBAGtBlZ,GACC0V,SAAUvH,EAAOuH,SACjB/E,KAAMxC,EAAOwC,KACbgF,KAAMxH,EAAOwH,KACbtF,OAAQzkB,KAAKutB,QAAQ9I,OACrB7Y,QAAS5L,KAAKstB,UAGS,WAApB/K,EAAOzjB,WACVsV,EAAQ4Z,oBAAqB,EAC7B5Z,EAAQ6Z,OAAQ,GAGb1L,EAAOpmB,OACViY,EAAQjY,KAAOomB,EAAOpmB,MAGvB6D,KAAK6sB,OAAQ,EACb5qB,EAASjC,KAAM,oBAEfgC,EAA0B,UAApBugB,EAAOzjB,SAAuB3D,EAAOC,EAE3C2U,EAAU/N,EAAI+N,QAAQqE,EAAS,SAAUtT,GACxC2L,EAAQqhB,EAAShtB,KACfyB,GAAG,QAAS,SAAU4F,GACxBuE,EAAQohB,EAAS3lB,KAGT,OAAT6M,EAAgBjF,EAAQme,oBAAmB,GAAQne,EAAQf,MAAMgG,EAAM,QACvEhV,KAAKwtB,SAAWzd,EAChBA,EAAQzG,MAERrH,EAASjC,KAAM,aAERA,QAGRtG,IAAK,mBAWLzB,MAAO,SAA0B+V,EAAQ/V,GACxC,GAAI+H,KAAKqQ,aAAewb,EACvB,KAAM,IAAIhqB,OAAMC,EAAM6c,sBAChB,IAAI3e,KAAK6sB,MACf,KAAM,IAAIhrB,OAAMC,EAAM4c,uBAKvB,OAFA1e,MAAKstB,SAAStf,EAAOT,eAAiBtV,EAE/B+H,SAIFpF,GACLiI,EAEH,OAAOjI,IAUJuzB,EAAc,WACjB,QAASA,KACRp1B,gBAAgBiH,KAAMmuB,GAEtBnuB,KAAKkd,YA+BN,MA5BAhkB,cAAai1B,IACZz0B,IAAK,QACLzB,MAAO,WACN+H,KAAKkd,eAGNxjB,IAAK,SACLzB,MAAO,SAAiB6I,SAChBd,MAAKkd,SAASpc,MAGtBpH,IAAK,MACLzB,MAAO,SAAa6I,GACnB,MAA8BhJ,UAAvBkI,KAAKkd,SAASpc,MAGtBpH,IAAK,MACLzB,MAAO,SAAa6I,GACnB,MAAOd,MAAK8b,IAAIhb,GAAOd,KAAKkd,SAASpc,GAAK7I,MAAQH,UAGnD4B,IAAK,MACLzB,MAAO,SAAa6I,EAAK7I,GAExB,MADA+H,MAAKkd,SAASpc,IAAS7I,MAAOA,GACvB+H,SAIFmuB,KAOJvuB,GASH4O,OAAQ,SAAgB1N,GACvB,OAAO,GAAIstB,YAAYC,gBAAgBvtB,EAAK,aAW7CgQ,OAAQ,SAAgBhQ,GACvB,GAAIwtB,GAAwBx2B,SAAjBiI,UAAU,IAAmB,EAAOA,UAAU,GACrDsc,EAAuBvkB,SAAjBiI,UAAU,IAAmB,EAAOA,UAAU,GACpDrG,EAAuB5B,SAAjBiI,UAAU,GAAmB,GAAKA,UAAU,GAElDsL,EAAIijB,EAAO,KAAO50B,GAAO,OAAS,IAAM,EA8B5C,OA5BY,QAARoH,GAAgBA,EAAIlB,MACvBkB,EAAMA,EAAIlB,KAGPgN,EAAOI,KAAOlM,YAAemM,YAChCnM,GAAM,GAAIytB,gBAAgBC,kBAAkB1tB,IAGzCjF,MAAMQ,sBAAsBkJ,WAAYzE,IAC3CuK,GAAKzL,EAAIwsB,KAAK/nB,MAAM3K,GAAOA,EAAM,OAAQoH,GACvB,OAARA,GAAwBhJ,SAARgJ,EAC1BuK,GAAK,OACKvK,YAAeM,OACzBgB,MAAMwD,KAAK9E,EAAK,SAAUkG,GACzBqE,GAAKzL,EAAIkR,OAAO9J,EAAgB,gBAANA,IAAgB,EAAO,UAExClG,YAAelJ,SACzB0J,QAAQC,QAAQT,EAAK,SAAUkG,EAAGiC,GACjCoC,GAAKzL,EAAIkR,OAAO9J,EAAgB,gBAANA,IAAgB,EAAOiC,KAInDoC,GAAKijB,EAAO,MAAQ50B,GAAO,OAAS,IAAM,GAEtC2iB,IACHhR,EAAI,wCAA8CA,GAG5CA,GAYR+gB,KAAM,SAAcjP,EAAMllB,GACzB,MAAO,WAAWyP,QAAQ,IAAK7L,MAAMU,MAAMgJ,KAAKtN,GAAS,YAAcA,EAAQ,MAAQA,GAAOyP,QAAQ,YAAa,MAAQyV,EAAO,MAWnIvO,MAAO,SAAe9N,GACrB,MAAsE,KAA/DlB,EAAI4O,OAAO1N,GAAKuoB,qBAAqB,eAAe9vB,SAWzDk1B,GAAY,WASf,GAPmB32B,SAAfsJ,MAAMkD,OACTlD,MAAMkD,KAAO,SAAUxD,GACtB,SAAU0I,MAAMrR,KAAK2I,KAKlB7G,EAQJW,EAAiBsR,QALjB,IAFAU,EAAOO,QAAUP,EAAOO,UAEpBP,EAAOlP,IAAMkP,EAAOO,QAAU,GACjC,KAAM,IAAItL,OAAMC,EAAM+c,QAaxB,IALgB,OAAZhkB,IACHA,EAAUszB,GAIPpzB,EACH,IACCU,EAAS5B,EAAO60B,IAAIC,gBAAgBrtB,QAAQyL,KAAK,OAASnF,OAAOhB,WAAWxE,MAAO,SAAW,KAAOwF,OAAOhB,WAAW/K,MAAO,SAAW,KAAO+L,OAAOhB,WAAWgB,OAAQ,UAAY,KAAOA,OAAOhB,WAAWtF,QAAS,WAAa,iBAAmB4S,MAAMiQ,OAAOha,WAAa,MACjR,MAAOhC,GACRpN,GAAY,EAIdS,GAAO,GAAIkQ,OAAOC,UAIjBpQ,EADoCzD,SAAjC+B,EAAO+0B,sBACD/0B,EAAO+0B,sBAEP,SAAU1pB,GAClB,GAAIY,IAAS,GAAI4F,OAAOC,UAAYnQ,CAEpC8F,SAAQ8K,MAAM,WACblH,EAAGY,IACD,GAAIA,IAIJ7L,GACJqH,QAAQsmB,SAQV,OAHA6G,OAICnpB,OAAQA,EACR6N,KAAMA,EAAKvS,QACX6U,KAAMA,EACNvB,MAAOA,MAAMtT,QACbiuB,MACCjW,EAAGtX,QAAQsX,EACXxW,MAAOA,MACPwlB,OAAQtmB,QAAQsmB,OAChBtH,KAAMhf,QAAQgf,KACd9Q,YAAalO,QAAQkO,YACrB1K,MAAOxD,QAAQwD,MACf+N,OAAQvR,QAAQuR,OAChB4V,MAAOnnB,QAAQmnB,MACfha,IAAKA,EACLrC,MAAOC,EACPmE,MAAOlP,QAAQ8K,MACfqD,QAASA,EACTvJ,MAAO5E,QAAQ4E,MACfoiB,OAAQhnB,QAAQgnB,OAChB/Y,MAAOjO,QAAQiO,MACfhO,QAASD,QAAQC,QACjBgN,KAAMA,EACNY,MAAOvC,EAAOuC,MACd2Y,IAAKxmB,QAAQwmB,IACbnnB,IAAKA,EAAIC,QACTsK,KAAMA,EACNpC,MAAOxH,QAAQwH,MACftI,KAAMc,QAAQkP,MACdpS,OAAQA,EACR0E,SAAUF,EACVsG,MAAO5H,QAAQ4H,MACf4F,QAASxN,QAAQwN,QACjByb,QAASjpB,QAAQipB,QACjBN,YAAa3oB,QAAQ2oB,YACrBY,KAAMvpB,QAAQupB,KACdhvB,MAAOA,MACP2c,OAAQlX,QAAQkX,OAChBzS,OAAQzE,QAAQyE,OAChBgK,QAASnD,EAAOmD,QAChBqF,KAAM9T,QAAQ8T,KACdxN,OAAQA,OACRxO,OAAQkI,QAAQlI,OAChB+I,KAAMb,QAAQa,KACdkW,KAAM/W,QAAQ+W,KACd+J,KAAM9gB,QAAQ8gB,KACdxiB,IAAKA,GAENuN,QAAS,YAKY,oBAAZ2hB,SACVC,OAAOD,QAAUlzB,EACW,kBAAXozB,QACjBA,OAAO,WACN,MAAOpzB,KAGR/B,EAAOyV,OAAS1T,GAEG,mBAAX/B,QAAyBA,OAASuY","sourcesContent":["\"use strict\";\n\nvar _get = function get(object, property, receiver) { var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _inherits = function (subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) subClass.__proto__ = superClass; };\n\nvar _classCallCheck = function (instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } };\n\nvar _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\n/*\r\n __          .__             .__   ____     ________      ____  ______  \r\n|  | __ ____ |__| _________  |__| /_   |    \\_____  \\    /_   |/  __  \\ \r\n|  |/ // __ \\|  |/ ___\\__  \\ |  |  |   |      _(__  <     |   |>      < \r\n|    <\\  ___/|  / /_/  > __ \\|  |  |   |     /       \\    |   /   --   \\\r\n|__|_ \\\\___  >__\\___  (____  /__|  |___| /\\ /______  / /\\ |___\\______  /\r\n     \\/    \\/  /_____/     \\/            \\/        \\/  \\/            \\/ \r\n\r\n2015 Jason Mulligan <jason.mulligan@avoidwork.com>\r\n*/\n(function (global) {\n\tvar document = global.document;\n\tvar location = global.location || {};\n\tvar navigator = global.navigator;\n\tvar server = typeof process !== \"undefined\";\n\tvar mutation = typeof MutationObserver === \"function\";\n\tvar MAX = 10;\n\tvar VERSIONS = 100;\n\tvar CACHE = 500;\n\tvar EVENTS = [\"readystatechange\", \"abort\", \"load\", \"loadstart\", \"loadend\", \"error\", \"progress\", \"timeout\"];\n\n\tvar Buffer = function Buffer() {};\n\tvar Promise = global.Promise || undefined;\n\tvar localStorage = global.localStorage || undefined;\n\tvar XMLHttpRequest = global.XMLHttpRequest || null;\n\tvar WeakMap = global.WeakMap || null;\n\tvar btoa = global.btoa || undefined;\n\tvar webWorker = typeof Blob !== \"undefined\" && typeof Worker !== \"undefined\";\n\tvar external = undefined,\n\t    http = undefined,\n\t    https = undefined,\n\t    mongodb = undefined,\n\t    url = undefined,\n\t    RENDER = undefined,\n\t    TIME = undefined,\n\t    WORKER = undefined;\n\n\tif (server) {\n\t\turl = require(\"url\");\n\t\thttp = require(\"http\");\n\t\thttps = require(\"https\");\n\t\tmongodb = require(\"mongodb\").MongoClient;\n\t\tBuffer = require(\"buffer\").Buffer;\n\n\t\tif (typeof Promise === \"undefined\") {\n\t\t\tPromise = require(\"es6-promise\").Promise;\n\t\t}\n\n\t\tif (typeof localStorage === \"undefined\") {\n\t\t\tlocalStorage = require(\"localStorage\");\n\t\t}\n\n\t\tif (typeof btoa === \"undefined\") {\n\t\t\tbtoa = require(\"btoa\");\n\t\t}\n\t}\n\n\tvar lib = (function () {\n\n\t\t/**\r\n   * Regex patterns used through keigai\r\n   *\r\n   * `url` was authored by Diego Perini\r\n   *\r\n   * @namespace regex\r\n   * @private\r\n   * @type {Object}\r\n   */\n\t\tvar regex = {\n\t\t\tafter_space: /\\s+.*/,\n\t\t\tallow: /^allow$/i,\n\t\t\tallow_cors: /^access-control-allow-methods$/i,\n\t\t\tand: /^&/,\n\t\t\targs: /\\((.*)\\)/,\n\t\t\tauth: /\\/\\/(.*)\\@/,\n\t\t\tbool: /^(true|false)?$/,\n\t\t\tboolean_number_string: /boolean|number|string/,\n\t\t\tcaps: /[A-Z]/,\n\t\t\tcdata: /\\&|<|>|\\\"|\\'|\\t|\\r|\\n|\\@|\\$/,\n\t\t\tchecked_disabled: /checked|disabled/i,\n\t\t\tcomplete_loaded: /^(complete|loaded)$/i,\n\t\t\tcsv_quote: /^\\s|\\\"|\\n|,|\\s$/,\n\t\t\tdel: /^del/,\n\t\t\tdomain: /^[\\w.-_]+\\.[A-Za-z]{2,}$/,\n\t\t\tdown: /down/,\n\t\t\tendslash: /\\/$/,\n\t\t\teol_nl: /\\n$/,\n\t\t\telement_update: /id|innerHTML|innerText|textContent|type|src/,\n\t\t\tget_headers: /^(head|get|options)$/,\n\t\t\tget_remove_set: /get|remove|set/,\n\t\t\thash: /^\\#/,\n\t\t\theader_replace: /:.*/,\n\t\t\theader_value_replace: /.*:\\s+/,\n\t\t\thtml: /^<.*>$/,\n\t\t\thttp_body: /200|201|202|203|206/,\n\t\t\thttp_ports: /80|443/,\n\t\t\thost: /\\/\\/(.*)\\//,\n\t\t\tie: /msie|ie|\\.net|windows\\snt/i,\n\t\t\tip: /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,\n\t\t\tis_xml: /^<\\?xml.*\\?>/,\n\t\t\tjson_maybe: /json|plain|javascript/,\n\t\t\tjson_wrap: /^[\\[\\{]/,\n\t\t\tklass: /^\\./,\n\t\t\tno: /no-store|no-cache/i,\n\t\t\tnot_dotnotation: /-|\\s/,\n\t\t\tnot_endpoint: /.*\\//,\n\t\t\tnull_undefined: /null|undefined/,\n\t\t\tnumber: /(^-?\\d\\d*\\.\\d*$)|(^-?\\d\\d*$)|(^-?\\.\\d\\d*$)|number/,\n\t\t\tnumber_format_1: /.*\\./,\n\t\t\tnumber_format_2: /\\..*/,\n\t\t\tnumber_present: /\\d{1,}/,\n\t\t\tnumber_string: /number|string/i,\n\t\t\tnumber_string_object: /number|object|string/i,\n\t\t\tobject_type: /\\[object Object\\]/,\n\t\t\tpatch: /^patch$/,\n\t\t\tprimitive: /^(boolean|function|number|string)$/,\n\t\t\tpriv: /private/,\n\t\t\tprotocol: /^(.*)\\/\\//,\n\t\t\tput_post: /^(post|put)$/i,\n\t\t\tradio_checkbox: /^(radio|checkbox)$/i,\n\t\t\troot: /^\\/[^\\/]/,\n\t\t\tselect: /select/i,\n\t\t\tselector_is: /^:/,\n\t\t\tselector_complex: /\\s+|\\>|\\+|\\~|\\:|\\[/,\n\t\t\tset_del: /^(set|del|delete)$/,\n\t\t\tspace_hyphen: /\\s|-/,\n\t\t\tstring_object: /string|object/i,\n\t\t\tsvg: /svg/,\n\t\t\ttop_bottom: /top|bottom/i,\n\t\t\turl: /^(?:(?:https?|ftp):\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!10(?:\\.\\d{1,3}){3})(?!127(?:\\.\\d{1,3}){3})(?!169\\.254(?:\\.\\d{1,3}){2})(?!192\\.168(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:\\/[^\\s]*)?$/i,\n\t\t\tword: /^\\w+$/,\n\t\t\txdomainrequest: /^(get|post)$/i,\n\t\t\txml: /xml/i\n\t\t};\n\n\t\tvar LRU = (function () {\n\t\t\t/**\r\n    * Creates a new Least Recently Used cache\r\n    *\r\n    * @constructor\r\n    * @memberOf keigai\r\n    * @param  {Number} max [Optional] Max size of cache, default is 1000\r\n    * @example\r\n    * let lru = keigai.util.lru( 50 );\r\n    */\n\n\t\t\tfunction LRU() {\n\t\t\t\tvar max = arguments[0] === undefined ? 1000 : arguments[0];\n\n\t\t\t\t_classCallCheck(this, LRU);\n\n\t\t\t\tthis.cache = {};\n\t\t\t\tthis.max = max;\n\t\t\t\tthis.first = null;\n\t\t\t\tthis.last = null;\n\t\t\t\tthis.length = 0;\n\t\t\t}\n\n\t\t\t_createClass(LRU, [{\n\t\t\t\tkey: \"evict\",\n\n\t\t\t\t/**\r\n     * Evicts the least recently used item from cache\r\n     *\r\n     * @method evict\r\n     * @memberOf keigai.LRU\r\n     * @return {Object} {@link keigai.LRU}\r\n     * @example\r\n     * lru.evict();\r\n     */\n\t\t\t\tvalue: function evict() {\n\t\t\t\t\tif (this.last !== null) {\n\t\t\t\t\t\tthis.remove(this.last);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"get\",\n\n\t\t\t\t/**\r\n     * Gets cached item and moves it to the front\r\n     *\r\n     * @method get\r\n     * @memberOf keigai.LRU\r\n     * @param  {String} key Item key\r\n     * @return {Object} {@link keigai.LRUItem}\r\n     * @example\r\n     * let item = lru.get( \"key\" );\r\n     */\n\t\t\t\tvalue: function get(key) {\n\t\t\t\t\tvar item = this.cache[key];\n\n\t\t\t\t\tif (item === undefined) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.set(key, item.value);\n\n\t\t\t\t\treturn item.value;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"remove\",\n\n\t\t\t\t/**\r\n     * Removes item from cache\r\n     *\r\n     * @method remove\r\n     * @memberOf keigai.LRU\r\n     * @param  {String} key Item key\r\n     * @return {Object} {@link keigai.LRUItem}\r\n     * @example\r\n     * lru.remove( \"key\" );\r\n     */\n\t\t\t\tvalue: function remove(key) {\n\t\t\t\t\tvar item = this.cache[key];\n\n\t\t\t\t\tif (item) {\n\t\t\t\t\t\tdelete this.cache[key];\n\n\t\t\t\t\t\tthis.length--;\n\n\t\t\t\t\t\tif (item.previous !== null) {\n\t\t\t\t\t\t\tthis.cache[item.previous].next = item.next;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (item.next !== null) {\n\t\t\t\t\t\t\tthis.cache[item.next].previous = item.previous;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.first === key) {\n\t\t\t\t\t\t\tthis.first = item.previous;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.last === key) {\n\t\t\t\t\t\t\tthis.last = item.next;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn item;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"set\",\n\n\t\t\t\t/**\r\n     * Sets item in cache as `first`\r\n     *\r\n     * @method set\r\n     * @memberOf keigai.LRU\r\n     * @param  {String} key   Item key\r\n     * @param  {Mixed}  value Item value\r\n     * @return {Object} {@link keigai.LRU}\r\n     * @example\r\n     * lru.set( \"key\", {x: true} );\r\n     */\n\t\t\t\tvalue: function set(key, value) {\n\t\t\t\t\tvar item = this.remove(key);\n\n\t\t\t\t\tif (item === undefined) {\n\t\t\t\t\t\titem = new LRUItem(value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\titem.value = value;\n\t\t\t\t\t}\n\n\t\t\t\t\titem.next = null;\n\t\t\t\t\titem.previous = this.first;\n\t\t\t\t\tthis.cache[key] = item;\n\n\t\t\t\t\tif (this.first !== null) {\n\t\t\t\t\t\tthis.cache[this.first].next = key;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.first = key;\n\n\t\t\t\t\tif (this.last === null) {\n\t\t\t\t\t\tthis.last = key;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (++this.length > this.max) {\n\t\t\t\t\t\tthis.evict();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}]);\n\n\t\t\treturn LRU;\n\t\t})();\n\n\t\t/**\r\n   * Creates a new LRUItem\r\n   *\r\n   * @constructor\r\n   * @memberOf keigai\r\n   * @param {Mixed} value Item value\r\n   * @private\r\n   */\n\n\t\tvar LRUItem = function LRUItem(value) {\n\t\t\t_classCallCheck(this, LRUItem);\n\n\t\t\tthis.next = null;\n\t\t\tthis.previous = null;\n\t\t\tthis.value = value;\n\t\t};\n\n\t\t/**\r\n   * @namespace lru\r\n   */\n\t\tvar lru = {\n\t\t\t/**\r\n    * LRU factory\r\n    *\r\n    * @method factory\r\n    * @memberOf lru\r\n    * @return {Object} {@link keigai.LRU}\r\n    * @example\r\n    * let lru = keigai.util.lru( 50 );\r\n    */\n\t\t\tfactory: function factory(max) {\n\t\t\t\treturn new LRU(max);\n\t\t\t}\n\t\t};\n\n\t\tvar Observable = (function () {\n\t\t\t/**\r\n    * Creates a new Observable\r\n    *\r\n    * @constructor\r\n    * @memberOf keigai\r\n    * @param  {Number} arg Maximum listeners, default is 10\r\n    * @example\r\n    * let observer = keigai.util.observer( 50 );\r\n    */\n\n\t\t\tfunction Observable() {\n\t\t\t\tvar arg = arguments[0] === undefined ? MAX : arguments[0];\n\n\t\t\t\t_classCallCheck(this, Observable);\n\n\t\t\t\tthis.limit = arg;\n\t\t\t\tthis.listeners = {};\n\t\t\t\tthis.hooks = new WeakMap();\n\t\t\t}\n\n\t\t\t_createClass(Observable, [{\n\t\t\t\tkey: \"dispatch\",\n\n\t\t\t\t/**\r\n     * Dispatches an event, with optional arguments\r\n     *\r\n     * @method dispatch\r\n     * @memberOf keigai.Observable\r\n     * @return {Object} {@link keigai.Observable}\r\n     * @example\r\n     * observer.dispatch( \"event\", ... );\r\n     */\n\t\t\t\tvalue: function dispatch(ev) {\n\t\t\t\t\tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n\t\t\t\t\t\targs[_key - 1] = arguments[_key];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (ev && this.listeners[ev]) {\n\t\t\t\t\t\tutility.iterate(this.listeners[ev], function (i) {\n\t\t\t\t\t\t\ti.handler.apply(i.scope, args);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"hook\",\n\n\t\t\t\t/**\r\n     * Hooks into `target` for a DOM event\r\n     *\r\n     * @method hook\r\n     * @memberOf keigai.Observable\r\n     * @param  {Object} target Element\r\n     * @param  {String} ev     Event\r\n     * @return {Object}        Element\r\n     * @example\r\n     * observer.hook( document.querySelector( \"a\" ), \"click\" );\r\n     */\n\t\t\t\tvalue: function hook(target, ev) {\n\t\t\t\t\tvar _this2 = this;\n\n\t\t\t\t\tif (typeof target.addEventListener !== \"function\") {\n\t\t\t\t\t\tthrow new Error(label.invalidArguments);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar obj = this.hooks.get(target) || {};\n\n\t\t\t\t\tobj[ev] = function (arg) {\n\t\t\t\t\t\t_this2.dispatch(ev, arg);\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.hooks.set(target, obj);\n\t\t\t\t\ttarget.addEventListener(ev, this.hooks.get(target)[ev], false);\n\n\t\t\t\t\treturn target;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"off\",\n\n\t\t\t\t/**\r\n     * Removes all, or a specific listener for an event\r\n     *\r\n     * @method off\r\n     * @memberOf keigai.Observable\r\n     * @param {String} ev Event name\r\n     * @param {String} id [Optional] Listener ID\r\n     * @return {Object} {@link keigai.Observable}\r\n     * @example\r\n     * observer.off( \"click\", \"myHook\" );\r\n     */\n\t\t\t\tvalue: function off(ev, id) {\n\t\t\t\t\tif (this.listeners[ev]) {\n\t\t\t\t\t\tif (id) {\n\t\t\t\t\t\t\tdelete this.listeners[ev][id];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdelete this.listeners[ev];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"on\",\n\n\t\t\t\t/**\r\n     * Adds a listener for an event\r\n     *\r\n     * @method on\r\n     * @memberOf keigai.Observable\r\n     * @param  {String}   ev      Event name\r\n     * @param  {Function} handler Handler\r\n     * @param  {String}   id      [Optional] Handler ID\r\n     * @param  {String}   scope   [Optional] Handler scope, default is `this`\r\n     * @return {Object} {@link keigai.Observable}\r\n     * @example\r\n     * observer.on( \"click\", function ( ev ) {\r\n     *   ...\r\n     * }, \"myHook\" );\r\n     */\n\t\t\t\tvalue: function on(ev, handler) {\n\t\t\t\t\tvar id = arguments[2] === undefined ? utility.uuid() : arguments[2];\n\t\t\t\t\tvar scope = arguments[3] === undefined ? undefined : arguments[3];\n\n\t\t\t\t\tif (!this.listeners[ev]) {\n\t\t\t\t\t\tthis.listeners[ev] = {};\n\t\t\t\t\t}\n\n\t\t\t\t\tif (array.keys(this.listeners[ev]).length >= this.limit) {\n\t\t\t\t\t\tthrow new Error(\"Possible memory leak, more than \" + this.limit + \" listeners for event: \" + ev);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.listeners[ev][id] = { scope: scope || this, handler: handler };\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"once\",\n\n\t\t\t\t/**\r\n     * Adds a short lived listener for an event\r\n     *\r\n     * @method once\r\n     * @memberOf keigai.Observable\r\n     * @param  {String}   ev      Event name\r\n     * @param  {Function} handler Handler\r\n     * @param  {String}   id      [Optional] Handler ID\r\n     * @param  {String}   scope   [Optional] Handler scope, default is `this`\r\n     * @return {Object} {@link keigai.Observable}\r\n     * @example\r\n     * observer.once( \"click\", function ( ev ) {\r\n     *   ...\r\n     * } );\r\n     */\n\t\t\t\tvalue: function once(ev, handler) {\n\t\t\t\t\tvar _this3 = this;\n\n\t\t\t\t\tvar id = arguments[2] === undefined ? utility.uuid() : arguments[2];\n\t\t\t\t\tvar scope = arguments[3] === undefined ? undefined : arguments[3];\n\n\t\t\t\t\tscope = scope || this;\n\n\t\t\t\t\treturn this.on(ev, function () {\n\t\t\t\t\t\tfor (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n\t\t\t\t\t\t\targs[_key2] = arguments[_key2];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\thandler.apply(scope, args);\n\t\t\t\t\t\t_this3.off(ev, id);\n\t\t\t\t\t}, id, scope);\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"unhook\",\n\n\t\t\t\t/**\r\n     * Unhooks from `target` for a DOM event\r\n     *\r\n     * @method unhook\r\n     * @memberOf keigai.Observable\r\n     * @param  {Object} target Element\r\n     * @param  {String} ev     Event\r\n     * @return {Object}        Element\r\n     * @example\r\n     * observer.unhook( document.querySelector( \"a\" ), \"click\" );\r\n     */\n\t\t\t\tvalue: function unhook(target, ev) {\n\t\t\t\t\tvar obj = this.hooks.get(target);\n\n\t\t\t\t\tif (obj) {\n\t\t\t\t\t\ttarget.removeEventListener(ev, obj[ev], false);\n\t\t\t\t\t\tdelete obj[ev];\n\n\t\t\t\t\t\tif (array.keys(obj).length === 0) {\n\t\t\t\t\t\t\tthis.hooks[\"delete\"](target);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.hooks.set(target, obj);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn target;\n\t\t\t\t}\n\t\t\t}]);\n\n\t\t\treturn Observable;\n\t\t})();\n\n\t\t/**\r\n   * Observable factory\r\n   *\r\n   * @method factory\r\n   * @memberOf observable\r\n   * @return {Object} {@link keigai.Observable}\r\n   * @example\r\n   * let observer = keigai.util.observer( 50 );\r\n   */\n\t\tvar observable = function observable(arg) {\n\t\t\treturn new Observable(arg);\n\t\t};\n\n\t\tvar Base = (function () {\n\t\t\t/**\r\n    * Base Object\r\n    *\r\n    * @constructor\r\n    * @memberOf keigai\r\n    */\n\n\t\t\tfunction Base() {\n\t\t\t\t_classCallCheck(this, Base);\n\n\t\t\t\t/**\r\n     * {@link keigai.Observable}\r\n     *\r\n     * @abstract\r\n     * @type {Object}\r\n     */\n\t\t\t\tthis.observer = null;\n\t\t\t}\n\n\t\t\t_createClass(Base, [{\n\t\t\t\tkey: \"addEventListener\",\n\n\t\t\t\t/**\r\n     * Adds an event listener\r\n     *\r\n     * @method addEventListener\r\n     * @memberOf keigai.Base\r\n     * @param  {String}   ev       Event name\r\n     * @param  {Function} listener Function to execute\r\n     * @param  {String}   id       [Optional] Listener ID\r\n     * @param  {String}   scope    [Optional] Listener scope, default is `this`\r\n     * @return {Object} {@link keigai.Base}\r\n     * @example\r\n     * obj.addEventListener( \"event\", function ( ev ) {\r\n     *   ...\r\n     * }, \"myHook\" );\r\n     */\n\t\t\t\tvalue: function addEventListener(ev, listener, id, scope) {\n\t\t\t\t\tthis.observer.on(ev, listener, id, scope || this);\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"addListener\",\n\n\t\t\t\t/**\r\n     * Adds an event listener\r\n     *\r\n     * @method addListener\r\n     * @memberOf keigai.Base\r\n     * @param  {String}   ev       Event name\r\n     * @param  {Function} listener Function to execute\r\n     * @param  {String}   id       [Optional] Listener ID\r\n     * @param  {String}   scope    [Optional] Listener scope, default is `this`\r\n     * @return {Object} {@link keigai.Base}\r\n     * @example\r\n     * obj.addEventListener( \"event\", function ( ev ) {\r\n     *   ...\r\n     * }, \"myHook\" );\r\n     */\n\t\t\t\tvalue: function addListener(ev, listener, id, scope) {\n\t\t\t\t\tthis.observer.on(ev, listener, id, scope || this);\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"dispatch\",\n\n\t\t\t\t/**\r\n     * Dispatches an event, with optional arguments\r\n     *\r\n     * @method dispatch\r\n     * @memberOf keigai.Base\r\n     * @return {Object} {@link keigai.Base}\r\n     * @example\r\n     * obj.dispatch( \"event\", ... );\r\n     */\n\t\t\t\tvalue: function dispatch() {\n\t\t\t\t\tfor (var _len3 = arguments.length, args = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n\t\t\t\t\t\targs[_key3] = arguments[_key3];\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.observer.dispatch.apply(this.observer, args);\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"dispatchEvent\",\n\n\t\t\t\t/**\r\n     * Dispatches an event, with optional arguments\r\n     *\r\n     * @method dispatchEvent\r\n     * @memberOf keigai.Base\r\n     * @return {Object} {@link keigai.Base}\r\n     * @example\r\n     * obj.dispatchEvent( \"event\", ... );\r\n     */\n\t\t\t\tvalue: function dispatchEvent() {\n\t\t\t\t\tfor (var _len4 = arguments.length, args = Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n\t\t\t\t\t\targs[_key4] = arguments[_key4];\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.observer.dispatch.apply(this.observer, args);\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"emit\",\n\n\t\t\t\t/**\r\n     * Dispatches an event, with optional arguments\r\n     *\r\n     * @method emit\r\n     * @memberOf keigai.Base\r\n     * @return {Object} {@link keigai.Base}\r\n     * @example\r\n     * obj.emit( \"event\", ... );\r\n     */\n\t\t\t\tvalue: function emit() {\n\t\t\t\t\tfor (var _len5 = arguments.length, args = Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n\t\t\t\t\t\targs[_key5] = arguments[_key5];\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.observer.dispatch.apply(this.observer, args);\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"hook\",\n\n\t\t\t\t/**\r\n     * Hooks into `target` for an event\r\n     *\r\n     * @method hook\r\n     * @memberOf keigai.Base\r\n     * @return {Object} {@link keigai.Base}\r\n     * @example\r\n     * obj.hook( document.querySelector( \"a\" ), \"click\" );\r\n     */\n\t\t\t\tvalue: function hook() {\n\t\t\t\t\tfor (var _len6 = arguments.length, args = Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {\n\t\t\t\t\t\targs[_key6] = arguments[_key6];\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.observer.hook.apply(this.observer, args);\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"listeners\",\n\n\t\t\t\t/**\r\n     * Gets listeners\r\n     *\r\n     * @method listeners\r\n     * @memberOf keigai.Base\r\n     * @param  {String} ev [Optional] Event name\r\n     * @return {Object} Listeners\r\n     * @example\r\n     * keigai.util.iterate( obj.listeners(), function ( fn, id ) {\r\n     *   ...\r\n     * } );\r\n     */\n\t\t\t\tvalue: function listeners(ev) {\n\t\t\t\t\treturn ev ? this.observer.listeners[ev] : this.observer.listeners;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"off\",\n\n\t\t\t\t/**\r\n     * Removes an event listener\r\n     *\r\n     * @method off\r\n     * @memberOf keigai.Base\r\n     * @param  {String} ev Event name\r\n     * @param  {String} id [Optional] Listener ID\r\n     * @return {Object} {@link keigai.Base}\r\n     * @example\r\n     * obj.off( \"event\", \"myHook\" );\r\n     */\n\t\t\t\tvalue: function off(ev, id) {\n\t\t\t\t\tthis.observer.off(ev, id);\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"on\",\n\n\t\t\t\t/**\r\n     * Adds an event listener\r\n     *\r\n     * @method on\r\n     * @memberOf keigai.Base\r\n     * @param  {String}   ev       Event name\r\n     * @param  {Function} listener Function to execute\r\n     * @param  {String}   id       [Optional] Listener ID\r\n     * @param  {String}   scope    [Optional] Listener scope, default is `this`\r\n     * @return {Object} {@link keigai.Base}\r\n     * @example\r\n     * obj.on( \"event\", function ( ev ) {\r\n     *   ...\r\n     * }, \"myHook\" );\r\n     */\n\t\t\t\tvalue: function on(ev, listener, id, scope) {\n\t\t\t\t\tthis.observer.on(ev, listener, id, scope || this);\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"once\",\n\n\t\t\t\t/**\r\n     * Adds a short lived event listener\r\n     *\r\n     * @method once\r\n     * @memberOf keigai.Base\r\n     * @param  {String}   ev       Event name\r\n     * @param  {Function} listener Function to execute\r\n     * @param  {String}   id       [Optional] Listener ID\r\n     * @param  {String}   scope    [Optional] Listener scope, default is `this`\r\n     * @return {Object} {@link keigai.Base}\r\n     * @example\r\n     * obj.once( \"event\", function ( ev ) {\r\n     *   ...\r\n     * } );\r\n     */\n\t\t\t\tvalue: function once(ev, listener, id, scope) {\n\t\t\t\t\tthis.observer.once(ev, listener, id, scope || this);\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"removeEventListener\",\n\n\t\t\t\t/**\r\n     * Removes an event listener\r\n     *\r\n     * @method removeEventListener\r\n     * @memberOf keigai.Base\r\n     * @param  {String} ev Event name\r\n     * @param  {String} id [Optional] Listener ID\r\n     * @return {Object} {@link keigai.Base}\r\n     * @example\r\n     * obj.removeListener( \"event\", \"myHook\" );\r\n     */\n\t\t\t\tvalue: function removeEventListener(ev, id) {\n\t\t\t\t\tthis.observer.off(ev, id);\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"removeListener\",\n\n\t\t\t\t/**\r\n     * Removes an event listener\r\n     *\r\n     * @method removeListener\r\n     * @memberOf keigai.Base\r\n     * @param  {String} ev Event name\r\n     * @param  {String} id [Optional] Listener ID\r\n     * @return {Object} {@link keigai.Base}\r\n     * @example\r\n     * obj.removeListener( \"event\", \"myHook\" );\r\n     */\n\t\t\t\tvalue: function removeListener(ev, id) {\n\t\t\t\t\tthis.observer.off(ev, id);\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}]);\n\n\t\t\treturn Base;\n\t\t})();\n\n\t\t/**\r\n   * @namespace array\r\n   */\n\t\tvar array = {\n\t\t\t/**\r\n    * Adds 'arg' to 'obj' if it is not found\r\n    *\r\n    * @method add\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to receive 'arg'\r\n    * @param  {Mixed} arg Argument to set in 'obj'\r\n    * @return {Array}     Array that was queried\r\n    * @example\r\n    * let myArray = [1, 2];\r\n    *\r\n    * keigai.util.array.add( myArray, 3 ); // [1, 2, 3]\r\n    * keigai.util.array.add( myArray, 1 ); // [1, 2, 3]\r\n    */\n\t\t\tadd: function add(obj, arg) {\n\t\t\t\tif (!array.contains(obj, arg)) {\n\t\t\t\t\tobj.push(arg);\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Preforms a binary search on a sorted Array\r\n    *\r\n    * @method binIndex\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to search\r\n    * @param  {Mixed} arg Value to find index of\r\n    * @return {Number}    Index of `arg` within `obj`\r\n    * @example\r\n    * let myArray = [1, 5, 10, 15, 20, 25, ...];\r\n    *\r\n    * keigai.util.array.binIndex( myArray, 5 ); // 1\r\n    */\n\t\t\tbinIndex: function binIndex(obj, arg) {\n\t\t\t\tvar max = obj.length - 1;\n\t\t\t\tvar min = 0;\n\t\t\t\tvar idx = 0;\n\t\t\t\tvar val = 0;\n\n\t\t\t\twhile (min <= max) {\n\t\t\t\t\tidx = Math.floor((min + max) / 2);\n\t\t\t\t\tval = obj[idx];\n\n\t\t\t\t\tif (val < arg) {\n\t\t\t\t\t\tmin = idx + 1;\n\t\t\t\t\t} else if (val > arg) {\n\t\t\t\t\t\tmax = idx - 1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn idx;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn -1;\n\t\t\t},\n\n\t\t\t/**\r\n    * Returns an Object ( NodeList, etc. ) as an Array\r\n    *\r\n    * @method cast\r\n    * @memberOf array\r\n    * @param  {Object}  obj Object to cast\r\n    * @param  {Boolean} key [Optional] Returns key or value, only applies to Objects without a length property\r\n    * @return {Array}       Object as an Array\r\n    * @example\r\n    * keigai.util.array.cast( document.querySelectorAll( \"...\" ) );\r\n    */\n\t\t\tcast: function cast(obj, key) {\n\t\t\t\tvar o = [];\n\n\t\t\t\tif (!isNaN(obj.length)) {\n\t\t\t\t\to = Array.from(obj);\n\t\t\t\t} else if (key === true) {\n\t\t\t\t\to = array.keys(obj);\n\t\t\t\t} else {\n\t\t\t\t\tutility.iterate(obj, function (i) {\n\t\t\t\t\t\to.push(i);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn o;\n\t\t\t},\n\n\t\t\t/**\r\n    * Transforms an Array to a 2D Array of chunks\r\n    *\r\n    * @method chunk\r\n    * @memberOf array\r\n    * @param  {Array}  obj  Array to process\r\n    * @param  {Number} size Chunk size ( integer )\r\n    * @return {Array}       Chunked Array\r\n    * @example\r\n    * keigai.util.array.chunk( [0, 1, 2, 3], 2 ); // [[0, 1], [2, 3]]\r\n    */\n\t\t\tchunk: function chunk(obj, size) {\n\t\t\t\tvar result = [];\n\t\t\t\tvar nth = number.round(obj.length / size, \"up\");\n\t\t\t\tvar start = 0;\n\t\t\t\tvar i = -1;\n\n\t\t\t\twhile (++i < nth) {\n\t\t\t\t\tstart = i * size;\n\t\t\t\t\tresult.push(array.limit(obj, start, size));\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Clears an Array without destroying it\r\n    *\r\n    * @method clear\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to clear\r\n    * @return {Array}     Cleared Array\r\n    * @example\r\n    * let myArray = [1, 2, 3, 4, 5];\r\n    *\r\n    * keigai.util.array.clear( myArray );\r\n    * myArray.length; // 0\r\n    */\n\t\t\tclear: function clear(obj) {\n\t\t\t\treturn obj.length > 0 ? array.remove(obj, 0, obj.length) : obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Clones an Array\r\n    *\r\n    * @method clone\r\n    * @memberOf array\r\n    * @param  {Array}   obj     Array to clone\r\n    * @param  {Boolean} shallow [Optional] Default is `true`\r\n    * @return {Array}           Clone of Array\r\n    * @example\r\n    * let myArray      = [1, 2, 3, 4, 5],\r\n    *     myArrayClone = keigai.util.array.clone( myArray );\r\n    *\r\n    * myArrayClone.push( 6 );\r\n    *\r\n    * myArray.length;      // 5\r\n    * myArrayClone.length; // 6\r\n    */\n\t\t\tclone: function clone(obj) {\n\t\t\t\tvar shallow = arguments[1] === undefined ? true : arguments[1];\n\n\t\t\t\treturn utility.clone(obj, shallow);\n\t\t\t},\n\n\t\t\t/**\r\n    * Determines if obj contains arg\r\n    *\r\n    * @method contains\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to search\r\n    * @param  {Mixed} arg Value to look for\r\n    * @return {Boolean}   True if found, false if not\r\n    * @example\r\n    * if ( keigai.util.array.contains( [1], 1 ) ) { ... }\r\n    */\n\t\t\tcontains: function contains(obj, arg) {\n\t\t\t\treturn obj.indexOf(arg) > -1;\n\t\t\t},\n\n\t\t\t/**\r\n    * Facade of `Array.map()`\r\n    *\r\n    * @method collect\r\n    * @memberOf array\r\n    * @param  {Array}    obj Array to iterate\r\n    * @param  {Function} fn  Function to execute against indices\r\n    * @return {Array}        New Array\r\n    * @example\r\n    * let results = keigai.util.array.collect( [...], function ( ... ) { ... } );\r\n    */\n\t\t\tcollect: function collect(obj, fn) {\n\t\t\t\treturn obj.map(fn);\n\t\t\t},\n\n\t\t\t/**\r\n    * Compacts a Array by removing `null` or `undefined` indices\r\n    *\r\n    * @method compact\r\n    * @memberOf array\r\n    * @param  {Array}   obj  Array to compact\r\n    * @param  {Boolean} diff Indicates to return resulting Array only if there's a difference\r\n    * @return {Array}        Compacted copy of `obj`, or null ( if `diff` is passed & no diff is found )\r\n    * @example\r\n    * keigai.util.array.compact( [null, \"a\", \"b\", \"c\", null, \"d\"] ); // [\"a\", \"b\", \"c\", \"d\"]\r\n    * keigai.util.array.compact( [\"a\", \"b\", \"c\", \"d\"], true );       // null\r\n    */\n\t\t\tcompact: function compact(obj, diff) {\n\t\t\t\tvar result = obj.filter(function (i) {\n\t\t\t\t\treturn !regex.null_undefined.test(i);\n\t\t\t\t});\n\n\t\t\t\treturn diff !== true ? result : result.length < obj.length ? result : null;\n\t\t\t},\n\n\t\t\t/**\r\n    * Counts `value` in `obj`\r\n    *\r\n    * @method count\r\n    * @memberOf array\r\n    * @param  {Array} obj   Array to search\r\n    * @param  {Mixed} value Value to compare\r\n    * @return {Array}       Array of counts\r\n    * @example\r\n    * keigai.util.array.count( [\"apple\", \"banana\", \"orange\", \"apple\"], \"apple\" ); // 2\r\n    */\n\t\t\tcount: function count(obj, value) {\n\t\t\t\treturn obj.filter(function (i) {\n\t\t\t\t\treturn i === value;\n\t\t\t\t}).length;\n\t\t\t},\n\n\t\t\t/**\r\n    * Finds the difference between two Arrays\r\n    *\r\n    * @method diff\r\n    * @memberOf array\r\n    * @param  {Array} obj1 Source Array\r\n    * @param  {Array} obj2 Comparison Array\r\n    * @return {Array}      Array of the differences\r\n    * @example\r\n    * keigai.util.array.diff( [\"a\"], [\"a\", \"b\"] ); // [\"b\"]\r\n    */\n\t\t\tdiff: function diff(obj1, obj2) {\n\t\t\t\tvar result = undefined;\n\n\t\t\t\tresult = obj1.filter(function (i) {\n\t\t\t\t\treturn !array.contains(obj2, i);\n\t\t\t\t});\n\n\t\t\t\tresult = result.concat(obj2.filter(function (i) {\n\t\t\t\t\treturn !array.contains(obj1, i);\n\t\t\t\t}));\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Iterates `obj` and executes `fn` with arguments [`value`, `index`].\r\n    * Returning `false` halts iteration.\r\n    *\r\n    * @method each\r\n    * @memberOf array\r\n    * @param  {Array}    obj   Array to iterate\r\n    * @param  {Function} fn    Function to execute on index values\r\n    * @param  {Boolean}  async [Optional] Asynchronous iteration\r\n    * @param  {Number}   size  [Optional] Batch size for async iteration, default is 10\r\n    * @return {Array}          Array\r\n    * @example\r\n    * keigai.util.array.each( [ ... ], function ( ... ) { ... } );\r\n    * keigai.util.array.each( [ ... ], function ( ... ) { ... }, true, 100 ); // processing batches of a 100\r\n    */\n\t\t\teach: function each(obj, fn, async) {\n\t\t\t\tvar size = arguments[3] === undefined ? 10 : arguments[3];\n\n\t\t\t\tvar nth = obj.length;\n\t\t\t\tvar i = undefined,\n\t\t\t\t    offset = undefined;\n\n\t\t\t\tif (async !== true) {\n\t\t\t\t\ti = -1;\n\t\t\t\t\twhile (++i < nth) {\n\t\t\t\t\t\tif (fn.call(obj, obj[i], i) === false) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\toffset = 0;\n\n\t\t\t\t\tif (size > nth) {\n\t\t\t\t\t\tsize = nth;\n\t\t\t\t\t}\n\n\t\t\t\t\tutility.repeat(function () {\n\t\t\t\t\t\tvar i = -1;\n\t\t\t\t\t\tvar idx = undefined;\n\n\t\t\t\t\t\twhile (++i < size) {\n\t\t\t\t\t\t\tidx = i + offset;\n\n\t\t\t\t\t\t\tif (idx === nth || fn.call(obj, obj[idx], idx) === false) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\toffset += size;\n\n\t\t\t\t\t\tif (offset >= nth) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}, undefined, undefined, false);\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Iterates `obj` in reverse and executes `fn` with arguments [`value`, `index`].\r\n    * Returning `false` halts iteration.\r\n    *\r\n    * @method eachReverse\r\n    * @memberOf array\r\n    * @param  {Array}    obj   Array to iterate\r\n    * @param  {Function} fn    Function to execute on index values\r\n    * @param  {Boolean}  async [Optional] Asynchronous iteration\r\n    * @param  {Number}   size  [Optional] Batch size for async iteration, default is 10\r\n    * @return {Array}          Array\r\n    * @example\r\n    * keigai.util.array.eachReverse( [ ... ], function ( ... ) { ... } );\r\n    * keigai.util.array.eachReverse( [ ... ], function ( ... ) { ... }, true, 100 ); // processing batches of a 100\r\n    */\n\t\t\teachReverse: function eachReverse(obj, fn, async, size) {\n\t\t\t\tvar nth = obj.length;\n\t\t\t\tvar i = undefined,\n\t\t\t\t    offset = undefined;\n\n\t\t\t\tif (async !== true) {\n\t\t\t\t\ti = nth;\n\t\t\t\t\twhile (--i > -1) {\n\t\t\t\t\t\tif (fn.call(obj, obj[i], i) === false) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tsize = size || 10;\n\t\t\t\t\toffset = nth - 1;\n\n\t\t\t\t\tif (size > nth) {\n\t\t\t\t\t\tsize = nth;\n\t\t\t\t\t}\n\n\t\t\t\t\tutility.repeat(function () {\n\t\t\t\t\t\tvar i = -1;\n\t\t\t\t\t\tvar idx = undefined;\n\n\t\t\t\t\t\twhile (++i < size) {\n\t\t\t\t\t\t\tidx = offset - i;\n\n\t\t\t\t\t\t\tif (idx < 0 || fn.call(obj, obj[idx], idx) === false) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\toffset -= size;\n\n\t\t\t\t\t\tif (offset < 0) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}, undefined, undefined, false);\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Determines if an Array is empty\r\n    *\r\n    * @method empty\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to inspect\r\n    * @return {Boolean}   `true` if there's no indices\r\n    * @example\r\n    * keigai.util.array.empty( [] );    // true\r\n    * keigai.util.array.empty( [\"a\"] ); // false\r\n    */\n\t\t\tempty: function empty(obj) {\n\t\t\t\treturn obj.length === 0;\n\t\t\t},\n\n\t\t\t/**\r\n    * Determines if two Arrays are equal\r\n    *\r\n    * @method equal\r\n    * @memberOf array\r\n    * @param  {Array} obj1 Array to compare\r\n    * @param  {Array} obj2 Array to compare\r\n    * @return {Boolean} `true` if the Arrays match\r\n    * @example\r\n    * keigai.util.array.equal( [\"a\"], [\"a\"] );      // true\r\n    * keigai.util.array.equal( [\"a\"], [\"a\", \"b\"] ); // false\r\n    */\n\t\t\tequal: function equal(obj1, obj2) {\n\t\t\t\treturn JSON.stringify(obj1) === JSON.stringify(obj2);\n\t\t\t},\n\n\t\t\t/**\r\n    * Fills `obj` with the evalution of `arg`, optionally from `start` to `offset`\r\n    *\r\n    * @method fill\r\n    * @memberOf array\r\n    * @param  {Array}  obj   Array to fill\r\n    * @param  {Mixed}  arg   String, Number of Function to fill with\r\n    * @param  {Number} start [Optional] Index to begin filling at\r\n    * @param  {Number} end   [Optional] Offset from start to stop filling at\r\n    * @return {Array}        Filled Array\r\n    * @example\r\n    * let myArray = [\"a\", \"b\", \"c\"];\r\n    *\r\n    * keigai.util.array.fill( myArray, function ( i ) { return i + \"a\"; } );\r\n    * myArray[0]; // \"aa\"\r\n    */\n\t\t\tfill: function fill(obj, arg, start, offset) {\n\t\t\t\tvar fn = typeof arg === \"function\";\n\t\t\t\tvar l = obj.length;\n\t\t\t\tvar i = !isNaN(start) ? start : 0;\n\t\t\t\tvar nth = !isNaN(offset) ? i + offset : l - 1;\n\n\t\t\t\tif (nth > l - 1) {\n\t\t\t\t\tnth = l - 1;\n\t\t\t\t}\n\n\t\t\t\tif (fn) {\n\t\t\t\t\twhile (i <= nth) {\n\t\t\t\t\t\tobj[i] = arg(obj[i]);\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\twhile (i <= nth) {\n\t\t\t\t\t\tobj[i] = arg;\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Returns the first Array index\r\n    *\r\n    * @method first\r\n    * @memberOf array\r\n    * @param  {Array} obj The array\r\n    * @return {Mixed}     The first node of the array\r\n    * @example\r\n    * keigai.util.array.first( [\"a\", \"b\"] ); // \"a\"\r\n    */\n\t\t\tfirst: function first(obj) {\n\t\t\t\treturn obj[0];\n\t\t\t},\n\n\t\t\t/**\r\n    * Flattens a 2D Array\r\n    *\r\n    * @method flat\r\n    * @memberOf array\r\n    * @param  {Array} obj 2D Array to flatten\r\n    * @return {Array}     Flatten Array\r\n    * @example\r\n    * keigai.util.array.flat( [[0, 1], [2, 3]] ); // [0, 1, 2, 3]\r\n    */\n\t\t\tflat: function flat(obj) {\n\t\t\t\tvar result = [];\n\n\t\t\t\tresult = obj.reduce(function (a, b) {\n\t\t\t\t\treturn a.concat(b);\n\t\t\t\t}, result);\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Iterates `obj` and executes `fn` with arguments [`value`, `index`].\r\n    * Returning `false` halts iteration.\r\n    *\r\n    * @method forEach\r\n    * @memberOf array\r\n    * @see array.each\r\n    * @param  {Array}    obj   Array to iterate\r\n    * @param  {Function} fn    Function to execute on index values\r\n    * @param  {Boolean}  async [Optional] Asynchronous iteration\r\n    * @param  {Number}   size  [Optional] Batch size for async iteration, default is 10\r\n    * @return {Array}          Array\r\n    * @example\r\n    * keigai.util.array.forEach( [ ... ], function ( ... ) { ... } );\r\n    * keigai.util.array.forEach( [ ... ], function ( ... ) { ... }, true, 100 ); // processing batches of a 100\r\n    */\n\t\t\tforEach: function forEach(obj, fn, async, size) {\n\t\t\t\treturn array.each(obj, fn, async, size);\n\t\t\t},\n\n\t\t\t/**\r\n    * Creates a 2D Array from an Object\r\n    *\r\n    * @method fromObject\r\n    * @memberOf array\r\n    * @param  {Object} obj Object to convert\r\n    * @return {Array}      2D Array\r\n    * @example\r\n    * keigai.util.array.fromObject( {name: \"John\", sex: \"male\"} ); // [[\"name\", \"John\"], [\"sex\", \"male\"]]\r\n    */\n\t\t\tfromObject: function fromObject(obj) {\n\t\t\t\treturn array.mingle(array.keys(obj), array.cast(obj));\n\t\t\t},\n\n\t\t\t/**\r\n    * Facade of indexOf\r\n    *\r\n    * @method index\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to search\r\n    * @param  {Mixed} arg Value to find index of\r\n    * @return {Number}    The position of arg in instance\r\n    * @example\r\n    * keigai.util.array.index( [\"a\", \"b\", \"c\"], \"b\" ); // 1\r\n    */\n\t\t\tindex: function index(obj, arg) {\n\t\t\t\treturn obj.indexOf(arg);\n\t\t\t},\n\n\t\t\t/**\r\n    * Returns an Associative Array as an Indexed Array\r\n    *\r\n    * @method indexed\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to index\r\n    * @return {Array}     Indexed Array\r\n    * @example\r\n    * let myArray = [\"a\", \"b\", \"c\"];\r\n    *\r\n    * myArray.prop = \"d\";\r\n    * keigai.util.array.indexed( myArray ); [\"a\", \"b\", \"c\", \"d\"];\r\n    */\n\t\t\tindexed: function indexed(obj) {\n\t\t\t\tvar result = [];\n\n\t\t\t\tutility.iterate(obj, function (v) {\n\t\t\t\t\tresult.push(v);\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Finds the intersections between obj1 and obj2\r\n    *\r\n    * @method intersect\r\n    * @memberOf array\r\n    * @param  {Array} obj1 Source Array\r\n    * @param  {Array} obj2 Comparison Array\r\n    * @return {Array}      Array of the intersections\r\n    * @example\r\n    * keigai.util.array.intersect( [\"a\", \"b\", \"d\"], [\"b\", \"c\", \"d\"] ); // [\"b\", \"d\"]\r\n    */\n\t\t\tintersect: function intersect(obj1, obj2) {\n\t\t\t\tvar a = obj1.length > obj2.length ? obj1 : obj2;\n\t\t\t\tvar b = a === obj1 ? obj2 : obj1;\n\n\t\t\t\treturn a.filter(function (key) {\n\t\t\t\t\treturn array.contains(b, key);\n\t\t\t\t});\n\t\t\t},\n\n\t\t\t/**\r\n    * Iterates an Array using an Iterator\r\n    *\r\n    * @method iterate\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to iterate\r\n    * @return {Array}     Array to iterate\r\n    */\n\t\t\titerate: function iterate(obj, fn) {\n\t\t\t\tvar itr = array.iterator(obj);\n\t\t\t\tvar i = -1;\n\t\t\t\tvar item = undefined,\n\t\t\t\t    next = undefined;\n\n\t\t\t\tdo {\n\t\t\t\t\titem = itr.next();\n\n\t\t\t\t\tif (!item.done) {\n\t\t\t\t\t\tnext = fn(item.value, ++i);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnext = false;\n\t\t\t\t\t}\n\t\t\t\t} while (next !== false);\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Creates an Array generator to iterate the indices\r\n    *\r\n    * @method iterator\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to iterate\r\n    * @return {Function}  Generator\r\n    */\n\t\t\titerator: function iterator(obj) {\n\t\t\t\tvar i = -1;\n\t\t\t\tvar n = obj.length;\n\n\t\t\t\treturn {\n\t\t\t\t\tnext: function next() {\n\t\t\t\t\t\tif (++i < n) {\n\t\t\t\t\t\t\treturn { done: false, value: obj[i] };\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn { done: true };\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t},\n\n\t\t\t/**\r\n    * Keeps every element of `obj` for which `fn` evaluates to true\r\n    *\r\n    * @method keepIf\r\n    * @memberOf array\r\n    * @param  {Array}    obj Array to iterate\r\n    * @param  {Function} fn  Function to test indices against\r\n    * @return {Array}        Array\r\n    * @example\r\n    * let myArray = [\"a\", \"b\", \"c\"];\r\n    *\r\n    * keigai.util.array.keepIf( myArray, function ( i ) { return /a|c/.test( i ); } );\r\n    * myArray[1]; // \"c\"\r\n    */\n\t\t\tkeepIf: function keepIf(obj, fn) {\n\t\t\t\tvar result = undefined,\n\t\t\t\t    remove = undefined;\n\n\t\t\t\tresult = obj.filter(fn);\n\t\t\t\tremove = array.diff(obj, result);\n\n\t\t\t\tarray.each(remove, function (i) {\n\t\t\t\t\tarray.remove(obj, array.index(obj, i));\n\t\t\t\t});\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Returns the keys in an \"Associative Array\"\r\n    *\r\n    * @method keys\r\n    * @memberOf array\r\n    * @param  {Mixed} obj Array or Object to extract keys from\r\n    * @return {Array}     Array of the keys\r\n    * @example\r\n    * keigai.util.array.keys( {abc: true, xyz: false} ); // [\"abc\", \"xyz\"]\r\n    */\n\t\t\tkeys: function keys(obj) {\n\t\t\t\treturn Object.keys(obj);\n\t\t\t},\n\n\t\t\t/**\r\n    * Sorts an Array based on key values, like an SQL ORDER BY clause\r\n    *\r\n    * @method keySort\r\n    * @memberOf array\r\n    * @param  {Array}  obj   Array to sort\r\n    * @param  {String} query Sort query, e.g. \"name, age desc, country\"\r\n    * @param  {String} sub   [Optional] Key which holds data, e.g. \"{data: {}}\" = \"data\"\r\n    * @return {Array}        Sorted Array\r\n    * @example\r\n    * let myArray = [{abc: 123124, xyz: 5}, {abc: 123124, xyz: 6}, {abc: 2, xyz: 5}];\r\n    *\r\n    * keigai.util.array.keySort( myArray, \"abc\" );           // [{abc: 2, xyz: 5}, {abc: 123124, xyz: 5}, {abc: 123124, xyz: 6}];\r\n    * keigai.util.array.keySort( myArray, \"abc, xyz desc\" ); // [{abc: 2, xyz: 5}, {abc: 123124, xyz: 6}, {abc: 123124, xyz: 5}];\r\n    */\n\t\t\tkeySort: function keySort(obj, query, sub) {\n\t\t\t\tquery = query.replace(/\\s*asc/ig, \"\").replace(/\\s*desc/ig, \" desc\");\n\n\t\t\t\tvar queries = string.explode(query).map(function (i) {\n\t\t\t\t\treturn i.split(\" \");\n\t\t\t\t});\n\t\t\t\tvar sorts = [];\n\t\t\t\tvar braceS = \"[\\\"\";\n\t\t\t\tvar braceE = \"\\\"]\";\n\n\t\t\t\tif (sub && sub !== \"\") {\n\t\t\t\t\tsub = \".\" + sub;\n\t\t\t\t} else {\n\t\t\t\t\tsub = \"\";\n\t\t\t\t}\n\n\t\t\t\tarray.each(queries, function (i) {\n\t\t\t\t\tvar s = \".\";\n\t\t\t\t\tvar e = \"\";\n\n\t\t\t\t\tif (regex.not_dotnotation.test(i[0])) {\n\t\t\t\t\t\ts = braceS;\n\t\t\t\t\t\te = braceE;\n\t\t\t\t\t}\n\n\t\t\t\t\tsorts.push(\"try {\");\n\n\t\t\t\t\tif (i[1] === \"desc\") {\n\t\t\t\t\t\tsorts.push(\"if ( a\" + sub + s + i[0] + e + \" < b\" + sub + s + i[0] + e + \" ) return 1;\");\n\t\t\t\t\t\tsorts.push(\"if ( a\" + sub + s + i[0] + e + \" > b\" + sub + s + i[0] + e + \" ) return -1;\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsorts.push(\"if ( a\" + sub + s + i[0] + e + \" < b\" + sub + s + i[0] + e + \" ) return -1;\");\n\t\t\t\t\t\tsorts.push(\"if ( a\" + sub + s + i[0] + e + \" > b\" + sub + s + i[0] + e + \" ) return 1;\");\n\t\t\t\t\t}\n\n\t\t\t\t\tsorts.push(\"} catch (e) {\");\n\t\t\t\t\tsorts.push(\"try {\");\n\t\t\t\t\tsorts.push(\"if ( a\" + sub + s + i[0] + e + \" !== undefined ) return \" + (i[1] === \"desc\" ? \"-1\" : \"1\") + \";\");\n\t\t\t\t\tsorts.push(\"} catch (e) {}\");\n\t\t\t\t\tsorts.push(\"try {\");\n\t\t\t\t\tsorts.push(\"if ( b\" + sub + s + i[0] + e + \" !== undefined ) return \" + (i[1] === \"desc\" ? \"1\" : \"-1\") + \";\");\n\t\t\t\t\tsorts.push(\"} catch (e) {}\");\n\t\t\t\t\tsorts.push(\"}\");\n\t\t\t\t});\n\n\t\t\t\tsorts.push(\"return 0;\");\n\n\t\t\t\treturn obj.sort(new Function(\"a\", \"b\", sorts.join(\"\\n\")));\n\t\t\t},\n\n\t\t\t/**\r\n    * Returns the last index of the Array\r\n    *\r\n    * @method last\r\n    * @memberOf array\r\n    * @param  {Array}  obj Array\r\n    * @param  {Number} arg [Optional] Negative offset from last index to return\r\n    * @return {Mixed}      Last index( s ) of Array\r\n    * @example\r\n    * let myArray = [1, 2, 3, 4];\r\n    *\r\n    * keigai.util.array.last( myArray );    // 4\r\n    * keigai.util.array.last( myArray, 2 ); // [3, 4]\r\n    */\n\t\t\tlast: function last(obj, arg) {\n\t\t\t\tvar n = obj.length - 1;\n\n\t\t\t\tif (arg >= n + 1) {\n\t\t\t\t\treturn obj;\n\t\t\t\t} else if (isNaN(arg) || arg === 1) {\n\t\t\t\t\treturn obj[n];\n\t\t\t\t} else {\n\t\t\t\t\treturn array.limit(obj, n - --arg, n);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\r\n    * Returns a limited range of indices from the Array\r\n    *\r\n    * @method limit\r\n    * @memberOf array\r\n    * @param  {Array}  obj    Array to iterate\r\n    * @param  {Number} start  Starting index\r\n    * @param  {Number} offset Number of indices to return\r\n    * @return {Array}         Array of indices\r\n    * @example\r\n    * let myArray = [1, 2, 3, 4];\r\n    *\r\n    * keigai.util.array.limit( myArray, 0, 2 ); // [1, 2]\r\n    * keigai.util.array.limit( myArray, 2, 2 ); // [3, 4]\r\n    */\n\t\t\tlimit: function limit(obj, start, offset) {\n\t\t\t\tvar result = [];\n\t\t\t\tvar i = start - 1;\n\t\t\t\tvar nth = start + offset;\n\t\t\t\tvar max = obj.length;\n\n\t\t\t\tif (max > 0) {\n\t\t\t\t\twhile (++i < nth && i < max) {\n\t\t\t\t\t\tresult.push(obj[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Finds the maximum value in an Array\r\n    *\r\n    * @method max\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to process\r\n    * @return {Mixed}     Number, String, etc.\r\n    * @example\r\n    * keigai.util.array.max( [5, 3, 9, 1, 4] ); // 9\r\n    */\n\t\t\tmax: function max(obj) {\n\t\t\t\treturn array.last(array.sorted(array.clone(obj)));\n\t\t\t},\n\n\t\t\t/**\r\n    * Finds the mean of an Array ( of numbers )\r\n    *\r\n    * @method mean\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to process\r\n    * @return {Number}    Mean of the Array ( float or integer )\r\n    * @example\r\n    * keigai.util.array.mean( [1, 3, 5] ); // 3\r\n    */\n\t\t\tmean: function mean(obj) {\n\t\t\t\treturn obj.length > 0 ? array.sum(obj) / obj.length : undefined;\n\t\t\t},\n\n\t\t\t/**\r\n    * Finds the median value of an Array ( of numbers )\r\n    *\r\n    * @method median\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to process\r\n    * @return {Number}    Median number of the Array ( float or integer )\r\n    * @example\r\n    * keigai.util.array.median( [5, 1, 3, 8] ); // 4\r\n    * keigai.util.array.median( [5, 1, 3] );    // 3\r\n    */\n\t\t\tmedian: function median(obj) {\n\t\t\t\tvar dupe = array.sorted(array.clone(obj));\n\t\t\t\tvar nth = dupe.length;\n\t\t\t\tvar mid = number.round(nth / 2, \"down\");\n\n\t\t\t\treturn number.odd(nth) ? dupe[mid] : (dupe[mid - 1] + dupe[mid]) / 2;\n\t\t\t},\n\n\t\t\t/**\r\n    * Merges `arg` into `obj`, excluding duplicate indices\r\n    *\r\n    * @method merge\r\n    * @memberOf array\r\n    * @param  {Array} obj1 Array to receive indices\r\n    * @param  {Array} obj2 Array to merge\r\n    * @return {Array}      First argument\r\n    * @example\r\n    * let a = [\"a\", \"b\", \"c\"],\r\n    *     b = [\"d\"];\r\n    *\r\n    * keigai.util.array.merge( a, b );\r\n    * a[3]; // \"d\"\r\n    */\n\t\t\tmerge: function merge(obj1, obj2) {\n\t\t\t\tarray.each(obj2, function (i) {\n\t\t\t\t\tarray.add(obj1, i);\n\t\t\t\t});\n\n\t\t\t\treturn obj1;\n\t\t\t},\n\n\t\t\t/**\r\n    * Finds the minimum value in an Array\r\n    *\r\n    * @method min\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to process\r\n    * @return {Mixed}     Number, String, etc.\r\n    * @example\r\n    * keigai.util.array.min( [5, 3, 9, 1, 4] ); // 1\r\n    */\n\t\t\tmin: function min(obj) {\n\t\t\t\treturn array.sorted(array.clone(obj))[0];\n\t\t\t},\n\n\t\t\t/**\r\n    * Mingles Arrays and returns a 2D Array\r\n    *\r\n    * @method mingle\r\n    * @memberOf array\r\n    * @param  {Array} obj1 Array to mingle\r\n    * @param  {Array} obj2 Array to mingle\r\n    * @return {Array}      2D Array\r\n    * @example\r\n    * let a = [\"a\", \"b\"],\r\n    *     b = [\"c\", \"d\"];\r\n    *\r\n    * keigai.util.array.mingle( a, b ); // [[\"a\", \"c\"], [\"b\", \"d\"]]\r\n    */\n\t\t\tmingle: function mingle(obj1, obj2) {\n\t\t\t\tvar result = obj1.map(function (i, idx) {\n\t\t\t\t\treturn [i, obj2[idx]];\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Finds the mode value of an Array\r\n    *\r\n    * @method mode\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to process\r\n    * @return {Mixed}     Mode value of the Array\r\n    * @example\r\n    * keigai.util.array.mode( [1, 3, 7, 1, 2, 10, 7, 7, 3, 10] );     // 7\r\n    * keigai.util.array.mode( [1, 3, 7, 1, 2, 10, 7, 7, 3, 10, 10] ); // [7, 10]\r\n    */\n\t\t\tmode: function mode(obj) {\n\t\t\t\tvar values = {};\n\t\t\t\tvar count = 0;\n\t\t\t\tvar mode = [];\n\t\t\t\tvar nth = undefined,\n\t\t\t\t    result = undefined;\n\n\t\t\t\t// Counting values\n\t\t\t\tarray.each(obj, function (i) {\n\t\t\t\t\tif (!isNaN(values[i])) {\n\t\t\t\t\t\tvalues[i]++;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalues[i] = 1;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Finding the highest occurring count\n\t\t\t\tcount = array.max(array.cast(values));\n\n\t\t\t\t// Finding values that match the count\n\t\t\t\tutility.iterate(values, function (v, k) {\n\t\t\t\t\tif (v === count) {\n\t\t\t\t\t\tmode.push(number.parse(k));\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Determining the result\n\t\t\t\tnth = mode.length;\n\n\t\t\t\tif (nth > 0) {\n\t\t\t\t\tresult = nth === 1 ? mode[0] : mode;\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Finds the range of the Array ( of numbers ) values\r\n    *\r\n    * @method range\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to process\r\n    * @return {Number}    Range of the array ( float or integer )\r\n    * @example\r\n    * keigai.util.array.range( [5, 1, 3, 8] ); // 7\r\n    */\n\t\t\trange: function range(obj) {\n\t\t\t\treturn array.max(obj) - array.min(obj);\n\t\t\t},\n\n\t\t\t/**\r\n    * Searches a 2D Array `obj` for the first match of `arg` as a second index\r\n    *\r\n    * @method rassoc\r\n    * @memberOf array\r\n    * @param  {Array} obj 2D Array to search\r\n    * @param  {Mixed} arg Primitive to find\r\n    * @return {Mixed}     Array or undefined\r\n    * @example\r\n    * keigai.util.array.rassoc( [[1, 3], [7, 2], [4, 3]], 3 ); // [1, 3]\r\n    */\n\t\t\trassoc: function rassoc(obj, arg) {\n\t\t\t\tvar result = undefined;\n\n\t\t\t\tarray.each(obj, function (i, idx) {\n\t\t\t\t\tif (i[1] === arg) {\n\t\t\t\t\t\tresult = utility.clone(obj[idx], true);\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Returns Array containing the items in `obj` for which `fn()` is not true\r\n    *\r\n    * @method reject\r\n    * @memberOf array\r\n    * @param  {Array}    obj Array to iterate\r\n    * @param  {Function} fn  Function to execute against `obj` indices\r\n    * @return {Array}        Array of indices which fn() is not true\r\n    * @example\r\n    * keigai.util.array.reject( [0, 1, 2, 3, 4, 5], function ( i ) { return i % 2 > 0; } ); // [0, 2, 4]\r\n    */\n\t\t\treject: function reject(obj, fn) {\n\t\t\t\treturn array.diff(obj, obj.filter(fn));\n\t\t\t},\n\n\t\t\t/**\r\n    * Removes indices from an Array without recreating it\r\n    *\r\n    * @method remove\r\n    * @memberOf array\r\n    * @param  {Array}  obj   Array to remove from\r\n    * @param  {Mixed}  start Starting index, or value to find within obj\r\n    * @param  {Number} end   [Optional] Ending index\r\n    * @return {Array}        Modified Array\r\n    * @example\r\n    * let myArray = [\"a\", \"b\", \"c\", \"d\", \"e\"];\r\n    *\r\n    * keigai.util.array.remove( myArray, 2, 3 );\r\n    * myArray[2]; // \"e\"\r\n    */\n\t\t\tremove: function remove(obj, start, end) {\n\t\t\t\tif (isNaN(start)) {\n\t\t\t\t\tstart = array.index(obj, start);\n\n\t\t\t\t\tif (start === -1) {\n\t\t\t\t\t\treturn obj;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tstart = start || 0;\n\t\t\t\t}\n\n\t\t\t\tvar length = obj.length;\n\t\t\t\tvar remaining = obj.slice((end || start) + 1 || length);\n\n\t\t\t\tobj.length = start < 0 ? length + start : start;\n\t\t\t\tobj.push.apply(obj, remaining);\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Deletes every element of `obj` for which `fn` evaluates to true\r\n    *\r\n    * @method removeIf\r\n    * @memberOf array\r\n    * @param  {Array}    obj Array to iterate\r\n    * @param  {Function} fn  Function to test indices against\r\n    * @return {Array}        Array\r\n    * @example\r\n    * let myArray = [\"a\", \"b\", \"c\"];\r\n    *\r\n    * keigai.util.array.removeIf( myArray, function ( i ) { return /a|c/.test( i ); } );\r\n    * myArray[0]; // \"b\"\r\n    */\n\t\t\tremoveIf: function removeIf(obj, fn) {\n\t\t\t\tvar remove = obj.filter(fn);\n\n\t\t\t\tarray.each(remove, function (i) {\n\t\t\t\t\tarray.remove(obj, array.index(obj, i));\n\t\t\t\t});\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Deletes elements of `obj` until `fn` evaluates to false\r\n    *\r\n    * @method removeWhile\r\n    * @memberOf array\r\n    * @param  {Array}    obj Array to iterate\r\n    * @param  {Function} fn  Function to test indices against\r\n    * @return {Array}        Array\r\n    * @example\r\n    * let myArray = [\"a\", \"b\", \"c\"];\r\n    *\r\n    * keigai.util.array.removeWhile( myArray, function ( i ) { return /a|c/.test( i ); } );\r\n    * myArray[0];     // \"b\"\r\n    * myArray.length; // 2\r\n    */\n\t\t\tremoveWhile: function removeWhile(obj, fn) {\n\t\t\t\tvar remove = [];\n\n\t\t\t\tarray.each(obj, function (i) {\n\t\t\t\t\tif (fn(i) !== false) {\n\t\t\t\t\t\tremove.push(i);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tarray.each(remove, function (i) {\n\t\t\t\t\tarray.remove(obj, array.index(obj, i));\n\t\t\t\t});\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Replaces the contents of `obj1` with `obj2`\r\n    *\r\n    * @method replace\r\n    * @memberOf array\r\n    * @param  {Array} obj1 Array to modify\r\n    * @param  {Array} obj2 Array to values to push into `obj1`\r\n    * @return {Array}      Array to modify\r\n    * @example\r\n    * let myArray = [\"a\", \"b\", \"c\"];\r\n    *\r\n    * keigai.util.array.replace( myArray, [true, false] );\r\n    * myArray[0];     // true\r\n    * myArray.length; // 2\r\n    */\n\t\t\treplace: function replace(obj1, obj2) {\n\t\t\t\tarray.remove(obj1, 0, obj1.length);\n\t\t\t\tarray.each(obj2, function (i) {\n\t\t\t\t\tobj1.push(i);\n\t\t\t\t});\n\n\t\t\t\treturn obj1;\n\t\t\t},\n\n\t\t\t/**\r\n    * Returns the \"rest\" of `obj` from `arg`\r\n    *\r\n    * @method rest\r\n    * @memberOf array\r\n    * @param  {Array}  obj Array to process\r\n    * @param  {Number} arg [Optional] Start position of subset of `obj` ( positive number only )\r\n    * @return {Array}      Array of a subset of `obj`\r\n    * @example\r\n    * keigai.util.array.rest( [1, 2, 3, 4, 5, 6] );    // [2, 3, 4, 5, 6]\r\n    * keigai.util.array.rest( [1, 2, 3, 4, 5, 6], 3 ); // [4, 5, 6]\r\n    */\n\t\t\trest: function rest(obj) {\n\t\t\t\tvar arg = arguments[1] === undefined ? 1 : arguments[1];\n\n\t\t\t\tif (arg < 1) {\n\t\t\t\t\targ = 1;\n\t\t\t\t}\n\n\t\t\t\treturn array.limit(obj, arg, obj.length);\n\t\t\t},\n\n\t\t\t/**\r\n    * Finds the last index of `arg` in `obj`\r\n    *\r\n    * @method rindex\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to search\r\n    * @param  {Mixed} arg Primitive to find\r\n    * @return {Mixed}     Index or undefined\r\n    * @example\r\n    * keigai.util.array.rindex( [1, 2, 3, 2, 1], 2 ); // 3\r\n    */\n\t\t\trindex: function rindex(obj, arg) {\n\t\t\t\tvar result = -1;\n\n\t\t\t\tarray.each(obj, function (i, idx) {\n\t\t\t\t\tif (i === arg) {\n\t\t\t\t\t\tresult = idx;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Returns new Array with `arg` moved to the first index\r\n    *\r\n    * @method rotate\r\n    * @memberOf array\r\n    * @param  {Array}  obj Array to rotate\r\n    * @param  {Number} arg Index to become the first index, if negative the rotation is in the opposite direction\r\n    * @return {Array}      Newly rotated Array\r\n    * @example\r\n    * keigai.util.array.rotate( [0, 1, 2, 3, 4],  3 )[0] // 2;\r\n    * keigai.util.array.rotate( [0, 1, 2, 3, 4], -2 )[0] // 3;\r\n    */\n\t\t\trotate: function rotate(obj, arg) {\n\t\t\t\tvar nth = obj.length;\n\t\t\t\tvar result = undefined;\n\n\t\t\t\tif (arg === 0) {\n\t\t\t\t\tresult = obj;\n\t\t\t\t} else {\n\t\t\t\t\tif (arg < 0) {\n\t\t\t\t\t\targ += nth;\n\t\t\t\t\t} else {\n\t\t\t\t\t\targ--;\n\t\t\t\t\t}\n\n\t\t\t\t\tresult = array.limit(obj, arg, nth);\n\t\t\t\t\tresult = result.concat(array.limit(obj, 0, arg));\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Generates a series Array\r\n    *\r\n    * @method series\r\n    * @memberOf array\r\n    * @param  {Number} start  Start value the series\r\n    * @param  {Number} end    [Optional] The end of the series\r\n    * @param  {Number} offset [Optional] Offset for indices, default is 1\r\n    * @return {Array}         Array of new series\r\n    * @example\r\n    * keigai.util.array.series( 0, 5 );     // [0, 1, 2, 3, 4]\r\n    * keigai.util.array.series( 0, 25, 5 ); // [0, 5, 10, 15, 20]\r\n    */\n\t\t\tseries: function series() {\n\t\t\t\tvar start = arguments[0] === undefined ? 0 : arguments[0];\n\t\t\t\tvar end = arguments[1] === undefined ? undefined : arguments[1];\n\t\t\t\tvar offset = arguments[2] === undefined ? 1 : arguments[2];\n\n\t\t\t\tend = end || start;\n\n\t\t\t\tvar result = [];\n\t\t\t\tvar n = -1;\n\t\t\t\tvar nth = Math.max(0, Math.ceil((end - start) / offset));\n\n\t\t\t\twhile (++n < nth) {\n\t\t\t\t\tresult[n] = start;\n\t\t\t\t\tstart += offset;\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Sorts the Array by parsing values\r\n    *\r\n    * @method sort\r\n    * @memberOf array\r\n    * @param  {Mixed} a Argument to compare\r\n    * @param  {Mixed} b Argument to compare\r\n    * @return {Number}  Number indicating sort order\r\n    * @example\r\n    * keigai.util.array.sort( 2, 3 ); // -1\r\n    */\n\t\t\tsort: function sort(a, b) {\n\t\t\t\tvar types = { a: typeof a, b: typeof b };\n\t\t\t\tvar c = undefined,\n\t\t\t\t    d = undefined,\n\t\t\t\t    result = undefined;\n\n\t\t\t\tif (types.a === \"number\" && types.b === \"number\") {\n\t\t\t\t\tresult = a - b;\n\t\t\t\t} else {\n\t\t\t\t\tc = a.toString();\n\t\t\t\t\td = b.toString();\n\n\t\t\t\t\tif (c < d) {\n\t\t\t\t\t\tresult = -1;\n\t\t\t\t\t} else if (c > d) {\n\t\t\t\t\t\tresult = 1;\n\t\t\t\t\t} else if (types.a === types.b) {\n\t\t\t\t\t\tresult = 0;\n\t\t\t\t\t} else if (types.a === \"boolean\") {\n\t\t\t\t\t\tresult = -1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult = 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Sorts `obj` using `array.sort`\r\n    *\r\n    * @method sorted\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to sort\r\n    * @return {Array}     Sorted Array\r\n    * @example\r\n    * let myArray = [5, 9, 2, 4];\r\n    *\r\n    * keigai.util.array.sorted( myArray );\r\n    * myArray[0]; // 2\r\n    */\n\t\t\tsorted: function sorted(obj) {\n\t\t\t\treturn obj.sort(array.sort);\n\t\t\t},\n\n\t\t\t/**\r\n    * Splits an Array by divisor\r\n    *\r\n    * @method split\r\n    * @memberOf array\r\n    * @param  {Array}  obj     Array to process\r\n    * @param  {Number} divisor Integer to divide the Array by\r\n    * @return {Array}          Split Array\r\n    * @example\r\n    * let myArray = [],\r\n    *     i       = -1,\r\n    *     results;\r\n    *\r\n    * while ( ++i < 100 ) {\r\n   \t *   myArray.push( i + 1 );\r\n   \t * }\r\n    *\r\n    * results = keigai.util.array.split( myArray, 21 );\r\n    * results.length;     // 21\r\n    * results[0].length;  // 5\r\n    * results[19].length; // 4\r\n    * results[19][0];     // 99\r\n    * results[20].length; // 1\r\n    * results[20][0];     // 100\r\n    */\n\t\t\tsplit: function split(obj, divisor) {\n\t\t\t\tvar result = [];\n\t\t\t\tvar total = obj.length;\n\t\t\t\tvar nth = Math.ceil(total / divisor);\n\t\t\t\tvar low = Math.floor(total / divisor);\n\t\t\t\tvar lower = Math.ceil(total / nth);\n\t\t\t\tvar lowered = false;\n\t\t\t\tvar start = 0;\n\t\t\t\tvar i = -1;\n\n\t\t\t\t// Finding the fold\n\t\t\t\tif (number.diff(total, divisor * nth) > nth) {\n\t\t\t\t\tlower = total - low * divisor + low - 1;\n\t\t\t\t} else if (total % divisor > 0 && lower * nth >= total) {\n\t\t\t\t\tlower--;\n\t\t\t\t}\n\n\t\t\t\twhile (++i < divisor) {\n\t\t\t\t\tif (i > 0) {\n\t\t\t\t\t\tstart = start + nth;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!lowered && lower < divisor && i === lower) {\n\t\t\t\t\t\t--nth;\n\t\t\t\t\t\tlowered = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tresult.push(array.limit(obj, start, nth));\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Finds the standard deviation of an Array ( of numbers )\r\n    *\r\n    * @method stddev\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to process\r\n    * @return {Number}    Standard deviation of the Array ( float or integer )\r\n    * @example\r\n    * keigai.util.array.stddev( [1, 3, 5] ); // 1.632993161855452\r\n    */\n\t\t\tstddev: function stddev(obj) {\n\t\t\t\treturn Math.sqrt(array.variance(obj));\n\t\t\t},\n\n\t\t\t/**\r\n    * Gets the summation of an Array of numbers\r\n    *\r\n    * @method sum\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to sum\r\n    * @return {Number}    Summation of Array\r\n    * @example\r\n    * keigai.util.array.sum( [2, 4, 3, 1] ); // 10\r\n    */\n\t\t\tsum: function sum(obj) {\n\t\t\t\tvar result = 0;\n\n\t\t\t\tif (obj.length > 0) {\n\t\t\t\t\tresult = obj.reduce(function (prev, cur) {\n\t\t\t\t\t\treturn prev + cur;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Takes the first `n` indices from `obj`\r\n    *\r\n    * @method take\r\n    * @memberOf array\r\n    * @param  {Array}  obj Array to process\r\n    * @param  {Number} n   Offset from 0 to return\r\n    * @return {Array}      Subset of `obj`\r\n    * @example\r\n    * keigai.util.array.take( [1, 2, 3, 4], 2 ); // [1, 2]\r\n    */\n\t\t\ttake: function take(obj, n) {\n\t\t\t\treturn array.limit(obj, 0, n);\n\t\t\t},\n\n\t\t\t/**\r\n    * Casts an Array to Object\r\n    *\r\n    * @method toObject\r\n    * @memberOf array\r\n    * @param  {Array} ar Array to transform\r\n    * @return {Object}   New object\r\n    * @example\r\n    * keigai.util.array.toObject( [\"abc\", \"def\"] ); // {0: \"abc\", 1: \"def\"}\r\n    */\n\t\t\ttoObject: function toObject(ar) {\n\t\t\t\tvar obj = {};\n\t\t\t\tvar i = ar.length;\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tobj[i.toString()] = ar[i];\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Gets the total keys in an Array\r\n    *\r\n    * @method total\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to find the length of\r\n    * @return {Number}    Number of keys in Array\r\n    * @example\r\n    * let myArray = [true, true, false];\r\n    *\r\n    * myArray.extra = true;\r\n    * keigai.util.array.total( myArray ); // 4\r\n    */\n\t\t\ttotal: function total(obj) {\n\t\t\t\treturn array.indexed(obj).length;\n\t\t\t},\n\n\t\t\t/**\r\n    * Returns an Array of unique indices of `obj`\r\n    *\r\n    * @method unique\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to process\r\n    * @return {Array}     Array of unique indices\r\n    * @example\r\n    * keigai.util.array.unique( [\"a\", \"b\", \"a\", \"c\", \"b\", \"d\"] ); // [\"a\", \"b\", \"c\", \"d\"]\r\n    */\n\t\t\tunique: function unique(obj) {\n\t\t\t\tvar result = [];\n\n\t\t\t\tarray.each(obj, function (i) {\n\t\t\t\t\tarray.add(result, i);\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Finds the variance of an Array ( of numbers )\r\n    *\r\n    * @method variance\r\n    * @memberOf array\r\n    * @param  {Array} obj Array to process\r\n    * @return {Number}    Variance of the Array ( float or integer )\r\n    * @example\r\n    * keigai.util.array.variance( [1, 3, 5] ); // 2.6666666666666665\r\n    */\n\t\t\tvariance: function variance(obj) {\n\t\t\t\tvar nth = obj.length;\n\t\t\t\tvar n = 0;\n\t\t\t\tvar mean = undefined;\n\n\t\t\t\tif (nth > 0) {\n\t\t\t\t\tmean = array.mean(obj);\n\n\t\t\t\t\tarray.each(obj, function (i) {\n\t\t\t\t\t\tn += math.sqr(i - mean);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn n / nth;\n\t\t\t\t} else {\n\t\t\t\t\treturn n;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\r\n    * Converts any arguments to Arrays, then merges elements of `obj` with corresponding elements from each argument\r\n    *\r\n    * @method zip\r\n    * @memberOf array\r\n    * @param  {Array} obj  Array to transform\r\n    * @param  {Mixed} args Argument instance or Array to merge\r\n    * @return {Array}      Array\r\n    * @example\r\n    * keigai.util.array.zip( [0, 1], 1 ); // [[0, 1], [1, null]]\r\n    */\n\t\t\tzip: function zip(obj, args) {\n\t\t\t\tvar result = [];\n\n\t\t\t\t// Preparing args\n\t\t\t\tif (!(args instanceof Array)) {\n\t\t\t\t\targs = typeof args === \"object\" ? array.cast(args) : [args];\n\t\t\t\t}\n\n\t\t\t\tarray.each(args, function (i, idx) {\n\t\t\t\t\tif (!(i instanceof Array)) {\n\t\t\t\t\t\targs[idx] = [i];\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Building result Array\n\t\t\t\tarray.each(obj, function (i, idx) {\n\t\t\t\t\tresult[idx] = [i];\n\t\t\t\t\tarray.each(args, function (x) {\n\t\t\t\t\t\tresult[idx].push(x[idx] || null);\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t}\n\t\t};\n\n\t\t/**\r\n   * @namespace cache\r\n   * @private\r\n   */\n\t\tvar cache = {\n\t\t\t/**\r\n    * Collection URIs\r\n    *\r\n    * @memberOf cache\r\n    * @type {Object}\r\n    */\n\t\t\tlru: lru.factory(CACHE),\n\n\t\t\t/**\r\n    * Expires a URI from the local cache\r\n    *\r\n    * @method expire\r\n    * @memberOf cache\r\n    * @param  {String} uri URI of the local representation\r\n    * @return {Boolean} `true` if successful\r\n    */\n\t\t\texpire: function expire(uri) {\n\t\t\t\tif (cache.lru.cache[uri]) {\n\t\t\t\t\tcache.lru.remove(uri);\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\n\t\t\t/**\r\n    * Determines if a URI has expired\r\n    *\r\n    * @method expired\r\n    * @memberOf cache\r\n    * @param  {Object} uri Cached URI object\r\n    * @return {Boolean}    True if the URI has expired\r\n    */\n\t\t\texpired: function expired(uri) {\n\t\t\t\tvar item = cache.lru.cache[uri];\n\n\t\t\t\treturn item && item.value.expires < new Date().getTime();\n\t\t\t},\n\n\t\t\t/**\r\n    * Returns the cached object {headers, response} of the URI or false\r\n    *\r\n    * @method get\r\n    * @memberOf cache\r\n    * @param  {String}  uri     URI/Identifier for the resource to retrieve from cache\r\n    * @param  {Boolean} expire  [Optional] If 'false' the URI will not expire\r\n    * @param  {Object}  headers [Optional] Request headers\r\n    * @return {Mixed}           URI Object {headers, response} or False\r\n    */\n\t\t\tget: function get(uri, expire, headers) {\n\t\t\t\turi = utility.parse(uri).href;\n\t\t\t\tvar item = cache.lru.get(uri);\n\n\t\t\t\tif (!item) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (expire !== false && cache.expired(uri) || !utility.equal(item.request_headers, headers)) {\n\t\t\t\t\tcache.expire(uri);\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn utility.clone(item, true);\n\t\t\t},\n\n\t\t\t/**\r\n    * Sets, or updates an item in cache.items\r\n    *\r\n    * @method set\r\n    * @memberOf cache\r\n    * @param  {String} uri      URI to set or update\r\n    * @param  {String} property Property of the cached URI to set\r\n    * @param  {Mixed} value     Value to set\r\n    * @return {Mixed}           URI Object {headers, response} or undefined\r\n    */\n\t\t\tset: function set(uri, property, value) {\n\t\t\t\turi = utility.parse(uri).href;\n\t\t\t\tvar item = cache.lru.get(uri);\n\n\t\t\t\tif (!item) {\n\t\t\t\t\titem = {\n\t\t\t\t\t\tpermission: 0\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (property === \"permission\") {\n\t\t\t\t\titem.permission |= value;\n\t\t\t\t} else if (property === \"!permission\") {\n\t\t\t\t\titem.permission &= ~value;\n\t\t\t\t} else {\n\t\t\t\t\titem[property] = value;\n\t\t\t\t}\n\n\t\t\t\tcache.lru.set(uri, item);\n\n\t\t\t\treturn item;\n\t\t\t}\n\t\t};\n\n\t\t/**\r\n   * Custom Object returned from `client.request()`\r\n   *\r\n   * @constructor\r\n   * @memberOf keigai\r\n   * @extends {keigai.Base}\r\n   * @param {Object} xhr XMLHttpRequest\r\n   */\n\n\t\tvar KXMLHttpRequest = (function (_Base) {\n\t\t\tfunction KXMLHttpRequest(xhr) {\n\t\t\t\tvar _this4 = this;\n\n\t\t\t\t_classCallCheck(this, KXMLHttpRequest);\n\n\t\t\t\t_get(Object.getPrototypeOf(KXMLHttpRequest.prototype), \"constructor\", this).call(this);\n\n\t\t\t\tthis.observer = observable();\n\t\t\t\tthis.defer = deferred();\n\t\t\t\tthis.xhr = xhr;\n\n\t\t\t\t// Hooking observer for standard events\n\t\t\t\tarray.each(EVENTS, function (i) {\n\t\t\t\t\t_this4.hook(_this4.xhr, i);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t_inherits(KXMLHttpRequest, _Base);\n\n\t\t\t_createClass(KXMLHttpRequest, [{\n\t\t\t\tkey: \"always\",\n\t\t\t\tvalue: function always(arg) {\n\t\t\t\t\treturn this.defer.always.call(this.defer, arg);\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"done\",\n\t\t\t\tvalue: function done(arg) {\n\t\t\t\t\treturn this.defer.done.call(this.defer, arg);\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"fail\",\n\t\t\t\tvalue: function fail(arg) {\n\t\t\t\t\treturn this.defer.fail.call(this.defer, arg);\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"reject\",\n\t\t\t\tvalue: function reject(arg) {\n\t\t\t\t\treturn this.defer.reject.call(this.defer, arg);\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"resolve\",\n\t\t\t\tvalue: function resolve(arg) {\n\t\t\t\t\treturn this.defer.resolve.call(this.defer, arg);\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"then\",\n\t\t\t\tvalue: function then(success, failure) {\n\t\t\t\t\treturn this.defer.then.call(this.defer, success, failure);\n\t\t\t\t}\n\t\t\t}]);\n\n\t\t\treturn KXMLHttpRequest;\n\t\t})(Base);\n\n\t\t/**\r\n   * @namespace client\r\n   */\n\t\tvar client = {\n\t\t\t/**\r\n    * Array Buffer is available\r\n    *\r\n    * @memberOf client\r\n    * @type {Boolean}\r\n    * @private\r\n    */\n\t\t\tab: typeof ArrayBuffer !== \"undefined\",\n\n\t\t\t/**\r\n    * Blob is available\r\n    *\r\n    * @memberOf client\r\n    * @type {Boolean}\r\n    * @private\r\n    */\n\t\t\tblob: typeof Blob !== \"undefined\",\n\n\t\t\t/**\r\n    * Document is available\r\n    *\r\n    * @memberOf client\r\n    * @type {Boolean}\r\n    * @private\r\n    */\n\t\t\tdoc: typeof Document !== \"undefined\",\n\n\t\t\t/**\r\n    * Internet Explorer browser\r\n    *\r\n    * @memberOf client\r\n    * @type {Boolean}\r\n    * @private\r\n    */\n\t\t\tie: !server && regex.ie.test(navigator.userAgent),\n\n\t\t\t/**\r\n    * Client version\r\n    *\r\n    * @memberOf client\r\n    * @type {Number}\r\n    * @private\r\n    */\n\t\t\tversion: function version() {\n\t\t\t\tvar result = 0;\n\n\t\t\t\tif (client.ie) {\n\t\t\t\t\tresult = number.parse(string.trim(navigator.userAgent.replace(/( .*msie|;.*)/gi, \"\")) || 9, 10);\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Quick way to see if a URI allows a specific verb\r\n    *\r\n    * @method allows\r\n    * @memberOf client\r\n    * @param  {String} uri     URI to query\r\n    * @param  {String} verb    HTTP verb\r\n    * @param  {Object} headers [Optional] Request headers\r\n    * @return {Boolean}        `true` if the verb is allowed, undefined if unknown\r\n    * @private\r\n    */\n\t\t\tallows: function allows(uri, verb, headers) {\n\t\t\t\turi = utility.parse(uri).href;\n\t\t\t\tverb = verb.toLowerCase();\n\n\t\t\t\tvar result = false;\n\t\t\t\tvar bit = 0;\n\n\t\t\t\tif (!cache.get(uri, false, headers)) {\n\t\t\t\t\tresult = undefined;\n\t\t\t\t} else {\n\t\t\t\t\tif (regex.del.test(verb)) {\n\t\t\t\t\t\tbit = 1;\n\t\t\t\t\t} else if (regex.get_headers.test(verb)) {\n\t\t\t\t\t\tbit = 4;\n\t\t\t\t\t} else if (regex.put_post.test(verb)) {\n\t\t\t\t\t\tbit = 2;\n\t\t\t\t\t} else if (regex.patch.test(verb)) {\n\t\t\t\t\t\tbit = 8;\n\t\t\t\t\t}\n\n\t\t\t\t\tresult = Boolean(client.permissions(uri, headers).bit & bit);\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Gets bit value based on args\r\n    *\r\n    * @method bit\r\n    * @memberOf client\r\n    * @param  {Array} args Array of commands the URI accepts\r\n    * @return {Number} To be set as a bit\r\n    * @private\r\n    */\n\t\t\tbit: function bit(args) {\n\t\t\t\tvar result = 0;\n\n\t\t\t\tarray.each(args, function (verb) {\n\t\t\t\t\tverb = verb.toLowerCase();\n\n\t\t\t\t\tif (regex.get_headers.test(verb)) {\n\t\t\t\t\t\tresult |= 4;\n\t\t\t\t\t} else if (regex.put_post.test(verb)) {\n\t\t\t\t\t\tresult |= 2;\n\t\t\t\t\t} else if (regex.patch.test(verb)) {\n\t\t\t\t\t\tresult |= 8;\n\t\t\t\t\t} else if (regex.del.test(verb)) {\n\t\t\t\t\t\tresult |= 1;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Determines if a URI is a CORS end point\r\n    *\r\n    * @method cors\r\n    * @memberOf client\r\n    * @param  {String} uri  URI to parse\r\n    * @return {Boolean}     True if CORS\r\n    * @private\r\n    */\n\t\t\tcors: function cors(uri) {\n\t\t\t\treturn !server && uri.indexOf(\"//\") > -1 && uri.indexOf(\"//\" + location.host) === -1;\n\t\t\t},\n\n\t\t\t/**\r\n    * Caches the headers from the XHR response\r\n    *\r\n    * @method headers\r\n    * @memberOf client\r\n    * @param  {Object} xhr             XMLHttpRequest Object\r\n    * @param  {String} uri             URI to request\r\n    * @param  {String} type            Type of request\r\n    * @param  {Object} request_headers Request headers\r\n    * @return {Object}                 Cached URI representation\r\n    * @private\r\n    */\n\t\t\theaders: function headers(xhr, uri, type, request_headers) {\n\t\t\t\tvar headers = string.trim(xhr.getAllResponseHeaders()).split(\"\\n\");\n\t\t\t\tvar items = {};\n\t\t\t\tvar o = {};\n\t\t\t\tvar allow = null;\n\t\t\t\tvar expires = new Date();\n\t\t\t\tvar cors = client.cors(uri);\n\t\t\t\tvar cachable = true;\n\n\t\t\t\tarray.each(headers, function (i) {\n\t\t\t\t\tvar header = i.split(\": \");\n\n\t\t\t\t\titems[header[0].toLowerCase()] = string.trim(header[1]);\n\n\t\t\t\t\tif (allow === null) {\n\t\t\t\t\t\tif (!cors && regex.allow.test(header[0]) || cors && regex.allow_cors.test(header[0])) {\n\t\t\t\t\t\t\tallow = header[1];\n\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (regex.no.test(items[\"cache-control\"])) {\n\t\t\t\t\texpires = expires.getTime();\n\t\t\t\t} else if (items[\"cache-control\"] && regex.number_present.test(items[\"cache-control\"])) {\n\t\t\t\t\texpires = expires.setSeconds(expires.getSeconds() + number.parse(regex.number_present.exec(items[\"cache-control\"])[0], 10));\n\t\t\t\t} else if (items.expires) {\n\t\t\t\t\texpires = new Date(items.expires).getTime();\n\t\t\t\t} else {\n\t\t\t\t\tcachable = false;\n\t\t\t\t\texpires = expires.getTime();\n\t\t\t\t}\n\n\t\t\t\to.cachable = cachable;\n\t\t\t\to.expires = expires;\n\t\t\t\to.headers = items;\n\t\t\t\to.timestamp = new Date();\n\t\t\t\to.permission = client.bit(allow !== null ? string.explode(allow) : [type]);\n\n\t\t\t\tif (type === \"get\" && cachable) {\n\t\t\t\t\tcache.set(uri, \"expires\", o.expires);\n\t\t\t\t\tcache.set(uri, \"headers\", o.headers);\n\t\t\t\t\tcache.set(uri, \"timestamp\", o.timestamp);\n\t\t\t\t\tcache.set(uri, \"permission\", o.permission);\n\t\t\t\t\tcache.set(uri, \"request_headers\", request_headers);\n\t\t\t\t}\n\n\t\t\t\treturn o;\n\t\t\t},\n\n\t\t\t/**\r\n    * Parses an XHR response\r\n    *\r\n    * @method parse\r\n    * @memberOf client\r\n    * @param  {Object} xhr  XHR Object\r\n    * @param  {String} type [Optional] content-type header value\r\n    * @return {Mixed}       Array, Boolean, Document, Number, Object or String\r\n    * @private\r\n    */\n\t\t\tparse: function parse(xhr) {\n\t\t\t\tvar type = arguments[1] === undefined ? \"\" : arguments[1];\n\n\t\t\t\tvar result = undefined,\n\t\t\t\t    obj = undefined;\n\n\t\t\t\tif ((regex.json_maybe.test(type) || string.isEmpty(type)) && (regex.json_wrap.test(xhr.responseText) && Boolean(obj = json.decode(xhr.responseText, true)))) {\n\t\t\t\t\tresult = obj;\n\t\t\t\t} else if (type === \"text/csv\") {\n\t\t\t\t\tresult = csv.decode(xhr.responseText);\n\t\t\t\t} else if (type === \"text/tsv\") {\n\t\t\t\t\tresult = csv.decode(xhr.responseText, \"\\t\");\n\t\t\t\t} else if (regex.xml.test(type)) {\n\t\t\t\t\tif (type !== \"text/xml\") {\n\t\t\t\t\t\txhr.overrideMimeType(\"text/xml\");\n\t\t\t\t\t}\n\n\t\t\t\t\tresult = xhr.responseXML;\n\t\t\t\t} else if (type === \"text/plain\" && regex.is_xml.test(xhr.responseText) && xml.valid(xhr.responseText)) {\n\t\t\t\t\tresult = xml.decode(xhr.responseText);\n\t\t\t\t} else {\n\t\t\t\t\tresult = xhr.responseText;\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Returns the permission of the cached URI\r\n    *\r\n    * @method permissions\r\n    * @memberOf client\r\n    * @param  {String} uri     URI to query\r\n    * @param  {Object} headers [Optional] Request headers\r\n    * @return {Object}         Contains an Array of available commands, the permission bit and a map\r\n    * @private\r\n    */\n\t\t\tpermissions: function permissions(uri, headers) {\n\t\t\t\tvar cached = cache.get(uri, false, headers);\n\t\t\t\tvar bit = !cached ? 0 : cached.permission;\n\t\t\t\tvar result = { allows: [], bit: bit, map: { partial: 8, read: 4, write: 2, \"delete\": 1, unknown: 0 } };\n\n\t\t\t\tif (bit & 1) {\n\t\t\t\t\tresult.allows.push(\"DELETE\");\n\t\t\t\t}\n\n\t\t\t\tif (bit & 2) {\n\t\t\t\t\tresult.allows.push(\"POST\");\n\t\t\t\t\tresult.allows.push(\"PUT\");\n\t\t\t\t}\n\n\t\t\t\tif (bit & 4) {\n\t\t\t\t\tresult.allows.push(\"GET\");\n\t\t\t\t}\n\n\t\t\t\tif (bit & 8) {\n\t\t\t\t\tresult.allows.push(\"PATCH\");\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Creates a JSONP request\r\n    *\r\n    * @method jsonp\r\n    * @memberOf client\r\n    * @param  {String} uri  URI to request\r\n    * @param  {Mixed}  args Custom JSONP handler parameter name, default is \"callback\"; or custom headers for GET request ( CORS )\r\n    * @return {Object} {@link keigai.Deferred}\r\n    * @example\r\n    * keigai.util.jsonp( \"http://somedomain.com/resource?callback=\", function ( arg ) {\r\n    *   // `arg` is the coerced response body\r\n    * }, function ( err ) {\r\n    *   // Handle `err`\r\n    * } );\r\n    */\n\t\t\tjsonp: function jsonp(uri, args) {\n\t\t\t\tvar defer = deferred();\n\t\t\t\tvar callback = \"callback\";\n\t\t\t\tvar cbid = undefined,\n\t\t\t\t    s = undefined;\n\n\t\t\t\tif (external === undefined) {\n\t\t\t\t\tif (!global.keigai) {\n\t\t\t\t\t\tglobal.keigai = { callback: {} };\n\t\t\t\t\t}\n\n\t\t\t\t\texternal = \"keigai\";\n\t\t\t\t}\n\n\t\t\t\tif (args instanceof Object && !args.callback) {\n\t\t\t\t\tcallback = args.callback;\n\t\t\t\t}\n\n\t\t\t\tdo {\n\t\t\t\t\tcbid = utility.genId().slice(0, 10);\n\t\t\t\t} while (global.callback[cbid]);\n\n\t\t\t\turi = uri.replace(callback + \"=?\", callback + \"=\" + external + \".callback.\" + cbid);\n\n\t\t\t\tglobal.callback[cbid] = function (arg) {\n\t\t\t\t\tutility.clearTimers(cbid);\n\t\t\t\t\tdelete global.callback[cbid];\n\t\t\t\t\tdefer.resolve(arg);\n\t\t\t\t\telement.destroy(s);\n\t\t\t\t};\n\n\t\t\t\ts = element.create(\"script\", { src: uri, type: \"text/javascript\" }, utility.dom(\"head\")[0]);\n\n\t\t\t\tutility.defer(function () {\n\t\t\t\t\tutility.clearTimers(cbid);\n\t\t\t\t\tdelete global.callback[cbid];\n\t\t\t\t\tdefer.reject(new Error(label.requestTimeout));\n\t\t\t\t}, 30000, cbid);\n\n\t\t\t\treturn defer;\n\t\t\t},\n\n\t\t\t/**\r\n    * KXMLHttpRequest factory\r\n    *\r\n    * @method kxhr\r\n    * @memberOf client\r\n    * @param {Object} xhr XMLHttpRequest\r\n    * @return {Object} {@link keigai.KXMLHttpRequest}\r\n    * @private\r\n    */\n\t\t\tkxhr: function kxhr(xhr) {\n\t\t\t\treturn new KXMLHttpRequest(xhr);\n\t\t\t},\n\n\t\t\t/**\r\n    * Creates an XmlHttpRequest to a URI ( aliased to multiple methods )\r\n    *\r\n    * The returned Deferred will have an .xhr\r\n    *\r\n    * @method request\r\n    * @memberOf client\r\n    * @param  {String}   uri     URI to query\r\n    * @param  {String}   type    [Optional] Type of request ( DELETE/GET/POST/PUT/PATCH/HEAD/OPTIONS ), default is `GET`\r\n    * @param  {Mixed}    args    [Optional] Data to send with the request\r\n    * @param  {Object}   headers [Optional] Custom request headers ( can be used to set withCredentials )\r\n    * @return {Object}   {@link keigai.KXMLHttpRequest}\r\n    * @example\r\n    * keigai.util.request( \"http://keigai.io\" ).then( function ( arg ) {\r\n    *   // `arg` is the coerced response body\r\n    * }, function ( err ) {\r\n    *   // Handle `err`\r\n    * } );\r\n    */\n\t\t\trequest: function request(uri) {\n\t\t\t\tvar type = arguments[1] === undefined ? \"GET\" : arguments[1];\n\t\t\t\tvar args = arguments[2] === undefined ? undefined : arguments[2];\n\t\t\t\tvar headers = arguments[3] === undefined ? undefined : arguments[3];\n\n\t\t\t\turi = utility.parse(uri).href;\n\t\t\t\ttype = type.toLowerCase();\n\t\t\t\theaders = headers instanceof Object ? headers : null;\n\n\t\t\t\tvar cors = client.cors(uri);\n\t\t\t\tvar kxhr = client.kxhr(!client.ie || (!cors || client.version > 9) ? new XMLHttpRequest() : new XDomainRequest());\n\t\t\t\tvar payload = (regex.put_post.test(type) || regex.patch.test(type)) && args ? args : null;\n\t\t\t\tvar cached = type === \"get\" ? cache.get(uri, false, headers) : false;\n\t\t\t\tvar contentType = null;\n\t\t\t\tvar doc = client.doc;\n\t\t\t\tvar ab = client.ab;\n\t\t\t\tvar blob = client.blob;\n\n\t\t\t\t// Only GET & POST is supported by XDomainRequest (so useless!)\n\t\t\t\tif (client.ie && client.version === 9 && cors && !regex.xdomainrequest.test(type)) {\n\t\t\t\t\tthrow new Error(label.notAvailable);\n\t\t\t\t}\n\n\t\t\t\t// Hooking custom events\n\t\t\t\tkxhr.on(\"readystatechange\", function (ev) {\n\t\t\t\t\tvar state = kxhr.xhr.readyState;\n\n\t\t\t\t\tif (state === 1) {\n\t\t\t\t\t\tkxhr.dispatch(\"beforeXHR\", kxhr.xhr, ev);\n\t\t\t\t\t} else if (state === 4) {\n\t\t\t\t\t\tkxhr.dispatch(\"afterXHR\", kxhr.xhr, ev);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (client.allows(uri, type, headers) === false) {\n\t\t\t\t\tkxhr.dispatch(\"beforeXHR\", kxhr.xhr, null);\n\t\t\t\t\tkxhr.xhr.status = 405;\n\t\t\t\t\tkxhr.reject(new Error(label.methodNotAllowed));\n\t\t\t\t\tutility.delay(function () {\n\t\t\t\t\t\tkxhr.dispatch(\"afterXHR\", kxhr.xhr, null);\n\t\t\t\t\t});\n\t\t\t\t} else if (type === \"get\" && Boolean(cached)) {\n\t\t\t\t\t// Decorating XHR for proxy behavior\n\t\t\t\t\tif (server) {\n\t\t\t\t\t\tkxhr.xhr.readyState = 4;\n\t\t\t\t\t\tkxhr.xhr.status = 200;\n\t\t\t\t\t\tkxhr.xhr._resheaders = cached.headers;\n\t\t\t\t\t}\n\n\t\t\t\t\tkxhr.dispatch(\"beforeXHR\", kxhr.xhr, null);\n\t\t\t\t\tkxhr.resolve(cached.response);\n\t\t\t\t\tutility.delay(function () {\n\t\t\t\t\t\tkxhr.dispatch(\"afterXHR\", kxhr.xhr, null);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tutility.delay(function () {\n\t\t\t\t\t\tkxhr.xhr.open(type.toUpperCase(), uri, true);\n\n\t\t\t\t\t\t// Setting content-type value\n\t\t\t\t\t\tif (headers !== null && headers.hasOwnProperty(\"content-type\")) {\n\t\t\t\t\t\t\tcontentType = headers[\"content-type\"];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (cors && contentType === null) {\n\t\t\t\t\t\t\tcontentType = \"text/plain\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Transforming payload\n\t\t\t\t\t\tif (payload !== null) {\n\t\t\t\t\t\t\tif (payload.hasOwnProperty(\"xml\")) {\n\t\t\t\t\t\t\t\tpayload = payload.xml;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (doc && payload instanceof Document) {\n\t\t\t\t\t\t\t\tpayload = xml.decode(payload);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (typeof payload === \"string\" && regex.is_xml.test(payload)) {\n\t\t\t\t\t\t\t\tcontentType = \"application/xml\";\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!(ab && payload instanceof ArrayBuffer) && !(blob && payload instanceof Blob) && !(payload instanceof Buffer) && payload instanceof Object) {\n\t\t\t\t\t\t\t\tcontentType = \"application/json\";\n\t\t\t\t\t\t\t\tpayload = json.encode(payload);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (contentType === null && (ab && payload instanceof ArrayBuffer || blob && payload instanceof Blob)) {\n\t\t\t\t\t\t\t\tcontentType = \"application/octet-stream\";\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (contentType === null) {\n\t\t\t\t\t\t\t\tcontentType = \"application/x-www-form-urlencoded; charset=UTF-8\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Setting headers for everything except IE9 CORS requests\n\t\t\t\t\t\tif (!client.ie || (!cors || client.version > 9)) {\n\t\t\t\t\t\t\tif (headers === null) {\n\t\t\t\t\t\t\t\theaders = {};\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (typeof cached === \"object\" && cached.headers.hasOwnProperty(\"etag\")) {\n\t\t\t\t\t\t\t\theaders.etag = cached.headers.etag;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (contentType !== null) {\n\t\t\t\t\t\t\t\theaders[\"content-type\"] = contentType;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (headers.hasOwnProperty(\"callback\")) {\n\t\t\t\t\t\t\t\tdelete headers.callback;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\theaders[\"x-requested-with\"] = \"XMLHttpRequest\";\n\n\t\t\t\t\t\t\tutility.iterate(headers, function (v, k) {\n\t\t\t\t\t\t\t\tif (v !== null && k !== \"withCredentials\") {\n\t\t\t\t\t\t\t\t\tkxhr.xhr.setRequestHeader(k, v);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// Cross Origin Resource Sharing ( CORS )\n\t\t\t\t\t\t\tif (typeof kxhr.xhr.withCredentials === \"boolean\" && headers !== null && typeof headers.withCredentials === \"boolean\") {\n\t\t\t\t\t\t\t\tkxhr.xhr.withCredentials = headers.withCredentials;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tkxhr.on(\"load\", function () {\n\t\t\t\t\t\t\tvar xdr = client.ie && kxhr.xhr.readyState === undefined;\n\t\t\t\t\t\t\tvar shared = true;\n\t\t\t\t\t\t\tvar o = undefined,\n\t\t\t\t\t\t\t    r = undefined,\n\t\t\t\t\t\t\t    t = undefined,\n\t\t\t\t\t\t\t    redirect = undefined;\n\n\t\t\t\t\t\t\tif (!xdr && kxhr.xhr.readyState === 4) {\n\t\t\t\t\t\t\t\tswitch (kxhr.xhr.status) {\n\t\t\t\t\t\t\t\t\tcase 200:\n\t\t\t\t\t\t\t\t\tcase 201:\n\t\t\t\t\t\t\t\t\tcase 202:\n\t\t\t\t\t\t\t\t\tcase 203:\n\t\t\t\t\t\t\t\t\tcase 204:\n\t\t\t\t\t\t\t\t\tcase 205:\n\t\t\t\t\t\t\t\t\tcase 206:\n\t\t\t\t\t\t\t\t\t\to = client.headers(kxhr.xhr, uri, type, headers);\n\n\t\t\t\t\t\t\t\t\t\tif (type === \"head\") {\n\t\t\t\t\t\t\t\t\t\t\treturn kxhr.resolve(o.headers);\n\t\t\t\t\t\t\t\t\t\t} else if (type === \"options\") {\n\t\t\t\t\t\t\t\t\t\t\treturn kxhr.resolve(o.headers);\n\t\t\t\t\t\t\t\t\t\t} else if (type !== \"delete\") {\n\t\t\t\t\t\t\t\t\t\t\tif (server && regex.priv.test(o.headers[\"cache-control\"])) {\n\t\t\t\t\t\t\t\t\t\t\t\tshared = false;\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tif (regex.http_body.test(kxhr.xhr.status)) {\n\t\t\t\t\t\t\t\t\t\t\t\tt = o.headers[\"content-type\"] || \"\";\n\t\t\t\t\t\t\t\t\t\t\t\tr = client.parse(kxhr.xhr, t);\n\n\t\t\t\t\t\t\t\t\t\t\t\tif (r === undefined) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tkxhr.reject(new Error(label.serverError));\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tif (type === \"get\" && shared && o.cachable) {\n\t\t\t\t\t\t\t\t\t\t\t\tcache.set(uri, \"response\", o.response = utility.clone(r, true));\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tcache.expire(uri, true);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else if (type === \"delete\") {\n\t\t\t\t\t\t\t\t\t\t\tcache.expire(uri, true);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tswitch (kxhr.xhr.status) {\n\t\t\t\t\t\t\t\t\t\t\tcase 200:\n\t\t\t\t\t\t\t\t\t\t\tcase 202:\n\t\t\t\t\t\t\t\t\t\t\tcase 203:\n\t\t\t\t\t\t\t\t\t\t\tcase 206:\n\t\t\t\t\t\t\t\t\t\t\t\tkxhr.resolve(r);\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\tcase 201:\n\t\t\t\t\t\t\t\t\t\t\t\tif ((o.headers.location === undefined || string.isEmpty(o.headers.location)) && !string.isUrl(r)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tkxhr.resolve(r);\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tredirect = string.trim(o.headers.Location || r);\n\t\t\t\t\t\t\t\t\t\t\t\t\tclient.request(redirect).then(function (arg) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (type === \"get\" && shared && o.cachable) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcache.set(uri, \"response\", arg);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tkxhr.resolve(arg);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tkxhr.reject(e);\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\tcase 204:\n\t\t\t\t\t\t\t\t\t\t\tcase 205:\n\t\t\t\t\t\t\t\t\t\t\t\tkxhr.resolve(null);\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 304:\n\t\t\t\t\t\t\t\t\t\tkxhr.resolve(r);\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 401:\n\t\t\t\t\t\t\t\t\t\tkxhr.reject(new Error(kxhr.xhr.responseText || label.serverUnauthorized));\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 403:\n\t\t\t\t\t\t\t\t\t\tcache.set(uri, \"!permission\", client.bit([type]));\n\t\t\t\t\t\t\t\t\t\tkxhr.reject(new Error(kxhr.xhr.responseText || label.serverForbidden));\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 405:\n\t\t\t\t\t\t\t\t\t\tcache.set(uri, \"!permission\", client.bit([type]));\n\t\t\t\t\t\t\t\t\t\tkxhr.reject(new Error(kxhr.xhr.responseText || label.serverInvalidMethod));\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\tkxhr.reject(new Error(kxhr.xhr.responseText || label.serverError));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (xdr) {\n\t\t\t\t\t\t\t\tr = client.parse(kxhr.xhr, \"text/plain\");\n\t\t\t\t\t\t\t\tcache.set(uri, \"permission\", client.bit([\"get\"]));\n\t\t\t\t\t\t\t\tcache.set(uri, \"response\", r);\n\t\t\t\t\t\t\t\tkxhr.resolve(r);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tkxhr.on(\"error\", function (e) {\n\t\t\t\t\t\t\tkxhr.reject(e);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Sending request\n\t\t\t\t\t\tkxhr.xhr.send(payload !== null ? payload : undefined);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn kxhr;\n\t\t\t},\n\n\t\t\t/**\r\n    * Scrolls to a position in the view using a two point bezier curve\r\n    *\r\n    * @method scroll\r\n    * @memberOf client\r\n    * @param  {Array}  dest Coordinates\r\n    * @param  {Number} ms   [Optional] Milliseconds to scroll, default is 250, min is 100\r\n    * @return {Object} {@link Deferred}\r\n    * @private\r\n    */\n\t\t\tscroll: function scroll(dest, ms) {\n\t\t\t\tvar defer = deferred();\n\t\t\t\tvar start = client.scrollPos();\n\t\t\t\tvar t = 0;\n\n\t\t\t\tms = (!isNaN(ms) ? ms : 250) / 100;\n\n\t\t\t\tutility.repeat(function () {\n\t\t\t\t\tvar pos = math.bezier(start[0], start[1], dest[0], dest[1], ++t / 100);\n\n\t\t\t\t\twindow.scrollTo(pos[0], pos[1]);\n\n\t\t\t\t\tif (t === 100) {\n\t\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}, ms, \"scrolling\");\n\n\t\t\t\treturn defer;\n\t\t\t},\n\n\t\t\t/**\r\n    * Returns the current scroll position of the View\r\n    *\r\n    * @method scrollPos\r\n    * @memberOf client\r\n    * @return {Array} Describes the scroll position\r\n    * @private\r\n    */\n\t\t\tscrollPos: function scrollPos() {\n\t\t\t\treturn [window.scrollX || 0, window.scrollY || 0];\n\t\t\t}\n\t\t};\n\n\t\t/**\r\n   * @namespace csv\r\n   */\n\t\tvar csv = {\n\t\t\t/**\r\n    * Converts CSV to an Array of Objects\r\n    *\r\n    * @method decode\r\n    * @memberOf csv\r\n    * @param  {String} arg       CSV string\r\n    * @param  {String} delimiter [Optional] Delimiter to split columns on, default is \",\"\r\n    * @return {Array}            Array of Objects\r\n    */\n\t\t\tdecode: function decode(arg) {\n\t\t\t\tvar delimiter = arguments[1] === undefined ? \",\" : arguments[1];\n\n\t\t\t\tvar regex = new RegExp(delimiter + \"(?=(?:[^\\\"]|\\\"(?:[^\\\"])[^\\\"]*\\\")*$)\");\n\t\t\t\tvar rows = string.trim(arg).split(\"\\n\");\n\t\t\t\tvar keys = rows.shift().split(delimiter);\n\t\t\t\tvar result = undefined;\n\n\t\t\t\tresult = rows.map(function (r) {\n\t\t\t\t\tvar obj = {};\n\t\t\t\t\tvar row = r.split(regex);\n\n\t\t\t\t\tarray.each(keys, function (i, idx) {\n\t\t\t\t\t\tobj[i] = utility.coerce((row[idx] || \"\").replace(/^\"|\"$/g, \"\"));\n\t\t\t\t\t});\n\n\t\t\t\t\treturn obj;\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Encodes an Array, JSON, or Object as CSV\r\n    *\r\n    * @method encode\r\n    * @memberOf csv\r\n    * @param  {Mixed}   arg       JSON, Array or Object\r\n    * @param  {String}  delimiter [Optional] Character to separate fields\r\n    * @param  {Boolean} header    [Optional] `false` to disable keys names as first row\r\n    * @return {String}            CSV string\r\n    * @example\r\n    * let csv = keigai.util.csv.encode( [{prop:\"value\"}, {prop:\"value2\"}] );\r\n    *\r\n    * console.log( csv );\r\n    * \"prop\r\n    *  value\r\n    *  value2\"\r\n    */\n\t\t\tencode: function encode(arg) {\n\t\t\t\tvar delimiter = arguments[1] === undefined ? \",\" : arguments[1];\n\t\t\t\tvar header = arguments[2] === undefined ? true : arguments[2];\n\n\t\t\t\tvar obj = json.decode(arg, true) || arg;\n\t\t\t\tvar result = \"\";\n\n\t\t\t\t// Prepares input based on CSV rules\n\t\t\t\tvar prepare = function prepare(input) {\n\t\t\t\t\tvar output = undefined;\n\n\t\t\t\t\tif (input instanceof Array) {\n\t\t\t\t\t\toutput = \"\\\"\" + input.toString() + \"\\\"\";\n\n\t\t\t\t\t\tif (regex.object_type.test(output)) {\n\t\t\t\t\t\t\toutput = \"\\\"\" + csv.encode(input, delimiter) + \"\\\"\";\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (input instanceof Object) {\n\t\t\t\t\t\toutput = \"\\\"\" + csv.encode(input, delimiter) + \"\\\"\";\n\t\t\t\t\t} else if (regex.csv_quote.test(input)) {\n\t\t\t\t\t\toutput = \"\\\"\" + input.replace(/\"/g, \"\\\"\\\"\") + \"\\\"\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\toutput = input;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn output;\n\t\t\t\t};\n\n\t\t\t\tif (obj instanceof Array) {\n\t\t\t\t\tif (obj[0] instanceof Object) {\n\t\t\t\t\t\tif (header) {\n\t\t\t\t\t\t\tresult = array.keys(obj[0]).join(delimiter) + \"\\n\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresult += obj.map(function (i) {\n\t\t\t\t\t\t\treturn csv.encode(i, delimiter, false);\n\t\t\t\t\t\t}).join(\"\\n\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult += prepare(obj, delimiter) + \"\\n\";\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (header) {\n\t\t\t\t\t\tresult = array.keys(obj).join(delimiter) + \"\\n\";\n\t\t\t\t\t}\n\n\t\t\t\t\tresult += array.cast(obj).map(prepare).join(delimiter) + \"\\n\";\n\t\t\t\t}\n\n\t\t\t\treturn result.replace(regex.eol_nl, \"\");\n\t\t\t}\n\t\t};\n\n\t\tvar DataListFilter = (function (_Base2) {\n\t\t\t/**\r\n    * Creates a new DataListFilter\r\n    *\r\n    * @constructor\r\n    * @memberOf keigai\r\n    * @extends {keigai.Base}\r\n    * @param  {Object} element  Element to receive the filter\r\n    * @param  {Object} list     {@link keigai.DataList}\r\n    * @param  {Number} debounce [Optional] Milliseconds to debounce\r\n    * @example\r\n    * let store  = keigai.store( [...] ),\r\n    *     list   = keigai.list( document.querySelector( \"#list\" ), store, \"{{field}}\" ),\r\n    *     filter = keigai.filter( document.querySelector( \"input.filter\" ), list, \"field\" );\r\n    */\n\n\t\t\tfunction DataListFilter(element, list, debounce) {\n\t\t\t\t_classCallCheck(this, DataListFilter);\n\n\t\t\t\t_get(Object.getPrototypeOf(DataListFilter.prototype), \"constructor\", this).call(this);\n\n\t\t\t\tthis.debounce = debounce;\n\t\t\t\tthis.element = element;\n\t\t\t\tthis.filters = {};\n\t\t\t\tthis.list = list;\n\t\t\t\tthis.observer = observable();\n\t\t\t}\n\n\t\t\t_inherits(DataListFilter, _Base2);\n\n\t\t\t_createClass(DataListFilter, [{\n\t\t\t\tkey: \"set\",\n\n\t\t\t\t/**\r\n     * Set the filters\r\n     *\r\n     * Create an object based on comma separated key string\r\n     *\r\n     * @method set\r\n     * @memberOf keigai.DataListFilter\r\n     * @param  {String} fields Comma separated filters\r\n     * @return {Object} {@link keigai.DataListFilter}\r\n     * @example\r\n     * filter.set( \"firstName, lastName, email\" );\r\n     */\n\t\t\t\tvalue: function set(fields) {\n\t\t\t\t\tvar _this5 = this;\n\n\t\t\t\t\tthis.filters = {};\n\t\t\t\t\tarray.each(string.explode(fields), function (v) {\n\t\t\t\t\t\t_this5.filters[v] = \"\";\n\t\t\t\t\t});\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"teardown\",\n\n\t\t\t\t/**\r\n     * Removes listeners, and DOM hooks to avoid memory leaks\r\n     *\r\n     * @method teardown\r\n     * @memberOf keigai.DataListFilter\r\n     * @return {Object} {@link keigai.DataListFilter}\r\n     * @example\r\n     * filter.teardown();\r\n     */\n\t\t\t\tvalue: function teardown() {\n\t\t\t\t\tthis.observer.unhook(this.element, \"keyup\");\n\t\t\t\t\tthis.observer.unhook(this.element, \"input\");\n\t\t\t\t\tthis.element = null;\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"update\",\n\n\t\t\t\t/**\r\n     * Applies the input value as a filter against the DataList based on specific fields\r\n     *\r\n     * @method update\r\n     * @memberOf keigai.DataListFilter\r\n     * @fires keigai.DataList#beforeFilter Fires before filter\r\n     * @fires keigai.DataList#afterFilter Fires after filter\r\n     * @return {Object} {@link keigai.DataListFilter}\r\n     * @example\r\n     * filter.update(); // Debounced execution\r\n     */\n\t\t\t\tvalue: function update() {\n\t\t\t\t\tvar _this6 = this;\n\n\t\t\t\t\tutility.defer(function () {\n\t\t\t\t\t\tvar val = element.val(_this6.element).toString();\n\n\t\t\t\t\t\t_this6.list.dispatch(\"beforeFilter\", _this6.element, val);\n\n\t\t\t\t\t\tif (!string.isEmpty(val)) {\n\t\t\t\t\t\t\tutility.iterate(_this6.filters, function (v, k) {\n\t\t\t\t\t\t\t\tvar queries = string.explode(val);\n\n\t\t\t\t\t\t\t\t// Ignoring trailing commas\n\t\t\t\t\t\t\t\tqueries = queries.filter(function (i) {\n\t\t\t\t\t\t\t\t\treturn !string.isEmpty(i);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t// Shaping valid pattern\n\t\t\t\t\t\t\t\tarray.each(queries, function (i, idx) {\n\t\t\t\t\t\t\t\t\tqueries[idx] = \"^.*\" + string.escape(i).replace(/(^\\*|\\*$)/g, \"\").replace(/\\*/g, \".*\") + \".*\";\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t_this6.filters[k] = queries.join(\",\");\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t_this6.list.filter = _this6.filters;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t_this6.list.filter = null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_this6.list.pageIndex = 1;\n\t\t\t\t\t\t_this6.list.refresh();\n\t\t\t\t\t\t_this6.list.dispatch(\"afterFilter\", _this6.element);\n\t\t\t\t\t}, this.debounce, this.element.id + \"Debounce\");\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}]);\n\n\t\t\treturn DataListFilter;\n\t\t})(Base);\n\n\t\t/**\r\n   * DataListFilter factory\r\n   *\r\n   * @method factory\r\n   * @memberOf filter\r\n   * @param  {Object} target   Element to receive the filter\r\n   * @param  {Object} list     {@link keigai.DataList}\r\n   * @param  {String} filters  Comma delimited string of fields to filter by\r\n   * @param  {Number} debounce [Optional] Milliseconds to debounce, default is `250`\r\n   * @return {Object} {@link keigai.DataListFilter}\r\n   * @example\r\n   * let store  = keigai.store( [...] ),\r\n   *     list   = keigai.list( document.querySelector( \"#list\" ), store, \"{{field}}\" ),\r\n   *     filter = keigai.filter( document.querySelector( \"input.filter\" ), list, \"field\" );\r\n   */\n\t\tvar filter = function filter(target, list, filters) {\n\t\t\tvar debounce = arguments[3] === undefined ? 250 : arguments[3];\n\n\t\t\tvar ref = [list];\n\t\t\tvar obj = new DataListFilter(target, ref[0], debounce).set(filters);\n\n\t\t\t// Decorating `target` with the appropriate input `type`\n\t\t\telement.attr(target, \"type\", \"text\");\n\n\t\t\t// Setting up a chain of Events\n\t\t\tobj.observer.hook(obj.element, \"keyup\");\n\t\t\tobj.observer.hook(obj.element, \"input\");\n\t\t\tobj.on(\"keyup\", obj.update, \"keyup\");\n\t\t\tobj.on(\"input\", obj.update, \"input\");\n\n\t\t\treturn obj;\n\t\t};\n\n\t\tvar DataGrid = (function (_Base3) {\n\t\t\t/**\r\n    * Creates a new DataGrid\r\n    *\r\n    * @constructor\r\n    * @memberOf keigai\r\n    * @extends {keigai.Base}\r\n    * @param  {Object}  target   Element to receive DataGrid\r\n    * @param  {Object}  store    DataStore\r\n    * @param  {Array}   fields   Array of fields to display\r\n    * @param  {Array}   sortable [Optional] Array of sortable columns/fields\r\n    * @param  {Object}  options  [Optional] DataList options\r\n    * @param  {Boolean} filtered [Optional] Create an input to filter the DataGrid\r\n    * @example\r\n    * let fields  = [\"name\", \"age\"],\r\n    *     options = {pageSize: 5, order: \"age desc, name\"},\r\n    *     store   = keigai.store( [...] ),\r\n    *     grid    = keigai.grid( document.querySelector( \"#grid\" ), store, fields, fields, options, true );\r\n    */\n\n\t\t\tfunction DataGrid(target, store, fields) {\n\t\t\t\tvar sortable = arguments[3] === undefined ? [] : arguments[3];\n\t\t\t\tvar options = arguments[4] === undefined ? {} : arguments[4];\n\t\t\t\tvar filtered = arguments[5] === undefined ? false : arguments[5];\n\n\t\t\t\t_classCallCheck(this, DataGrid);\n\n\t\t\t\t_get(Object.getPrototypeOf(DataGrid.prototype), \"constructor\", this).call(this);\n\n\t\t\t\tvar sortOrder = undefined;\n\n\t\t\t\tif (options.order && !string.isEmpty(options.order)) {\n\t\t\t\t\tsortOrder = string.explode(options.order).map(function (i) {\n\t\t\t\t\t\treturn i.replace(regex.after_space, \"\");\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.element = element.create(\"section\", { \"class\": \"grid\" }, target);\n\t\t\t\tthis.fields = fields;\n\t\t\t\tthis.filtered = filtered;\n\t\t\t\tthis.list = null;\n\t\t\t\tthis.observer = observable();\n\t\t\t\tthis.options = options;\n\t\t\t\tthis.store = store;\n\t\t\t\tthis.sortable = sortable;\n\t\t\t\tthis.sortOrder = sortOrder || sortable;\n\t\t\t}\n\n\t\t\t_inherits(DataGrid, _Base3);\n\n\t\t\t_createClass(DataGrid, [{\n\t\t\t\tkey: \"add\",\n\n\t\t\t\t/**\r\n     * Adds an item to the DataGrid\r\n     *\r\n     * @method add\r\n     * @memberOf keigai.DataGrid\r\n     * @param {Object} record New DataStore record (shapes should match)\r\n     * @return {Object}       {@link keigai.DataGrid}\r\n     * @example\r\n     * grid.add( {name: \"John Doe\", age: 34} );\r\n     */\n\t\t\t\tvalue: function add(record) {\n\t\t\t\t\tvar _this7 = this;\n\n\t\t\t\t\tthis.store.set(null, record).then(null, function (e) {\n\t\t\t\t\t\tutility.error(e);\n\t\t\t\t\t\t_this7.dispatch(\"error\", e);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"dump\",\n\n\t\t\t\t/**\r\n     * Exports data grid records\r\n     *\r\n     * @method dump\r\n     * @memberOf keigai.DataGrid\r\n     * @return {Array} Record set\r\n     * @example\r\n     * let data = grid.dump();\r\n     */\n\t\t\t\tvalue: function dump() {\n\t\t\t\t\treturn this.store.dump(this.list.records, this.fields);\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"refresh\",\n\n\t\t\t\t/**\r\n     * Refreshes the DataGrid\r\n     *\r\n     * @method refresh\r\n     * @memberOf keigai.DataGrid\r\n     * @fires keigai.DataGrid#beforeRefresh Fires before refresh\r\n     * @fires keigai.DataGrid#afterRefresh Fires after refresh\r\n     * @return {Object} {@link keigai.DataGrid}\r\n     * @example\r\n     * grid.refresh();\r\n     */\n\t\t\t\tvalue: function refresh() {\n\t\t\t\t\tvar _this8 = this;\n\n\t\t\t\t\tvar sort = [];\n\t\t\t\t\tthis.dispatch(\"beforeRefresh\", this.element);\n\n\t\t\t\t\tif (this.sortOrder.length > 0) {\n\t\t\t\t\t\tarray.each(this.sortOrder, function (i) {\n\t\t\t\t\t\t\tvar obj = element.find(_this8.element, \".header span[data-field='\" + i + \"']\")[0];\n\n\t\t\t\t\t\t\tsort.push(string.trim(i + \" \" + (element.data(obj, \"sort\") || \"\")));\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.options.order = this.list.order = sort.join(\", \");\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.list.where = null;\n\t\t\t\t\tutility.merge(this.list, this.options);\n\t\t\t\t\tthis.list.refresh();\n\t\t\t\t\tthis.dispatch(\"afterRefresh\", this.element);\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"remove\",\n\n\t\t\t\t/**\r\n     * Removes an item from the DataGrid\r\n     *\r\n     * @method remove\r\n     * @memberOf keigai.DataGrid\r\n     * @param {Mixed} record Record, key or index\r\n     * @return {Object} {@link keigai.DataGrid}\r\n     * @example\r\n     * grid.remove( \"key\" );\r\n     */\n\t\t\t\tvalue: function remove(record) {\n\t\t\t\t\tvar _this9 = this;\n\n\t\t\t\t\tthis.store.del(record).then(null, function (e) {\n\t\t\t\t\t\tutility.error(e);\n\t\t\t\t\t\t_this9.dispatch(\"error\", e);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"sort\",\n\n\t\t\t\t/**\r\n     * Sorts the DataGrid when a column header is clicked\r\n     *\r\n     * @method sort\r\n     * @memberOf keigai.DataGrid\r\n     * @param  {Object} ev Event\r\n     * @return {Object} {@link keigai.DataGrid}\r\n     */\n\t\t\t\tvalue: function sort(ev) {\n\t\t\t\t\tvar target = utility.target(ev);\n\t\t\t\t\tvar field = undefined;\n\n\t\t\t\t\t// Stopping event propogation\n\t\t\t\t\tutility.stop(ev);\n\n\t\t\t\t\t// Refreshing list if target is sortable\n\t\t\t\t\tif (element.hasClass(target, \"sortable\")) {\n\t\t\t\t\t\tfield = element.data(target, \"field\");\n\t\t\t\t\t\telement.data(target, \"sort\", element.data(target, \"sort\") === \"asc\" ? \"desc\" : \"asc\");\n\t\t\t\t\t\tarray.remove(this.sortOrder, field);\n\t\t\t\t\t\tthis.sortOrder.splice(0, 0, field);\n\t\t\t\t\t\tthis.refresh();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"teardown\",\n\n\t\t\t\t/**\r\n     * Tears down the DataGrid\r\n     *\r\n     * @method teardown\r\n     * @memberOf keigai.DataGrid\r\n     * @return {Object} {@link keigai.DataGrid}\r\n     * @example\r\n     * grid.teardown();\r\n     */\n\t\t\t\tvalue: function teardown() {\n\t\t\t\t\tthis.observer.unhook(element.find(this.element, \"ul.header\")[0], \"click\");\n\t\t\t\t\tthis.list.teardown();\n\t\t\t\t\telement.destroy(this.element);\n\t\t\t\t\tthis.element = null;\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"update\",\n\n\t\t\t\t/**\r\n     * Updates an item in the DataGrid\r\n     *\r\n     * @method update\r\n     * @memberOf keigai.DataGrid\r\n     * @param {Mixed}  key  Key or index\r\n     * @param {Object} data New property values\r\n     * @return {Object}     {@link keigai.DataGrid}\r\n     * @example\r\n     * grid.update( \"key\", {name: \"Jim Smith\"} );\r\n     */\n\t\t\t\tvalue: function update(key, data) {\n\t\t\t\t\tvar _this10 = this;\n\n\t\t\t\t\tthis.store.update(key, data).then(null, function (e) {\n\t\t\t\t\t\tutility.error(e);\n\t\t\t\t\t\t_this10.dispatch(\"error\", e);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}]);\n\n\t\t\treturn DataGrid;\n\t\t})(Base);\n\n\t\t/**\r\n   * DataGrid factory\r\n   *\r\n   * @method factory\r\n   * @memberOf grid\r\n   * @fires keigai.DataGrid#change Fires when the DOM changes\r\n   * @param  {Object}  target      Element to receive DataGrid\r\n   * @param  {Object}  store       DataStore\r\n   * @param  {Array}   fields      Array of fields to display\r\n   * @param  {Array}   sortable    [Optional] Array of sortable columns/fields\r\n   * @param  {Object}  options     [Optional] DataList options\r\n   * @param  {Boolean} filtered    [Optional] Create an input to filter the data grid\r\n   * @param  {Number}  debounce    [Optional] DataListFilter input debounce, default is 250\r\n   * @return {Object} {@link keigai.DataGrid}\r\n   * @example\r\n   * let fields  = [\"name\", \"age\"],\r\n   *     options = {pageSize: 5, order: \"age desc, name\"},\r\n   *     store   = keigai.store(),\r\n   *     grid    = keigai.grid( document.querySelector( \"#grid\" ), store, fields, fields, options, true );\r\n   *\r\n   * store.setUri( \"data.json\" ).then( null, function ( e ) {\r\n   *   ...\r\n   * } );\r\n   */\n\t\tvar grid = function grid(target, store, fields, sortable, options, filtered) {\n\t\t\tvar debounce = arguments[6] === undefined ? 250 : arguments[6];\n\n\t\t\tvar ref = [store];\n\t\t\tvar obj = new DataGrid(target, ref[0], fields, sortable, options, filtered);\n\t\t\tvar template = \"\";\n\t\t\tvar header = element.create(\"li\", {}, element.create(\"ul\", { \"class\": \"header\" }, obj.element));\n\t\t\tvar width = 100 / obj.fields.length + \"%\";\n\t\t\tvar css = \"display:inline-block;width:\" + width;\n\t\t\tvar sort = obj.options.order ? string.explode(obj.options.order) : [];\n\n\t\t\t// Creating DataList template based on fields\n\t\t\tarray.each(obj.fields, function (i) {\n\t\t\t\tvar trimmed = i.replace(/.*\\./g, \"\");\n\t\t\t\tvar el = element.create(\"span\", {\n\t\t\t\t\tinnerHTML: string.capitalize(string.unCamelCase(string.unhyphenate(trimmed, true)).replace(/_|-/g, \" \"), true),\n\t\t\t\t\tstyle: css,\n\t\t\t\t\t\"data-field\": i\n\t\t\t\t}, header);\n\n\t\t\t\t// Adding CSS class if \"column\" is sortable\n\t\t\t\tif (array.contains(obj.sortable, i)) {\n\t\t\t\t\telement.addClass(el, \"sortable\");\n\n\t\t\t\t\t// Applying default sort, if specified\n\t\t\t\t\tif (sort.filter(function (x) {\n\t\t\t\t\t\treturn x.indexOf(i) === 0;\n\t\t\t\t\t}).length > 0) {\n\t\t\t\t\t\telement.data(el, \"sort\", array.contains(sort, i + \" desc\") ? \"desc\" : \"asc\");\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttemplate += \"<span class=\\\"\" + i + \"\\\" data-field=\\\"\" + i + \"\\\" style=\\\"\" + css + \"\\\">{{\" + i + \"}}</span>\";\n\t\t\t});\n\n\t\t\t// Setting click handler on sortable \"columns\"\n\t\t\tif (obj.sortable.length > 0) {\n\t\t\t\tobj.observer.hook(header.parentNode, \"click\", obj.sort, \"sort\", obj);\n\t\t\t}\n\n\t\t\tif (obj.filtered === true) {\n\t\t\t\tobj.options.listFiltered = true;\n\t\t\t\tobj.options.listFilter = obj.fields.join(\",\");\n\t\t\t}\n\n\t\t\tobj.options.debounce = debounce;\n\n\t\t\t// Creating DataList\n\t\t\tref.push(list.factory(obj.element, ref[0], template, obj.options));\n\n\t\t\t// Setting by-reference DataList on DataGrid\n\t\t\tobj.list = ref[1];\n\n\t\t\t// Setting up a chain of Events\n\t\t\tobj.on(\"beforeRefresh\", function (arg) {\n\t\t\t\telement.dispatch(arg, \"beforeRefresh\");\n\t\t\t}, \"bubble\");\n\n\t\t\tobj.on(\"afterRefresh\", function (arg) {\n\t\t\t\telement.dispatch(arg, \"afterRefresh\");\n\t\t\t}, \"bubble\");\n\n\t\t\tobj.on(\"click\", function (e) {\n\t\t\t\tif (element.hasClass(e.currentTarget, \"header\")) {\n\t\t\t\t\tobj.sort(e);\n\t\t\t\t}\n\t\t\t}, \"header\");\n\n\t\t\tobj.list.on(\"change\", function () {\n\t\t\t\tfor (var _len7 = arguments.length, args = Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {\n\t\t\t\t\targs[_key7] = arguments[_key7];\n\t\t\t\t}\n\n\t\t\t\tobj.dispatch.apply(obj, [\"change\"].concat(args));\n\t\t\t}, \"change\");\n\n\t\t\tobj.list.on(\"beforeFilter\", function () {\n\t\t\t\tfor (var _len8 = arguments.length, args = Array(_len8), _key8 = 0; _key8 < _len8; _key8++) {\n\t\t\t\t\targs[_key8] = arguments[_key8];\n\t\t\t\t}\n\n\t\t\t\tobj.dispatch.apply(obj, [\"beforeFilter\"].concat(args));\n\t\t\t}, \"beforeFilter\");\n\n\t\t\tobj.list.on(\"afterFilter\", function () {\n\t\t\t\tfor (var _len9 = arguments.length, args = Array(_len9), _key9 = 0; _key9 < _len9; _key9++) {\n\t\t\t\t\targs[_key9] = arguments[_key9];\n\t\t\t\t}\n\n\t\t\t\tobj.dispatch.apply(obj, [\"afterFilter\"].concat(args));\n\t\t\t}, \"afterFilter\");\n\n\t\t\treturn obj;\n\t\t};\n\n\t\tvar DataList = (function (_Base4) {\n\t\t\t/**\r\n    * Creates a new DataList\r\n    *\r\n    * @constructor\r\n    * @memberOf keigai\r\n    * @extends {keigai.Base}\r\n    * @example\r\n    * let store = keigai.store( [...] ),\r\n    *     list  = keigai.list( document.querySelector(\"#list\"), store, \"{{name}}\", {order: \"name\"} );\r\n    */\n\n\t\t\tfunction DataList(element, store, template) {\n\t\t\t\t_classCallCheck(this, DataList);\n\n\t\t\t\t_get(Object.getPrototypeOf(DataList.prototype), \"constructor\", this).call(this);\n\n\t\t\t\tthis.callback = null;\n\t\t\t\tthis.current = [];\n\t\t\t\tthis.element = element;\n\t\t\t\tthis.emptyMsg = label.noData;\n\t\t\t\tthis.filter = null;\n\t\t\t\tthis.filtered = [];\n\t\t\t\tthis.id = utility.genId();\n\t\t\t\tthis.items = [];\n\t\t\t\tthis.listFilter = null;\n\t\t\t\tthis.mutation = null;\n\t\t\t\tthis.observer = observable();\n\t\t\t\tthis.pageIndex = 1;\n\t\t\t\tthis.pageSize = null;\n\t\t\t\tthis.pageRange = 5;\n\t\t\t\tthis.pagination = \"bottom\"; // \"top\" or \"bottom|top\" are also valid\n\t\t\t\tthis.placeholder = \"\";\n\t\t\t\tthis.order = \"\";\n\t\t\t\tthis.records = [];\n\t\t\t\tthis.template = template;\n\t\t\t\tthis.total = 0;\n\t\t\t\tthis.store = store;\n\t\t\t\tthis.where = null;\n\t\t\t}\n\n\t\t\t_inherits(DataList, _Base4);\n\n\t\t\t_createClass(DataList, [{\n\t\t\t\tkey: \"add\",\n\n\t\t\t\t/**\r\n     * Adds an item to the DataList\r\n     *\r\n     * @method add\r\n     * @memberOf keigai.DataList\r\n     * @param {Object} record New DataStore record (shapes should match)\r\n     * @return {Object}       {@link keigai.DataList}\r\n     * @example\r\n     * list.add( {name: \"John Doe\", age: 34} );\r\n     */\n\t\t\t\tvalue: function add(record) {\n\t\t\t\t\tvar _this11 = this;\n\n\t\t\t\t\tthis.store.set(null, record).then(null, function (e) {\n\t\t\t\t\t\tutility.error(e);\n\t\t\t\t\t\t_this11.dispatch(\"error\", e);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"dump\",\n\n\t\t\t\t/**\r\n     * Exports data list records\r\n     *\r\n     * @method dump\r\n     * @memberOf keigai.DataList\r\n     * @return {Array} Record set\r\n     * @example\r\n     * let data = list.dump();\r\n     */\n\t\t\t\tvalue: function dump() {\n\t\t\t\t\treturn this.store.dump(this.records);\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"page\",\n\n\t\t\t\t/**\r\n     * Changes the page index of the DataList\r\n     *\r\n     * @method page\r\n     * @memberOf keigai.DataList\r\n     * @param  {Number} n Page to view\r\n     * @return {Object}   {@link keigai.DataList}\r\n     * @example\r\n     * list.page( 2 );\r\n     */\n\t\t\t\tvalue: function page(n) {\n\t\t\t\t\tthis.pageIndex = n;\n\n\t\t\t\t\treturn this.refresh();\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"pages\",\n\n\t\t\t\t/**\r\n     * Adds pagination Elements to the View, executed from `DataList.refresh()`\r\n     *\r\n     * @method pages\r\n     * @memberOf keigai.DataList\r\n     * @return {Object} {@link keigai.DataList}\r\n     * @example\r\n     * list.pages();\r\n     */\n\t\t\t\tvalue: function pages() {\n\t\t\t\t\tvar _this12 = this;\n\n\t\t\t\t\tvar obj = this.element;\n\t\t\t\t\tvar page = this.pageIndex;\n\t\t\t\t\tvar pos = this.pagination;\n\t\t\t\t\tvar range = this.pageRange;\n\t\t\t\t\tvar mid = Math.floor(range / 2);\n\t\t\t\t\tvar start = page - mid;\n\t\t\t\t\tvar end = page + mid;\n\t\t\t\t\tvar total = list.pages(this);\n\t\t\t\t\tvar diff = undefined;\n\n\t\t\t\t\t// Removing the existing controls\n\t\t\t\t\tarray.each(utility.dom(\"#\" + obj.id + \"-pages-top, #\" + obj.id + \"-pages-bottom\"), function (i) {\n\t\t\t\t\t\tif (i) {\n\t\t\t\t\t\t\t_this12.observer.unhook(i, \"click\");\n\t\t\t\t\t\t\telement.destroy(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Halting because there's 1 page, or nothing\n\t\t\t\t\tif (this.filter && this.filtered.length === 0 || this.total === 0 || total === 1) {\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Getting the range to display\n\t\t\t\t\tif (start < 1) {\n\t\t\t\t\t\tdiff = number.diff(start, 1);\n\t\t\t\t\t\tstart = start + diff;\n\t\t\t\t\t\tend = end + diff;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (end > total) {\n\t\t\t\t\t\tend = total;\n\t\t\t\t\t\tstart = end - range + 1;\n\n\t\t\t\t\t\tif (start < 1) {\n\t\t\t\t\t\t\tstart = 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (number.diff(start, end) >= range) {\n\t\t\t\t\t\t--end;\n\t\t\t\t\t}\n\n\t\t\t\t\tarray.each(string.explode(pos), function (i) {\n\t\t\t\t\t\tvar current = false;\n\t\t\t\t\t\tvar more = page > 1;\n\t\t\t\t\t\tvar next = page + 1 <= total;\n\t\t\t\t\t\tvar last = page >= total;\n\t\t\t\t\t\tvar el = undefined,\n\t\t\t\t\t\t    n = undefined;\n\n\t\t\t\t\t\t// Setting up the list\n\t\t\t\t\t\tel = element.create(\"ul\", {\n\t\t\t\t\t\t\t\"class\": \"list pages hidden \" + i,\n\t\t\t\t\t\t\tid: obj.id + \"-pages-\" + i\n\t\t\t\t\t\t}, obj, i === \"bottom\" ? \"after\" : \"before\");\n\n\t\t\t\t\t\t// First page\n\t\t\t\t\t\telement.create(more ? \"a\" : \"span\", {\n\t\t\t\t\t\t\t\"class\": \"first page\",\n\t\t\t\t\t\t\t\"data-page\": 1,\n\t\t\t\t\t\t\tinnerHTML: \"&lt;&lt;\"\n\t\t\t\t\t\t}, element.create(\"li\", {}, el));\n\n\t\t\t\t\t\t// Previous page\n\t\t\t\t\t\telement.create(more ? \"a\" : \"span\", {\n\t\t\t\t\t\t\t\"class\": \"prev page\",\n\t\t\t\t\t\t\t\"data-page\": page - 1,\n\t\t\t\t\t\t\tinnerHTML: \"&lt;\"\n\t\t\t\t\t\t}, element.create(\"li\", {}, el));\n\n\t\t\t\t\t\t// Rendering the page range\n\t\t\t\t\t\tn = start - 1;\n\t\t\t\t\t\twhile (++n <= end) {\n\t\t\t\t\t\t\tcurrent = n === page;\n\t\t\t\t\t\t\telement.create(current ? \"span\" : \"a\", {\n\t\t\t\t\t\t\t\t\"class\": current ? \"current page\" : \"page\",\n\t\t\t\t\t\t\t\t\"data-page\": n,\n\t\t\t\t\t\t\t\tinnerHTML: n\n\t\t\t\t\t\t\t}, element.create(\"li\", {}, el));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Next page\n\t\t\t\t\t\telement.create(next ? \"a\" : \"span\", {\n\t\t\t\t\t\t\t\"class\": \"next page\",\n\t\t\t\t\t\t\t\"data-page\": next ? page + 1 : null,\n\t\t\t\t\t\t\tinnerHTML: \"&gt;\"\n\t\t\t\t\t\t}, element.create(\"li\", {}, el));\n\n\t\t\t\t\t\t// Last page\n\t\t\t\t\t\telement.create(last ? \"span\" : \"a\", {\n\t\t\t\t\t\t\t\"class\": \"last page\",\n\t\t\t\t\t\t\t\"data-page\": last ? null : total,\n\t\t\t\t\t\t\tinnerHTML: \"&gt;&gt;\"\n\t\t\t\t\t\t}, element.create(\"li\", {}, el));\n\n\t\t\t\t\t\t// Adding to DOM\n\t\t\t\t\t\telement.removeClass(el, \"hidden\");\n\n\t\t\t\t\t\t// Pagination listener\n\t\t\t\t\t\t_this12.observer.hook(el, \"click\");\n\t\t\t\t\t});\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"refresh\",\n\n\t\t\t\t/**\r\n     * Refreshes element\r\n     *\r\n     * @method refresh\r\n     * @memberOf keigai.DataList\r\n     * @extends {keigai.Base}\r\n     * @fires keigai.DataList#beforeRefresh Fires before refresh\r\n     * @fires keigai.DataList#afterRefresh Fires after refresh\r\n     * @fires keigai.DataList#error Fires on error\r\n     * @param  {Boolean} create [Optional] Recreates cached View of data\r\n     * @return {Object} {@link keigai.DataList}\r\n     * @example\r\n     * list.refresh();\r\n     */\n\t\t\t\tvalue: function refresh() {\n\t\t\t\t\tvar _this13 = this;\n\n\t\t\t\t\tvar create = arguments[0] === undefined ? false : arguments[0];\n\n\t\t\t\t\tvar el = this.element;\n\t\t\t\t\tvar template = typeof this.template === \"object\";\n\t\t\t\t\tvar filter = this.filter !== null;\n\t\t\t\t\tvar items = [];\n\t\t\t\t\tvar callback = typeof this.callback === \"function\";\n\t\t\t\t\tvar reg = new RegExp();\n\t\t\t\t\tvar registry = []; // keeps track of records in the list ( for filtering )\n\t\t\t\t\tvar range = [];\n\t\t\t\t\tvar fn = undefined,\n\t\t\t\t\t    ceiling = undefined,\n\t\t\t\t\t    next = undefined;\n\n\t\t\t\t\tthis.dispatch(\"beforeRefresh\", el);\n\n\t\t\t\t\t// Function to create templates for the html rep\n\t\t\t\t\tif (!template) {\n\t\t\t\t\t\tfn = function (i) {\n\t\t\t\t\t\t\tvar html = _this13.template;\n\t\t\t\t\t\t\tvar items = array.unique(html.match(/\\{\\{[\\w\\.\\-\\[\\]]+\\}\\}/g));\n\n\t\t\t\t\t\t\t// Replacing record key\n\t\t\t\t\t\t\thtml = html.replace(\"{{\" + _this13.store.key + \"}}\", i.key);\n\n\t\t\t\t\t\t\t// Replacing dot notation properties\n\t\t\t\t\t\t\tarray.each(items, function (attr) {\n\t\t\t\t\t\t\t\tvar key = attr.replace(/\\{\\{|\\}\\}/g, \"\"),\n\t\t\t\t\t\t\t\t    value = utility.walk(i.data, key);\n\n\t\t\t\t\t\t\t\tif (value === undefined) {\n\t\t\t\t\t\t\t\t\tvalue = \"\";\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treg.compile(string.escape(attr), \"g\");\n\t\t\t\t\t\t\t\thtml = html.replace(reg, value);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// Filling in placeholder value\n\t\t\t\t\t\t\thtml = html.replace(/\\{\\{.*\\}\\}/g, _this13.placeholder);\n\n\t\t\t\t\t\t\treturn \"<li data-key=\\\"\" + i.key + \"\\\">\" + html + \"</li>\";\n\t\t\t\t\t\t};\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfn = function (i) {\n\t\t\t\t\t\t\tvar obj = json.encode(_this13.template);\n\t\t\t\t\t\t\tvar items = array.unique(obj.match(/\\{\\{[\\w\\.\\-\\[\\]]+\\}\\}/g));\n\n\t\t\t\t\t\t\t// Replacing record key\n\t\t\t\t\t\t\tobj = obj.replace(\"{{\" + _this13.store.key + \"}}\", i.key);\n\n\t\t\t\t\t\t\t// Replacing dot notation properties\n\t\t\t\t\t\t\tarray.each(items, function (attr) {\n\t\t\t\t\t\t\t\tvar key = attr.replace(/\\{\\{|\\}\\}/g, \"\");\n\t\t\t\t\t\t\t\tvar value = utility.walk(i.data, key) || \"\";\n\n\t\t\t\t\t\t\t\treg.compile(string.escape(attr), \"g\");\n\n\t\t\t\t\t\t\t\t// Stripping first and last \" to concat to valid JSON\n\t\t\t\t\t\t\t\tobj = obj.replace(reg, json.encode(value).replace(/(^\")|(\"$)/g, \"\"));\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// Filling in placeholder value\n\t\t\t\t\t\t\tobj = json.decode(obj.replace(/\\{\\{.*\\}\\}/g, _this13.placeholder));\n\n\t\t\t\t\t\t\treturn { li: obj };\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\t// Next phase\n\t\t\t\t\tnext = function (args) {\n\t\t\t\t\t\t// Creating view of DataStore\n\t\t\t\t\t\t_this13.records = args;\n\t\t\t\t\t\t_this13.total = _this13.records.length;\n\t\t\t\t\t\t_this13.filtered = [];\n\n\t\t\t\t\t\t// Resetting 'view' specific arrays\n\t\t\t\t\t\t_this13.current = [];\n\n\t\t\t\t\t\t// Filtering records (if applicable)\n\t\t\t\t\t\tif (filter) {\n\t\t\t\t\t\t\tarray.each(_this13.records, function (i) {\n\t\t\t\t\t\t\t\tutility.iterate(_this13.filter, function (v, k) {\n\t\t\t\t\t\t\t\t\tvar key = undefined;\n\n\t\t\t\t\t\t\t\t\tif (array.contains(registry, i.key)) {\n\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tkey = k === _this13.store.key;\n\n\t\t\t\t\t\t\t\t\tarray.each(string.explode(v), function (query) {\n\t\t\t\t\t\t\t\t\t\tvar reg = new RegExp(query, \"i\");\n\t\t\t\t\t\t\t\t\t\tvar value = !key ? utility.walk(i.data, k) : \"\";\n\n\t\t\t\t\t\t\t\t\t\tif (key && reg.test(i.key) || reg.test(value)) {\n\t\t\t\t\t\t\t\t\t\t\tregistry.push(i.key);\n\t\t\t\t\t\t\t\t\t\t\t_this13.filtered.push(i);\n\n\t\t\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Pagination\n\t\t\t\t\t\tif (_this13.pageSize !== null && !isNaN(_this13.pageIndex) && !isNaN(_this13.pageSize)) {\n\t\t\t\t\t\t\tceiling = list.pages(_this13);\n\n\t\t\t\t\t\t\t// Passed the end, so putting you on the end\n\t\t\t\t\t\t\tif (ceiling > 0 && _this13.pageIndex > ceiling) {\n\t\t\t\t\t\t\t\treturn _this13.page(ceiling);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Paginating the items\n\t\t\t\t\t\t\telse if (_this13.total > 0) {\n\t\t\t\t\t\t\t\trange = list.range(_this13);\n\t\t\t\t\t\t\t\t_this13.current = array.limit(!filter ? _this13.records : _this13.filtered, range[0], range[1]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t_this13.current = !filter ? _this13.records : _this13.filtered;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Processing records & generating templates\n\t\t\t\t\t\tarray.each(_this13.current, function (i) {\n\t\t\t\t\t\t\tvar html = fn(i);\n\t\t\t\t\t\t\tvar hash = btoa(html);\n\n\t\t\t\t\t\t\titems.push({ key: i.key, template: html, hash: hash });\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Updating element\n\t\t\t\t\t\tutility.render(function () {\n\t\t\t\t\t\t\tvar destroy = [];\n\t\t\t\t\t\t\tvar callbacks = [];\n\t\t\t\t\t\t\tvar i = undefined,\n\t\t\t\t\t\t\t    nth = undefined;\n\n\t\t\t\t\t\t\tif (items.length === 0) {\n\t\t\t\t\t\t\t\telement.html(el, \"<li class=\\\"empty\\\">\" + _this13.emptyMsg + \"</li>\");\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (_this13.items.length === 0) {\n\t\t\t\t\t\t\t\t\telement.html(el, items.map(function (i) {\n\t\t\t\t\t\t\t\t\t\treturn i.template;\n\t\t\t\t\t\t\t\t\t}).join(\"\"));\n\n\t\t\t\t\t\t\t\t\tif (callback) {\n\t\t\t\t\t\t\t\t\t\tarray.each(array.cast(el.childNodes), function (i) {\n\t\t\t\t\t\t\t\t\t\t\t_this13.callback(i);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tarray.each(items, function (i, idx) {\n\t\t\t\t\t\t\t\t\t\tif (_this13.items[idx] !== undefined && _this13.items[idx].hash !== i.hash) {\n\t\t\t\t\t\t\t\t\t\t\telement.data(element.html(el.childNodes[idx], i.template.replace(/<li data-key=\\\"\\d+\\\">|<\\/li>/g, \"\")), \"key\", i.key);\n\t\t\t\t\t\t\t\t\t\t\tcallbacks.push(idx);\n\t\t\t\t\t\t\t\t\t\t} else if (_this13.items[idx] === undefined) {\n\t\t\t\t\t\t\t\t\t\t\telement.create(i.template, null, el);\n\t\t\t\t\t\t\t\t\t\t\tcallbacks.push(idx);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tif (items.length < _this13.items.length) {\n\t\t\t\t\t\t\t\t\t\ti = items.length - 1;\n\t\t\t\t\t\t\t\t\t\tnth = _this13.items.length;\n\n\t\t\t\t\t\t\t\t\t\twhile (++i < nth) {\n\t\t\t\t\t\t\t\t\t\t\tdestroy.push(i);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tarray.each(destroy.reverse(), function (i) {\n\t\t\t\t\t\t\t\t\t\t\telement.destroy(el.childNodes[i]);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (callback) {\n\t\t\t\t\t\t\t\t\t\tarray.each(callbacks, function (i) {\n\t\t\t\t\t\t\t\t\t\t\t_this13.callback(el.childNodes[i]);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Updating reference for next change\n\t\t\t\t\t\t\t_this13.items = items;\n\n\t\t\t\t\t\t\t// Rendering pagination elements\n\t\t\t\t\t\t\tif (_this13.pageSize !== null && regex.top_bottom.test(_this13.pagination) && !isNaN(_this13.pageIndex) && !isNaN(_this13.pageSize)) {\n\t\t\t\t\t\t\t\t_this13.pages();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tarray.each(utility.$(\"#\" + el.id + \"-pages-top, #\" + el.id + \"-pages-bottom\"), function (i) {\n\t\t\t\t\t\t\t\t\telement.destroy(i);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t_this13.dispatch(\"afterRefresh\", el);\n\t\t\t\t\t\t});\n\t\t\t\t\t};\n\n\t\t\t\t\t// Consuming records based on sort\n\t\t\t\t\tif (this.where === null) {\n\t\t\t\t\t\tstring.isEmpty(this.order) ? next(this.store.get()) : this.store.sort(this.order, create).then(next, function (e) {\n\t\t\t\t\t\t\tutility.error(e);\n\t\t\t\t\t\t\t_this13.dispatch(\"error\", e);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (string.isEmpty(this.order)) {\n\t\t\t\t\t\tthis.store.select(this.where).then(next, function (e) {\n\t\t\t\t\t\t\tutility.error(e);\n\t\t\t\t\t\t\t_this13.dispatch(\"error\", e);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.store.sort(this.order, create, this.where).then(next, function (e) {\n\t\t\t\t\t\t\tutility.error(e);\n\t\t\t\t\t\t\t_this13.dispatch(\"error\", e);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"remove\",\n\n\t\t\t\t/**\r\n     * Removes an item from the DataList\r\n     *\r\n     * @method remove\r\n     * @memberOf keigai.DataList\r\n     * @param {Mixed} record Record, key or index\r\n     * @return {Object} {@link keigai.DataList}\r\n     * @example\r\n     * // Adding a click handler to 'trash' Elements\r\n     * keigai.util.array.cast( document.querySelectorAll( \".list .trash\" ) ).forEach( function ( i ) {\r\n     *   i.addEventListener( \"click\", ( ev ) => {\r\n     *     let key = keigai.util.element.data( keigai.util.target( ev ).parentNode, \"key\" );\r\n     *\r\n     *     list.remove( key );\r\n     *   }, false );\r\n     * } );\r\n     */\n\t\t\t\tvalue: function remove(record) {\n\t\t\t\t\tvar _this14 = this;\n\n\t\t\t\t\tthis.store.del(record).then(null, function (e) {\n\t\t\t\t\t\tutility.error(e);\n\t\t\t\t\t\t_this14.dispatch(\"error\", e);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"sort\",\n\n\t\t\t\t/**\r\n     * Sorts data list & refreshes element\r\n     *\r\n     * @method sort\r\n     * @memberOf keigai.DataList\r\n     * @param  {String} order SQL \"ORDER BY\" clause\r\n     * @return {Object} {@link keigai.DataList}\r\n     * @example\r\n     * list.sort( \"age, name\" );\r\n     */\n\t\t\t\tvalue: function sort(order) {\n\t\t\t\t\tthis.order = order;\n\n\t\t\t\t\treturn this.refresh();\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"teardown\",\n\n\t\t\t\t/**\r\n     * Tears down references to the DataList\r\n     *\r\n     * @method teardown\r\n     * @memberOf keigai.DataList\r\n     * @param  {Boolean} destroy [Optional] `true` will remove the DataList from the DOM\r\n     * @return {Object} {@link keigai.DataList}\r\n     * @example\r\n     * list.teardown();\r\n     */\n\t\t\t\tvalue: function teardown() {\n\t\t\t\t\tvar _this15 = this;\n\n\t\t\t\t\tvar destroy = arguments[0] === undefined ? false : arguments[0];\n\n\t\t\t\t\tvar el = this.element;\n\t\t\t\t\tvar id = el.id;\n\n\t\t\t\t\tarray.each(this.store.lists, function (i, idx) {\n\t\t\t\t\t\tif (i.id === _this15.id) {\n\t\t\t\t\t\t\tarray.remove(_this15.store.lists, idx);\n\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (this.listFilter) {\n\t\t\t\t\t\tthis.listFilter.teardown();\n\t\t\t\t\t}\n\n\t\t\t\t\tarray.each(utility.$(\"#\" + id + \"-pages-top, #\" + id + \"-pages-bottom\"), function (i) {\n\t\t\t\t\t\t_this15.observer.unhook(i, \"click\");\n\n\t\t\t\t\t\tif (destroy) {\n\t\t\t\t\t\t\telement.destroy(i);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.observer.unhook(el, \"click\");\n\n\t\t\t\t\tif (destroy) {\n\t\t\t\t\t\telement.destroy(el);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.element = null;\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"update\",\n\n\t\t\t\t/**\r\n     * Updates an item in the DataList\r\n     *\r\n     * @method update\r\n     * @memberOf keigai.DataList\r\n     * @param {Mixed}  key  Key or index\r\n     * @param {Object} data New property values\r\n     * @return {Object}     {@link keigai.DataList}\r\n     * @example\r\n     * list.update( \"key\", {name: \"Jim Smith\"} );\r\n     */\n\t\t\t\tvalue: function update(key, data) {\n\t\t\t\t\tvar _this16 = this;\n\n\t\t\t\t\tthis.store.update(key, data).then(null, function (e) {\n\t\t\t\t\t\tutility.error(e);\n\t\t\t\t\t\t_this16.dispatch(\"error\", e);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}]);\n\n\t\t\treturn DataList;\n\t\t})(Base);\n\n\t\t/**\r\n   * @namespace list\r\n   */\n\t\tvar list = {\n\t\t\t/**\r\n    * Creates an instance of DataList\r\n    *\r\n    * @method factory\r\n    * @memberOf list\r\n    * @fires keigai.DataList#change Fires when the DOM changes\r\n    * @param  {Object} target   Element to receive the DataList\r\n    * @param  {Object} store    {@link keigai.DataStore}\r\n    * @param  {Mixed}  template Record field, template ( $.tpl ), or String, e.g. \"<p>this is a {{field}} sample.</p>\", fields are marked with {{ }}\r\n    * @param  {Object} options  Optional parameters to set on the DataList\r\n    * @return {Object} {@link keigai.DataList}\r\n    * @example\r\n    * let store = keigai.store( [...] ),\r\n    *     list  = keigai.list( document.querySelector(\"#list\"), store, \"{{name}}\", {order: \"name\"} );\r\n    */\n\t\t\tfactory: function factory(target, store, template, options) {\n\t\t\t\tvar ref = [store];\n\t\t\t\tvar obj = new DataList(element.create(\"ul\", { \"class\": \"list\", id: utility.genId(null, true) }, target), ref[0], template);\n\n\t\t\t\tif (options instanceof Object) {\n\t\t\t\t\tif (options.listFiltered && options.listFilter) {\n\t\t\t\t\t\tobj.listFilter = filter(element.create(\"input\", {\n\t\t\t\t\t\t\tid: obj.element.id + \"-filter\",\n\t\t\t\t\t\t\t\"class\": \"filter\",\n\t\t\t\t\t\t\tplaceholder: \"Filter\"\n\t\t\t\t\t\t}, target, \"first\"), obj, options.listFilter, options.debounce);\n\t\t\t\t\t\tdelete options.listFilter;\n\t\t\t\t\t\tdelete options.listFiltered;\n\t\t\t\t\t\tdelete options.debounce;\n\t\t\t\t\t}\n\n\t\t\t\t\tutility.merge(obj, options);\n\t\t\t\t}\n\n\t\t\t\tobj.store.lists.push(obj);\n\n\t\t\t\t// Setting up a chain of Events\n\t\t\t\tobj.on(\"beforeRefresh\", function (arg) {\n\t\t\t\t\telement.dispatch(arg, \"beforeRefresh\");\n\t\t\t\t}, \"bubble\");\n\n\t\t\t\tobj.on(\"afterRefresh\", function (arg) {\n\t\t\t\t\telement.dispatch(arg, \"afterRefresh\");\n\t\t\t\t}, \"bubble\");\n\n\t\t\t\tobj.on(\"change\", function (arg) {\n\t\t\t\t\telement.dispatch(obj.element, \"change\", arg);\n\t\t\t\t}, \"change\");\n\n\t\t\t\tobj.on(\"click\", function (e) {\n\t\t\t\t\tvar target = utility.target(e);\n\t\t\t\t\tvar page = undefined;\n\n\t\t\t\t\tutility.stop(e);\n\n\t\t\t\t\tif (target.nodeName === \"A\") {\n\t\t\t\t\t\tpage = element.data(target, \"page\");\n\n\t\t\t\t\t\tif (!isNaN(page)) {\n\t\t\t\t\t\t\tobj.page(page);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, \"pagination\");\n\n\t\t\t\tif (mutation) {\n\t\t\t\t\tobj.mutation = new MutationObserver(function (arg) {\n\t\t\t\t\t\tobj.dispatch(\"change\", arg);\n\t\t\t\t\t});\n\n\t\t\t\t\tobj.mutation.observe(obj.element, { childList: true, subtree: true });\n\t\t\t\t}\n\n\t\t\t\t// Rendering if not tied to an API or data is ready\n\t\t\t\tif (obj.store.uri === null || obj.store.loaded) {\n\t\t\t\t\tobj.refresh();\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Calculates the total pages\r\n    *\r\n    * @method pages\r\n    * @memberOf list\r\n    * @return {Number} Total pages\r\n    * @private\r\n    */\n\t\t\tpages: function pages(obj) {\n\t\t\t\tif (isNaN(obj.pageSize)) {\n\t\t\t\t\tthrow new Error(label.invalidArguments);\n\t\t\t\t}\n\n\t\t\t\treturn Math.ceil((!obj.filter ? obj.total : obj.filtered.length) / obj.pageSize);\n\t\t\t},\n\n\t\t\t/**\r\n    * Calculates the page size as an Array of start & finish\r\n    *\r\n    * @method range\r\n    * @memberOf list\r\n    * @return {Array}  Array of start & end numbers\r\n    * @private\r\n    */\n\t\t\trange: function range(obj) {\n\t\t\t\tvar start = obj.pageIndex * obj.pageSize - obj.pageSize;\n\t\t\t\tvar end = obj.pageSize;\n\n\t\t\t\treturn [start, end];\n\t\t\t}\n\t\t};\n\n\t\tvar Deferred = (function () {\n\t\t\t/**\r\n    * Creates a new Deferred\r\n    *\r\n    * @constructor\r\n    * @memberOf keigai\r\n    */\n\n\t\t\tfunction Deferred() {\n\t\t\t\tvar _this17 = this;\n\n\t\t\t\t_classCallCheck(this, Deferred);\n\n\t\t\t\tthis.promise = promise.factory();\n\t\t\t\tthis.onDone = [];\n\t\t\t\tthis.onAlways = [];\n\t\t\t\tthis.onFail = [];\n\n\t\t\t\t// Setting handlers to execute Arrays of Functions\n\t\t\t\tthis.promise.then(function (arg) {\n\t\t\t\t\tarray.each(_this17.onDone, function (i) {\n\t\t\t\t\t\ti(arg);\n\t\t\t\t\t});\n\n\t\t\t\t\tarray.each(_this17.onAlways, function (i) {\n\t\t\t\t\t\ti(arg);\n\t\t\t\t\t});\n\n\t\t\t\t\t_this17.onAlways = [];\n\t\t\t\t\t_this17.onDone = [];\n\t\t\t\t\t_this17.onFail = [];\n\t\t\t\t}, function (arg) {\n\t\t\t\t\tarray.each(_this17.onFail, function (i) {\n\t\t\t\t\t\ti(arg);\n\t\t\t\t\t});\n\n\t\t\t\t\tarray.each(_this17.onAlways, function (i) {\n\t\t\t\t\t\ti(arg);\n\t\t\t\t\t});\n\n\t\t\t\t\t_this17.onAlways = [];\n\t\t\t\t\t_this17.onDone = [];\n\t\t\t\t\t_this17.onFail = [];\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t_createClass(Deferred, [{\n\t\t\t\tkey: \"always\",\n\n\t\t\t\t/**\r\n     * Registers a function to execute after Promise is reconciled\r\n     *\r\n     * @method always\r\n     * @memberOf keigai.Deferred\r\n     * @param  {Function} arg Function to execute\r\n     * @return {Object} {@link keigai.Deferred}\r\n     * @example\r\n     * let deferred = keigai.util.defer();\r\n     *\r\n     * deferred.always( function () {\r\n     *     ...\r\n     * } ).then( function () {\r\n     *     ...\r\n     * } );\r\n     *\r\n     * ...\r\n     *\r\n     * deferred.resolve( true );\r\n     */\n\t\t\t\tvalue: function always(arg) {\n\t\t\t\t\tthis.onAlways.push(arg);\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"catch\",\n\n\t\t\t\t/**\r\n     * Catches errors from the Promise\r\n     *\r\n     * @method  catch\r\n     * @memberOf keigai.Deferred\r\n     * @param  {Function} arg Function to execute\r\n     * @return {Object} {@link keigai.Deferred}\r\n     * @example\r\n     * let deferred = keigai.util.defer();\r\n     *\r\n     * deferred.catch( function ( err ) {\r\n     *   ...\r\n     * } );\r\n     */\n\t\t\t\tvalue: function _catch(arg) {\n\t\t\t\t\treturn this.promise[\"catch\"](arg);\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"done\",\n\n\t\t\t\t/**\r\n     * Registers a function to execute after Promise is resolved\r\n     *\r\n     * @method done\r\n     * @memberOf keigai.Deferred\r\n     * @param  {Function} arg Function to execute\r\n     * @return {Object} {@link keigai.Deferred}\r\n     * @example\r\n     * let deferred = keigai.util.defer();\r\n     *\r\n     * deferred.done( function ( ... ) {\r\n     *   ...\r\n     * } );\r\n     */\n\t\t\t\tvalue: function done(arg) {\n\t\t\t\t\tthis.onDone.push(arg);\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"fail\",\n\n\t\t\t\t/**\r\n     * Registers a function to execute after Promise is rejected\r\n     *\r\n     * @method fail\r\n     * @memberOf keigai.Deferred\r\n     * @param  {Function} arg Function to execute\r\n     * @return {Object} {@link keigai.Deferred}\r\n     * @example\r\n     * let deferred = keigai.util.defer();\r\n     *\r\n     * deferred.fail( function ( ... ) {\r\n     *   ...\r\n     * } );\r\n     */\n\t\t\t\tvalue: function fail(arg) {\n\t\t\t\t\tthis.onFail.push(arg);\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"reject\",\n\n\t\t\t\t/**\r\n     * Rejects the Promise\r\n     *\r\n     * @method reject\r\n     * @memberOf keigai.Deferred\r\n     * @param  {Mixed} arg Rejection outcome\r\n     * @return {Object} {@link keigai.Deferred}\r\n     * @example\r\n     * let deferred = keigai.util.defer();\r\n     *\r\n     * deferred.reject( new Error( \"Something went wrong\" ) );\r\n     */\n\t\t\t\tvalue: function reject(arg) {\n\t\t\t\t\tthis.promise.reject.call(this.promise, arg);\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"resolve\",\n\n\t\t\t\t/**\r\n     * Resolves the Promise\r\n     *\r\n     * @method resolve\r\n     * @memberOf keigai.Deferred\r\n     * @param  {Mixed} arg Resolution outcome\r\n     * @return {Object} {@link keigai.Deferred}\r\n     * @example\r\n     * let deferred = keigai.util.defer();\r\n     *\r\n     * deferred.resolve( true );\r\n     */\n\t\t\t\tvalue: function resolve(arg) {\n\t\t\t\t\tthis.promise.resolve.call(this.promise, arg);\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"then\",\n\n\t\t\t\t/**\r\n     * Registers handler(s) for the Promise\r\n     *\r\n     * @method then\r\n     * @memberOf keigai.Deferred\r\n     * @param  {Function} success Executed when/if promise is resolved\r\n     * @param  {Function} failure [Optional] Executed when/if promise is broken\r\n     * @return {Object} {@link Promise}\r\n     * @example\r\n     * let deferred = keigai.util.defer();\r\n     *\r\n     * deferred.then( function ( ... ) { ... }, function ( err ) { ... } )\r\n     *         .then( function ( ... ) { ... }, function ( err ) { ... } );\r\n     *\r\n     * ...\r\n     *\r\n     * deferred.resolve( true );\r\n     */\n\t\t\t\tvalue: function then(success, failure) {\n\t\t\t\t\treturn this.promise.then(success, failure);\n\t\t\t\t}\n\t\t\t}]);\n\n\t\t\treturn Deferred;\n\t\t})();\n\n\t\t/**\r\n   * Deferred factory\r\n   *\r\n   * @method factory\r\n   * @memberOf deferred\r\n   * @return {Object} {@link keigai.Deferred}\r\n   * @example\r\n   * let deferred = keigai.util.defer();\r\n   *\r\n   * deferred.then( function ( ... ) { ... }, function ( err ) { ... } )\r\n   * deferred.always( function ( ... ) { ... } );\r\n   *\r\n   * ...\r\n   *\r\n   * deferred.resolve( true );\r\n   */\n\t\tvar deferred = function deferred() {\n\t\t\treturn new Deferred();\n\t\t};\n\n\t\t/**\r\n   * @namespace element\r\n   */\n\t\tvar element = {\n\t\t\t/**\r\n    * Adds a CSS class to an Element\r\n    *\r\n    * @method addClass\r\n    * @memberOf element\r\n    * @param  {Object} obj Element\r\n    * @param  {String} arg CSS class\r\n    * @return {Object}     Element\r\n    * @example\r\n    * keigai.util.element.addClass( document.querySelector( \"#target\" ), \"newClass\" );\r\n    */\n\t\t\taddClass: function addClass(obj, arg) {\n\t\t\t\telement.klass(obj, arg, true);\n\t\t\t},\n\n\t\t\t/**\r\n    * Appends an Element to an Element\r\n    *\r\n    * @method appendTo\r\n    * @memberOf element\r\n    * @param  {Object} obj   Element\r\n    * @param  {Object} child Child Element\r\n    * @return {Object}       Element\r\n    * @example\r\n    * keigai.util.element.appendTo( document.querySelector( \"#target\" ), document.querySelector( \"#something\" ) );\r\n    */\n\t\t\tappendTo: function appendTo(obj, child) {\n\t\t\t\tobj.appendChild(child);\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Gets or sets an Element attribute\r\n    *\r\n    * @method attr\r\n    * @memberOf element\r\n    * @param  {Object} obj   Element\r\n    * @param  {String} key   Attribute name\r\n    * @param  {Mixed}  value Attribute value\r\n    * @return {Object}       Element\r\n    * @example\r\n    * keigai.util.element.attr( document.querySelector( \"select\" ), \"selected\", \"option 1\" );\r\n    */\n\t\t\tattr: function attr(obj, key, value) {\n\t\t\t\tvar target = undefined,\n\t\t\t\t    result = undefined;\n\n\t\t\t\tif (regex.svg.test(obj.namespaceURI)) {\n\t\t\t\t\tif (value === undefined) {\n\t\t\t\t\t\tresult = obj.getAttributeNS(obj.namespaceURI, key);\n\n\t\t\t\t\t\tif (result === null || string.isEmpty(result)) {\n\t\t\t\t\t\t\tresult = undefined;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult = utility.coerce(result);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobj.setAttributeNS(obj.namespaceURI, key, value);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (typeof value === \"string\") {\n\t\t\t\t\t\tvalue = string.trim(value);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (regex.checked_disabled.test(key) && value === undefined) {\n\t\t\t\t\t\treturn utility.coerce(obj[key]);\n\t\t\t\t\t} else if (regex.checked_disabled.test(key) && value !== undefined) {\n\t\t\t\t\t\tobj[key] = value;\n\t\t\t\t\t} else if (obj.nodeName === \"SELECT\" && key === \"selected\" && value === undefined) {\n\t\t\t\t\t\treturn utility.dom(\"#\" + obj.id + \" option[selected=\\\"selected\\\"]\")[0] || utility.dom(\"#\" + obj.id + \" option\")[0];\n\t\t\t\t\t} else if (obj.nodeName === \"SELECT\" && key === \"selected\" && value !== undefined) {\n\t\t\t\t\t\ttarget = utility.dom(\"#\" + obj.id + \" option[selected=\\\"selected\\\"]\")[0];\n\n\t\t\t\t\t\tif (target !== undefined) {\n\t\t\t\t\t\t\ttarget.selected = false;\n\t\t\t\t\t\t\ttarget.removeAttribute(\"selected\");\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttarget = utility.dom(\"#\" + obj.id + \" option[value=\\\"\" + value + \"\\\"]\")[0];\n\t\t\t\t\t\ttarget.selected = true;\n\t\t\t\t\t\ttarget.setAttribute(\"selected\", \"selected\");\n\t\t\t\t\t} else if (value === undefined) {\n\t\t\t\t\t\tresult = obj.getAttribute(key);\n\n\t\t\t\t\t\tif (result === null || string.isEmpty(result)) {\n\t\t\t\t\t\t\tresult = undefined;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult = utility.coerce(result);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobj.setAttribute(key, value);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Clears an object's innerHTML, or resets it's state\r\n    *\r\n    * @method clear\r\n    * @memberOf element\r\n    * @param  {Object} obj Element\r\n    * @return {Object}     Element\r\n    * @example\r\n    * keigai.util.element.clear( document.querySelector( \"#something\" ) );\r\n    */\n\t\t\tclear: function clear(obj) {\n\t\t\t\tif (typeof obj.reset === \"function\") {\n\t\t\t\t\tobj.reset();\n\t\t\t\t} else if (obj.value !== undefined) {\n\t\t\t\t\telement.update(obj, { innerHTML: \"\", value: \"\" });\n\t\t\t\t} else {\n\t\t\t\t\telement.update(obj, { innerHTML: \"\" });\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Creates an Element in document.body or a target Element.\r\n    * An id is generated if not specified with args.\r\n    *\r\n    * @method create\r\n    * @memberOf element\r\n    * @param  {String} type Type of Element to create, or HTML String\r\n    * @param  {Object} args [Optional] Properties to set\r\n    * @param  {Object} obj  [Optional] Target Element\r\n    * @param  {Mixed}  pos  [Optional] \"first\", \"last\" or Object describing how to add the new Element, e.g. {before: referenceElement}, default is \"last\"\r\n    * @return {Mixed}       Element that was created, or an Array if `type` is a String of multiple Elements (frag)\r\n    * @example\r\n    * keigai.util.element.create( \"div\", {innerHTML: \"Hello World!\"}, document.querySelector( \"#something\" ) );\r\n    * keigai.util.element.create( \"&lt;div&gt;Hello World!&lt;/div&gt;\" );\r\n    */\n\t\t\tcreate: function create(type, args, obj, pos) {\n\t\t\t\tvar svg = false;\n\t\t\t\tvar frag = false;\n\t\t\t\tvar fragment = undefined,\n\t\t\t\t    result = undefined;\n\n\t\t\t\t// Removing potential HTML template formatting\n\t\t\t\ttype = type.replace(/\\t|\\n|\\r/g, \"\");\n\n\t\t\t\tif (obj) {\n\t\t\t\t\tsvg = obj.namespaceURI && regex.svg.test(obj.namespaceURI);\n\t\t\t\t} else {\n\t\t\t\t\tobj = document.body;\n\t\t\t\t}\n\n\t\t\t\t// String injection, create a frag and apply it\n\t\t\t\tif (regex.html.test(type)) {\n\t\t\t\t\tfrag = true;\n\t\t\t\t\tfragment = element.frag(type);\n\t\t\t\t\tresult = fragment.childNodes.length === 1 ? fragment.childNodes[0] : array.cast(fragment.childNodes);\n\t\t\t\t}\n\t\t\t\t// Original syntax\n\t\t\t\telse {\n\t\t\t\t\tif (!svg && !regex.svg.test(type)) {\n\t\t\t\t\t\tfragment = document.createElement(type);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfragment = document.createElementNS(\"http://www.w3.org/2000/svg\", type);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (args instanceof Object) {\n\t\t\t\t\t\telement.update(fragment, args);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!pos || pos === \"last\") {\n\t\t\t\t\tobj.appendChild(fragment);\n\t\t\t\t} else if (pos === \"first\") {\n\t\t\t\t\telement.prependChild(obj, fragment);\n\t\t\t\t} else if (pos === \"after\") {\n\t\t\t\t\tpos = { after: obj };\n\t\t\t\t\tobj = obj.parentNode;\n\t\t\t\t\tobj.insertBefore(fragment, pos.after.nextSibling);\n\t\t\t\t} else if (pos.after) {\n\t\t\t\t\tobj.insertBefore(fragment, pos.after.nextSibling);\n\t\t\t\t} else if (pos === \"before\") {\n\t\t\t\t\tpos = { before: obj };\n\t\t\t\t\tobj = obj.parentNode;\n\t\t\t\t\tobj.insertBefore(fragment, pos.before);\n\t\t\t\t} else if (pos.before) {\n\t\t\t\t\tobj.insertBefore(fragment, pos.before);\n\t\t\t\t} else {\n\t\t\t\t\tobj.appendChild(fragment);\n\t\t\t\t}\n\n\t\t\t\treturn !frag ? fragment : result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Gets or sets a CSS style attribute on an Element\r\n    *\r\n    * @method css\r\n    * @memberOf element\r\n    * @param  {Object} obj   Element\r\n    * @param  {String} key   CSS to put in a style tag\r\n    * @param  {String} value [Optional] Value to set\r\n    * @return {Object}       Element\r\n    * @example\r\n    * keigai.util.element.css( document.querySelector( \"#something\" ), \"font-weight\", \"bold\" );\r\n    * keigai.util.element.css( document.querySelector( \"#something\" ), \"font-weight\" ); // \"bold\"\r\n    */\n\t\t\tcss: function css(obj, key, value) {\n\t\t\t\tif (!regex.caps.test(key)) {\n\t\t\t\t\tkey = string.toCamelCase(key);\n\t\t\t\t}\n\n\t\t\t\tif (value !== undefined) {\n\t\t\t\t\tobj.style[key] = value;\n\t\t\t\t\treturn obj;\n\t\t\t\t} else {\n\t\t\t\t\treturn obj.style[key];\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\r\n    * Data attribute facade acting as a getter (with coercion) & setter\r\n    *\r\n    * @method data\r\n    * @memberOf element\r\n    * @param  {Object} obj   Element\r\n    * @param  {String} key   Data key\r\n    * @param  {Mixed}  value Boolean, Number or String to set\r\n    * @return {Mixed}        undefined, Element or value\r\n    * @example\r\n    * // Setting\r\n    * keigai.util.element.data( document.querySelector( \"#something\" ), \"id\", \"abc-1234\" );\r\n    *\r\n    * // Getting\r\n    * keigai.util.element.data( document.querySelector( \"#something\" ), \"id\" ); // \"abc-1234\"\r\n    *\r\n    * // Unsetting\r\n    * keigai.util.element.data( document.querySelector( \"#something\" ), \"id\", null );\r\n    *\r\n    * // Setting a `null` value can be done by using a String\r\n    * keigai.util.element.data( document.querySelector( \"#something\" ), \"id\", \"null\" );\r\n    */\n\t\t\tdata: function data(obj, key, value) {\n\t\t\t\tif (value !== undefined) {\n\t\t\t\t\tobj.setAttribute(\"data-\" + key, regex.json_wrap.test(value) ? json.encode(value) : value);\n\n\t\t\t\t\treturn obj;\n\t\t\t\t} else {\n\t\t\t\t\treturn utility.coerce(obj.getAttribute(\"data-\" + key));\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\r\n    * Destroys an Element\r\n    *\r\n    * @method destroy\r\n    * @memberOf element\r\n    * @param  {Object} obj Element\r\n    * @return {Undefined} undefined\r\n    * @example\r\n    * keigai.util.element.destroy( document.querySelector( \"#something\" ) );\r\n    */\n\t\t\tdestroy: function destroy(obj) {\n\t\t\t\tif (obj.parentNode !== null) {\n\t\t\t\t\tobj.parentNode.removeChild(obj);\n\t\t\t\t}\n\n\t\t\t\treturn undefined;\n\t\t\t},\n\n\t\t\t/**\r\n    * Disables an Element\r\n    *\r\n    * @method disable\r\n    * @memberOf element\r\n    * @param  {Object} obj Element\r\n    * @return {Object}     Element\r\n    * @example\r\n    * keigai.util.element.disable( document.querySelector( \"#something\" ) );\r\n    */\n\t\t\tdisable: function disable(obj) {\n\t\t\t\tif (typeof obj.disabled === \"boolean\" && !obj.disabled) {\n\t\t\t\t\tobj.disabled = true;\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Dispatches a DOM Event from an Element\r\n    *\r\n    * `data` will appear as `Event.detail`\r\n    *\r\n    * @method dispatch\r\n    * @memberOf element\r\n    * @param  {Object}  obj        Element which dispatches the Event\r\n    * @param  {String}  type       Type of Event to dispatch\r\n    * @param  {Object}  data       [Optional] Data to include with the Event\r\n    * @param  {Boolean} bubbles    [Optional] Determines if the Event bubbles, defaults to `true`\r\n    * @param  {Boolean} cancelable [Optional] Determines if the Event can be canceled, defaults to `true`\r\n    * @return {Object}             Element which dispatches the Event\r\n    * @example\r\n    * keigai.util.element.dispatch( document.querySelector( \"#something\" ), \"click\" );\r\n    */\n\t\t\tdispatch: function dispatch(obj, type) {\n\t\t\t\tvar data = arguments[2] === undefined ? {} : arguments[2];\n\t\t\t\tvar bubbles = arguments[3] === undefined ? true : arguments[3];\n\t\t\t\tvar cancelable = arguments[4] === undefined ? true : arguments[4];\n\n\t\t\t\tvar ev = undefined;\n\n\t\t\t\tif (!obj) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tev = new CustomEvent(type);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tev = document.createEvent(\"CustomEvent\");\n\t\t\t\t}\n\n\t\t\t\tev.initCustomEvent(type, bubbles, cancelable, data);\n\t\t\t\tobj.dispatchEvent(ev);\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Enables an Element\r\n    *\r\n    * @method enable\r\n    * @memberOf element\r\n    * @param  {Object} obj Element\r\n    * @return {Object}     Element\r\n    * @example\r\n    * keigai.util.element.enable( document.querySelector( \"#something\" ) );\r\n    */\n\t\t\tenable: function enable(obj) {\n\t\t\t\tif (typeof obj.disabled === \"boolean\" && obj.disabled) {\n\t\t\t\t\tobj.disabled = false;\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Finds descendant childNodes of Element matched by arg\r\n    *\r\n    * @method find\r\n    * @memberOf element\r\n    * @param  {Object} obj Element to search\r\n    * @param  {String} arg Comma delimited string of descendant selectors\r\n    * @return {Mixed}      Array of Elements or undefined\r\n    * @example\r\n    * keigai.util.element.find( document.querySelector( \"#something\" ), \"p\" );\r\n    */\n\t\t\tfind: function find(obj, arg) {\n\t\t\t\tvar result = [];\n\n\t\t\t\tarray.each(string.explode(arg), function (i) {\n\t\t\t\t\tresult = result.concat(array.cast(obj.querySelectorAll(i)));\n\t\t\t\t});\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Creates a document fragment\r\n    *\r\n    * @method frag\r\n    * @memberOf element\r\n    * @param  {String} arg [Optional] innerHTML\r\n    * @return {Object}     Document fragment\r\n    * @example\r\n    * let frag = keigai.util.element.frag( \"Hello World!\" );\r\n    */\n\t\t\tfrag: function frag(arg) {\n\t\t\t\tvar obj = document.createDocumentFragment();\n\n\t\t\t\tif (arg) {\n\t\t\t\t\tarray.each(array.cast(element.create(\"div\", { innerHTML: arg }, obj).childNodes), function (i) {\n\t\t\t\t\t\tobj.appendChild(i);\n\t\t\t\t\t});\n\n\t\t\t\t\tobj.removeChild(obj.childNodes[0]);\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Determines if Element has descendants matching arg\r\n    *\r\n    * @method has\r\n    * @memberOf element\r\n    * @param  {Object} obj Element\r\n    * @param  {String} arg Type of Element to find\r\n    * @return {Boolean}    `true` if 1 or more Elements are found\r\n    * @example\r\n    * if ( keigai.util.element.has( document.querySelector( \"#something\" ), \"p\" ) ) {\r\n    *   ...\r\n    * }\r\n    */\n\t\t\thas: function has(obj, arg) {\n\t\t\t\tvar result = element.find(obj, arg);\n\n\t\t\t\treturn !isNaN(result.length) && result.length > 0;\n\t\t\t},\n\n\t\t\t/**\r\n    * Determines if obj has a specific CSS class\r\n    *\r\n    * @method hasClass\r\n    * @memberOf element\r\n    * @param  {Object} obj Element\r\n    * @param  {String} arg CSS class to test for\r\n    * @return {Boolean}    `true` if Element has `arg`\r\n    * @example\r\n    * if ( keigai.util.element.hasClass( document.querySelector( \"#something\" ), \"someClass\" ) ) {\r\n    *   ...\r\n    * }\r\n    */\n\t\t\thasClass: function hasClass(obj, arg) {\n\t\t\t\treturn obj.classList.contains(arg);\n\t\t\t},\n\n\t\t\t/**\r\n    * Returns a Boolean indidcating if the Object is hidden\r\n    *\r\n    * @method hidden\r\n    * @memberOf element\r\n    * @param  {Object} obj Element\r\n    * @return {Boolean}   `true` if hidden\r\n    * @example\r\n    * if ( keigai.util.element.hidden( document.querySelector( \"#something\" ) ) ) {\r\n    *   ...\r\n    * }\r\n    */\n\t\t\thidden: function hidden(obj) {\n\t\t\t\treturn obj.style.display === \"none\" || obj.hidden === true;\n\t\t\t},\n\n\t\t\t/**\r\n    * Gets or sets an Elements innerHTML\r\n    *\r\n    * @method html\r\n    * @memberOf element\r\n    * @param  {Object} obj Element\r\n    * @param  {String} arg [Optional] innerHTML value\r\n    * @return {Object}     Element\r\n    * @example\r\n    * keigai.util.element.html( document.querySelector( \"#something\" ), \"Hello World!\" );\r\n    * keigai.util.element.html( document.querySelector( \"#something\" ) ); // \"Hello World!\"\r\n    */\n\t\t\thtml: function html(obj, arg) {\n\t\t\t\tif (arg === undefined) {\n\t\t\t\t\treturn obj.innerHTML;\n\t\t\t\t} else {\n\t\t\t\t\tobj.innerHTML = arg;\n\t\t\t\t\treturn obj;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\r\n    * Determines if Element is equal to `arg`, supports nodeNames & CSS2+ selectors\r\n    *\r\n    * @method is\r\n    * @memberOf element\r\n    * @param  {Object} obj Element\r\n    * @param  {String} arg Property to query\r\n    * @return {Boolean}    `true` if a match\r\n    * @example\r\n    * if ( keigai.util.element.is( document.querySelector( \"#something\" ), \"div\" ) ) {\r\n    *   ...\r\n    * }\r\n    *\r\n    * if ( keigai.util.element.is( document.querySelector( \"#something\" ), \":first-child\" ) ) {\r\n    *   ...\r\n    * }\r\n    */\n\t\t\tis: function is(obj, arg) {\n\t\t\t\tif (regex.selector_is.test(arg)) {\n\t\t\t\t\treturn element.find(obj.parentNode, obj.nodeName.toLowerCase() + arg).filter(function (i) {\n\t\t\t\t\t\treturn i.id === obj.id;\n\t\t\t\t\t}).length === 1;\n\t\t\t\t} else {\n\t\t\t\t\treturn new RegExp(arg, \"i\").test(obj.nodeName);\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\r\n    * Adds or removes a CSS class\r\n    *\r\n    * @method klass\r\n    * @memberOf element\r\n    * @param  {Object}  obj Element\r\n    * @param  {String}  arg Class to add or remove ( can be a wildcard )\r\n    * @param  {Boolean} add Boolean to add or remove, defaults to true\r\n    * @return {Object}      Element\r\n    * @example\r\n    * // Adding a class\r\n    * keigai.util.element.klass( document.querySelector( \"#something\" ), \"newClass\" );\r\n    *\r\n    * // Removing a class\r\n    * keigai.util.element.klass( document.querySelector( \"#something\" ), \"newClass\", false );\r\n    */\n\t\t\tklass: function klass(obj, arg) {\n\t\t\t\tvar add = arguments[2] === undefined ? true : arguments[2];\n\n\t\t\t\targ = string.explode(arg, \" \");\n\n\t\t\t\tif (add) {\n\t\t\t\t\tarray.each(arg, function (i) {\n\t\t\t\t\t\tobj.classList.add(i);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tarray.each(arg, function (i) {\n\t\t\t\t\t\tif (i !== \"*\") {\n\t\t\t\t\t\t\tobj.classList.remove(i);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tarray.each(obj.classList, function (x) {\n\t\t\t\t\t\t\t\tobj.classList.remove(x);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Finds the position of an Element\r\n    *\r\n    * @method position\r\n    * @memberOf element\r\n    * @param  {Object} obj Element\r\n    * @return {Array}      Coordinates [left, top, right, bottom]\r\n    * @example\r\n    * let pos = keigai.util.element.position( document.querySelector( \"#something\" ) );\r\n    */\n\t\t\tposition: function position() {\n\t\t\t\tvar obj = arguments[0] === undefined ? document.body : arguments[0];\n\n\t\t\t\tvar left = undefined,\n\t\t\t\t    top = undefined,\n\t\t\t\t    right = undefined,\n\t\t\t\t    bottom = undefined,\n\t\t\t\t    height = undefined,\n\t\t\t\t    width = undefined;\n\n\t\t\t\tleft = top = 0;\n\t\t\t\twidth = obj.offsetWidth;\n\t\t\t\theight = obj.offsetHeight;\n\n\t\t\t\tif (obj.offsetParent) {\n\t\t\t\t\ttop = obj.offsetTop;\n\t\t\t\t\tleft = obj.offsetLeft;\n\n\t\t\t\t\twhile (obj = obj.offsetParent) {\n\t\t\t\t\t\tleft += obj.offsetLeft;\n\t\t\t\t\t\ttop += obj.offsetTop;\n\t\t\t\t\t}\n\n\t\t\t\t\tright = document.body.offsetWidth - (left + width);\n\t\t\t\t\tbottom = document.body.offsetHeight - (top + height);\n\t\t\t\t} else {\n\t\t\t\t\tright = width;\n\t\t\t\t\tbottom = height;\n\t\t\t\t}\n\n\t\t\t\treturn [left, top, right, bottom];\n\t\t\t},\n\n\t\t\t/**\r\n    * Prepends an Element to an Element\r\n    *\r\n    * @method prependChild\r\n    * @memberOf element\r\n    * @param  {Object} obj   Element\r\n    * @param  {Object} child Child Element\r\n    * @return {Object}       Element\r\n    * @example\r\n    * keigai.util.element.prependChild( document.querySelector( \"#target\" ), document.querySelector( \"#something\" ) );\r\n    */\n\t\t\tprependChild: function prependChild(obj, child) {\n\t\t\t\treturn obj.childNodes.length === 0 ? obj.appendChild(child) : obj.insertBefore(child, obj.childNodes[0]);\n\t\t\t},\n\n\t\t\t/**\r\n    * Removes an Element attribute\r\n    *\r\n    * @method removeAttr\r\n    * @memberOf element\r\n    * @param  {Object} obj Element\r\n    * @param  {String} key Attribute name\r\n    * @return {Object}     Element\r\n    * @example\r\n    * keigai.util.element.removeAttr( document.querySelector( \"a\" ), \"href\" );\r\n    */\n\t\t\tremoveAttr: function removeAttr(obj, key) {\n\t\t\t\tif (regex.svg.test(obj.namespaceURI)) {\n\t\t\t\t\tobj.removeAttributeNS(obj.namespaceURI, key);\n\t\t\t\t} else if (obj.nodeName === \"SELECT\" && key === \"selected\") {\n\t\t\t\t\tarray.each(element.find(obj, \"option\"), function (i) {\n\t\t\t\t\t\tif (i.selected === true) {\n\t\t\t\t\t\t\ti.selected = false;\n\t\t\t\t\t\t\ti.removeAttribute(\"selected\");\n\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tobj.removeAttribute(key);\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Removes a CSS class from Element\r\n    *\r\n    * @method removeClass\r\n    * @memberOf element\r\n    * @param  {Object} obj Element\r\n    * @param  {String} arg CSS class\r\n    * @return {Object}     Element\r\n    * @example\r\n    * keigai.util.element.removeClass( document.querySelector( \"#target\" ), \"existingClass\" );\r\n    */\n\t\t\tremoveClass: function removeClass(obj, arg) {\n\t\t\t\telement.klass(obj, arg, false);\n\t\t\t},\n\n\t\t\t/**\r\n    * Scrolls to the position of an Element\r\n    *\r\n    * @method scrollTo\r\n    * @memberOf element\r\n    * @param  {Object} obj        Element to scroll to\r\n    * @param  {Number} ms         [Optional] Milliseconds to scroll, default is 250, min is 100\r\n    * @param  {Number} offsetTop  [Optional] Offset from top of Element\r\n    * @param  {Number} offsetLeft [Optional] Offset from left of Element\r\n    * @return {Object} {@link Deferred}\r\n    * @example\r\n    * keigai.util.element.scrollTo( document.querySelector( \"#something\" ) ).then( () => {\r\n    *   ...\r\n    * } );\r\n    */\n\t\t\tscrollTo: function scrollTo(obj, ms, offsetTop, offsetLeft) {\n\t\t\t\tvar pos = array.remove(element.position(obj), 2, 3);\n\n\t\t\t\tif (!isNaN(offsetTop)) {\n\t\t\t\t\tpos[0] += offsetTop;\n\t\t\t\t}\n\n\t\t\t\tif (!isNaN(offsetLeft)) {\n\t\t\t\t\tpos[1] += offsetLeft;\n\t\t\t\t}\n\n\t\t\t\treturn client.scroll(pos, ms);\n\t\t\t},\n\n\t\t\t/**\r\n    * Serializes the elements of an Element\r\n    *\r\n    * @method serialize\r\n    * @memberOf element\r\n    * @param  {Object}  obj    Element\r\n    * @param  {Boolean} string [Optional] true if you want a query string, default is false ( JSON )\r\n    * @param  {Boolean} encode [Optional] true if you want to URI encode the value, default is true\r\n    * @return {Mixed}          String or Object\r\n    * @example\r\n    * let userInput = keigai.util.element.serialize( document.querySelector( \"form\" ) );\r\n    */\n\t\t\tserialize: function serialize(obj) {\n\t\t\t\tvar string = arguments[1] === undefined ? true : arguments[1];\n\t\t\t\tvar encode = arguments[2] === undefined ? true : arguments[2];\n\n\t\t\t\tvar registry = {};\n\t\t\t\tvar children = undefined,\n\t\t\t\t    result = undefined;\n\n\t\t\t\tchildren = obj.nodeName === \"FORM\" ? obj.elements ? array.cast(obj.elements) : obj.find(\"button, input, select, textarea\") : [obj];\n\n\t\t\t\tarray.each(children, function (i) {\n\t\t\t\t\tvar id = i.id || i.name || i.type;\n\n\t\t\t\t\tif (i.nodeName === \"FORM\") {\n\t\t\t\t\t\tutility.merge(registry, json.decode(element.serialize(i)));\n\t\t\t\t\t} else if (!registry[id]) {\n\t\t\t\t\t\tregistry[id] = element.val(i);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (!string) {\n\t\t\t\t\tresult = registry;\n\t\t\t\t} else {\n\t\t\t\t\tresult = \"\";\n\n\t\t\t\t\tutility.iterate(registry, function (v, k) {\n\t\t\t\t\t\tencode ? result += \"&\" + encodeURIComponent(k) + \"=\" + encodeURIComponent(v) : result += \"&\" + k + \"=\" + v;\n\t\t\t\t\t});\n\n\t\t\t\t\tresult = result.replace(regex.and, \"?\");\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Returns the size of the Element\r\n    *\r\n    * @method size\r\n    * @memberOf element\r\n    * @param  {Object} obj Element\r\n    * @return {Array}      [width, height]\r\n    * @example\r\n    * let size = keigai.util.element.size( document.querySelector( \"#something\" ) );\r\n    */\n\t\t\tsize: function size(obj) {\n\t\t\t\treturn [obj.offsetWidth + number.parse(obj.style.paddingLeft || 0) + number.parse(obj.style.paddingRight || 0) + number.parse(obj.style.borderLeft || 0) + number.parse(obj.style.borderRight || 0), obj.offsetHeight + number.parse(obj.style.paddingTop || 0) + number.parse(obj.style.paddingBottom || 0) + number.parse(obj.style.borderTop || 0) + number.parse(obj.style.borderBottom || 0)];\n\t\t\t},\n\n\t\t\t/**\r\n    * Getter / setter for an Element's text\r\n    *\r\n    * @method text\r\n    * @memberOf element\r\n    * @param  {Object} obj Element\r\n    * @param  {String} arg [Optional] Value to set\r\n    * @return {Object}     Element\r\n    * @example\r\n    * let obj  = document.querySelector( \"#something\" ),\r\n    *     text = keigai.util.element.text( obj );\r\n    *\r\n    * keigai.util.element.text( obj, text + \", and some more text\" );\r\n    */\n\t\t\ttext: function text(obj, arg) {\n\t\t\t\tvar key = obj.textContent ? \"textContent\" : \"innerText\";\n\t\t\t\tvar payload = {};\n\t\t\t\tvar set = false;\n\n\t\t\t\tif (typeof arg !== \"undefined\") {\n\t\t\t\t\tset = true;\n\t\t\t\t\tpayload[key] = arg;\n\t\t\t\t}\n\n\t\t\t\treturn set ? element.update(obj, payload) : obj[key];\n\t\t\t},\n\n\t\t\t/**\r\n    * Toggles a CSS class\r\n    *\r\n    * @method toggleClass\r\n    * @memberOf element\r\n    * @param  {Object} obj Element\r\n    * @param  {String} arg CSS class to toggle\r\n    * @return {Object}     Element\r\n    * @example\r\n    * let obj = document.querySelector( \"#something\" );\r\n    *\r\n    * keigai.util.element.toggleClass( obj, \"someClass\" );\r\n    */\n\t\t\ttoggleClass: function toggleClass(obj, arg) {\n\t\t\t\tobj.classList.toggle(arg);\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Updates an Element\r\n    *\r\n    * @method update\r\n    * @memberOf element\r\n    * @param  {Object}  obj  Element\r\n    * @param  {Object} args Properties to set\r\n    * @return {Object}      Element\r\n    * @example\r\n    * keigai.util.element.update( document.querySelector( \"#something\" ), {innerHTML: \"Hello World!\", \"class\": \"new\"} );\r\n    */\n\t\t\tupdate: function update(obj, args) {\n\t\t\t\tutility.iterate(args, function (v, k) {\n\t\t\t\t\tif (regex.element_update.test(k)) {\n\t\t\t\t\t\tobj[k] = v;\n\t\t\t\t\t} else if (k === \"class\") {\n\t\t\t\t\t\t!string.isEmpty(v) ? element.addClass(obj, v) : element.removeClass(obj, \"*\");\n\t\t\t\t\t} else if (k.indexOf(\"data-\") === 0) {\n\t\t\t\t\t\telement.data(obj, k.replace(\"data-\", \"\"), v);\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.attr(obj, k, v);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Gets or sets the value of Element\r\n    *\r\n    * @method val\r\n    * @memberOf element\r\n    * @param  {Object} obj   Element\r\n    * @param  {Mixed}  value [Optional] Value to set\r\n    * @return {Object}       Element\r\n    * @example\r\n    * keigai.util.element.val( document.querySelector( \"input[type='text']\" ), \"new value\" );\r\n    */\n\t\t\tval: function val(obj, value) {\n\t\t\t\tvar ev = \"input\";\n\t\t\t\tvar output = undefined;\n\n\t\t\t\tif (value === undefined) {\n\t\t\t\t\tif (regex.radio_checkbox.test(obj.type)) {\n\t\t\t\t\t\tif (string.isEmpty(obj.name)) {\n\t\t\t\t\t\t\tthrow new Error(label.expectedProperty);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tarray.each(utility.dom(\"input[name='\" + obj.name + \"']\"), function (i) {\n\t\t\t\t\t\t\tif (i.checked) {\n\t\t\t\t\t\t\t\toutput = i.value;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (regex.select.test(obj.type)) {\n\t\t\t\t\t\toutput = null;\n\t\t\t\t\t\tarray.each(element.find(obj, \"option\"), function (i) {\n\t\t\t\t\t\t\tif (i.selected === true) {\n\t\t\t\t\t\t\t\toutput = i.value;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (obj.value) {\n\t\t\t\t\t\toutput = obj.value;\n\t\t\t\t\t} else if (obj.placeholder) {\n\t\t\t\t\t\toutput = obj.placeholder === obj.innerText ? undefined : obj.innerText;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toutput = element.text(obj);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (output !== undefined) {\n\t\t\t\t\t\toutput = utility.coerce(output);\n\n\t\t\t\t\t\tif (typeof output === \"string\") {\n\t\t\t\t\t\t\toutput = string.trim(output);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\toutput = \"\";\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tvalue = value.toString();\n\n\t\t\t\t\tif (regex.radio_checkbox.test(obj.type)) {\n\t\t\t\t\t\tev = \"click\";\n\n\t\t\t\t\t\tarray.each(utility.dom(\"input[name='\" + obj.name + \"']\"), function (i) {\n\t\t\t\t\t\t\tif (i.value === value) {\n\t\t\t\t\t\t\t\ti.checked = true;\n\t\t\t\t\t\t\t\toutput = i;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (regex.select.test(obj.type)) {\n\t\t\t\t\t\tev = \"change\";\n\n\t\t\t\t\t\tarray.each(element.find(obj, \" option\"), function (i) {\n\t\t\t\t\t\t\tif (i.value === value) {\n\t\t\t\t\t\t\t\ti.selected = true;\n\t\t\t\t\t\t\t\toutput = i;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobj.value !== undefined ? obj.value = value : element.text(obj, value);\n\t\t\t\t\t}\n\n\t\t\t\t\telement.dispatch(obj, ev);\n\n\t\t\t\t\toutput = obj;\n\t\t\t\t}\n\n\t\t\t\treturn output;\n\t\t\t}\n\t\t};\n\n\t\t/**\r\n   * @namespace json\r\n   */\n\t\tvar json = {\n\t\t\t/**\r\n    * Decodes the argument\r\n    *\r\n    * @method decode\r\n    * @memberOf json\r\n    * @param  {String}  arg    String to parse\r\n    * @param  {Boolean} silent [Optional] Silently fail\r\n    * @return {Mixed}          Entity resulting from parsing JSON, or undefined\r\n    * @example\r\n    * let x = keigai.util.json.decode( ..., true );\r\n    *\r\n    * if ( x ) {\r\n    *   ...\r\n    * } else {\r\n    *   ... // invalid JSON, with `Error` suppressed by `silent`\r\n    * }\r\n    */\n\t\t\tdecode: function decode(arg, silent) {\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.parse(arg);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (silent !== true) {\n\t\t\t\t\t\tutility.error(e, [arg, silent]);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\r\n    * Encodes `arg` as JSON\r\n    *\r\n    * @method encode\r\n    * @memberOf json\r\n    * @param  {Mixed}   arg    Primative\r\n    * @param  {Boolean} silent [Optional] Silently fail\r\n    * @return {String}         JSON, or undefined\r\n    * @example\r\n    * let x = keigai.util.json.encode( ..., true );\r\n    *\r\n    * if ( x ) {\r\n    *   ...\r\n    * } else {\r\n    *   ... // invalid JSON, with `Error` suppressed by `silent`\r\n    * }\r\n    */\n\t\t\tencode: function encode(arg, silent) {\n\t\t\t\ttry {\n\t\t\t\t\treturn JSON.stringify(arg);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (silent !== true) {\n\t\t\t\t\t\tutility.error(e, [arg, silent]);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\r\n   * @namespace label\r\n   * @private\r\n   */\n\t\tvar label = {\n\t\t\t/**\r\n    * Expected a Number\r\n    *\r\n    * @type {String}\r\n    * @memberOf label\r\n    */\n\t\t\texpectedNumber: \"Expected a Number\",\n\n\t\t\t/**\r\n    * Expected a property, and it was not set\r\n    *\r\n    * @type {String}\r\n    * @memberOf label\r\n    */\n\t\t\texpectedProperty: \"Expected a property, and it was not set\",\n\n\t\t\t/**\r\n    * Expected an Object\r\n    *\r\n    * @type {String}\r\n    * @memberOf label\r\n    */\n\t\t\texpectedObject: \"Expected an Object\",\n\n\t\t\t/**\r\n    * One or more arguments is invalid\r\n    *\r\n    * @type {String}\r\n    * @memberOf label\r\n    */\n\t\t\tinvalidArguments: \"One or more arguments is invalid\",\n\n\t\t\t/**\r\n    * INVALID_STATE_ERR: Headers have not been received\r\n    *\r\n    * @type {String}\r\n    * @memberOf label\r\n    */\n\t\t\tinvalidStateNoHeaders: \"INVALID_STATE_ERR: Headers have not been received\",\n\n\t\t\t/**\r\n    * Synchronous XMLHttpRequest requests are not supported\r\n    *\r\n    * @type {String}\r\n    * @memberOf label\r\n    */\n\t\t\tinvalidStateNoSync: \"Synchronous XMLHttpRequest requests are not supported\",\n\n\t\t\t/**\r\n    * INVALID_STATE_ERR: Object is not open\r\n    *\r\n    * @type {String}\r\n    * @memberOf label\r\n    */\n\t\t\tinvalidStateNotOpen: \"INVALID_STATE_ERR: Object is not open\",\n\n\t\t\t/**\r\n    * INVALID_STATE_ERR: Object is sending\r\n    *\r\n    * @type {String}\r\n    * @memberOf label\r\n    */\n\t\t\tinvalidStateNotSending: \"INVALID_STATE_ERR: Object is sending\",\n\n\t\t\t/**\r\n    * INVALID_STATE_ERR: Object is not usable\r\n    *\r\n    * @type {String}\r\n    * @memberOf label\r\n    */\n\t\t\tinvalidStateNotUsable: \"INVALID_STATE_ERR: Object is not usable\",\n\n\t\t\t/**\r\n    * Error when deferred is rejected for invalid request\r\n    *\r\n    * @type {String}\r\n    * @memberOf label\r\n    */\n\t\t\tmethodNotAllowed: \"Method not allowed\",\n\n\t\t\t/**\r\n    * Default `emptyMsg` of DataLists\r\n    *\r\n    * @type {String}\r\n    * @memberOf label\r\n    */\n\t\t\tnoData: \"Nothing to display\",\n\n\t\t\t/**\r\n    * Requested method is not available\r\n    *\r\n    * @type {String}\r\n    * @memberOf label\r\n    */\n\t\t\tnotAvailable: \"Requested method is not available\",\n\n\t\t\t/**\r\n    * No previous version of a record\r\n    *\r\n    * @type {String}\r\n    * @memberOf label\r\n    */\n\t\t\tdatastoreNoPrevVersion: \"No previous version found\",\n\n\t\t\t/**\r\n    * HTTP request timed out\r\n    *\r\n    * @type {String}\r\n    * @memberOf label\r\n    */\n\t\t\trequestTimeout: \"Request timed out\",\n\n\t\t\t/**\r\n    * Server error has occurred\r\n    *\r\n    * @type {String}\r\n    * @memberOf label\r\n    */\n\t\t\tserverError: \"Server error has occurred\",\n\n\t\t\t/**\r\n    * Forbidden to access URI\r\n    *\r\n    * @type {String}\r\n    * @memberOf label\r\n    */\n\t\t\tserverForbidden: \"Forbidden to access URI\",\n\n\t\t\t/**\r\n    * Method not allowed\r\n    *\r\n    * @type {String}\r\n    * @memberOf label\r\n    */\n\t\t\tserverInvalidMethod: \"Method not allowed\",\n\n\t\t\t/**\r\n    * Authorization required to access URI\r\n    *\r\n    * @type {String}\r\n    * @memberOf label\r\n    */\n\t\t\tserverUnauthorized: \"Authorization required to access URI\",\n\n\t\t\t/**\r\n    * Your browser is too old to use keigai, please upgrade\r\n    *\r\n    * @type {String}\r\n    * @memberOf label\r\n    */\n\t\t\tupgrade: \"Your browser is too old to use keigai, please upgrade\"\n\t\t};\n\n\t\t/**\r\n   * @namespace math\r\n   */\n\t\tvar math = {\n\t\t\t/**\r\n    * Generates bezier curve coordinates for up to 4 points, last parameter is `t`\r\n    *\r\n    * Two point example: (0, 10, 0, 0, 1) means move straight up\r\n    *\r\n    * @method bezier\r\n    * @memberOf math\r\n    * @return {Array} Coordinates\r\n    * @example\r\n    * // Moving straight down\r\n    * let p1 = keigai.util.math.bezier( 0, 10, 2000, 10, 0 ),\r\n    *     p2 = keigai.util.math.bezier( 0, 10, 2000, 10, 0.5 ),\r\n    *     p3 = keigai.util.math.bezier( 0, 10, 2000, 10, 0.75 ),\r\n    *     p4 = keigai.util.math.bezier( 0, 10, 2000, 10, 0.9 ),\r\n    *     p5 = keigai.util.math.bezier( 0, 10, 2000, 10, 1 );\r\n    */\n\t\t\tbezier: function bezier() {\n\t\t\t\tfor (var _len10 = arguments.length, args = Array(_len10), _key10 = 0; _key10 < _len10; _key10++) {\n\t\t\t\t\targs[_key10] = arguments[_key10];\n\t\t\t\t}\n\n\t\t\t\tvar a = array.cast(args);\n\t\t\t\tvar t = a.pop();\n\t\t\t\tvar P = array.chunk(a, 2);\n\t\t\t\tvar n = P.length;\n\t\t\t\tvar c = undefined,\n\t\t\t\t    S0 = undefined,\n\t\t\t\t    Q0 = undefined,\n\t\t\t\t    Q1 = undefined,\n\t\t\t\t    Q2 = undefined,\n\t\t\t\t    C0 = undefined,\n\t\t\t\t    C1 = undefined,\n\t\t\t\t    C2 = undefined,\n\t\t\t\t    C3 = undefined;\n\n\t\t\t\tif (n < 2 || n > 4) {\n\t\t\t\t\tthrow new Error(label.invalidArguments);\n\t\t\t\t}\n\n\t\t\t\t// Setting variables\n\t\t\t\tc = [];\n\t\t\t\tS0 = 1 - t;\n\t\t\t\tQ0 = math.sqr(S0);\n\t\t\t\tQ1 = 2 * S0 * t;\n\t\t\t\tQ2 = math.sqr(t);\n\t\t\t\tC0 = Math.pow(S0, 3);\n\t\t\t\tC1 = 3 * Q0 * t;\n\t\t\t\tC2 = 3 * S0 * Q2;\n\t\t\t\tC3 = Math.pow(t, 3);\n\n\t\t\t\t// Straight\n\t\t\t\tif (n === 2) {\n\t\t\t\t\tc.push(S0 * P[0][0] + t * P[1][0]);\n\t\t\t\t\tc.push(S0 * P[0][1] + t * P[1][1]);\n\t\t\t\t}\n\t\t\t\t// Quadratic\n\t\t\t\telse if (n === 3) {\n\t\t\t\t\tc.push(Q0 * P[0][0] + Q1 * P[1][0] + (Q2 + P[2][0]));\n\t\t\t\t\tc.push(Q0 * P[0][1] + Q1 * P[1][1] + (Q2 + P[2][1]));\n\t\t\t\t}\n\t\t\t\t// Cubic\n\t\t\t\telse if (n === 4) {\n\t\t\t\t\tc.push(C0 * P[0][0] + C1 * P[1][0] + C2 * P[2][0] + C3 * P[3][0]);\n\t\t\t\t\tc.push(C0 * P[0][1] + C1 * P[1][1] + C2 * P[2][1] + C3 * P[3][1]);\n\t\t\t\t}\n\n\t\t\t\treturn c;\n\t\t\t},\n\n\t\t\t/**\r\n    * Finds the distance between 2 Arrays of coordinates\r\n    *\r\n    * @method dist\r\n    * @memberOf math\r\n    * @param  {Array} a Coordinates [x, y]\r\n    * @param  {Array} b Coordinates [x, y]\r\n    * @return {Number}  Distance between `a` & `b`\r\n    * @example\r\n    * let dist = keigai.util.math.dist( [4, 40], [-10, 12] );\r\n    */\n\t\t\tdist: function dist(a, b) {\n\t\t\t\treturn Math.sqrt(math.sqr(b[0] - a[0]) + math.sqr(b[1] - a[1]));\n\t\t\t},\n\n\t\t\t/**\r\n    * Squares a Number\r\n    *\r\n    * @method sqr\r\n    * @memberOf math\r\n    * @param  {Number} n Number to square\r\n    * @return {Number}   Squared value\r\n    * @example\r\n    * let sqr = keigai.util.math.sqr( 23 );\r\n    */\n\t\t\tsqr: function sqr(n) {\n\t\t\t\treturn n * n;\n\t\t\t}\n\t\t};\n\n\t\t/**\r\n   * @namespace number\r\n   */\n\t\tvar number = {\n\t\t\t/**\r\n    * Returns the difference of arg\r\n    *\r\n    * @method diff\r\n    * @memberOf number\r\n    * @param {Number} arg Number to compare\r\n    * @return {Number}    The absolute difference\r\n    * @example\r\n    * keigai.util.number.diff( -3, 8 ); // 11\r\n    */\n\t\t\tdiff: function diff(num1, num2) {\n\t\t\t\treturn Math.abs(num1 - num2);\n\t\t\t},\n\n\t\t\t/**\r\n    * Tests if an number is even\r\n    *\r\n    * @method even\r\n    * @memberOf number\r\n    * @param {Number} arg Number to test\r\n    * @return {Boolean}   True if even, or undefined\r\n    * @example\r\n    * let n = keigai.util.number.random( 10 );\r\n    *\r\n    * if ( keigai.util.number.even( n ) ) {\r\n    *   ...\r\n    * }\r\n    */\n\t\t\teven: function even(arg) {\n\t\t\t\treturn arg % 2 === 0;\n\t\t\t},\n\n\t\t\t/**\r\n    * Formats a Number to a delimited String\r\n    *\r\n    * @method format\r\n    * @memberOf number\r\n    * @param  {Number} arg       Number to format\r\n    * @param  {String} delimiter [Optional] String to delimit the Number with\r\n    * @param  {String} every     [Optional] Position to insert the delimiter, default is 3\r\n    * @return {String}           Number represented as a comma delimited String\r\n    * @example\r\n    * keigai.util.number.format( 1000 ); // \"1,000\"\r\n    */\n\t\t\tformat: function format(arg) {\n\t\t\t\tvar delimiter = arguments[1] === undefined ? \",\" : arguments[1];\n\t\t\t\tvar every = arguments[2] === undefined ? 3 : arguments[2];\n\n\t\t\t\targ = arg.toString();\n\n\t\t\t\tvar d = arg.indexOf(\".\") > -1 ? \".\" + arg.replace(regex.number_format_1, \"\") : \"\";\n\t\t\t\tvar a = arg.replace(regex.number_format_2, \"\").split(\"\").reverse();\n\t\t\t\tvar p = Math.floor(a.length / every);\n\t\t\t\tvar i = 1;\n\t\t\t\tvar b = -1;\n\t\t\t\tvar n = undefined;\n\n\t\t\t\twhile (++b < p) {\n\t\t\t\t\tn = i === 1 ? every : every * i + (i === 2 ? 1 : i - 1);\n\t\t\t\t\ta.splice(n, 0, delimiter);\n\t\t\t\t\ti++;\n\t\t\t\t}\n\n\t\t\t\ta = a.reverse().join(\"\");\n\n\t\t\t\tif (a.charAt(0) === delimiter) {\n\t\t\t\t\ta = a.substring(1);\n\t\t\t\t}\n\n\t\t\t\treturn a + d;\n\t\t\t},\n\n\t\t\t/**\r\n    * Returns half of a, or true if a is half of b\r\n    *\r\n    * @method half\r\n    * @memberOf number\r\n    * @param  {Number} a Number to divide\r\n    * @param  {Number} b [Optional] Number to test a against\r\n    * @return {Mixed}    Boolean if b is passed, Number if b is undefined\r\n    * @example\r\n    * if ( keigai.util.number.half( 2, 4 ) ) {\r\n    *   ...\r\n    * } );\r\n    */\n\t\t\thalf: function half(a, b) {\n\t\t\t\treturn b ? a / b === 0.5 : a / 2;\n\t\t\t},\n\n\t\t\t/**\r\n    * Tests if a number is odd\r\n    *\r\n    * @method odd\r\n    * @memberOf number\r\n    * @param  {Number} arg Number to test\r\n    * @return {Boolean}    True if odd, or undefined\r\n    * @example\r\n    * let n = keigai.util.number.random( 10 );\r\n    *\r\n    * if ( keigai.util.number.odd( n ) ) {\r\n    *   ...\r\n    * }\r\n    */\n\t\t\todd: function odd(arg) {\n\t\t\t\treturn !number.even(arg);\n\t\t\t},\n\n\t\t\t/**\r\n    * Parses the number\r\n    *\r\n    * @method parse\r\n    * @memberOf number\r\n    * @param  {Mixed}  arg  Number to parse\r\n    * @param  {Number} base Integer representing the base or radix\r\n    * @return {Number}      Integer or float\r\n    * @example\r\n    * // Unsure if `n` is an int or a float\r\n    * keigai.util.number.parse( n );\r\n    */\n\t\t\tparse: function parse(arg, base) {\n\t\t\t\treturn base === undefined ? parseFloat(arg) : parseInt(arg, base);\n\t\t\t},\n\n\t\t\t/**\r\n    * Generates a random number between 0 and `arg`\r\n    *\r\n    * @method random\r\n    * @memberOf number\r\n    * @param  {Number} arg Ceiling for random number, default is 100\r\n    * @return {Number}     Random number\r\n    * @example\r\n    * let n = keigai.util.math.random( 10 );\r\n    */\n\t\t\trandom: function random() {\n\t\t\t\tvar arg = arguments[0] === undefined ? 100 : arguments[0];\n\n\t\t\t\treturn Math.floor(Math.random() * (arg + 1));\n\t\t\t},\n\n\t\t\t/**\r\n    * Rounds a number up or down\r\n    *\r\n    * @method round\r\n    * @memberOf number\r\n    * @param  {Number} arg       Number to round\r\n    * @param  {String} direction [Optional] \"up\" or \"down\"\r\n    * @return {Number}           Rounded interger\r\n    * @example\r\n    * keigai.util.math.round( n, \"down\" );\r\n    */\n\t\t\tround: function round(arg, direction) {\n\t\t\t\targ = number.parse(arg);\n\n\t\t\t\tif (direction === undefined || string.isEmpty(direction)) {\n\t\t\t\t\treturn number.parse(arg.toFixed(0));\n\t\t\t\t} else if (regex.down.test(direction)) {\n\t\t\t\t\treturn ~ ~arg;\n\t\t\t\t} else {\n\t\t\t\t\treturn Math.ceil(arg);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\r\n   * @namespace promise\r\n   */\n\t\tvar promise = {\n\t\t\t/**\r\n    * \"Unboxed\" Promise factory\r\n    *\r\n    * @method factory\r\n    * @memberOf promise\r\n    * @return {Object} {@link Promise}\r\n    */\n\t\t\tfactory: function factory() {\n\t\t\t\tvar promise = undefined,\n\t\t\t\t    pCatch = undefined,\n\t\t\t\t    pResolve = undefined,\n\t\t\t\t    pReject = undefined,\n\t\t\t\t    pThen = undefined;\n\n\t\t\t\tpromise = new Promise(function (resolve, reject) {\n\t\t\t\t\tpResolve = resolve;\n\t\t\t\t\tpReject = reject;\n\t\t\t\t});\n\n\t\t\t\tpCatch = function () {\n\t\t\t\t\tfor (var _len11 = arguments.length, args = Array(_len11), _key11 = 0; _key11 < _len11; _key11++) {\n\t\t\t\t\t\targs[_key11] = arguments[_key11];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn promise[\"catch\"].apply(promise, args);\n\t\t\t\t};\n\n\t\t\t\tpThen = function () {\n\t\t\t\t\tfor (var _len12 = arguments.length, args = Array(_len12), _key12 = 0; _key12 < _len12; _key12++) {\n\t\t\t\t\t\targs[_key12] = arguments[_key12];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn promise.then.apply(promise, args);\n\t\t\t\t};\n\n\t\t\t\treturn { \"catch\": pCatch, resolve: pResolve, reject: pReject, then: pThen };\n\t\t\t}\n\t\t};\n\n\t\tvar DataStore = (function (_Base5) {\n\t\t\t/**\r\n    * Creates a new DataStore\r\n    *\r\n    * @constructor\r\n    * @memberOf keigai\r\n    * @extends {keigai.Base}\r\n    * @example\r\n    * let store = keigai.store();\r\n    */\n\n\t\t\tfunction DataStore() {\n\t\t\t\t_classCallCheck(this, DataStore);\n\n\t\t\t\t_get(Object.getPrototypeOf(DataStore.prototype), \"constructor\", this).call(this);\n\n\t\t\t\tthis.autosave = false;\n\t\t\t\tthis.callback = null;\n\t\t\t\tthis.credentials = null;\n\t\t\t\tthis.lists = [];\n\t\t\t\tthis.events = true;\n\t\t\t\tthis.expires = null;\n\t\t\t\tthis.headers = { Accept: \"application/json\" };\n\t\t\t\tthis.ignore = [];\n\t\t\t\tthis.index = [];\n\t\t\t\tthis.indexes = { key: {} };\n\t\t\t\tthis.key = null;\n\t\t\t\tthis.loaded = false;\n\t\t\t\tthis.mongodb = \"\";\n\t\t\t\tthis.observer = observable();\n\t\t\t\tthis.records = [];\n\t\t\t\tthis.source = null;\n\t\t\t\tthis.total = 0;\n\t\t\t\tthis.versions = {};\n\t\t\t\tthis.versioning = true;\n\t\t\t\tthis.views = {};\n\t\t\t\tthis.uri = null;\n\t\t\t}\n\n\t\t\t_inherits(DataStore, _Base5);\n\n\t\t\t_createClass(DataStore, [{\n\t\t\t\tkey: \"batch\",\n\n\t\t\t\t/**\r\n     * Batch sets or deletes data in the store\r\n     *\r\n     * @method batch\r\n     * @memberOf keigai.DataStore\r\n     * @param  {String}  type Type of action to perform ( set/del/delete )\r\n     * @param  {Array}   data Array of keys or indices to delete, or Object containing multiple records to set\r\n     * @param  {Boolean} sync [Optional] Syncs store with data, if true everything is erased\r\n     * @return {Object} {@link keigai.Deferred}\r\n     * @fires keigai.DataStore#beforeBatch Fires before the batch is queued\r\n     * @fires keigai.DataStore#afterBatch Fires after the batch is queued\r\n     * @fires keigai.DataStore#failedBatch Fires when an exception occurs\r\n     * @example\r\n     * store.batch( \"set\", [...] ).then( ( records ) => {\r\n     *   ...\r\n     * }, ( err ) => {\r\n     *   ...\r\n     * } );\r\n     */\n\t\t\t\tvalue: function batch(type, data) {\n\t\t\t\t\tvar _this18 = this;\n\n\t\t\t\t\tvar sync = arguments[2] === undefined ? false : arguments[2];\n\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tvar events = this.events;\n\t\t\t\t\tvar defer = deferred();\n\t\t\t\t\tvar deferreds = [];\n\t\t\t\t\tvar patch = [];\n\n\t\t\t\t\tif (!regex.set_del.test(type) || sync && regex.del.test(type) || typeof data !== \"object\") {\n\t\t\t\t\t\tdefer.reject(new Error(label.invalidArguments));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (events) {\n\t\t\t\t\t\t\tthis.dispatch(\"beforeBatch\", data);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (sync) {\n\t\t\t\t\t\t\tthis.clear(sync);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (data.length === 0) {\n\t\t\t\t\t\t\tthis.loaded = true;\n\n\t\t\t\t\t\t\tif (events) {\n\t\t\t\t\t\t\t\tthis.dispatch(\"afterBatch\", this.records);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tdefer.resolve(this.records);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Batch deletion will create a sparse array, which will be compacted before re-indexing\n\t\t\t\t\t\t\tif (type === \"del\") {\n\t\t\t\t\t\t\t\tarray.each(data, function (i) {\n\t\t\t\t\t\t\t\t\tdeferreds.push(_this18.del(i, false, true));\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tarray.each(data, function (i) {\n\t\t\t\t\t\t\t\t\tdeferreds.push(_this18.set(i[_this18.key] || null, i, true));\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.loaded = false;\n\n\t\t\t\t\t\t\tutility.when(deferreds).then(function (args) {\n\t\t\t\t\t\t\t\t_this18.loaded = true;\n\n\t\t\t\t\t\t\t\tif (events) {\n\t\t\t\t\t\t\t\t\t_this18.dispatch(\"afterBatch\", args);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Forcing a clear of views to deal with async nature of workers & staggered loading\n\t\t\t\t\t\t\t\tarray.each(_this18.lists, function (i) {\n\t\t\t\t\t\t\t\t\ti.refresh(true);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tif (type === \"del\") {\n\t\t\t\t\t\t\t\t\t_this18.records = array.compact(_this18.records);\n\t\t\t\t\t\t\t\t\t_this18.reindex();\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (_this18.autosave) {\n\t\t\t\t\t\t\t\t\t_this18.save();\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tdefer.resolve(args);\n\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\tif (events) {\n\t\t\t\t\t\t\t\t\t_this18.dispatch(\"failedBatch\", e);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn defer;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"buildUri\",\n\n\t\t\t\t/**\r\n     * Builds a URI\r\n     *\r\n     * @method buildUri\r\n     * @memberOf keigai.DataStore\r\n     * @param  {String} key Record key\r\n     * @return {String}     URI\r\n     * @example\r\n     * let uri = store.buildUri( \"key\" );\r\n     */\n\t\t\t\tvalue: function buildUri(key) {\n\t\t\t\t\tvar parsed = utility.parse(this.uri);\n\n\t\t\t\t\treturn parsed.protocol + \"//\" + parsed.host + parsed.pathname.replace(regex.endslash, \"\") + \"/\" + key;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"clear\",\n\n\t\t\t\t/**\r\n     * Clears the data object, unsets the uri property\r\n     *\r\n     * @method clear\r\n     * @memberOf keigai.DataStore\r\n     * @param  {Boolean} sync [Optional] Boolean to limit clearing of properties\r\n     * @return {Object} {@link keigai.DataStore}\r\n     * @fires keigai.DataStore#beforeClear Fires before the data is cleared\r\n     * @fires keigai.DataStore#afterClear Fires after the data is cleared\r\n     * @example\r\n     * // Resyncing the records, if wired to an API\r\n     * store.clear( true );\r\n     *\r\n     * // Resetting the store\r\n     * store.clear();\r\n     */\n\t\t\t\tvalue: function clear() {\n\t\t\t\t\tvar sync = arguments[0] === undefined ? true : arguments[0];\n\n\t\t\t\t\tvar events = this.events === true;\n\t\t\t\t\tvar resave = this.autosave === true;\n\n\t\t\t\t\tif (!sync) {\n\t\t\t\t\t\tif (events) {\n\t\t\t\t\t\t\tthis.dispatch(\"beforeClear\");\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tarray.each(this.lists, function (i) {\n\t\t\t\t\t\t\tif (i) {\n\t\t\t\t\t\t\t\ti.teardown(true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.autosave = false;\n\t\t\t\t\t\tthis.callback = null;\n\t\t\t\t\t\tthis.credentials = null;\n\t\t\t\t\t\tthis.lists = [];\n\t\t\t\t\t\tthis.events = true;\n\t\t\t\t\t\tthis.expires = null;\n\t\t\t\t\t\tthis.headers = { Accept: \"application/json\" };\n\t\t\t\t\t\tthis.ignore = [];\n\t\t\t\t\t\tthis.index = [];\n\t\t\t\t\t\tthis.indexes = { key: {} };\n\t\t\t\t\t\tthis.key = null;\n\t\t\t\t\t\tthis.loaded = false;\n\t\t\t\t\t\tthis.records = [];\n\t\t\t\t\t\tthis.source = null;\n\t\t\t\t\t\tthis.total = 0;\n\t\t\t\t\t\tthis.versions = {};\n\t\t\t\t\t\tthis.versioning = true;\n\t\t\t\t\t\tthis.views = {};\n\t\t\t\t\t\tthis.uri = null;\n\n\t\t\t\t\t\tif (events) {\n\t\t\t\t\t\t\tthis.dispatch(\"afterClear\");\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.indexes = { key: {} };\n\t\t\t\t\t\tthis.loaded = false;\n\t\t\t\t\t\tthis.records = [];\n\t\t\t\t\t\tthis.total = 0;\n\t\t\t\t\t\tthis.views = {};\n\n\t\t\t\t\t\tarray.each(this.lists, function (i) {\n\t\t\t\t\t\t\tif (i) {\n\t\t\t\t\t\t\t\ti.refresh();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (resave) {\n\t\t\t\t\t\tthis.save();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"del\",\n\n\t\t\t\t/**\r\n     * Deletes a record based on key or index\r\n     *\r\n     * @method del\r\n     * @memberOf keigai.DataStore\r\n     * @param  {Mixed}   record  Record, key or index\r\n     * @param  {Boolean} reindex [Optional] `true` if DataStore should be reindexed\r\n     * @param  {Boolean} batch   [Optional] `true` if part of a batch operation\r\n     * @return {Object} {@link keigai.Deferred}\r\n     * @fires keigai.DataStore#beforeDelete Fires before the record is deleted\r\n     * @fires keigai.DataStore#afterDelete Fires after the record is deleted\r\n     * @fires keigai.DataStore#failedDelete Fires if the store is RESTful and the action is denied\r\n     * @example\r\n     * store.del( \"key\" ).then( () => {\r\n     *   console.log( \"Successfully deleted \" + key );\r\n     * }, ( err ) => {\r\n     *   console.warn( \"Failed to delete \" + key + \": \" + err.message );\r\n     * } );\r\n     */\n\t\t\t\tvalue: function del(record) {\n\t\t\t\t\tvar _this19 = this;\n\n\t\t\t\t\tvar reindex = arguments[1] === undefined ? true : arguments[1];\n\t\t\t\t\tvar batch = arguments[2] === undefined ? false : arguments[2];\n\n\t\t\t\t\trecord = record.key ? record : this.get(record);\n\n\t\t\t\t\tvar defer = deferred();\n\n\t\t\t\t\tif (record === undefined) {\n\t\t\t\t\t\tdefer.reject(new Error(label.invalidArguments));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (this.events) {\n\t\t\t\t\t\t\tthis.dispatch(\"beforeDelete\", record);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.uri === null || this.callback !== null) {\n\t\t\t\t\t\t\tthis.delComplete(record, reindex, batch, defer);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tclient.request(this.buildUri(record.key), \"DELETE\", null, utility.merge({ withCredentials: this.credentials }, this.headers)).then(function () {\n\t\t\t\t\t\t\t\t_this19.delComplete(record, reindex, batch, defer);\n\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t_this19.dispatch(\"failedDelete\", e);\n\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn defer;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"delComplete\",\n\n\t\t\t\t/**\r\n     * Delete completion\r\n     *\r\n     * @method delComplete\r\n     * @memberOf keigai.DataStore\r\n     * @param  {Object}  record  DataStore record\r\n     * @param  {Boolean} reindex `true` if DataStore should be reindexed\r\n     * @param  {Boolean} batch   `true` if part of a batch operation\r\n     * @param  {Object}  defer   Deferred instance\r\n     * @return {Object} {@link keigai.DataStore}\r\n     * @private\r\n     */\n\t\t\t\tvalue: function delComplete(record, reindex, batch, defer) {\n\t\t\t\t\tvar _this20 = this;\n\n\t\t\t\t\tdelete this.indexes.key[record.key];\n\t\t\t\t\tdelete this.versions[record.key];\n\t\t\t\t\tthis.total--;\n\t\t\t\t\tthis.views = {};\n\n\t\t\t\t\tif (!batch) {\n\t\t\t\t\t\tarray.remove(this.records, record.index);\n\n\t\t\t\t\t\tif (reindex) {\n\t\t\t\t\t\t\tthis.reindex();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tarray.each(record.indexes, function (i) {\n\t\t\t\t\t\t\t\tarray.remove(_this20.indexes[i[0]][i[1]], record.index);\n\n\t\t\t\t\t\t\t\tif (_this20.indexes[i[0]][i[1]].length === 0) {\n\t\t\t\t\t\t\t\t\tdelete _this20.indexes[i[0]][i[1]];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.autosave) {\n\t\t\t\t\t\t\tthis.purge(record.key);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.events) {\n\t\t\t\t\t\t\tthis.dispatch(\"afterDelete\", record);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tarray.each(this.lists, function (i) {\n\t\t\t\t\t\t\ti.refresh();\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.records[record.index] = null;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn defer !== undefined ? defer.resolve(record.key) : record.key;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"dump\",\n\n\t\t\t\t/**\r\n     * Exports a subset or complete record set of DataStore\r\n     *\r\n     * @method dump\r\n     * @memberOf keigai.DataStore\r\n     * @param  {Array} args   [Optional] Sub-data set of DataStore\r\n     * @param  {Array} fields [Optional] Fields to export, defaults to all\r\n     * @return {Array}        Records\r\n     * @example\r\n     * let data = store.dump();\r\n     */\n\t\t\t\tvalue: function dump(args, fields) {\n\t\t\t\t\tvar _this21 = this;\n\n\t\t\t\t\targs = args || this.records;\n\n\t\t\t\t\tvar custom = fields instanceof Array && fields.length > 0;\n\t\t\t\t\tvar key = this.key !== null;\n\t\t\t\t\tvar fn = undefined;\n\n\t\t\t\t\tif (custom) {\n\t\t\t\t\t\tfn = function (i) {\n\t\t\t\t\t\t\tvar record = {};\n\n\t\t\t\t\t\t\tarray.each(fields, function (f) {\n\t\t\t\t\t\t\t\trecord[f] = f === _this21.key ? isNaN(i.key) ? i.key : Number(i.key) : utility.clone(i.data[f], true);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\treturn record;\n\t\t\t\t\t\t};\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfn = function (i) {\n\t\t\t\t\t\t\tvar record = {};\n\n\t\t\t\t\t\t\tif (key) {\n\t\t\t\t\t\t\t\trecord[_this21.key] = isNaN(i.key) ? i.key : Number(i.key);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tutility.iterate(i.data, function (v, k) {\n\t\t\t\t\t\t\t\trecord[k] = utility.clone(v, true);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\treturn record;\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\treturn args.map(fn);\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"get\",\n\n\t\t\t\t/**\r\n     * Retrieves the current version of a record(s) based on key or index\r\n     *\r\n     * If the key is an integer, cast to a string before sending as an argument!\r\n     *\r\n     * @method get\r\n     * @memberOf keigai.DataStore\r\n     * @param  {Mixed}  record Key, index or Array of pagination start & end; or comma delimited String of keys or indices\r\n     * @param  {Number} offset [Optional] Offset from `record` for pagination\r\n     * @return {Mixed}         Individual record, or Array of records\r\n     * @example\r\n     * let record = store.get( \"key\" );\r\n     */\n\t\t\t\tvalue: function get(record, offset) {\n\t\t\t\t\tvar _this22 = this;\n\n\t\t\t\t\tvar type = typeof record;\n\t\t\t\t\tvar result = undefined;\n\n\t\t\t\t\tif (type === \"undefined\") {\n\t\t\t\t\t\tresult = this.records;\n\t\t\t\t\t} else if (type === \"string\") {\n\t\t\t\t\t\tif (record.indexOf(\",\") === -1) {\n\t\t\t\t\t\t\tresult = this.records[this.indexes.key[record]];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult = string.explode(record).map(function (i) {\n\t\t\t\t\t\t\t\tif (!isNaN(i)) {\n\t\t\t\t\t\t\t\t\treturn _this22.records[parseInt(i, 10)];\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\treturn _this22.records[_this22.indexes.key[i]];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (type === \"number\") {\n\t\t\t\t\t\tif (isNaN(offset)) {\n\t\t\t\t\t\t\tresult = this.records[parseInt(record, 10)];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult = array.limit(this.records, parseInt(record, 10), parseInt(offset, 10));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn utility.clone(result, true);\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"join\",\n\n\t\t\t\t/**\r\n     * Performs an (INNER/LEFT/RIGHT) JOIN on two DataStores\r\n     *\r\n     * @method join\r\n     * @memberOf keigai.DataStore\r\n     * @param  {String} arg   DataStore to join\r\n     * @param  {String} field Field in both DataStores\r\n     * @param  {String} join  Type of JOIN to perform, defaults to `inner`\r\n     * @return {Object} {@link keigai.Deferred}\r\n     * let data = store.join( otherStore, \"commonField\" );\r\n     */\n\t\t\t\tvalue: (function (_join) {\n\t\t\t\t\tfunction join(_x, _x2) {\n\t\t\t\t\t\treturn _join.apply(this, arguments);\n\t\t\t\t\t}\n\n\t\t\t\t\tjoin.toString = function () {\n\t\t\t\t\t\treturn _join.toString();\n\t\t\t\t\t};\n\n\t\t\t\t\treturn join;\n\t\t\t\t})(function (arg, field) {\n\t\t\t\t\tvar _this23 = this;\n\n\t\t\t\t\tvar join = arguments[2] === undefined ? \"inner\" : arguments[2];\n\n\t\t\t\t\tvar defer = deferred();\n\t\t\t\t\tvar results = [];\n\t\t\t\t\tvar deferreds = [];\n\t\t\t\t\tvar key = field === this.key;\n\t\t\t\t\tvar keys = array.merge(array.keys(this.records[0].data), array.keys(arg.records[0].data));\n\t\t\t\t\tvar fn = undefined;\n\n\t\t\t\t\tif (join === \"inner\") {\n\t\t\t\t\t\tfn = function (i) {\n\t\t\t\t\t\t\tvar where = {},\n\t\t\t\t\t\t\t    record = i.data,\n\t\t\t\t\t\t\t    defer = deferred();\n\n\t\t\t\t\t\t\twhere[field] = key ? i.key : record[field];\n\n\t\t\t\t\t\t\targ.select(where).then(function (match) {\n\t\t\t\t\t\t\t\tif (match.length > 2) {\n\t\t\t\t\t\t\t\t\tdefer.reject(new Error(label.databaseMoreThanOne));\n\t\t\t\t\t\t\t\t} else if (match.length === 1) {\n\t\t\t\t\t\t\t\t\tresults.push(utility.merge(record, match[0].data));\n\t\t\t\t\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdefer.resolve(false);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tdeferreds.push(defer);\n\t\t\t\t\t\t};\n\t\t\t\t\t} else if (join === \"left\") {\n\t\t\t\t\t\tfn = function (i) {\n\t\t\t\t\t\t\tvar where = {},\n\t\t\t\t\t\t\t    record = i.data,\n\t\t\t\t\t\t\t    defer = deferred();\n\n\t\t\t\t\t\t\twhere[field] = key ? i.key : record[field];\n\n\t\t\t\t\t\t\targ.select(where).then(function (match) {\n\t\t\t\t\t\t\t\tif (match.length > 2) {\n\t\t\t\t\t\t\t\t\tdefer.reject(new Error(label.databaseMoreThanOne));\n\t\t\t\t\t\t\t\t} else if (match.length === 1) {\n\t\t\t\t\t\t\t\t\tresults.push(utility.merge(record, match[0].data));\n\t\t\t\t\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tarray.each(keys, function (i) {\n\t\t\t\t\t\t\t\t\t\tif (record[i] === undefined) {\n\t\t\t\t\t\t\t\t\t\t\trecord[i] = null;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tresults.push(record);\n\t\t\t\t\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tdeferreds.push(defer);\n\t\t\t\t\t\t};\n\t\t\t\t\t} else if (join === \"right\") {\n\t\t\t\t\t\tfn = function (i) {\n\t\t\t\t\t\t\tvar where = {},\n\t\t\t\t\t\t\t    record = i.data,\n\t\t\t\t\t\t\t    defer = deferred();\n\n\t\t\t\t\t\t\twhere[field] = key ? i.key : record[field];\n\n\t\t\t\t\t\t\t_this23.select(where).then(function (match) {\n\t\t\t\t\t\t\t\tif (match.length > 2) {\n\t\t\t\t\t\t\t\t\tdefer.reject(new Error(label.databaseMoreThanOne));\n\t\t\t\t\t\t\t\t} else if (match.length === 1) {\n\t\t\t\t\t\t\t\t\tresults.push(utility.merge(record, match[0].data));\n\t\t\t\t\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tarray.each(keys, function (i) {\n\t\t\t\t\t\t\t\t\t\tif (record[i] === undefined) {\n\t\t\t\t\t\t\t\t\t\t\trecord[i] = null;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tresults.push(record);\n\t\t\t\t\t\t\t\t\tdefer.resolve(true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tdeferreds.push(defer);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tarray.each(utility.clone(join === \"right\" ? arg.records : this.records, true), fn);\n\n\t\t\t\t\tutility.when(deferreds).then(function () {\n\t\t\t\t\t\tdefer.resolve(results);\n\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn defer;\n\t\t\t\t})\n\t\t\t}, {\n\t\t\t\tkey: \"only\",\n\n\t\t\t\t/**\r\n     * Retrieves only 1 field/property\r\n     *\r\n     * @method only\r\n     * @memberOf keigai.DataStore\r\n     * @param  {String} arg Field/property to retrieve\r\n     * @return {Array}      Array of values\r\n     * @example\r\n     * let ages = store.only( \"age\" );\r\n     */\n\t\t\t\tvalue: function only(arg) {\n\t\t\t\t\tif (arg === this.key) {\n\t\t\t\t\t\treturn this.records.map(function (i) {\n\t\t\t\t\t\t\treturn i.key;\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn this.records.map(function (i) {\n\t\t\t\t\t\t\treturn i.data[arg];\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"purge\",\n\n\t\t\t\t/**\r\n     * Purges DataStore or record from persistant storage\r\n     *\r\n     * @method purge\r\n     * @memberOf keigai.DataStore\r\n     * @param  {Mixed} arg  [Optional] String or Number for record\r\n     * @return {Object}     Record or store\r\n     * @example\r\n     * store.purge();\r\n     */\n\t\t\t\tvalue: function purge(arg) {\n\t\t\t\t\treturn this.storage(arg || this, \"remove\");\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"reindex\",\n\n\t\t\t\t/**\r\n     * Reindexes the DataStore\r\n     *\r\n     * @method reindex\r\n     * @memberOf keigai.DataStore\r\n     * @return {Object} {@link keigai.DataStore}\r\n     * @example\r\n     * store.reindex();\r\n     */\n\t\t\t\tvalue: function reindex() {\n\t\t\t\t\tvar _this24 = this;\n\n\t\t\t\t\tvar i = -1;\n\t\t\t\t\tvar tmp = [];\n\n\t\t\t\t\tthis.views = {};\n\t\t\t\t\tthis.indexes = { key: {} };\n\n\t\t\t\t\tif (this.total > 0) {\n\t\t\t\t\t\tarray.each(this.records, function (record) {\n\t\t\t\t\t\t\tif (record !== undefined) {\n\t\t\t\t\t\t\t\ttmp[++i] = record;\n\t\t\t\t\t\t\t\trecord.index = i;\n\t\t\t\t\t\t\t\t_this24.indexes.key[record.key] = i;\n\t\t\t\t\t\t\t\t_this24.setIndexes(record);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.records = tmp;\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"restore\",\n\n\t\t\t\t/**\r\n     * Restores DataStore or record persistant storage\r\n     *\r\n     * @method restore\r\n     * @memberOf keigai.DataStore\r\n     * @param  {Mixed} arg  [Optional] String or Number for record\r\n     * @return {Object}     Record or store\r\n     * @example\r\n     * store.restore();\r\n     */\n\t\t\t\tvalue: function restore(arg) {\n\t\t\t\t\treturn this.storage(arg || this, \"get\");\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"save\",\n\n\t\t\t\t/**\r\n     * Saves DataStore or record to persistant storage, or sessionStorage\r\n     *\r\n     * @method save\r\n     * @memberOf keigai.DataStore\r\n     * @param  {Mixed} arg  [Optional] String or Number for record\r\n     * @return {Object} {@link keigai.Deferred}\r\n     * @example\r\n     * store.save();\r\n     */\n\t\t\t\tvalue: function save(arg) {\n\t\t\t\t\treturn this.storage(arg || this, \"set\");\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"select\",\n\n\t\t\t\t/**\r\n     * Selects records (not by reference) based on an explicit description\r\n     *\r\n     * @method select\r\n     * @memberOf keigai.DataStore\r\n     * @param  {Object} where Object describing the WHERE clause\r\n     * @return {Object} {@link keigai.Deferred}\r\n     * @example\r\n     * let adults;\r\n     *\r\n     * store.select( {age: function ( i ) { return i >= 21; } } ).then( function ( records ) {\r\n     *   adults = records;\r\n     * }, ( err ) => {\r\n     *   adults = [];\r\n     *   console.error( err.stack || err.message || err );\r\n     * } );\r\n     */\n\t\t\t\tvalue: function select(where) {\n\t\t\t\t\tvar _this25 = this;\n\n\t\t\t\t\tvar defer = deferred();\n\t\t\t\t\tvar functions = [];\n\t\t\t\t\tvar clauses = undefined,\n\t\t\t\t\t    cond = undefined,\n\t\t\t\t\t    index = undefined,\n\t\t\t\t\t    result = undefined,\n\t\t\t\t\t    sorted = undefined,\n\t\t\t\t\t    values = undefined,\n\t\t\t\t\t    worker = undefined;\n\n\t\t\t\t\tif (!(where instanceof Object)) {\n\t\t\t\t\t\tdefer.reject(new Error(label.invalidArguments));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tutility.iterate(where, function (v, k) {\n\t\t\t\t\t\t\tif (typeof v === \"function\") {\n\t\t\t\t\t\t\t\t_this25[k] = v.toString();\n\t\t\t\t\t\t\t\tfunctions.push(k);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (webWorker) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tworker = utility.worker(defer);\n\t\t\t\t\t\t\t\tworker.postMessage({\n\t\t\t\t\t\t\t\t\tcmd: \"select\",\n\t\t\t\t\t\t\t\t\tindexes: this.indexes,\n\t\t\t\t\t\t\t\t\trecords: this.records,\n\t\t\t\t\t\t\t\t\twhere: json.encode(where),\n\t\t\t\t\t\t\t\t\tfunctions: functions\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t// Probably IE10, which doesn't have the correct security flag for local loading\n\t\t\t\t\t\t\t\twebWorker = false;\n\n\t\t\t\t\t\t\t\tthis.select(where).then(function (arg) {\n\t\t\t\t\t\t\t\t\tdefer.resolve(arg);\n\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tclauses = array.fromObject(where);\n\t\t\t\t\t\t\tsorted = array.flat(clauses).filter(function (i, idx) {\n\t\t\t\t\t\t\t\treturn idx % 2 === 0;\n\t\t\t\t\t\t\t}).map(function (i) {\n\t\t\t\t\t\t\t\treturn i.toString();\n\t\t\t\t\t\t\t}).sort(array.sort);\n\t\t\t\t\t\t\tindex = sorted.join(\"|\");\n\t\t\t\t\t\t\tvalues = sorted.map(function (i) {\n\t\t\t\t\t\t\t\treturn where[i];\n\t\t\t\t\t\t\t}).join(\"|\");\n\t\t\t\t\t\t\tcond = \"return ( \";\n\n\t\t\t\t\t\t\tif (functions.length === 0 && this.indexes[index]) {\n\t\t\t\t\t\t\t\tresult = (this.indexes[index][values] || []).map(function (i) {\n\t\t\t\t\t\t\t\t\treturn _this25.records[i];\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (clauses.length > 1) {\n\t\t\t\t\t\t\t\t\tarray.each(clauses, function (i, idx) {\n\t\t\t\t\t\t\t\t\t\tvar b1 = \"( \";\n\n\t\t\t\t\t\t\t\t\t\tif (idx > 0) {\n\t\t\t\t\t\t\t\t\t\t\tb1 = \" && ( \";\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (i[1] instanceof Function) {\n\t\t\t\t\t\t\t\t\t\t\tcond += b1 + i[1].toString() + \"( rec.data[\\\"\" + i[0] + \"\\\"] ) )\";\n\t\t\t\t\t\t\t\t\t\t} else if (!isNaN(i[1])) {\n\t\t\t\t\t\t\t\t\t\t\tcond += b1 + \"rec.data[\\\"\" + i[0] + \"\\\"] === \" + i[1] + \" )\";\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tcond += b1 + \"rec.data[\\\"\" + i[0] + \"\\\"] === \\\"\" + i[1] + \"\\\" )\";\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (clauses[0][1] instanceof Function) {\n\t\t\t\t\t\t\t\t\t\tcond += clauses[0][1].toString() + \"( rec.data[\\\"\" + clauses[0][0] + \"\\\"] )\";\n\t\t\t\t\t\t\t\t\t} else if (!isNaN(clauses[0][1])) {\n\t\t\t\t\t\t\t\t\t\tcond += \"rec.data[\\\"\" + clauses[0][0] + \"\\\"] === \" + clauses[0][1];\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tcond += \"rec.data[\\\"\" + clauses[0][0] + \"\\\"] === \\\"\" + clauses[0][1] + \"\\\"\";\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tcond += \" );\";\n\n\t\t\t\t\t\t\t\tresult = utility.clone(this.records, true).filter(new Function(\"rec\", cond));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tdefer.resolve(result);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn defer;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"set\",\n\n\t\t\t\t/**\r\n     * Creates or updates an existing record\r\n     *\r\n     * @method set\r\n     * @memberOf keigai.DataStore\r\n     * @param  {Mixed}   key       [Optional] Integer or String to use as a Primary Key\r\n     * @param  {Object}  data      Key:Value pairs to set as field values\r\n     * @param  {Boolean} batch     [Optional] True if called by data.batch\r\n     * @param  {Boolean} overwrite [Optional] Overwrites the existing record, if found\r\n     * @return {Object} {@link keigai.Deferred}\r\n     * @fires keigai.DataStore#beforeSet Fires before the record is set\r\n     * @fires keigai.DataStore#afterSet Fires after the record is set, the record is the argument for listeners\r\n     * @fires keigai.DataStore#failedSet Fires if the store is RESTful and the action is denied\r\n     * @example\r\n     * // Creating a new record\r\n     * store.set( null, {...} );\r\n     *\r\n     * // Updating a record\r\n     * store.set( \"key\", {...} );\r\n     */\n\t\t\t\tvalue: function set(key, data) {\n\t\t\t\t\tvar _this26 = this;\n\n\t\t\t\t\tvar batch = arguments[2] === undefined ? false : arguments[2];\n\t\t\t\t\tvar overwrite = arguments[3] === undefined ? false : arguments[3];\n\n\t\t\t\t\tdata = utility.clone(data, true);\n\n\t\t\t\t\tvar events = this.events;\n\t\t\t\t\tvar defer = deferred();\n\t\t\t\t\tvar record = key !== null ? this.get(key) || null : data[this.key] ? this.get(data[this.key]) || null : null;\n\t\t\t\t\tvar method = \"POST\";\n\t\t\t\t\tvar parsed = utility.parse(this.uri || \"\");\n\t\t\t\t\tvar uri = undefined,\n\t\t\t\t\t    odata = undefined,\n\t\t\t\t\t    rdefer = undefined;\n\n\t\t\t\t\tvar patch = function patch(overwrite, data, ogdata) {\n\t\t\t\t\t\tvar ndata = [];\n\n\t\t\t\t\t\tif (overwrite) {\n\t\t\t\t\t\t\tarray.each(array.keys(ogdata), function (k) {\n\t\t\t\t\t\t\t\tif (k !== _this26.key && data[k] === undefined) {\n\t\t\t\t\t\t\t\t\tndata.push({ op: \"remove\", path: \"/\" + k });\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tutility.iterate(data, function (v, k) {\n\t\t\t\t\t\t\tif (k !== _this26.key && ogdata[k] === undefined) {\n\t\t\t\t\t\t\t\tndata.push({ op: \"add\", path: \"/\" + k, value: v });\n\t\t\t\t\t\t\t} else if (json.encode(ogdata[k]) !== json.encode(v)) {\n\t\t\t\t\t\t\t\tndata.push({ op: \"replace\", path: \"/\" + k, value: v });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn ndata;\n\t\t\t\t\t};\n\n\t\t\t\t\tif (typeof data === \"string\") {\n\t\t\t\t\t\tif (data.indexOf(\"//\") === -1) {\n\t\t\t\t\t\t\t// Relative path to store, i.e. a child\n\t\t\t\t\t\t\tif (data.charAt(0) !== \"/\") {\n\t\t\t\t\t\t\t\turi = this.buildUri(data);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Root path, relative to store, i.e. a domain\n\t\t\t\t\t\t\telse if (this.uri !== null && regex.root.test(data)) {\n\t\t\t\t\t\t\t\turi = parsed.protocol + \"//\" + parsed.host + data;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\turi = data;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\turi = data;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tkey = uri.replace(regex.not_endpoint, \"\");\n\n\t\t\t\t\t\tif (string.isEmpty(key)) {\n\t\t\t\t\t\t\tdefer.reject(new Error(label.invalidArguments));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (!batch && events) {\n\t\t\t\t\t\t\t\tthis.dispatch(\"beforeSet\", { key: key, data: data });\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tclient.request(uri, \"GET\", null, utility.merge({ withCredentials: this.credentials }, this.headers)).then(function (arg) {\n\t\t\t\t\t\t\t\t_this26.setComplete(record, key, _this26.source ? utility.walk(arg, _this26.source) : arg, batch, overwrite, defer);\n\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t_this26.dispatch(\"failedSet\", e);\n\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!batch && events) {\n\t\t\t\t\t\t\tthis.dispatch(\"beforeSet\", { key: key, data: data });\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (batch || this.uri === null) {\n\t\t\t\t\t\t\tthis.setComplete(record, key, data, batch, overwrite, defer);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (key !== null) {\n\t\t\t\t\t\t\t\turi = this.buildUri(key);\n\t\t\t\t\t\t\t\tmethod = \"PATCH\";\n\t\t\t\t\t\t\t\todata = utility.clone(data, true);\n\t\t\t\t\t\t\t\tdata = patch(overwrite, data, this.dump([record])[0]);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Dropping query string\n\t\t\t\t\t\t\t\turi = parsed.protocol + \"//\" + parsed.host + parsed.pathname;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\trdefer = client.request(uri, method, data, utility.merge({ withCredentials: this.credentials }, this.headers));\n\t\t\t\t\t\t\trdefer.then(function (arg) {\n\t\t\t\t\t\t\t\tvar change = undefined;\n\n\t\t\t\t\t\t\t\tif (rdefer.xhr.status !== 204 && rdefer.xhr.status < 300) {\n\t\t\t\t\t\t\t\t\tchange = key === null ? _this26.source ? utility.walk(arg, _this26.source) : arg : odata;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tchange = odata;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t_this26.setComplete(record, key, change, batch, overwrite, defer);\n\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\tif (method === \"PATCH\") {\n\t\t\t\t\t\t\t\t\tmethod = \"PUT\";\n\t\t\t\t\t\t\t\t\tdata = utility.clone(odata, true);\n\n\t\t\t\t\t\t\t\t\tutility.iterate(record.data, function (v, k) {\n\t\t\t\t\t\t\t\t\t\tdata[k] = v;\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tclient.request(uri, method, data, utility.merge({ withCredentials: _this26.credentials }, _this26.headers)).then(function () {\n\t\t\t\t\t\t\t\t\t\t_this26.setComplete(record, key, odata, batch, overwrite, defer);\n\t\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\t\t_this26.dispatch(\"failedSet\", e);\n\t\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t_this26.dispatch(\"failedSet\", e);\n\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn defer;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"setComplete\",\n\n\t\t\t\t/**\r\n     * Set completion\r\n     *\r\n     * @method setComplete\r\n     * @memberOf keigai.DataStore\r\n     * @param  {Mixed}   record    DataStore record, or `null` if new\r\n     * @param  {String}  key       Record key\r\n     * @param  {Object}  data      Record data\r\n     * @param  {Boolean} batch     `true` if part of a batch operation\r\n     * @param  {Boolean} overwrite Overwrites the existing record, if found\r\n     * @param  {Object}  defer     Deferred instance\r\n     * @return {Object} {@link keigai.DataStore}\r\n     * @private\r\n     */\n\t\t\t\tvalue: function setComplete(record, key, data, batch, overwrite, defer) {\n\t\t\t\t\t// Clearing views\n\t\t\t\t\tthis.views = {};\n\n\t\t\t\t\t// Setting key\n\t\t\t\t\tif (key === null) {\n\t\t\t\t\t\tif (this.key !== null && data[this.key] !== undefined && data[this.key] !== null) {\n\t\t\t\t\t\t\tkey = data[this.key].toString();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tkey = utility.uuid();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Removing primary key from data\n\t\t\t\t\tif (this.key) {\n\t\t\t\t\t\tdelete data[this.key];\n\t\t\t\t\t}\n\n\t\t\t\t\t// Create\n\t\t\t\t\tif (record === null) {\n\t\t\t\t\t\trecord = {\n\t\t\t\t\t\t\tindex: this.total++,\n\t\t\t\t\t\t\tkey: key,\n\t\t\t\t\t\t\tdata: data,\n\t\t\t\t\t\t\tindexes: []\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tthis.indexes.key[key] = record.index;\n\t\t\t\t\t\tthis.records[record.index] = record;\n\n\t\t\t\t\t\tif (this.versioning) {\n\t\t\t\t\t\t\tthis.versions[record.key] = lru.factory(VERSIONS);\n\t\t\t\t\t\t\tthis.versions[record.key].nth = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// Update\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (this.versioning) {\n\t\t\t\t\t\t\tif (this.versions[record.key] === undefined) {\n\t\t\t\t\t\t\t\tthis.versions[record.key] = lru.factory(VERSIONS);\n\t\t\t\t\t\t\t\tthis.versions[record.key].nth = 0;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.versions[record.key].set(\"v\" + ++this.versions[record.key].nth, this.dump([record])[0]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// By reference\n\t\t\t\t\t\trecord = this.records[record.index];\n\n\t\t\t\t\t\tif (overwrite) {\n\t\t\t\t\t\t\trecord.data = {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tutility.iterate(data, function (v, k) {\n\t\t\t\t\t\t\trecord.data[k] = v;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Snapshot that's safe to hand out\n\t\t\t\t\t\trecord = utility.clone(record, true);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.setIndexes(record);\n\n\t\t\t\t\tif (!batch) {\n\t\t\t\t\t\tif (this.autosave) {\n\t\t\t\t\t\t\tthis.save();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.events) {\n\t\t\t\t\t\t\tthis.dispatch(\"afterSet\", record);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tarray.each(this.lists, function (i) {\n\t\t\t\t\t\t\ti.refresh();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (defer !== undefined) {\n\t\t\t\t\t\tdefer.resolve(record);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"setExpires\",\n\n\t\t\t\t/**\r\n     * Gets or sets an explicit expiration of data\r\n     *\r\n     * @method setExpires\r\n     * @memberOf keigai.DataStore\r\n     * @param  {Number} arg Milliseconds until data is stale\r\n     * @return {Object} {@link keigai.DataStore}\r\n     * @example\r\n     * store.setExpires( 5 * 60 * 1000 ); // Resyncs every 5 minutes\r\n     */\n\t\t\t\tvalue: function setExpires(arg) {\n\t\t\t\t\tvar _this27 = this;\n\n\t\t\t\t\tvar id = this.id + \"Expire\";\n\t\t\t\t\tvar expires = arg;\n\n\t\t\t\t\t// Expiry cannot be less than a second, and must be a valid scenario for consumption; null will disable repetitive expiration\n\t\t\t\t\tif (arg !== null && this.uri === null || arg !== null && (isNaN(arg) || arg < 1000)) {\n\t\t\t\t\t\tthrow new Error(label.invalidArguments);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.expires === arg) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.expires = arg;\n\n\t\t\t\t\tutility.clearTimers(id);\n\n\t\t\t\t\tif (arg === null) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tutility.repeat(function () {\n\t\t\t\t\t\tif (_this27.uri === null) {\n\t\t\t\t\t\t\t_this27.setExpires(null);\n\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_this27.dispatch(\"beforeExpire\");\n\t\t\t\t\t\tcache.expire(_this27.uri);\n\t\t\t\t\t\t_this27.dispatch(\"expire\");\n\t\t\t\t\t\t_this27.dispatch(\"afterExpire\");\n\t\t\t\t\t}, expires, id, false);\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"setIndexes\",\n\n\t\t\t\t/**\r\n     * Sets indexes for a record using `store.indexes`\r\n     *\r\n     * Composite indexes are supported, but require keys be in alphabetical order, e.g. \"age|name\"\r\n     *\r\n     * @method setIndexes\r\n     * @memberOf keigai.DataStore\r\n     * @param  {Object} arg DataStore Record\r\n     * @return {Object} {@link keigai.DataStore}\r\n     * @example\r\n     * store.setIndexes( record );\r\n     */\n\t\t\t\tvalue: function setIndexes(arg) {\n\t\t\t\t\tvar _this28 = this;\n\n\t\t\t\t\tvar delimter = \"|\";\n\n\t\t\t\t\targ.indexes = [];\n\n\t\t\t\t\tarray.each(this.index, function (i) {\n\t\t\t\t\t\tvar keys = i.split(delimter);\n\t\t\t\t\t\tvar values = \"\";\n\n\t\t\t\t\t\tif (_this28.indexes[i] === undefined) {\n\t\t\t\t\t\t\t_this28.indexes[i] = {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tarray.each(keys, function (k, kdx) {\n\t\t\t\t\t\t\tvalues += (kdx > 0 ? delimter : \"\") + arg.data[k];\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (_this28.indexes[i][values] === undefined) {\n\t\t\t\t\t\t\t_this28.indexes[i][values] = [];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!array.contains(_this28.indexes[i][values], arg.index)) {\n\t\t\t\t\t\t\t_this28.indexes[i][values].push(arg.index);\n\t\t\t\t\t\t\targ.indexes.push([i, values]);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"setUri\",\n\n\t\t\t\t/**\r\n     * Sets the RESTful API end point\r\n     *\r\n     * @method setUri\r\n     * @memberOf keigai.DataStore\r\n     * @param  {String} arg API collection end point\r\n     * @return {Object}     Deferred\r\n     * @example\r\n     * store.setUri( \"...\" ).then( ( records ) => {\r\n     *   ...\r\n     * }, ( err ) => {\r\n     *   ...\r\n     * } );\r\n     */\n\t\t\t\tvalue: function setUri(arg) {\n\t\t\t\t\tvar _this29 = this;\n\n\t\t\t\t\tvar defer = deferred();\n\t\t\t\t\tvar parsed = undefined;\n\n\t\t\t\t\tif (arg !== null && string.isEmpty(arg)) {\n\t\t\t\t\t\tdefer.reject(new Error(label.invalidArguments));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (arg === null) {\n\t\t\t\t\t\tthis.uri = arg;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tparsed = utility.parse(arg);\n\t\t\t\t\t\tthis.uri = parsed.protocol + \"//\" + parsed.host + parsed.path;\n\n\t\t\t\t\t\tif (!string.isEmpty(parsed.auth) && !this.headers.authorization && !this.headers.Authorization) {\n\t\t\t\t\t\t\tthis.headers.Authorization = \"Basic \" + btoa(decodeURIComponent(parsed.auth));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.on(\"expire\", function () {\n\t\t\t\t\t\t\t_this29.sync();\n\t\t\t\t\t\t}, \"resync\");\n\n\t\t\t\t\t\tcache.expire(this.uri);\n\n\t\t\t\t\t\tthis.sync().then(function (arg) {\n\t\t\t\t\t\t\tdefer.resolve(arg);\n\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn defer;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"sort\",\n\n\t\t\t\t/**\r\n     * Creates, or returns a cached view of the records (not by reference)\r\n     *\r\n     * @method sort\r\n     * @memberOf keigai.DataStore\r\n     * @param  {String} query  SQL ( style ) order by\r\n     * @param  {String} create [Optional, default behavior is true, value is false] Boolean determines whether to recreate a view if it exists\r\n     * @param  {Object} where  [Optional] Object describing the WHERE clause\r\n     * @return {Object} {@link keigai.Deferred}\r\n     * @example\r\n     * store.sort( \"age desc, name\" ).then( ( records ) => {\r\n     *   ...\r\n     * }, ( err ) => {\r\n     *   ...\r\n     * } );\r\n     */\n\t\t\t\tvalue: function sort(query, create, where) {\n\t\t\t\t\tvar _this30 = this;\n\n\t\t\t\t\tcreate = create === true || where instanceof Object;\n\n\t\t\t\t\tvar view = string.toCamelCase(string.explode(query).join(\" \"));\n\t\t\t\t\tvar defer = deferred();\n\n\t\t\t\t\t// Next phase\n\t\t\t\t\tvar next = function next(records) {\n\t\t\t\t\t\tvar worker = undefined;\n\n\t\t\t\t\t\tif (_this30.total === 0) {\n\t\t\t\t\t\t\tdefer.resolve([]);\n\t\t\t\t\t\t} else if (!create && _this30.views[view]) {\n\t\t\t\t\t\t\tdefer.resolve(_this30.views[view]);\n\t\t\t\t\t\t} else if (webWorker) {\n\t\t\t\t\t\t\tdefer.then(function (arg) {\n\t\t\t\t\t\t\t\t_this30.views[view] = arg;\n\n\t\t\t\t\t\t\t\treturn _this30.views[view];\n\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\tutility.error(e);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tworker = utility.worker(defer);\n\t\t\t\t\t\t\t\tworker.postMessage({ cmd: \"sort\", indexes: _this30.indexes, records: records, query: query });\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t// Probably IE10, which doesn't have the correct security flag for local loading\n\t\t\t\t\t\t\t\twebWorker = false;\n\n\t\t\t\t\t\t\t\t_this30.views[view] = array.keySort(records, query, \"data\");\n\t\t\t\t\t\t\t\tdefer.resolve(_this30.views[view]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t_this30.views[view] = array.keySort(records, query, \"data\");\n\t\t\t\t\t\t\tdefer.resolve(_this30.views[view]);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tif (!where) {\n\t\t\t\t\t\tnext(utility.clone(this.records, true));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.select(where).then(next, function (e) {\n\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn defer;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"storage\",\n\n\t\t\t\t/**\r\n     * Storage interface\r\n     *\r\n     * SQL/NoSQL backends will be used if configured in lieu of localStorage (node.js only)\r\n     *\r\n     * @method storage\r\n     * @memberOf keigai.DataStore\r\n     * @param  {Mixed}  obj  Record ( Object, key or index ) or store\r\n     * @param  {Object} op   Operation to perform ( get, remove or set )\r\n     * @param  {String} type [Optional] Type of Storage to use ( local, session [local] )\r\n     * @return {Object} {@link keigai.Deferred}\r\n     * @example\r\n     * store.storage( store, \"set\" );\r\n     */\n\t\t\t\tvalue: function storage(obj, op, type) {\n\t\t\t\t\tvar _this31 = this;\n\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tvar record = false;\n\t\t\t\t\tvar mongo = !string.isEmpty(this.mongodb);\n\t\t\t\t\tvar session = type === \"session\" && typeof sessionStorage !== \"undefined\";\n\t\t\t\t\tvar defer = deferred();\n\t\t\t\t\tvar data = undefined,\n\t\t\t\t\t    key = undefined,\n\t\t\t\t\t    result = undefined;\n\n\t\t\t\t\tif (!regex.number_string_object.test(typeof obj) || !regex.get_remove_set.test(op)) {\n\t\t\t\t\t\tdefer.reject(new Error(label.invalidArguments));\n\t\t\t\t\t} else {\n\t\t\t\t\t\trecord = regex.number_string.test(typeof obj) || obj.hasOwnProperty(\"data\");\n\n\t\t\t\t\t\tif (op !== \"remove\") {\n\t\t\t\t\t\t\tif (record && !(obj instanceof Object)) {\n\t\t\t\t\t\t\t\tobj = this.get(obj);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tkey = record ? obj.key : obj.id;\n\t\t\t\t\t\t} else if (op === \"remove\" && record) {\n\t\t\t\t\t\t\tkey = obj.key || obj;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (mongo) {\n\t\t\t\t\t\t\tmongodb.connect(this.mongodb, function (e, db) {\n\t\t\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\t\t\tif (db) {\n\t\t\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\treturn defer.reject(e);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tdb.collection(_this31.id, function (e, collection) {\n\t\t\t\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\t\t\treturn defer.reject(e);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (op === \"get\") {\n\t\t\t\t\t\t\t\t\t\tif (record) {\n\t\t\t\t\t\t\t\t\t\t\tcollection.find({ _id: obj.key }).limit(1).toArray(function (e, recs) {\n\t\t\t\t\t\t\t\t\t\t\t\tdb.close();\n\n\t\t\t\t\t\t\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t\t\t\t\t} else if (recs.length === 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdefer.resolve(null);\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdelete recs[0]._id;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t_this31.set(key, recs[0], true).then(function (rec) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefer.resolve(rec);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tcollection.find({}).toArray(function (e, recs) {\n\t\t\t\t\t\t\t\t\t\t\t\tvar i = undefined,\n\t\t\t\t\t\t\t\t\t\t\t\t    nth = undefined;\n\n\t\t\t\t\t\t\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn defer.reject(e);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\ti = -1;\n\t\t\t\t\t\t\t\t\t\t\t\tnth = recs.length;\n\n\t\t\t\t\t\t\t\t\t\t\t\tif (nth > 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t_this31.records = recs.map(function (r) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar rec = { key: r._id, index: ++i, data: {} };\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t_this31.indexes.key[rec.key] = rec.index;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trec.data = r;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdelete rec.data._id;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t_this31.setIndexes(rec);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn rec;\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t_this31.total = nth;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\t\t\t\t\tdefer.resolve(_this31.records);\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else if (op === \"remove\") {\n\t\t\t\t\t\t\t\t\t\tcollection.remove(record ? { _id: key } : {}, { safe: true }, function (e, arg) {\n\t\t\t\t\t\t\t\t\t\t\tdb.close();\n\n\t\t\t\t\t\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tdefer.resolve(arg);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else if (op === \"set\") {\n\t\t\t\t\t\t\t\t\t\tif (record) {\n\t\t\t\t\t\t\t\t\t\t\tcollection.update({ _id: obj.key }, obj.data, {\n\t\t\t\t\t\t\t\t\t\t\t\tw: 1,\n\t\t\t\t\t\t\t\t\t\t\t\tsafe: true,\n\t\t\t\t\t\t\t\t\t\t\t\tupsert: true\n\t\t\t\t\t\t\t\t\t\t\t}, function (e, arg) {\n\t\t\t\t\t\t\t\t\t\t\t\tdb.close();\n\n\t\t\t\t\t\t\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdefer.resolve(arg);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t// Removing all documents & re-inserting\n\t\t\t\t\t\t\t\t\t\t\tcollection.remove({}, { w: 1, safe: true }, function (e) {\n\t\t\t\t\t\t\t\t\t\t\t\tvar deferreds = undefined;\n\n\t\t\t\t\t\t\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn defer.reject(e);\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tdeferreds = [];\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tarray.each(_this31.records, function (i) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar data = {};\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar defer2 = deferred();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdeferreds.push(defer2);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tutility.iterate(i.data, function (v, k) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata[k] = v;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcollection.update({ _id: i.key }, data, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tw: 1,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsafe: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tupsert: true\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}, function (e, arg) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefer2.reject(e);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefer2.resolve(arg);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tutility.when(deferreds).then(function (result) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefer.resolve(result);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\t\t\tdefer.reject(null);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (op === \"get\") {\n\t\t\t\t\t\t\t\tresult = session ? sessionStorage.getItem(key) : localStorage.getItem(key);\n\n\t\t\t\t\t\t\t\tif (result !== null) {\n\t\t\t\t\t\t\t\t\tresult = json.decode(result);\n\n\t\t\t\t\t\t\t\t\tif (record) {\n\t\t\t\t\t\t\t\t\t\tthis.set(key, result, true).then(function (rec) {\n\t\t\t\t\t\t\t\t\t\t\tdefer.resolve(rec);\n\t\t\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tutility.merge(self, result);\n\t\t\t\t\t\t\t\t\t\tdefer.resolve(self);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdefer.resolve(self);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Decorating loaded state for various code paths\n\t\t\t\t\t\t\t\tdefer.then(function () {\n\t\t\t\t\t\t\t\t\t_this31.loaded = true;\n\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\tthrow e;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else if (op === \"remove\") {\n\t\t\t\t\t\t\t\tsession ? sessionStorage.removeItem(key) : localStorage.removeItem(key);\n\t\t\t\t\t\t\t\tdefer.resolve(this);\n\t\t\t\t\t\t\t} else if (op === \"set\") {\n\t\t\t\t\t\t\t\tdata = json.encode(record ? obj.data : {\n\t\t\t\t\t\t\t\t\ttotal: this.total,\n\t\t\t\t\t\t\t\t\tindex: this.index,\n\t\t\t\t\t\t\t\t\tindexes: this.indexes,\n\t\t\t\t\t\t\t\t\trecords: this.records\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tsession ? sessionStorage.setItem(key, data) : localStorage.setItem(key, data);\n\t\t\t\t\t\t\t\tdefer.resolve(this);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tdefer.reject(null);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn defer;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"sync\",\n\n\t\t\t\t/**\r\n     * Syncs the DataStore with a URI representation\r\n     *\r\n     * @method sync\r\n     * @memberOf keigai.DataStore\r\n     * @return {Object} {@link keigai.Deferred}\r\n     * @fires keigai.DataStore#beforeSync Fires before syncing the DataStore\r\n     * @fires keigai.DataStore#afterSync Fires after syncing the DataStore\r\n     * @fires keigai.DataStore#failedSync Fires when an exception occurs\r\n     * @example\r\n     * store.sync().then( ( records ) => {\r\n     *   ...\r\n     * }, ( err ) => {\r\n     *   ...\r\n     * } );\r\n     */\n\t\t\t\tvalue: function sync() {\n\t\t\t\t\tvar _this32 = this;\n\n\t\t\t\t\tvar events = this.events === true;\n\t\t\t\t\tvar defer = deferred();\n\n\t\t\t\t\t/**\r\n      * Resolves public deferred\r\n      *\r\n      * @method success\r\n      * @memberOf keigai.DataStore.sync\r\n      * @private\r\n      * @param  {Object} arg API response\r\n      * @return {Undefined}  undefined\r\n      */\n\t\t\t\t\tvar success = function success(arg) {\n\t\t\t\t\t\tvar data = undefined;\n\n\t\t\t\t\t\tif (typeof arg !== \"object\") {\n\t\t\t\t\t\t\treturn failure(new Error(label.expectedObject));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (_this32.source !== null) {\n\t\t\t\t\t\t\targ = utility.walk(arg, _this32.source);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (arg instanceof Array) {\n\t\t\t\t\t\t\tdata = arg;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdata = [arg];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_this32.batch(\"set\", data, true).then(function (arg) {\n\t\t\t\t\t\t\tif (events) {\n\t\t\t\t\t\t\t\t_this32.dispatch(\"afterSync\", arg);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tdefer.resolve(arg);\n\t\t\t\t\t\t}, failure);\n\t\t\t\t\t};\n\n\t\t\t\t\t/**\r\n      * Rejects public deferred\r\n      *\r\n      * @method failure\r\n      * @memberOf keigai.DataStore.sync\r\n      * @private\r\n      * @param  {Object} e Error instance\r\n      * @return {Undefined} undefined\r\n      */\n\t\t\t\t\tvar failure = function failure(e) {\n\t\t\t\t\t\tif (events) {\n\t\t\t\t\t\t\t_this32.dispatch(\"failedSync\", e);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t};\n\n\t\t\t\t\tif (this.uri === null || string.isEmpty(this.uri)) {\n\t\t\t\t\t\tdefer.reject(new Error(label.invalidArguments));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (events) {\n\t\t\t\t\t\t\tthis.dispatch(\"beforeSync\", this.uri);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.callback !== null) {\n\t\t\t\t\t\t\tclient.jsonp(this.uri, { callback: this.callback }).then(success, failure);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tclient.request(this.uri, \"GET\", null, utility.merge({ withCredentials: this.credentials }, this.headers)).then(success, failure);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn defer;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"teardown\",\n\n\t\t\t\t/**\r\n     * Tears down a store & expires all records associated to an API\r\n     *\r\n     * @method teardown\r\n     * @memberOf keigai.DataStore\r\n     * @return {Object} {@link keigai.DataStore}\r\n     * @example\r\n     * store.teardown();\r\n     */\n\t\t\t\tvalue: function teardown() {\n\t\t\t\t\tvar uri = this.uri;\n\t\t\t\t\tvar id = undefined;\n\n\t\t\t\t\tif (uri !== null) {\n\t\t\t\t\t\tcache.expire(uri, true);\n\n\t\t\t\t\t\tid = this.id + \"DataExpire\";\n\t\t\t\t\t\tutility.clearTimers(id);\n\n\t\t\t\t\t\tarray.each(this.records, function (i) {\n\t\t\t\t\t\t\tvar recordUri = uri + \"/\" + i.key;\n\n\t\t\t\t\t\t\tcache.expire(recordUri, true);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tarray.each(this.lists, function (i) {\n\t\t\t\t\t\ti.teardown(true);\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.clear(true);\n\t\t\t\t\tthis.dispatch(\"afterTeardown\");\n\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"undo\",\n\n\t\t\t\t/**\r\n     * Undoes the last modification to a record, if it exists\r\n     *\r\n     * @method undo\r\n     * @memberOf keigai.DataStore\r\n     * @param  {Mixed}  key     Key or index\r\n     * @param  {String} version [Optional] Version to restore\r\n     * @return {Object}         Deferred\r\n     * @example\r\n     * // Didn't like the new version, so undo the change\r\n     * store.undo( \"key\", \"v1\" );\r\n     */\n\t\t\t\tvalue: function undo(key, version) {\n\t\t\t\t\tvar record = this.get(key);\n\t\t\t\t\tvar defer = deferred();\n\t\t\t\t\tvar versions = this.versions[record.key];\n\t\t\t\t\tvar previous = undefined;\n\n\t\t\t\t\tif (record === undefined) {\n\t\t\t\t\t\tdefer.reject(new Error(label.invalidArguments));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (versions) {\n\t\t\t\t\t\t\tprevious = versions.get(version || versions.first);\n\n\t\t\t\t\t\t\tif (previous === undefined) {\n\t\t\t\t\t\t\t\tdefer.reject(label.datastoreNoPrevVersion);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.set(key, previous).then(function (arg) {\n\t\t\t\t\t\t\t\t\tdefer.resolve(arg);\n\t\t\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdefer.reject(label.datastoreNoPrevVersion);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn defer;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"unique\",\n\n\t\t\t\t/**\r\n     * Returns Array of unique values of `key`\r\n     *\r\n     * @method unique\r\n     * @memberOf keigai.DataStore\r\n     * @param  {String} key Field to compare\r\n     * @return {Array}      Array of values\r\n     * @example\r\n     * let ages = store.unique( \"age\" );\r\n     */\n\t\t\t\tvalue: function unique(key) {\n\t\t\t\t\treturn array.unique(this.records.map(function (i) {\n\t\t\t\t\t\treturn i.data[key];\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"update\",\n\n\t\t\t\t/**\r\n     * Applies a difference to a record\r\n     *\r\n     * Use `data.set()` if `data` is the complete field set\r\n     *\r\n     * @method update\r\n     * @memberOf keigai.DataStore\r\n     * @param  {Mixed}  key  Key or index\r\n     * @param  {Object} data Key:Value pairs to set as field values\r\n     * @return {Object} {@link keigai.Deferred}\r\n     * @example\r\n     * store.update( \"key\", {age: 34} );\r\n     */\n\t\t\t\tvalue: function update(key, data) {\n\t\t\t\t\tvar record = this.get(key);\n\t\t\t\t\tvar defer = deferred();\n\n\t\t\t\t\tif (record === undefined) {\n\t\t\t\t\t\tdefer.reject(new Error(label.invalidArguments));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.set(key, utility.merge(record.data, data)).then(function (arg) {\n\t\t\t\t\t\t\tdefer.resolve(arg);\n\t\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn defer;\n\t\t\t\t}\n\t\t\t}]);\n\n\t\t\treturn DataStore;\n\t\t})(Base);\n\n\t\t/**\r\n   * @namespace store\r\n   */\n\t\tvar store = {\n\t\t\t/**\r\n    * Decorates a DataStore on an Object\r\n    *\r\n    * @method factory\r\n    * @memberOf store\r\n    * @param  {Mixed}  recs [Optional] Data to set with this.batch\r\n    * @param  {Object} args [Optional] Arguments to set on the store\r\n    * @return {Object} {@link keigai.DataStore}\r\n    * @example\r\n    * let store = keigai.store(null, {key: \"guid\"});\r\n    *\r\n    * store.setUri( \"http://...\" ).then( ( records ) => {\r\n    *   // Do something with the records\r\n    * }, ( e ) => {\r\n    *   // Handle `e`\r\n    * } );\r\n    */\n\t\t\tfactory: function factory(recs, args) {\n\t\t\t\tvar obj = new DataStore();\n\n\t\t\t\tif (args instanceof Object) {\n\t\t\t\t\tutility.merge(obj, args);\n\t\t\t\t}\n\n\t\t\t\tif (recs !== null && typeof recs === \"object\") {\n\t\t\t\t\tobj.batch(\"set\", recs);\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * DataStore worker handler\r\n    *\r\n    * @method worker\r\n    * @memberOf store\r\n    * @param  {Object} ev Event\r\n    * @return {Undefined} undefined\r\n    * @private\r\n    */\n\t\t\tworker: function worker(ev) {\n\t\t\t\tvar cmd = ev.data.cmd;\n\t\t\t\tvar records = ev.data.records;\n\t\t\t\tvar clauses = undefined,\n\t\t\t\t    cond = undefined,\n\t\t\t\t    functions = undefined,\n\t\t\t\t    indexes = undefined,\n\t\t\t\t    index = undefined,\n\t\t\t\t    result = undefined,\n\t\t\t\t    sorted = undefined,\n\t\t\t\t    where = undefined,\n\t\t\t\t    values = undefined;\n\n\t\t\t\tif (cmd === \"select\") {\n\t\t\t\t\twhere = JSON.parse(ev.data.where);\n\t\t\t\t\tfunctions = ev.data.functions;\n\t\t\t\t\tclauses = array.fromObject(where);\n\t\t\t\t\tsorted = array.flat(clauses).filter(function (i, idx) {\n\t\t\t\t\t\treturn idx % 2 === 0;\n\t\t\t\t\t}).sort(array.sort);\n\t\t\t\t\tindex = sorted.join(\"|\");\n\t\t\t\t\tvalues = sorted.map(function (i) {\n\t\t\t\t\t\treturn where[i];\n\t\t\t\t\t}).join(\"|\");\n\t\t\t\t\tindexes = ev.data.indexes;\n\t\t\t\t\tcond = \"return ( \";\n\n\t\t\t\t\tif (functions.length === 0 && indexes[index]) {\n\t\t\t\t\t\tresult = (indexes[index][values] || []).map(function (i) {\n\t\t\t\t\t\t\treturn records[i];\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (clauses.length > 1) {\n\t\t\t\t\t\t\tarray.each(clauses, function (i, idx) {\n\t\t\t\t\t\t\t\tvar b1 = \"( \";\n\n\t\t\t\t\t\t\t\tif (idx > 0) {\n\t\t\t\t\t\t\t\t\tb1 = \" && ( \";\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (array.contains(functions, i[0])) {\n\t\t\t\t\t\t\t\t\tcond += b1 + i[1] + \"( rec.data[\\\"\" + i[0] + \"\\\"] ) )\";\n\t\t\t\t\t\t\t\t} else if (!isNaN(i[1])) {\n\t\t\t\t\t\t\t\t\tcond += b1 + \"rec.data[\\\"\" + i[0] + \"\\\"] === \" + i[1] + \" )\";\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tcond += b1 + \"rec.data[\\\"\" + i[0] + \"\\\"] === \\\"\" + i[1] + \"\\\" )\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (array.contains(functions, clauses[0][0])) {\n\t\t\t\t\t\t\t\tcond += clauses[0][1] + \"( rec.data[\\\"\" + clauses[0][0] + \"\\\"] )\";\n\t\t\t\t\t\t\t} else if (!isNaN(clauses[0][1])) {\n\t\t\t\t\t\t\t\tcond += \"rec.data[\\\"\" + clauses[0][0] + \"\\\"] === \" + clauses[0][1];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcond += \"rec.data[\\\"\" + clauses[0][0] + \"\\\"] === \\\"\" + clauses[0][1] + \"\\\"\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcond += \" );\";\n\n\t\t\t\t\t\tresult = records.filter(new Function(\"rec\", cond));\n\t\t\t\t\t}\n\t\t\t\t} else if (cmd === \"sort\") {\n\t\t\t\t\tresult = array.keySort(records, ev.data.query, \"data\");\n\t\t\t\t}\n\n\t\t\t\tpostMessage(result);\n\t\t\t}\n\t\t};\n\n\t\t/**\r\n   * @namespace string\r\n   */\n\t\tvar string = {\n\t\t\t/**\r\n    * Capitalizes the String\r\n    *\r\n    * @method capitalize\r\n    * @memberOf string\r\n    * @param  {String}  obj String to capitalize\r\n    * @param  {Boolean} all [Optional] Capitalize each word\r\n    * @return {String}      Capitalized String\r\n    * @example\r\n    * keigai.util.string.capitalize( \"hello\" ); // \"Hello\"\r\n    */\n\t\t\tcapitalize: function capitalize(obj) {\n\t\t\t\tvar all = arguments[1] === undefined ? false : arguments[1];\n\n\t\t\t\tvar result = undefined;\n\n\t\t\t\tif (all) {\n\t\t\t\t\tresult = string.explode(obj, \" \").map(function (i) {\n\t\t\t\t\t\treturn i.charAt(0).toUpperCase() + i.slice(1);\n\t\t\t\t\t}).join(\" \");\n\t\t\t\t} else {\n\t\t\t\t\tresult = obj.charAt(0).toUpperCase() + obj.slice(1);\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Escapes meta characters within a string\r\n    *\r\n    * @method escape\r\n    * @memberOf string\r\n    * @param  {String} obj String to escape\r\n    * @return {String}     Escaped string\r\n    * @example\r\n    * keigai.util.string.escape( \"{hello}\" ); // \"\\{hello\\}\"\r\n    */\n\t\t\tescape: function escape(obj) {\n\t\t\t\treturn obj.replace(/[\\-\\[\\]{}()*+?.,\\\\\\/\\^\\$|#\\s]/g, \"\\\\$&\");\n\t\t\t},\n\n\t\t\t/**\r\n    * Splits a string on comma, or a parameter, and trims each value in the resulting Array\r\n    *\r\n    * @method explode\r\n    * @memberOf string\r\n    * @param  {String} obj String to capitalize\r\n    * @param  {String} arg String to split on\r\n    * @return {Array}      Array of the exploded String\r\n    * @example\r\n    * keigai.util.array.each( keigai.util.string.explode( \"abc, def\" ), ( i ) => {\r\n    *   ...\r\n    * } );\r\n    */\n\t\t\texplode: function explode(obj) {\n\t\t\t\tvar arg = arguments[1] === undefined ? \",\" : arguments[1];\n\n\t\t\t\treturn string.trim(obj).split(new RegExp(\"\\\\s*\" + arg + \"\\\\s*\"));\n\t\t\t},\n\n\t\t\t/**\r\n    * Creates a String representation of an Object, preserving Functions\r\n    *\r\n    * Nested Objects are not supported\r\n    *\r\n    * @method fromObject\r\n    * @memberOf string\r\n    * @param  {Object} obj  Object to convert\r\n    * @param  {String} name [Optional] Name of Object\r\n    * @return {String}      String representation\r\n    * @example\r\n    * keigai.util.string.fromObject( {a: true, b: false}, \"stats\" ); // \"stats = {'a': true,'b':false}\"\r\n    */\n\t\t\tfromObject: function fromObject(obj, name) {\n\t\t\t\tvar result = (name ? name + \" = {\" : \"{\") + \"\\n\";\n\n\t\t\t\tutility.iterate(obj, function (v, k) {\n\t\t\t\t\tresult += \"\\\"\" + k + \"\\\":\" + v.toString() + \",\\n\";\n\t\t\t\t});\n\n\t\t\t\tresult = result.replace(/\\[object Object\\]/g, \"{}\").replace(/,\\n$/, \"\\n\") + \"}\";\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Replaces all spaces in a string with dashes\r\n    *\r\n    * @method hyphenate\r\n    * @memberOf string\r\n    * @param  {String} obj   String to hyphenate\r\n    * @param {Boolean} camel [Optional] Hyphenate camelCase\r\n    * @return {String}       String with dashes instead of spaces\r\n    * @example\r\n    * keigai.util.string.hyphenate( \"hello world\" ); // \"hello-world\"\r\n    */\n\t\t\thyphenate: function hyphenate(obj) {\n\t\t\t\tvar camel = arguments[1] === undefined ? false : arguments[1];\n\n\t\t\t\tvar result = string.trim(obj).replace(/\\s+/g, \"-\");\n\n\t\t\t\tif (camel === true) {\n\t\t\t\t\tresult = result.replace(/([A-Z])/g, \"-$1\").toLowerCase();\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Tests if a string is a boolean\r\n    *\r\n    * @method isBoolean\r\n    * @memberOf string\r\n    * @param  {String}  obj String to test\r\n    * @return {Boolean}     Result of test\r\n    * @example\r\n    * if ( keigai.util.string.isBoolean( ... ) {\r\n    *   ...\r\n    * } );\r\n    */\n\t\t\tisBoolean: function isBoolean(obj) {\n\t\t\t\treturn regex.bool.test(obj);\n\t\t\t},\n\n\t\t\t/**\r\n    * Tests if a string is empty\r\n    *\r\n    * @method isEmpty\r\n    * @memberOf string\r\n    * @param  {String}  obj String to test\r\n    * @return {Boolean}     Result of test\r\n    * @example\r\n    * if ( !keigai.util.string.isEmpty( ... ) {\r\n    *   ...\r\n    * } );\r\n    */\n\t\t\tisEmpty: function isEmpty(obj) {\n\t\t\t\treturn string.trim(obj) === \"\";\n\t\t\t},\n\n\t\t\t/**\r\n    * Tests if a string is a number\r\n    *\r\n    * @method isNumber\r\n    * @memberOf string\r\n    * @param  {String}  obj String to test\r\n    * @return {Boolean}     Result of test\r\n    * @example\r\n    * if ( keigai.util.string.isNumber( ... ) {\r\n    *   ...\r\n    * } );\r\n    */\n\t\t\tisNumber: function isNumber(obj) {\n\t\t\t\treturn regex.number.test(obj);\n\t\t\t},\n\n\t\t\t/**\r\n    * Tests if a string is a URL\r\n    *\r\n    * @method isUrl\r\n    * @memberOf string\r\n    * @param  {String}  obj String to test\r\n    * @return {Boolean}     Result of test\r\n    * @example\r\n    * if ( keigai.util.string.isUrl( ... ) {\r\n    *   ...\r\n    * } );\r\n    */\n\t\t\tisUrl: function isUrl(obj) {\n\t\t\t\treturn regex.url.test(obj);\n\t\t\t},\n\n\t\t\t/**\r\n    * Transforms the case of a String into CamelCase\r\n    *\r\n    * @method toCamelCase\r\n    * @memberOf string\r\n    * @param  {String} obj String to capitalize\r\n    * @return {String}     Camel case String\r\n    * @example\r\n    * keigai.util.string.toCamelCase( \"hello world\" ); // \"helloWorld\"\r\n    */\n\t\t\ttoCamelCase: function toCamelCase(obj) {\n\t\t\t\tvar s = string.trim(obj).replace(/\\.|_|-|\\@|\\[|\\]|\\(|\\)|\\#|\\$|\\%|\\^|\\&|\\*|\\s+/g, \" \").toLowerCase().split(regex.space_hyphen);\n\t\t\t\tvar r = [];\n\n\t\t\t\tarray.each(s, function (i, idx) {\n\t\t\t\t\tr.push(idx === 0 ? i : string.capitalize(i));\n\t\t\t\t});\n\n\t\t\t\treturn r.join(\"\");\n\t\t\t},\n\n\t\t\t/**\r\n    * Returns singular form of the string\r\n    *\r\n    * @method singular\r\n    * @memberOf string\r\n    * @param  {String} obj String to transform\r\n    * @return {String}     Transformed string\r\n    * @example\r\n    * keigai.util.string.singular( \"cans\" ); // \"can\"\r\n    */\n\t\t\tsingular: function singular(obj) {\n\t\t\t\treturn obj.replace(/oe?s$/, \"o\").replace(/ies$/, \"y\").replace(/ses$/, \"se\").replace(/s$/, \"\");\n\t\t\t},\n\n\t\t\t/**\r\n    * Casts a String to a Function\r\n    *\r\n    * @method toFunction\r\n    * @memberOf string\r\n    * @param  {String} obj String to cast\r\n    * @return {Function}   Function\r\n    * @example\r\n    * let fn = someFunction.toString();\r\n    *\r\n    * ...\r\n    *\r\n    * let func = keigai.util.string.toFunction( fn );\r\n    */\n\t\t\ttoFunction: function toFunction(obj) {\n\t\t\t\tvar args = string.trim(obj.replace(/^.*\\(/, \"\").replace(/[\\t|\\r|\\n|\\\"|\\']+/g, \"\").replace(/\\).*/, \"\"));\n\t\t\t\tvar body = string.trim(obj.replace(/^.*\\{/, \"\").replace(/\\}$/, \"\"));\n\n\t\t\t\treturn Function.apply(Function, string.explode(args).concat([body]));\n\t\t\t},\n\n\t\t\t/**\r\n    * Trims the whitespace around a String\r\n    *\r\n    * @method trim\r\n    * @memberOf string\r\n    * @param  {String} obj String to capitalize\r\n    * @return {String}     Trimmed String\r\n    * @example\r\n    * keigai.util.string.trim( \"  hello world \" ); // \"hello world\"\r\n    */\n\t\t\ttrim: function trim(obj) {\n\t\t\t\treturn obj.replace(/^(\\s+|\\t+|\\n+)|(\\s+|\\t+|\\n+)$/g, \"\");\n\t\t\t},\n\n\t\t\t/**\r\n    * Uncamelcases the String\r\n    *\r\n    * @method unCamelCase\r\n    * @memberOf string\r\n    * @param  {String} obj String to uncamelcase\r\n    * @return {String}     Uncamelcased String\r\n    */\n\t\t\tunCamelCase: function unCamelCase(obj) {\n\t\t\t\treturn string.trim(obj.replace(/([A-Z])/g, \" $1\").toLowerCase());\n\t\t\t},\n\n\t\t\t/**\r\n    * Uncapitalizes the String\r\n    *\r\n    * @method uncapitalize\r\n    * @memberOf string\r\n    * @param  {String} obj String to uncapitalize\r\n    * @return {String}     Uncapitalized String\r\n    * @example\r\n    * keigai.util.string.uncapitalize( \"Hello\" ); // \"hello\"\r\n    */\n\t\t\tuncapitalize: function uncapitalize(obj) {\n\t\t\t\tvar result = string.trim(obj);\n\n\t\t\t\treturn result.charAt(0).toLowerCase() + result.slice(1);\n\t\t\t},\n\n\t\t\t/**\r\n    * Replaces all hyphens with spaces\r\n    *\r\n    * @method unhyphenate\r\n    * @memberOf string\r\n    * @param  {String}  obj  String to unhypenate\r\n    * @param  {Boolean} caps [Optional] True to capitalize each word\r\n    * @return {String}       Unhyphenated String\r\n    * @example\r\n    * keigai.util.string.unhyphenate( \"hello-world\" );       // \"hello world\"\r\n    * keigai.util.string.unhyphenate( \"hello-world\", true ); // \"Hello World\"\r\n    */\n\t\t\tunhyphenate: function unhyphenate(obj) {\n\t\t\t\tvar caps = arguments[1] === undefined ? false : arguments[1];\n\n\t\t\t\tif (caps !== true) {\n\t\t\t\t\treturn string.explode(obj, \"-\").join(\" \");\n\t\t\t\t} else {\n\t\t\t\t\treturn string.explode(obj, \"-\").map(function (i) {\n\t\t\t\t\t\treturn string.capitalize(i);\n\t\t\t\t\t}).join(\" \");\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t/**\r\n   * @namespace utility\r\n   */\n\t\tvar utility = {\n\t\t\t/**\r\n    * Collection of timers\r\n    *\r\n    * @memberOf utility\r\n    * @type {Object}\r\n    * @private\r\n    */\n\t\t\ttimer: {},\n\n\t\t\t/**\r\n    * Creates Elements or Queries the DOM using CSS selectors\r\n    *\r\n    * @method $\r\n    * @memberOf utility\r\n    * @param  {Mixed} arg HTML, or Comma delimited string of CSS selectors\r\n    * @return {Array}     Array of matching Elements\r\n    * @example\r\n    * let $ = keigai.util.$;\r\n    *\r\n    * // Looking for Elements\r\n    * $( \".someClass\" ).forEach( function ( i ) {\r\n    *   ...\r\n    * } );\r\n    *\r\n    * // Creating an H1 Element\r\n    * $( \"&lt;h1&gt;\" ).forEach( function ( i ) {\r\n    *   ...\r\n    * } );\r\n    */\n\t\t\t$: function $(arg) {\n\t\t\t\tvar result = undefined;\n\n\t\t\t\t// Nothing\n\t\t\t\tif (!arg) {}\n\t\t\t\t// HTML\n\t\t\t\telse if (regex.html.test(arg)) {\n\t\t\t\t\tresult = [element.create(arg)];\n\t\t\t\t}\n\t\t\t\t// CSS selector(s)\n\t\t\t\telse {\n\t\t\t\t\targ = string.trim(arg);\n\n\t\t\t\t\tif (arg.indexOf(\",\") === -1) {\n\t\t\t\t\t\tresult = utility.dom(arg);\n\n\t\t\t\t\t\tif (result) {\n\t\t\t\t\t\t\tif (isNaN(result.length)) {\n\t\t\t\t\t\t\t\tresult = [result];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult = [];\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult = [];\n\n\t\t\t\t\t\tarray.each(string.explode(arg), function (query) {\n\t\t\t\t\t\t\tvar obj = utility.dom(query);\n\n\t\t\t\t\t\t\tif (obj instanceof Array) {\n\t\t\t\t\t\t\t\tresult = result.concat(obj);\n\t\t\t\t\t\t\t} else if (obj) {\n\t\t\t\t\t\t\t\tresult.push(obj);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Writes the banner to the console\r\n    *\r\n    * @method banner\r\n    * @memberOf utility\r\n    * @return {Undefined} undefined\r\n    * @example\r\n    * keigai.util.banner();\r\n    */\n\t\t\tbanner: function banner() {\n\t\t\t\tconsole.log([\" __          .__             .__   ____     ________      ____  ______  \", \"|  | __ ____ |__| _________  |__| /_   |    \\\\_____  \\\\    /_   |/  __  \\\\ \", \"|  |/ // __ \\\\|  |/ ___\\\\__  \\\\ |  |  |   |      _(__  <     |   |>      < \", \"|    <\\\\  ___/|  / /_/  > __ \\\\|  |  |   |     /       \\\\    |   /   --   \\\\\", \"|__|_ \\\\\\\\___  >__\\\\___  (____  /__|  |___| /\\\\ /______  / /\\\\ |___\\\\______  /\", \"     \\\\/    \\\\/  /_____/     \\\\/            \\\\/        \\\\/  \\\\/            \\\\/ \"].join(\"\\n\"));\n\t\t\t},\n\n\t\t\t/**\r\n    * Creates an instance of Base\r\n    *\r\n    * @method base\r\n    * @memberOf utility\r\n    * @param  {Object} arg [Optional] Decorative Object\r\n    * @return {Object}     Instance of Base\r\n    */\n\t\t\tbase: function base(arg) {\n\t\t\t\tvar obj = new Base();\n\n\t\t\t\tif (arg instanceof Object) {\n\t\t\t\t\tutility.merge(obj, arg);\n\t\t\t\t}\n\n\t\t\t\tobj.observer = observable();\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Blob factory\r\n    *\r\n    * @method blob\r\n    * @memberOf utility\r\n    * @param  {String} arg String to convert to a Blob\r\n    * @return {Object}     Blob\r\n    * @private\r\n    */\n\t\t\tblob: function blob(arg) {\n\t\t\t\tvar obj = undefined;\n\n\t\t\t\ttry {\n\t\t\t\t\tobj = new Blob([arg], { type: \"application/javascript\" });\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (!global.BlobBuilder) {\n\t\t\t\t\t\tglobal.BlobBuilder = global.MSBlobBuilder || global.WebKitBlobBuilder || global.MozBlobBuilder;\n\t\t\t\t\t}\n\n\t\t\t\t\tobj = new global.BlobBuilder().append(arg).getBlob();\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Clears deferred & repeating functions\r\n    *\r\n    * @method clearTimers\r\n    * @memberOf utility\r\n    * @param  {String} id ID of timer( s )\r\n    * @return {Undefined} undefined\r\n    * @example\r\n    * keigai.util.clearTimers( 'helloWorld' );\r\n    */\n\t\t\tclearTimers: function clearTimers(id) {\n\t\t\t\tif (utility.timer[id]) {\n\t\t\t\t\tclearTimeout(utility.timer[id]);\n\t\t\t\t\tdelete utility.timer[id];\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\r\n    * Clones an Object\r\n    *\r\n    * @method clone\r\n    * @memberOf utility\r\n    * @param  {Object}  obj     Object to clone\r\n    * @param  {Boolean} shallow [Optional] Create a shallow clone, which doesn't maintain prototypes, default is `false`\r\n    * @return {Object}          Clone of obj\r\n    * @example\r\n    * let x = {a: true, b: false},\r\n    *     y = keigai.util.clone( x, true );\r\n    *\r\n    * y.a; // true\r\n    */\n\t\t\tclone: function clone(obj) {\n\t\t\t\tvar shallow = arguments[1] === undefined ? false : arguments[1];\n\n\t\t\t\tvar clone = undefined,\n\t\t\t\t    result = undefined;\n\n\t\t\t\tif (shallow === true) {\n\t\t\t\t\treturn obj !== undefined && obj !== null ? JSON.parse(JSON.stringify(obj)) : obj;\n\t\t\t\t} else if (!obj || regex.primitive.test(typeof obj) || obj instanceof RegExp) {\n\t\t\t\t\treturn obj;\n\t\t\t\t} else if (obj instanceof Array) {\n\t\t\t\t\tresult = [];\n\n\t\t\t\t\tarray.each(obj, function (i, idx) {\n\t\t\t\t\t\tresult[idx] = utility.clone(i);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn result;\n\t\t\t\t} else if (!server && !client.ie && obj instanceof Document) {\n\t\t\t\t\treturn xml.decode(xml.encode(obj));\n\t\t\t\t} else if (typeof obj.__proto__ !== \"undefined\") {\n\t\t\t\t\treturn utility.extend(obj.__proto__, obj);\n\t\t\t\t} else if (obj instanceof Object) {\n\t\t\t\t\t// If JSON encoding fails due to recursion, the original Object is returned because it's assumed this is for decoration\n\t\t\t\t\tclone = json.encode(obj, true);\n\n\t\t\t\t\tif (clone !== undefined) {\n\t\t\t\t\t\tclone = json.decode(clone);\n\n\t\t\t\t\t\t// Decorating Functions that would be lost with JSON encoding/decoding\n\t\t\t\t\t\tutility.iterate(obj, function (v, k) {\n\t\t\t\t\t\t\tif (typeof v === \"function\") {\n\t\t\t\t\t\t\t\tclone[k] = v;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tclone = obj;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn clone;\n\t\t\t\t} else {\n\t\t\t\t\treturn obj;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\r\n    * Coerces a String to a Type\r\n    *\r\n    * @method coerce\r\n    * @memberOf utility\r\n    * @param  {String} value String to coerce\r\n    * @return {Mixed}        Primitive version of the String\r\n    * @example\r\n    * keigai.util.coerce( \"1\" ); // 1\r\n    */\n\t\t\tcoerce: function coerce(value) {\n\t\t\t\tvar tmp = undefined;\n\n\t\t\t\tif (value === null || value === undefined) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t} else if (value === \"true\") {\n\t\t\t\t\treturn true;\n\t\t\t\t} else if (value === \"false\") {\n\t\t\t\t\treturn false;\n\t\t\t\t} else if (value === \"null\") {\n\t\t\t\t\treturn null;\n\t\t\t\t} else if (value === \"undefined\") {\n\t\t\t\t\treturn undefined;\n\t\t\t\t} else if (value === \"\") {\n\t\t\t\t\treturn value;\n\t\t\t\t} else if (!isNaN(tmp = Number(value))) {\n\t\t\t\t\treturn tmp;\n\t\t\t\t} else if (regex.json_wrap.test(value)) {\n\t\t\t\t\treturn json.decode(value, true) || value;\n\t\t\t\t} else {\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\r\n    * Recompiles a RegExp by reference\r\n    *\r\n    * This is ideal when you need to recompile a regex for use within a conditional statement\r\n    *\r\n    * @method compile\r\n    * @memberOf utility\r\n    * @param  {Object} regex     RegExp\r\n    * @param  {String} pattern   Regular expression pattern\r\n    * @param  {String} modifiers Modifiers to apply to the pattern\r\n    * @return {Boolean}          true\r\n    * @private\r\n    */\n\t\t\tcompile: function compile(reg, pattern, modifiers) {\n\t\t\t\treg.compile(pattern, modifiers);\n\n\t\t\t\treturn true;\n\t\t\t},\n\n\t\t\t/**\r\n    * Curries a Function\r\n    *\r\n    * Note: Function to curry must return a Function\r\n    *\r\n    * @method curry\r\n    * @memberOf utility\r\n    * @return {Function} Curried Function\r\n    * @example\r\n    * function f ( a, b ) {\r\n    *   return function ( n ) {\r\n    *     return ( a + b ) * n;\r\n    *   };\r\n    * }\r\n    *\r\n    * let g = keigai.util.curry( f, 2, 8 );\r\n    *\r\n    * g( 5 ); // 50\r\n    */\n\t\t\tcurry: function curry(fn) {\n\t\t\t\tfor (var _len13 = arguments.length, x = Array(_len13 > 1 ? _len13 - 1 : 0), _key13 = 1; _key13 < _len13; _key13++) {\n\t\t\t\t\tx[_key13 - 1] = arguments[_key13];\n\t\t\t\t}\n\n\t\t\t\tvar cfn = fn.apply(fn, x);\n\n\t\t\t\treturn function () {\n\t\t\t\t\tfor (var _len14 = arguments.length, y = Array(_len14), _key14 = 0; _key14 < _len14; _key14++) {\n\t\t\t\t\t\ty[_key14] = arguments[_key14];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn cfn.apply(cfn, y);\n\t\t\t\t};\n\t\t\t},\n\n\t\t\t/**\r\n    * Defers the execution of Function by at least the supplied milliseconds.\r\n    * Timing may vary under \"heavy load\" relative to the CPU & client JavaScript engine.\r\n    *\r\n    * @method defer\r\n    * @memberOf utility\r\n    * @param  {Function} fn Function to defer execution of\r\n    * @param  {Number}   ms Milliseconds to defer execution\r\n    * @param  {Number}   id [Optional] ID of the deferred function\r\n    * @return {String}      ID of the timer\r\n    * @example\r\n    * keigai.util.defer( () => {\r\n    *   console.log( 'hello world' );\r\n    * }, 1000, 'helloWorld' );\r\n    */\n\t\t\tdefer: function defer(fn) {\n\t\t\t\tvar ms = arguments[1] === undefined ? 0 : arguments[1];\n\t\t\t\tvar id = arguments[2] === undefined ? undefined : arguments[2];\n\n\t\t\t\tif (typeof id === \"string\") {\n\t\t\t\t\tutility.clearTimers(id);\n\t\t\t\t} else {\n\t\t\t\t\tid = utility.uuid(true);\n\t\t\t\t}\n\n\t\t\t\tutility.timer[id] = setTimeout(function () {\n\t\t\t\t\tutility.clearTimers(id);\n\t\t\t\t\tfn();\n\t\t\t\t}, ms);\n\n\t\t\t\treturn id;\n\t\t\t},\n\n\t\t\t/**\r\n    * Async delay strategy\r\n    *\r\n    * @method delay\r\n    * @memberOf promise\r\n    * @return {Function} Delay method\r\n    * @example\r\n    * keigai.util.next( function () {\r\n    *   console.log( 'On the next tick' );\r\n    * } );\r\n    */\n\t\t\tdelay: (function () {\n\t\t\t\tif (typeof setImmediate !== \"undefined\") {\n\t\t\t\t\treturn function (arg) {\n\t\t\t\t\t\tsetImmediate(arg);\n\t\t\t\t\t};\n\t\t\t\t} else if (typeof process !== \"undefined\") {\n\t\t\t\t\treturn process.nextTick;\n\t\t\t\t} else {\n\t\t\t\t\treturn function (arg) {\n\t\t\t\t\t\tsetTimeout(arg, 0);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t})(),\n\n\t\t\t/**\r\n    * Queries DOM with fastest method\r\n    *\r\n    * @method dom\r\n    * @memberOf utility\r\n    * @param  {String} arg DOM query\r\n    * @return {Mixed}      undefined, Element, or Array of Elements\r\n    * @private\r\n    */\n\t\t\tdom: function dom(arg) {\n\t\t\t\tvar result = undefined;\n\n\t\t\t\tif (!regex.selector_complex.test(arg)) {\n\t\t\t\t\tif (regex.hash.test(arg)) {\n\t\t\t\t\t\tresult = document.getElementById(arg.replace(regex.hash, \"\")) || undefined;\n\t\t\t\t\t} else if (regex.klass.test(arg)) {\n\t\t\t\t\t\tresult = array.cast(document.getElementsByClassName(arg.replace(regex.klass, \"\")));\n\t\t\t\t\t} else if (regex.word.test(arg)) {\n\t\t\t\t\t\tresult = array.cast(document.getElementsByTagName(arg));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult = array.cast(document.querySelectorAll(arg));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tresult = array.cast(document.querySelectorAll(arg));\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\r\n    * Encodes a UUID to a DOM friendly ID\r\n    *\r\n    * @method domId\r\n    * @memberOf utility\r\n    * @param  {String} UUID\r\n    * @return {String} DOM friendly ID\r\n    * @private\r\n    */\n\t\t\tdomId: function domId(arg) {\n\t\t\t\treturn \"a\" + arg.replace(/-/g, \"\").slice(1);\n\t\t\t},\n\n\t\t\t/**\r\n    * Equality verification\r\n    *\r\n    * @method equal\r\n    * @memberOf utility\r\n    * @param  {Mixed}   a Argument to compare\r\n    * @param  {Array}   b Argument to compare\r\n    * @return {Boolean}   `true` if equal\r\n    * @private\r\n    */\n\t\t\tequal: function equal(a, b) {\n\t\t\t\treturn json.encode(a, true) === json.encode(b, true);\n\t\t\t},\n\n\t\t\t/**\r\n    * Error handling, with history in `error.log`\r\n    *\r\n    * @method error\r\n    * @memberOf utility\r\n    * @param  {Mixed}   e       Error object or message to display\r\n    * @param  {Array}   args    Array of arguments from the callstack\r\n    * @param  {Mixed}   scope   Entity that was \"this\"\r\n    * @param  {Boolean} warning [Optional] Will display as console warning if true\r\n    * @return {Object}          Error descriptor\r\n    * @private\r\n    */\n\t\t\terror: function error(e, args, scope, warning) {\n\t\t\t\tvar o = {\n\t\t\t\t\targuments: args ? array.cast(args) : [],\n\t\t\t\t\tmessage: e.message || e,\n\t\t\t\t\tnumber: e.number ? e.number & 65535 : undefined,\n\t\t\t\t\tscope: scope,\n\t\t\t\t\tstack: e.stack || undefined,\n\t\t\t\t\ttimestamp: new Date().toUTCString(),\n\t\t\t\t\ttype: e.type || \"TypeError\"\n\t\t\t\t};\n\n\t\t\t\tutility.log(o.stack || o.message, warning !== true ? \"error\" : \"warn\");\n\n\t\t\t\treturn o;\n\t\t\t},\n\n\t\t\t/**\r\n    * Creates a \"class\" extending Object, with optional decoration. SuperClass can be called from `super` property.\r\n    *\r\n    * @method extend\r\n    * @memberOf utility\r\n    * @param  {Object} obj Object to extend\r\n    * @param  {Object} arg [Optional] Object for decoration\r\n    * @return {Object}     Decorated obj\r\n    * @example\r\n    * let extendObj = keigai.util.extend( someObj, {newProperty: value} );\r\n    */\n\t\t\textend: function extend(obj, arg) {\n\t\t\t\tvar o = Object.create(obj);\n\n\t\t\t\tif (arg instanceof Object) {\n\t\t\t\t\tutility.merge(o, arg);\n\t\t\t\t}\n\n\t\t\t\to[\"super\"] = obj;\n\n\t\t\t\treturn o;\n\t\t\t},\n\n\t\t\t/**\r\n    * Generates an ID value\r\n    *\r\n    * @method genId\r\n    * @memberOf utility\r\n    * @param  {Mixed}   obj [Optional] Object to receive id\r\n    * @param  {Boolean} dom [Optional] Verify the ID is unique in the DOM, default is false\r\n    * @return {Mixed}       Object or id\r\n    * @example\r\n    * let id = keigai.util.genId();\r\n    */\n\t\t\tgenId: function genId(obj) {\n\t\t\t\tvar dom = arguments[1] === undefined ? false : arguments[1];\n\n\t\t\t\tvar id = undefined;\n\n\t\t\t\tif (obj && (obj.id || obj instanceof Array || (typeof obj === \"string\" || obj instanceof String))) {\n\t\t\t\t\treturn obj;\n\t\t\t\t}\n\n\t\t\t\tif (dom) {\n\t\t\t\t\tdo {\n\t\t\t\t\t\tid = utility.domId(utility.uuid(true));\n\t\t\t\t\t} while (utility.dom(\"#\" + id));\n\t\t\t\t} else {\n\t\t\t\t\tid = utility.domId(utility.uuid(true));\n\t\t\t\t}\n\n\t\t\t\tif (obj && typeof obj === \"object\") {\n\t\t\t\t\tobj.id = id;\n\n\t\t\t\t\treturn obj;\n\t\t\t\t} else {\n\t\t\t\t\treturn id;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\r\n    * Iterates an Object and executes a function against the properties.\r\n    * Returning `false` halts iteration.\r\n    *\r\n    * @method iterate\r\n    * @memberOf utility\r\n    * @param  {Object}   obj Object to iterate\r\n    * @param  {Function} fn  Function to execute against properties\r\n    * @return {Object}       Object\r\n    * @example\r\n    * keigai.util.iterate( {...}, ( value, key ) => {\r\n    *   ...\r\n    * } );\r\n    */\n\t\t\titerate: function iterate(obj, fn) {\n\t\t\t\tarray.each(Object.keys(obj), function (i) {\n\t\t\t\t\treturn fn.call(obj, obj[i], i);\n\t\t\t\t});\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Writes argument to the console\r\n    *\r\n    * @method log\r\n    * @memberOf utility\r\n    * @param  {String} arg    String to write to the console\r\n    * @param  {String} target [Optional] Target console, default is \"log\"\r\n    * @return {Undefined}     undefined\r\n    * @example\r\n    * keigai.util.log( \"Something bad happened\", \"warn\" );\r\n    */\n\t\t\tlog: function log(arg) {\n\t\t\t\tvar target = arguments[1] === undefined ? \"log\" : arguments[1];\n\n\t\t\t\tvar msg = typeof arg !== \"object\" ? \"[\" + new Date().toLocaleTimeString() + \"] \" + arg : arg;\n\n\t\t\t\tconsole[target](msg);\n\t\t\t},\n\n\t\t\t/**\r\n    * Merges obj with arg\r\n    *\r\n    * @method merge\r\n    * @memberOf utility\r\n    * @param  {Object} obj Object to decorate\r\n    * @param  {Object} arg Decoration\r\n    * @return {Object}     Decorated Object\r\n    * @example\r\n    * let obj = {a: true};\r\n    *\r\n    * keigai.util.merge( obj, {b: false} )\r\n    * console.log(obj); // {a: true, b: false}\r\n    */\n\t\t\tmerge: function merge(obj, arg) {\n\t\t\t\tif (obj instanceof Object && arg instanceof Object) {\n\t\t\t\t\tObject.keys(arg).forEach(function (i) {\n\t\t\t\t\t\tif (obj[i] instanceof Object && arg[i] instanceof Object) {\n\t\t\t\t\t\t\tobj[i] = utility.merge(obj[i], arg[i]);\n\t\t\t\t\t\t} else if (obj[i] instanceof Array && arg[i] instanceof Array) {\n\t\t\t\t\t\t\tobj[i] = obj[i].concat(d[i]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tobj[i] = arg[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else if (obj instanceof Array && arg instanceof Array) {\n\t\t\t\t\tobj = obj.concat(arg);\n\t\t\t\t} else {\n\t\t\t\t\tobj = arg;\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Parses a URI into an Object\r\n    *\r\n    * @method parse\r\n    * @memberOf utility\r\n    * @param  {String} uri URI to parse\r\n    * @return {Object}     Parsed URI\r\n    * @example\r\n    * let parsed = keigai.util.parse( location.href );\r\n    *\r\n    * parsed;\r\n    * {\r\n    *   auth     : \"\",\r\n    *   hash     : \"\",\r\n    *   host     : \"\",\r\n    *   hostname : \"\",\r\n    *   query    : {},\r\n    *   pathname : \"\",\r\n    *   port     : n,\r\n    *   protocol : \"\",\r\n    *   search   : \"\",\r\n    * }\r\n    */\n\t\t\tparse: function parse(uri) {\n\t\t\t\tvar obj = {};\n\t\t\t\tvar host = undefined,\n\t\t\t\t    parsed = undefined,\n\t\t\t\t    protocol = undefined;\n\n\t\t\t\tif (uri === undefined) {\n\t\t\t\t\turi = !server ? location.href : \"\";\n\t\t\t\t}\n\n\t\t\t\tif (!server) {\n\t\t\t\t\tobj = document.createElement(\"a\");\n\t\t\t\t\tobj.href = uri;\n\t\t\t\t\thost = obj.href.match(regex.host)[1];\n\t\t\t\t\tprotocol = obj.href.match(regex.protocol)[1];\n\t\t\t\t} else {\n\t\t\t\t\tobj = url.parse(uri);\n\t\t\t\t}\n\n\t\t\t\tif (server) {\n\t\t\t\t\tutility.iterate(obj, function (v, k) {\n\t\t\t\t\t\tif (v === null) {\n\t\t\t\t\t\t\tobj[k] = undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tparsed = {\n\t\t\t\t\tauth: server ? null : regex.auth.exec(uri),\n\t\t\t\t\tprotocol: obj.protocol || protocol,\n\t\t\t\t\thostname: obj.hostname || host,\n\t\t\t\t\tport: obj.port ? number.parse(obj.port, 10) : \"\",\n\t\t\t\t\tpathname: obj.pathname,\n\t\t\t\t\tsearch: obj.search || \"\",\n\t\t\t\t\thash: obj.hash || \"\",\n\t\t\t\t\thost: obj.host || host\n\t\t\t\t};\n\n\t\t\t\t// 'cause IE is ... IE; required for data.batch()\n\t\t\t\tif (client.ie) {\n\t\t\t\t\tif (parsed.protocol === \":\") {\n\t\t\t\t\t\tparsed.protocol = location.protocol;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (string.isEmpty(parsed.hostname)) {\n\t\t\t\t\t\tparsed.hostname = location.hostname;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (string.isEmpty(parsed.host)) {\n\t\t\t\t\t\tparsed.host = location.host;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (parsed.pathname.charAt(0) !== \"/\") {\n\t\t\t\t\t\tparsed.pathname = \"/\" + parsed.pathname;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tparsed.auth = obj.auth || (parsed.auth === null ? \"\" : parsed.auth[1]);\n\t\t\t\tparsed.href = obj.href || parsed.protocol + \"//\" + (string.isEmpty(parsed.auth) ? \"\" : parsed.auth + \"@\") + parsed.host + parsed.pathname + parsed.search + parsed.hash;\n\t\t\t\tparsed.path = obj.path || parsed.pathname + parsed.search;\n\t\t\t\tparsed.query = utility.queryString(null, parsed.search);\n\n\t\t\t\treturn parsed;\n\t\t\t},\n\n\t\t\t/**\r\n    * Creates a partially applied Function\r\n    *\r\n    * @method partial\r\n    * @memberOf utility\r\n    * @return {Function} Partial Function\r\n    * @example\r\n    * function f ( a, b ) {\r\n    *   return a + b;\r\n    * }\r\n    *\r\n    * let g = keigai.util.partial( f, 2 );\r\n    *\r\n    * g( 2 ); // 4\r\n    */\n\t\t\tpartial: function partial(fn) {\n\t\t\t\tfor (var _len15 = arguments.length, args = Array(_len15 > 1 ? _len15 - 1 : 0), _key15 = 1; _key15 < _len15; _key15++) {\n\t\t\t\t\targs[_key15 - 1] = arguments[_key15];\n\t\t\t\t}\n\n\t\t\t\treturn function () {\n\t\t\t\t\tfor (var _len16 = arguments.length, args2 = Array(_len16), _key16 = 0; _key16 < _len16; _key16++) {\n\t\t\t\t\t\targs2[_key16] = arguments[_key16];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn fn.apply(fn, args.concat(args2));\n\t\t\t\t};\n\t\t\t},\n\n\t\t\t/**\r\n    * Prevents default behavior of an Event\r\n    *\r\n    * @method prevent\r\n    * @memberOf utility\r\n    * @param  {Object} ev Event\r\n    * @return {Object}    Event\r\n    * @example\r\n    * keigai.util.prevent( Event );\r\n    */\n\t\t\tprevent: function prevent(ev) {\n\t\t\t\tif (typeof ev.preventDefault === \"function\") {\n\t\t\t\t\tev.preventDefault();\n\t\t\t\t}\n\n\t\t\t\treturn ev;\n\t\t\t},\n\n\t\t\t/**\r\n    * Parses a query string & coerces values\r\n    *\r\n    * @method queryString\r\n    * @memberOf utility\r\n    * @param  {String} arg     [Optional] Key to find in the querystring\r\n    * @param  {String} qstring [Optional] Query string to parse\r\n    * @return {Mixed}          Value or Object of key:value pairs\r\n    */\n\t\t\tqueryString: function queryString(arg) {\n\t\t\t\tvar qstring = arguments[1] === undefined ? \"\" : arguments[1];\n\n\t\t\t\tvar obj = {};\n\t\t\t\tvar aresult = (qstring || location.search || \"\").split(\"?\");\n\t\t\t\tvar result = undefined;\n\n\t\t\t\tif (aresult.length > 1) {\n\t\t\t\t\taresult.shift();\n\t\t\t\t}\n\n\t\t\t\tresult = aresult.join(\"?\");\n\n\t\t\t\tarray.each(result.split(\"&\"), function (prop) {\n\t\t\t\t\tvar aitem = prop.split(\"=\");\n\t\t\t\t\tvar item = undefined;\n\n\t\t\t\t\tif (aitem.length > 2) {\n\t\t\t\t\t\titem = [aitem.shift(), aitem.join(\"=\")];\n\t\t\t\t\t} else {\n\t\t\t\t\t\titem = aitem;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (string.isEmpty(item[0])) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (item[1] === undefined) {\n\t\t\t\t\t\titem[1] = \"\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\titem[1] = utility.coerce(decodeURIComponent(item[1]));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (obj[item[0]] === undefined) {\n\t\t\t\t\t\tobj[item[0]] = item[1];\n\t\t\t\t\t} else if (!(obj[item[0]] instanceof Array)) {\n\t\t\t\t\t\tobj[item[0]] = [obj[item[0]]];\n\t\t\t\t\t\tobj[item[0]].push(item[1]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobj[item[0]].push(item[1]);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn typeof arg === \"string\" ? utility.walk(obj, arg) : obj;\n\t\t\t},\n\n\t\t\t/**\r\n    * Accepts Deferreds or Promises as arguments, or an Array of either\r\n    *\r\n    * @method race\r\n    * @memberOf utility\r\n    * @return {Object} {@link keigai.Deferred}\r\n    * @example\r\n    * let deferreds = [],\r\n    *     defer1    = keigai.util.defer(),\r\n    *     defer2    = keigai.util.defer();\r\n    *\r\n    * deferreds.push( defer1 );\r\n    * deferreds.push( defer2 );\r\n    *\r\n    * // Executes when one deferred is resolved or rejected\r\n    * keigai.util.race( deferreds ).then( function ( arg ) ) {\r\n    *   ...\r\n    * }, function ( err ) {\r\n    *   ...\r\n    * } );\r\n    *\r\n    * ...\r\n    *\r\n    * defer1.resolve( true );\r\n    * defer2.resolve( true );\r\n    */\n\t\t\trace: function race() {\n\t\t\t\tfor (var _len17 = arguments.length, args = Array(_len17), _key17 = 0; _key17 < _len17; _key17++) {\n\t\t\t\t\targs[_key17] = arguments[_key17];\n\t\t\t\t}\n\n\t\t\t\tvar defer = deferred();\n\n\t\t\t\t// Did we receive an Array? if so it overrides any other arguments\n\t\t\t\tif (args[0] instanceof Array) {\n\t\t\t\t\targs = args[0];\n\t\t\t\t}\n\n\t\t\t\t// None, end on next tick\n\t\t\t\tif (args.length === 0) {\n\t\t\t\t\tdefer.resolve(null);\n\t\t\t\t}\n\t\t\t\t// Setup and wait\n\t\t\t\telse {\n\t\t\t\t\tPromise.race(args).then(function (results) {\n\t\t\t\t\t\tdefer.resolve(results);\n\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn defer;\n\t\t\t},\n\n\t\t\t/**\r\n    * Asynchronous DOM rendering (cannot be cancelled, suggested for reactive behavior)\r\n    *\r\n    * @method render\r\n    * @memberOf utility\r\n    * @param  {Function} fn Function to execute on next 'frame'\r\n    * @return {Object} {@link keigai.Deferred}\r\n    * @example\r\n    * keigai.util.render( function () {\r\n    *     return keitai.util.element.html( document.querySelector( \"#id\" ), \"Hello World\" )\r\n    * } ).then( function ( arg ) {\r\n    *     // arg is the return value of your function\r\n    * }, function ( e ) {\r\n    *     // Handle e\r\n    * } );\r\n    */\n\t\t\trender: function render(fn) {\n\t\t\t\tvar defer = deferred();\n\n\t\t\t\tRENDER(function (arg) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdefer.resolve(fn(arg));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn defer;\n\t\t\t},\n\n\t\t\t/**\r\n    * Creates a recursive function. Return false from the function to halt recursion.\r\n    *\r\n    * @method repeat\r\n    * @memberOf utility\r\n    * @param  {Function} fn  Function to execute repeatedly\r\n    * @param  {Number}   ms  Milliseconds to stagger the execution\r\n    * @param  {String}   id  [Optional] Timeout ID\r\n    * @param  {Boolean}  now Executes `fn` and then setup repetition, default is `true`\r\n    * @return {String}       Timeout ID\r\n    * @example\r\n    * keigai.util.repeat( function () {\r\n    *   ...\r\n    *\r\n    *   // Cancelling repetition at some point in the future\r\n    *   if ( someCondition ) {\r\n    *     return false;\r\n    *   }\r\n    * }, 1000, \"repeating\" );\r\n    */\n\t\t\trepeat: function repeat(fn) {\n\t\t\t\tvar ms = arguments[1] === undefined ? 10 : arguments[1];\n\t\t\t\tvar id = arguments[2] === undefined ? utility.uuid(true) : arguments[2];\n\t\t\t\tvar now = arguments[3] === undefined ? true : arguments[3];\n\n\t\t\t\tvar recursive = undefined;\n\n\t\t\t\t// Could be valid to return false from initial execution\n\t\t\t\tif (now && fn() === false) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\trecursive = function () {\n\t\t\t\t\tif (fn() !== false) {\n\t\t\t\t\t\tutility.defer(recursive, ms, id);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tutility.defer(recursive, ms, id);\n\n\t\t\t\treturn id;\n\t\t\t},\n\n\t\t\t/**\r\n    * Stops an Event from bubbling, & prevents default behavior\r\n    *\r\n    * @method stop\r\n    * @memberOf utility\r\n    * @param  {Object} ev Event\r\n    * @return {Object}    Event\r\n    * @example\r\n    * keigai.util.stop( Event );\r\n    */\n\t\t\tstop: function stop(ev) {\n\t\t\t\tif (typeof ev.stopPropagation === \"function\") {\n\t\t\t\t\tev.stopPropagation();\n\t\t\t\t}\n\n\t\t\t\tutility.prevent(ev);\n\n\t\t\t\treturn ev;\n\t\t\t},\n\n\t\t\t/**\r\n    * Returns the Event target\r\n    *\r\n    * @method target\r\n    * @memberOf utility\r\n    * @param  {Object} ev Event\r\n    * @return {Object}    Event target\r\n    * @example\r\n    * let target = keigai.util.target( Event );\r\n    */\n\t\t\ttarget: function target(ev) {\n\t\t\t\treturn ev.target || ev.srcElement;\n\t\t\t},\n\n\t\t\t/**\r\n    * Generates a version 4 UUID\r\n    *\r\n    * @method uuid\r\n    * @memberOf utility\r\n    * @param  {Boolean} strip [Optional] Strips - from UUID\r\n    * @return {String}        UUID\r\n    * @example\r\n    * let uuid4 = keigai.util.uuid();\r\n    */\n\t\t\tuuid: function uuid(strip) {\n\t\t\t\tfunction s() {\n\t\t\t\t\treturn ((1 + Math.random()) * 65536 | 0).toString(16).substring(1);\n\t\t\t\t}\n\n\t\t\t\tvar r = [8, 9, \"a\", \"b\"];\n\t\t\t\tvar o = s() + s() + \"-\" + s() + \"-4\" + s().substr(0, 3) + \"-\" + r[Math.floor(Math.random() * 4)] + s().substr(0, 3) + \"-\" + s() + s() + s();\n\n\t\t\t\tif (strip === true) {\n\t\t\t\t\to = o.replace(/-/g, \"\");\n\t\t\t\t}\n\n\t\t\t\treturn o;\n\t\t\t},\n\n\t\t\t/**\r\n    * Walks `obj` and returns `arg`, for when you can't easily access `arg`\r\n    *\r\n    * @method  walk\r\n    * @memberOf utility\r\n    * @param  {Mixed}  obj  Object or Array\r\n    * @param  {String} arg  String describing the property to return\r\n    * @return {Mixed}       Target or undefined\r\n    * @example\r\n    * let obj = {a: [{b: true}]};\r\n    *\r\n    * keigai.util.walk( obj, \"a[0].b\" ); // true\r\n    */\n\t\t\twalk: function walk(obj, arg) {\n\t\t\t\tvar output = obj;\n\n\t\t\t\tarray.each(arg.replace(/\\]$/, \"\").replace(/\\]/g, \".\").replace(/\\.\\./g, \".\").split(/\\.|\\[/), function (i) {\n\t\t\t\t\tif (output[i] === undefined || output[i] === null) {\n\t\t\t\t\t\toutput = undefined;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\toutput = output[i];\n\t\t\t\t});\n\n\t\t\t\treturn output;\n\t\t\t},\n\n\t\t\t/**\r\n    * Accepts Deferreds or Promises as arguments, or an Array of either\r\n    *\r\n    * @method when\r\n    * @memberOf utility\r\n    * @return {Object} {@link keigai.Deferred}\r\n    * @example\r\n    * let deferreds = [],\r\n    *     defer1    = keigai.util.defer(),\r\n    *     defer2    = keigai.util.defer();\r\n    *\r\n    * deferreds.push( defer1 );\r\n    * deferreds.push( defer2 );\r\n    *\r\n    * // Executes when both deferreds have resolved or one has rejected\r\n    * keigai.util.when( deferreds ).then( function ( args ) {\r\n    *   ...\r\n    * }, function ( err ) {\r\n    *   ...\r\n    * } );\r\n    *\r\n    * ...\r\n    *\r\n    * defer1.resolve( true );\r\n    * defer2.resolve( true );\r\n    */\n\t\t\twhen: function when() {\n\t\t\t\tfor (var _len18 = arguments.length, args = Array(_len18), _key18 = 0; _key18 < _len18; _key18++) {\n\t\t\t\t\targs[_key18] = arguments[_key18];\n\t\t\t\t}\n\n\t\t\t\tvar defer = deferred();\n\n\t\t\t\t// Did we receive an Array? if so it overrides any other arguments\n\t\t\t\tif (args[0] instanceof Array) {\n\t\t\t\t\targs = args[0];\n\t\t\t\t}\n\n\t\t\t\t// None, end on next tick\n\t\t\t\tif (args.length === 0) {\n\t\t\t\t\tdefer.resolve(null);\n\t\t\t\t}\n\t\t\t\t// Setup and wait\n\t\t\t\telse {\n\t\t\t\t\tPromise.all(args).then(function (results) {\n\t\t\t\t\t\tdefer.resolve(results);\n\t\t\t\t\t}, function (e) {\n\t\t\t\t\t\tdefer.reject(e);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn defer;\n\t\t\t},\n\n\t\t\t/**\r\n    * Worker factory\r\n    *\r\n    * @method worker\r\n    * @memberOf utility\r\n    * @param  {Object} defer Deferred to receive message from Worker\r\n    * @return {Object}       Worker\r\n    * @private\r\n    */\n\t\t\tworker: function worker(defer) {\n\t\t\t\tvar obj = new Worker(WORKER);\n\n\t\t\t\tobj.onerror = function (err) {\n\t\t\t\t\tdefer.reject(err);\n\t\t\t\t\tobj.terminate();\n\t\t\t\t};\n\n\t\t\t\tobj.onmessage = function (ev) {\n\t\t\t\t\tdefer.resolve(ev.data);\n\t\t\t\t\tobj.terminate();\n\t\t\t\t};\n\n\t\t\t\treturn obj;\n\t\t\t}\n\t\t};\n\n\t\t/**\r\n   * XMLHttpRequest shim for node.js\r\n   *\r\n   * @method xhr\r\n   * @private\r\n   * @return {Object} XMLHttpRequest instance\r\n   */\n\t\tvar xhr = function xhr() {\n\t\t\tvar UNSENT = 0;\n\t\t\tvar OPENED = 1;\n\t\t\tvar HEADERS_RECEIVED = 2;\n\t\t\tvar LOADING = 3;\n\t\t\tvar DONE = 4;\n\t\t\tvar ERR_REFUSED = /ECONNREFUSED/;\n\t\t\tvar ready = new RegExp(HEADERS_RECEIVED + \"|\" + LOADING);\n\n\t\t\tvar headers = {\n\t\t\t\t\"user-agent\": \"keigai/1.3.18 node.js/\" + process.versions.node.replace(/^v/, \"\") + \" (\" + string.capitalize(process.platform) + \" V8/\" + process.versions.v8 + \" )\",\n\t\t\t\t\"content-type\": \"text/plain\",\n\t\t\t\taccept: \"*/*\"\n\t\t\t};\n\n\t\t\t/**\r\n    * Dispatches an event\r\n    *\r\n    * @method dispatch\r\n    * @memberOf xhr\r\n    * @param  {Object} obj In\r\n    * @param  {String} arg Event to dispatch\r\n    * @return {Object}     XMLHttpRequest instance\r\n    */\n\t\t\tvar dispatch = function dispatch(obj, arg) {\n\t\t\t\tvar fn = \"on\" + arg;\n\n\t\t\t\tif (typeof obj[fn] === \"function\") {\n\t\t\t\t\tobj[fn]();\n\t\t\t\t}\n\n\t\t\t\tobj.dispatchEvent(arg);\n\n\t\t\t\treturn obj;\n\t\t\t};\n\n\t\t\t/**\r\n    * Changes the readyState of an XMLHttpRequest\r\n    *\r\n    * @method state\r\n    * @memberOf xhr\r\n    * @param  {String} arg New readyState\r\n    * @return {Object}     XMLHttpRequest instance\r\n    */\n\t\t\tvar state = function state(obj, arg) {\n\t\t\t\tif (obj.readyState !== arg) {\n\t\t\t\t\tobj.readyState = arg;\n\t\t\t\t\tdispatch(obj, \"readystatechange\");\n\n\t\t\t\t\tif (obj.readyState === DONE && !obj._error) {\n\t\t\t\t\t\tdispatch(obj, \"load\");\n\t\t\t\t\t\tdispatch(obj, \"loadend\");\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t};\n\n\t\t\t/**\r\n    * Response handler\r\n    *\r\n    * @method success\r\n    * @memberOf xhr\r\n    * @param  {Object} obj {@link keigai.XMLHttpRequest}\r\n    * @param  {Object} res HTTP(S) Response Object\r\n    * @return {Undefined}  undefined\r\n    */\n\t\t\tvar success = function success(obj, res) {\n\t\t\t\tstate(obj, HEADERS_RECEIVED);\n\t\t\t\tobj.status = res.statusCode;\n\t\t\t\tobj._resheaders = res.headers;\n\n\t\t\t\tif (obj._resheaders[\"set-cookie\"] && obj._resheaders[\"set-cookie\"] instanceof Array) {\n\t\t\t\t\tobj._resheaders[\"set-cookie\"] = obj._resheaders[\"set-cookie\"].join(\";\");\n\t\t\t\t}\n\n\t\t\t\tres.on(\"data\", function (arg) {\n\t\t\t\t\tres.setEncoding(\"utf8\");\n\n\t\t\t\t\tif (obj._send) {\n\t\t\t\t\t\tif (arg) {\n\t\t\t\t\t\t\tobj.responseText += arg;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstate(obj, LOADING);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tres.on(\"end\", function () {\n\t\t\t\t\tif (obj._send) {\n\t\t\t\t\t\tstate(obj, DONE);\n\t\t\t\t\t\tobj._send = false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\n\t\t\t/**\r\n    * Response error handler\r\n    *\r\n    * @method failure\r\n    * @memberOf xhr\r\n    * @param  {Object} obj {@link keigai.XMLHttpRequest}\r\n    * @param  {Object} e   Error\r\n    * @return {Undefined}  undefined\r\n    */\n\t\t\tvar failure = function failure(obj, e) {\n\t\t\t\tobj.status = ERR_REFUSED.test(e.message) ? 503 : 500;\n\t\t\t\tobj.statusText = \"\";\n\t\t\t\tobj.responseText = e.message;\n\t\t\t\tobj._error = true;\n\t\t\t\tobj._send = false;\n\t\t\t\tdispatch(obj, \"error\");\n\t\t\t\tstate(obj, DONE);\n\t\t\t};\n\n\t\t\tvar XMLHttpRequest = (function (_Base6) {\n\t\t\t\t/**\r\n     * Creates a new XMLHttpRequest\r\n     *\r\n     * @constructor\r\n     * @private\r\n     * @memberOf xhr\r\n     * @return {Object} XMLHttpRequest instance\r\n     */\n\n\t\t\t\tfunction XMLHttpRequest() {\n\t\t\t\t\t_classCallCheck(this, XMLHttpRequest);\n\n\t\t\t\t\t_get(Object.getPrototypeOf(XMLHttpRequest.prototype), \"constructor\", this).call(this);\n\n\t\t\t\t\tthis.onabort = null;\n\t\t\t\t\tthis.onerror = null;\n\t\t\t\t\tthis.onload = null;\n\t\t\t\t\tthis.onloadend = null;\n\t\t\t\t\tthis.onloadstart = null;\n\t\t\t\t\tthis.onreadystatechange = null;\n\t\t\t\t\tthis.readyState = UNSENT;\n\t\t\t\t\tthis.response = null;\n\t\t\t\t\tthis.responseText = \"\";\n\t\t\t\t\tthis.responseType = \"\";\n\t\t\t\t\tthis.responseXML = null;\n\t\t\t\t\tthis.status = UNSENT;\n\t\t\t\t\tthis.statusText = \"\";\n\t\t\t\t\tthis.observer = observable();\n\n\t\t\t\t\t// Psuedo private for prototype chain\n\t\t\t\t\tthis._error = false;\n\t\t\t\t\tthis._headers = {};\n\t\t\t\t\tthis._params = {};\n\t\t\t\t\tthis._request = null;\n\t\t\t\t\tthis._resheaders = {};\n\t\t\t\t\tthis._send = false;\n\t\t\t\t}\n\n\t\t\t\t_inherits(XMLHttpRequest, _Base6);\n\n\t\t\t\t_createClass(XMLHttpRequest, [{\n\t\t\t\t\tkey: \"abort\",\n\n\t\t\t\t\t/**\r\n      * Aborts a request\r\n      *\r\n      * @method abort\r\n      * @memberOf XMLHttpRequest\r\n      * @return {Object} XMLHttpRequest instance\r\n      */\n\t\t\t\t\tvalue: function abort() {\n\t\t\t\t\t\tif (this._request !== null) {\n\t\t\t\t\t\t\tthis._request.abort();\n\t\t\t\t\t\t\tthis._request = null;\n\t\t\t\t\t\t\tthis.responseText = \"\";\n\t\t\t\t\t\t\tthis.responseXML = \"\";\n\t\t\t\t\t\t\tthis._error = true;\n\t\t\t\t\t\t\tthis._headers = {};\n\n\t\t\t\t\t\t\tif (this._send === true || ready.test(this.readyState)) {\n\t\t\t\t\t\t\t\tthis._send = false;\n\t\t\t\t\t\t\t\tstate(this, DONE);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tdispatch(this, \"abort\");\n\t\t\t\t\t\t\tthis.readyState = UNSENT;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tkey: \"getAllResponseHeaders\",\n\n\t\t\t\t\t/**\r\n      * Gets all response headers\r\n      *\r\n      * @method getAllResponseHeaders\r\n      * @memberOf XMLHttpRequest\r\n      * @return {Object} Response headers\r\n      */\n\t\t\t\t\tvalue: function getAllResponseHeaders() {\n\t\t\t\t\t\tvar result = \"\";\n\n\t\t\t\t\t\tif (this.readyState < HEADERS_RECEIVED) {\n\t\t\t\t\t\t\tthrow new Error(label.invalidStateNoHeaders);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tutility.iterate(this._resheaders, function (v, k) {\n\t\t\t\t\t\t\tresult += k + \": \" + v + \"\\n\";\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tkey: \"getResponseHeader\",\n\n\t\t\t\t\t/**\r\n      * Gets a specific response header\r\n      *\r\n      * @method getResponseHeader\r\n      * @memberOf XMLHttpRequest\r\n      * @param  {String} header Header to get\r\n      * @return {String}        Response header value\r\n      */\n\t\t\t\t\tvalue: function getResponseHeader(header) {\n\t\t\t\t\t\tif (this.readyState < HEADERS_RECEIVED || this._error) {\n\t\t\t\t\t\t\tthrow new Error(label.invalidStateNoHeaders);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn this._resheaders[header] || this._resheaders[header.toLowerCase()];\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tkey: \"open\",\n\n\t\t\t\t\t/**\r\n      * Prepares an XMLHttpRequest instance to make a request\r\n      *\r\n      * @method open\r\n      * @memberOf XMLHttpRequest\r\n      * @param  {String}  method   HTTP method\r\n      * @param  {String}  url      URL to receive request\r\n      * @param  {Boolean} async    [Optional] Asynchronous request\r\n      * @param  {String}  user     [Optional] Basic auth username\r\n      * @param  {String}  password [Optional] Basic auth password\r\n      * @return {Object}           XMLHttpRequest instance\r\n      */\n\t\t\t\t\tvalue: function open(method, url, async, user, password) {\n\t\t\t\t\t\tvar _this33 = this;\n\n\t\t\t\t\t\tif (async !== true) {\n\t\t\t\t\t\t\tthrow new Error(label.invalidStateNoSync);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.abort();\n\t\t\t\t\t\tthis._error = false;\n\t\t\t\t\t\tthis._params = {\n\t\t\t\t\t\t\tmethod: method,\n\t\t\t\t\t\t\turl: url,\n\t\t\t\t\t\t\tasync: async || true,\n\t\t\t\t\t\t\tuser: user || null,\n\t\t\t\t\t\t\tpassword: password || null\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tutility.iterate(headers, function (v, k) {\n\t\t\t\t\t\t\t_this33._headers[k] = v;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.readyState = OPENED;\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tkey: \"overrideMimeType\",\n\n\t\t\t\t\t/**\r\n      * Overrides the Content-Type of the request\r\n      *\r\n      * @method overrideMimeType\r\n      * @memberOf XMLHttpRequest\r\n      * @param  {String} mime Mime type of the request ( media type )\r\n      * @return {Object}      XMLHttpRequest instance\r\n      */\n\t\t\t\t\tvalue: function overrideMimeType(mime) {\n\t\t\t\t\t\tthis._headers[\"content-type\"] = mime;\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tkey: \"send\",\n\n\t\t\t\t\t/**\r\n      * Sends an XMLHttpRequest request\r\n      *\r\n      * @method send\r\n      * @memberOf XMLHttpRequest\r\n      * @param  {Mixed} data [Optional] Payload to send with the request\r\n      * @return {Object}     XMLHttpRequest instance\r\n      */\n\t\t\t\t\tvalue: function send() {\n\t\t\t\t\t\tvar _this34 = this;\n\n\t\t\t\t\t\tvar data = arguments[0] === undefined ? null : arguments[0];\n\n\t\t\t\t\t\tvar options = undefined,\n\t\t\t\t\t\t    parsed = undefined,\n\t\t\t\t\t\t    request = undefined,\n\t\t\t\t\t\t    obj = undefined;\n\n\t\t\t\t\t\tif (this.readyState < OPENED) {\n\t\t\t\t\t\t\tthrow new Error(label.invalidStateNotOpen);\n\t\t\t\t\t\t} else if (this._send) {\n\t\t\t\t\t\t\tthrow new Error(label.invalidStateNotSending);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tparsed = utility.parse(this._params.url);\n\t\t\t\t\t\tparsed.port = parsed.port || (parsed.protocol === \"https:\" ? 443 : 80);\n\n\t\t\t\t\t\tif (this._params.user !== null && this._params.password !== null) {\n\t\t\t\t\t\t\tparsed.auth = this._params.user + \":\" + this._params.password;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Specifying Content-Length accordingly\n\t\t\t\t\t\tif (regex.put_post.test(this._params.method)) {\n\t\t\t\t\t\t\tif (data === null) {\n\t\t\t\t\t\t\t\tthis._headers[\"content-length\"] = 0;\n\t\t\t\t\t\t\t} else if (typeof data === \"string\") {\n\t\t\t\t\t\t\t\tthis._headers[\"content-length\"] = Buffer.byteLength(data);\n\t\t\t\t\t\t\t} else if (data instanceof Buffer || typeof data.toString === \"function\") {\n\t\t\t\t\t\t\t\tdata = data.toString();\n\t\t\t\t\t\t\t\tthis._headers[\"content-length\"] = Buffer.byteLength(data);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthrow new Error(label.invalidArguments);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis._headers.host = parsed.host;\n\n\t\t\t\t\t\tif (this._headers[\"x-requested-with\"] === \"XMLHttpRequest\") {\n\t\t\t\t\t\t\tdelete this._headers[\"x-requested-with\"];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\toptions = {\n\t\t\t\t\t\t\thostname: parsed.hostname,\n\t\t\t\t\t\t\tpath: parsed.path,\n\t\t\t\t\t\t\tport: parsed.port,\n\t\t\t\t\t\t\tmethod: this._params.method,\n\t\t\t\t\t\t\theaders: this._headers\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tif (parsed.protocol === \"https:\") {\n\t\t\t\t\t\t\toptions.rejectUnauthorized = false;\n\t\t\t\t\t\t\toptions.agent = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (parsed.auth) {\n\t\t\t\t\t\t\toptions.auth = parsed.auth;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis._send = true;\n\t\t\t\t\t\tdispatch(this, \"readystatechange\");\n\n\t\t\t\t\t\tobj = parsed.protocol === \"http:\" ? http : https;\n\n\t\t\t\t\t\trequest = obj.request(options, function (arg) {\n\t\t\t\t\t\t\tsuccess(_this34, arg);\n\t\t\t\t\t\t}).on(\"error\", function (e) {\n\t\t\t\t\t\t\tfailure(_this34, e);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tdata === null ? request.setSocketKeepAlive(true) : request.write(data, \"utf8\");\n\t\t\t\t\t\tthis._request = request;\n\t\t\t\t\t\trequest.end();\n\n\t\t\t\t\t\tdispatch(this, \"loadstart\");\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tkey: \"setRequestHeader\",\n\n\t\t\t\t\t/**\r\n      * Sets a request header of an XMLHttpRequest instance\r\n      *\r\n      * @method setRequestHeader\r\n      * @memberOf XMLHttpRequest\r\n      * @param {String} header HTTP header\r\n      * @param {String} value  Header value\r\n      * @return {Object}       XMLHttpRequest instance\r\n      */\n\t\t\t\t\tvalue: function setRequestHeader(header, value) {\n\t\t\t\t\t\tif (this.readyState !== OPENED) {\n\t\t\t\t\t\t\tthrow new Error(label.invalidStateNotUsable);\n\t\t\t\t\t\t} else if (this._send) {\n\t\t\t\t\t\t\tthrow new Error(label.invalidStateNotSending);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis._headers[header.toLowerCase()] = value;\n\n\t\t\t\t\t\treturn this;\n\t\t\t\t\t}\n\t\t\t\t}]);\n\n\t\t\t\treturn XMLHttpRequest;\n\t\t\t})(Base);\n\n\t\t\treturn XMLHttpRequest;\n\t\t};\n\n\t\t/**\r\n   * WeakMap shim\r\n   *\r\n   * @class\r\n   * @private\r\n   */\n\n\t\tvar WeakMapShim = (function () {\n\t\t\tfunction WeakMapShim() {\n\t\t\t\t_classCallCheck(this, WeakMapShim);\n\n\t\t\t\tthis.elements = {};\n\t\t\t}\n\n\t\t\t_createClass(WeakMapShim, [{\n\t\t\t\tkey: \"clear\",\n\t\t\t\tvalue: function clear() {\n\t\t\t\t\tthis.elements = {};\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"delete\",\n\t\t\t\tvalue: function _delete(arg) {\n\t\t\t\t\tdelete this.elements[arg];\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"has\",\n\t\t\t\tvalue: function has(arg) {\n\t\t\t\t\treturn this.elements[arg] !== undefined;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"get\",\n\t\t\t\tvalue: function get(arg) {\n\t\t\t\t\treturn this.has(arg) ? this.elements[arg].value : undefined;\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tkey: \"set\",\n\t\t\t\tvalue: function set(arg, value) {\n\t\t\t\t\tthis.elements[arg] = { value: value };\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t}]);\n\n\t\t\treturn WeakMapShim;\n\t\t})();\n\n\t\t/**\r\n   * @namespace xml\r\n   * @private\r\n   */\n\t\tvar xml = {\n\t\t\t/**\r\n    * Returns XML (Document) Object from a String\r\n    *\r\n    * @method decode\r\n    * @memberOf xml\r\n    * @param  {String} arg XML String\r\n    * @return {Object}     XML Object or undefined\r\n    */\n\t\t\tdecode: function decode(arg) {\n\t\t\t\treturn new DOMParser().parseFromString(arg, \"text/xml\");\n\t\t\t},\n\n\t\t\t/**\r\n    * Returns XML String from an Object or Array\r\n    *\r\n    * @method encode\r\n    * @memberOf xml\r\n    * @param  {Mixed} arg Object or Array to cast to XML String\r\n    * @return {String}    XML String or undefined\r\n    */\n\t\t\tencode: function encode(arg) {\n\t\t\t\tvar wrap = arguments[1] === undefined ? true : arguments[1];\n\t\t\t\tvar top = arguments[2] === undefined ? true : arguments[2];\n\t\t\t\tvar key = arguments[3] === undefined ? \"\" : arguments[3];\n\n\t\t\t\tvar x = wrap ? \"<\" + (key || \"xml\") + \">\" : \"\";\n\n\t\t\t\tif (arg !== null && arg.xml) {\n\t\t\t\t\targ = arg.xml;\n\t\t\t\t}\n\n\t\t\t\tif (client.doc && arg instanceof Document) {\n\t\t\t\t\targ = new XMLSerializer().serializeToString(arg);\n\t\t\t\t}\n\n\t\t\t\tif (regex.boolean_number_string.test(typeof arg)) {\n\t\t\t\t\tx += xml.node(isNaN(key) ? key : \"item\", arg);\n\t\t\t\t} else if (arg === null || arg === undefined) {\n\t\t\t\t\tx += \"null\";\n\t\t\t\t} else if (arg instanceof Array) {\n\t\t\t\t\tarray.each(arg, function (v) {\n\t\t\t\t\t\tx += xml.encode(v, typeof v === \"object\", false, \"item\");\n\t\t\t\t\t});\n\t\t\t\t} else if (arg instanceof Object) {\n\t\t\t\t\tutility.iterate(arg, function (v, k) {\n\t\t\t\t\t\tx += xml.encode(v, typeof v === \"object\", false, k);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tx += wrap ? \"</\" + (key || \"xml\") + \">\" : \"\";\n\n\t\t\t\tif (top) {\n\t\t\t\t\tx = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF8\\\"?>\" + x;\n\t\t\t\t}\n\n\t\t\t\treturn x;\n\t\t\t},\n\n\t\t\t/**\r\n    * Encodes a value as a node\r\n    *\r\n    * @method node\r\n    * @memberOf xml\r\n    * @param  {String} name  Node name\r\n    * @param  {String} value Node value\r\n    * @return {String}       Node\r\n    */\n\t\t\tnode: function node(name, value) {\n\t\t\t\treturn \"<n>v</n>\".replace(\"v\", regex.cdata.test(value) ? \"<![CDATA[\" + value + \"]]>\" : value).replace(/<(\\/)?n>/g, \"<$1\" + name + \">\");\n\t\t\t},\n\n\t\t\t/**\r\n    * Validates `arg` is XML\r\n    *\r\n    * @method valid\r\n    * @memberOf xml\r\n    * @param  {String} arg String to validate\r\n    * @return {Boolean}    `true` if valid XML\r\n    */\n\t\t\tvalid: function valid(arg) {\n\t\t\t\treturn xml.decode(arg).getElementsByTagName(\"parsererror\").length === 0;\n\t\t\t}\n\t\t};\n\n\t\t/**\r\n   * Bootstraps environment\r\n   *\r\n   * @method bootstrap\r\n   * @private\r\n   * @return {Undefined} undefined\r\n   */\n\t\tvar bootstrap = function bootstrap() {\n\t\t\t// ES6 Array shims\n\t\t\tif (Array.from === undefined) {\n\t\t\t\tArray.from = function (arg) {\n\t\t\t\t\treturn [].slice.call(arg);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Describing the Client\n\t\t\tif (!server) {\n\t\t\t\tclient.version = client.version();\n\n\t\t\t\tif (client.ie && client.version < 10) {\n\t\t\t\t\tthrow new Error(label.upgrade);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// XHR shim\n\t\t\t\tXMLHttpRequest = xhr();\n\t\t\t}\n\n\t\t\t// WeakMap shim for client & server\n\t\t\tif (WeakMap === null) {\n\t\t\t\tWeakMap = WeakMapShim;\n\t\t\t}\n\n\t\t\t// DataStore Worker \"script\"\n\t\t\tif (webWorker) {\n\t\t\t\ttry {\n\t\t\t\t\tWORKER = global.URL.createObjectURL(utility.blob(\"var \" + string.fromObject(array, \"array\") + \", \" + string.fromObject(regex, \"regex\") + \", \" + string.fromObject(string, \"string\") + \", \" + string.fromObject(utility, \"utility\") + \"; onmessage = \" + store.worker.toString() + \";\"));\n\t\t\t\t} catch (e) {\n\t\t\t\t\twebWorker = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tTIME = new Date().getTime();\n\n\t\t\t// Setting up `utility.render()`\n\t\t\tif (global.requestAnimationFrame !== undefined) {\n\t\t\t\tRENDER = global.requestAnimationFrame;\n\t\t\t} else {\n\t\t\t\tRENDER = function (fn) {\n\t\t\t\t\tvar offset = new Date().getTime() - TIME;\n\n\t\t\t\t\tutility.defer(function () {\n\t\t\t\t\t\tfn(offset);\n\t\t\t\t\t}, 16, offset);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!server) {\n\t\t\t\tutility.banner();\n\t\t\t}\n\t\t};\n\n\t\t// Bootstrapping\n\t\tbootstrap();\n\n\t\t// Interface\n\t\treturn {\n\t\t\tfilter: filter,\n\t\t\tlist: list.factory,\n\t\t\tgrid: grid,\n\t\t\tstore: store.factory,\n\t\t\tutil: {\n\t\t\t\t$: utility.$,\n\t\t\t\tarray: array,\n\t\t\t\tbanner: utility.banner,\n\t\t\t\tbase: utility.base,\n\t\t\t\tclearTimers: utility.clearTimers,\n\t\t\t\tclone: utility.clone,\n\t\t\t\tcoerce: utility.coerce,\n\t\t\t\tcurry: utility.curry,\n\t\t\t\tcsv: csv,\n\t\t\t\tdefer: deferred,\n\t\t\t\tdelay: utility.defer,\n\t\t\t\telement: element,\n\t\t\t\tequal: utility.equal,\n\t\t\t\textend: utility.extend,\n\t\t\t\tgenId: utility.genId,\n\t\t\t\titerate: utility.iterate,\n\t\t\t\tjson: json,\n\t\t\t\tjsonp: client.jsonp,\n\t\t\t\tlog: utility.log,\n\t\t\t\tlru: lru.factory,\n\t\t\t\tmath: math,\n\t\t\t\tmerge: utility.merge,\n\t\t\t\tnext: utility.delay,\n\t\t\t\tnumber: number,\n\t\t\t\tobserver: observable,\n\t\t\t\tparse: utility.parse,\n\t\t\t\tpartial: utility.partial,\n\t\t\t\tprevent: utility.prevent,\n\t\t\t\tqueryString: utility.queryString,\n\t\t\t\trace: utility.race,\n\t\t\t\tregex: regex,\n\t\t\t\trender: utility.render,\n\t\t\t\trepeat: utility.repeat,\n\t\t\t\trequest: client.request,\n\t\t\t\tstop: utility.stop,\n\t\t\t\tstring: string,\n\t\t\t\ttarget: utility.target,\n\t\t\t\tuuid: utility.uuid,\n\t\t\t\twalk: utility.walk,\n\t\t\t\twhen: utility.when,\n\t\t\t\txml: xml\n\t\t\t},\n\t\t\tversion: \"1.3.18\"\n\t\t};\n\t})();\n\n\t// Node, AMD & window supported\n\tif (typeof exports !== \"undefined\") {\n\t\tmodule.exports = lib;\n\t} else if (typeof define === \"function\") {\n\t\tdefine(function () {\n\t\t\treturn lib;\n\t\t});\n\t} else {\n\t\tglobal.keigai = lib;\n\t}\n})(typeof global !== \"undefined\" ? global : window);"]}